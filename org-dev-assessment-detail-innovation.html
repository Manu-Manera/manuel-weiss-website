<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Innovation & Lernen - Organisationsentwicklung Assessment - Manuel Weiss</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Detaillierte Bewertung der innovation & lernen für Organisationsentwicklung.">
    <meta name="keywords" content="Innovation, Lernen, Organisationsentwicklung">
    <meta name="author" content="Manuel Weiss">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/ki-assessment-detail.css">
    <style>
        .detail-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .criterion-icon {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .detail-slider::-webkit-slider-thumb {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .detail-slider::-moz-range-thumb {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .sub-criterion-slider::-webkit-slider-thumb {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .sub-criterion-slider::-moz-range-thumb {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .slider-value-display {
            color: #7c3aed;
        }
        
        .sub-criterion-value {
            color: #7c3aed;
        }
        
        .criterion-average-value {
            color: #7c3aed;
        }
        
        .aggregated-score {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }
        
        .save-button {
            color: #7c3aed;
        }
        
        .criterion-examples {
            border-left: 4px solid #8b5cf6;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="manuel-weiss-photo.svg" alt="Manuel Weiss" class="nav-logo">
                <span class="nav-name">Manuel Weiss</span>
            </div>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="hr-transformation.html">HR-Transformation</a>
                <a href="index.html#about">Über mich</a>
                <a href="index.html#contact">Kontakt</a>
            </div>
        </div>
    </nav>
    
    <div class="detail-assessment-container">
        <div class="detail-header">
            <a href="organisationsentwicklung-workflow.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
                Zurück zur Übersicht
            </a>
            <h1><i class="fas fa-lightbulb"></i> Innovation & Lernen</h1>
            <p>Bewerten Sie Innovation und Lernen in Ihrer Organisation. Wissenschaftlich fundierte Bewertung basierend auf modernen Innovations-Prinzipien.</p>
        </div>
        
        <div id="criteriaContainer">
            <!-- Criteria will be dynamically loaded -->
        </div>
        
        <div class="aggregated-score">
            <h3>Gesamtbewertung</h3>
            <div class="score-display">
                <div class="score-circle-large" id="aggregatedScore">1.0</div>
                <div class="score-description" id="scoreDescription">Bewerten Sie die Kriterien, um Ihre Gesamtbewertung zu sehen</div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                <button class="save-button" onclick="saveAndReturn()" style="flex: 1; min-width: 200px;">
                    <i class="fas fa-save"></i> Bewertung speichern und zurück
                </button>
                <button class="export-button excel" onclick="exportToExcel()" style="background: #217346; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; flex: 1; min-width: 150px;">
                    <i class="fas fa-file-excel"></i> Excel Export
                </button>
                <button class="export-button pdf" onclick="exportToPDF()" style="background: #dc3545; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; flex: 1; min-width: 150px;">
                    <i class="fas fa-file-pdf"></i> PDF Export
                </button>
            </div>
        </div>
    </div>
    
    <script>
        const innovationCriteria = [            {
                id: 'innovationStrategy',
                title: 'Innovations-Strategie',
                description: 'Wie gut ist die Innovations-Strategie?',
                icon: 'fa-lightbulb',
                subCriteria: [
                    { 
                        id: 'innovationVision', 
                        title: 'Innovations-Vision',
                        description: 'Gibt es eine Innovations-Vision?',
                        examples: ['Vision', 'Strategie', 'Ausrichtung', 'Ziele']
                    },
                    { 
                        id: 'innovationGoals', 
                        title: 'Innovations-Ziele',
                        description: 'Gibt es klare Innovations-Ziele?',
                        examples: ['Ziele', 'KPIs', 'Metriken', 'Targets']
                    },
                    { 
                        id: 'innovationRoadmap', 
                        title: 'Innovations-Roadmap',
                        description: 'Gibt es eine Innovations-Roadmap?',
                        examples: ['Roadmap', 'Planung', 'Timeline', 'Strategie']
                    },
                    { 
                        id: 'innovationBudget', 
                        title: 'Innovations-Budget',
                        description: 'Gibt es ein Innovations-Budget?',
                        examples: ['Budget', 'Ressourcen', 'Investitionen', 'Mittel']
                    },
                    { 
                        id: 'innovationMetrics', 
                        title: 'Innovations-Metriken',
                        description: 'Gibt es Innovations-Metriken?',
                        examples: ['Metriken', 'KPIs', 'Messung', 'Tracking']
                    }
                ]
            },
            {
                id: 'innovationCulture',
                title: 'Innovationskultur',
                description: 'Wie stark ist die Innovationskultur?',
                icon: 'fa-brain',
                subCriteria: [
                    { 
                        id: 'innovationMindset', 
                        title: 'Innovations-Mindset',
                        description: 'Gibt es ein Innovations-Mindset?',
                        examples: ['Mindset', 'Kreativität', 'Innovation', 'Experimentierfreude']
                    },
                    { 
                        id: 'riskTolerance', 
                        title: 'Risikotoleranz',
                        description: 'Wie hoch ist die Risikotoleranz?',
                        examples: ['Risikobereitschaft', 'Fehlertoleranz', 'Experimente', 'Mut']
                    },
                    { 
                        id: 'failureAcceptance', 
                        title: 'Fehlerakzeptanz',
                        description: 'Werden Fehler akzeptiert?',
                        examples: ['Fehlerakzeptanz', 'Lernen', 'Verbesserung', 'Resilienz']
                    },
                    { 
                        id: 'curiosity', 
                        title: 'Neugier und Exploration',
                        description: 'Gibt es Neugier?',
                        examples: ['Neugier', 'Exploration', 'Entdeckung', 'Forschung']
                    },
                    { 
                        id: 'experimentationMindset', 
                        title: 'Experimentier-Mindset',
                        description: 'Gibt es ein Experimentier-Mindset?',
                        examples: ['Experimente', 'Test & Learn', 'Pilot-Projekte', 'Innovation']
                    }
                ]
            },
            {
                id: 'ideaManagement',
                title: 'Ideenmanagement',
                description: 'Wie gut ist das Ideenmanagement?',
                icon: 'fa-lightbulb',
                subCriteria: [
                    { 
                        id: 'ideaGeneration', 
                        title: 'Ideen-Generierung',
                        description: 'Wie gut ist die Ideen-Generierung?',
                        examples: ['Ideen', 'Kreativität', 'Brainstorming', 'Innovation']
                    },
                    { 
                        id: 'ideaPlatforms', 
                        title: 'Ideen-Plattformen',
                        description: 'Gibt es Ideen-Plattformen?',
                        examples: ['Plattformen', 'Tools', 'Systeme', 'Technologie']
                    },
                    { 
                        id: 'ideaEvaluation', 
                        title: 'Ideen-Bewertung',
                        description: 'Wie gut ist die Ideen-Bewertung?',
                        examples: ['Bewertung', 'Evaluation', 'Analyse', 'Screening']
                    },
                    { 
                        id: 'ideaImplementation', 
                        title: 'Ideen-Umsetzung',
                        description: 'Wie gut ist die Ideen-Umsetzung?',
                        examples: ['Umsetzung', 'Implementation', 'Realisation', 'Execution']
                    },
                    { 
                        id: 'ideaRecognition', 
                        title: 'Ideen-Anerkennung',
                        description: 'Gibt es Ideen-Anerkennung?',
                        examples: ['Anerkennung', 'Recognition', 'Belohnungen', 'Incentives']
                    }
                ]
            },
            {
                id: 'innovationProcesses',
                title: 'Innovations-Prozesse',
                description: 'Wie gut sind Innovations-Prozesse?',
                icon: 'fa-cogs',
                subCriteria: [
                    { 
                        id: 'structuredProcess', 
                        title: 'Strukturierte Innovations-Prozesse',
                        description: 'Gibt es strukturierte Prozesse?',
                        examples: ['Prozesse', 'Struktur', 'Methodologie', 'Framework']
                    },
                    { 
                        id: 'stageGate', 
                        title: 'Stage-Gate Prozess',
                        description: 'Gibt es einen Stage-Gate Prozess?',
                        examples: ['Stage-Gate', 'Phasen', 'Gates', 'Prozess']
                    },
                    { 
                        id: 'rapidPrototyping', 
                        title: 'Rapid Prototyping',
                        description: 'Gibt es Rapid Prototyping?',
                        examples: ['Prototyping', 'Schnell', 'Iterativ', 'Agil']
                    },
                    { 
                        id: 'pilotProjects', 
                        title: 'Pilot-Projekte',
                        description: 'Gibt es Pilot-Projekte?',
                        examples: ['Pilot', 'Test', 'Experiment', 'Validierung']
                    },
                    { 
                        id: 'scalingProcess', 
                        title: 'Skalierungs-Prozess',
                        description: 'Gibt es einen Skalierungs-Prozess?',
                        examples: ['Skalierung', 'Wachstum', 'Expansion', 'Rollout']
                    }
                ]
            },
            {
                id: 'innovationTeams',
                title: 'Innovations-Teams',
                description: 'Wie gut sind Innovations-Teams?',
                icon: 'fa-users',
                subCriteria: [
                    { 
                        id: 'dedicatedTeams', 
                        title: 'Dedizierte Innovations-Teams',
                        description: 'Gibt es dedizierte Teams?',
                        examples: ['Teams', 'Dediziert', 'Spezialisiert', 'Fokussiert']
                    },
                    { 
                        id: 'innovationLabs', 
                        title: 'Innovation Labs und Hubs',
                        description: 'Gibt es Innovation Labs?',
                        examples: ['Labs', 'Hubs', 'Zentren', 'Räume']
                    },
                    { 
                        id: 'crossFunctionalInnovation', 
                        title: 'Cross-funktionale Innovations-Teams',
                        description: 'Gibt es cross-funktionale Teams?',
                        examples: ['Cross-Functional', 'Interdisziplinär', 'Verschiedene Bereiche']
                    },
                    { 
                        id: 'innovationChampions', 
                        title: 'Innovation Champions',
                        description: 'Gibt es Innovation Champions?',
                        examples: ['Champions', 'Botschafter', 'Treiber', 'Promotoren']
                    },
                    { 
                        id: 'teamAutonomy', 
                        title: 'Team-Autonomie',
                        description: 'Haben Teams Autonomie?',
                        examples: ['Autonomie', 'Freiheit', 'Selbstbestimmung', 'Empowerment']
                    }
                ]
            },
            {
                id: 'learningOrganization',
                title: 'Lernende Organisation',
                description: 'Wie lernend ist die Organisation?',
                icon: 'fa-graduation-cap',
                subCriteria: [
                    { 
                        id: 'continuousLearning', 
                        title: 'Kontinuierliches Lernen',
                        description: 'Gibt es kontinuierliches Lernen?',
                        examples: ['Lernen', 'Entwicklung', 'Wachstum', 'Bildung']
                    },
                    { 
                        id: 'learningFromFailure', 
                        title: 'Lernen aus Fehlern',
                        description: 'Wird aus Fehlern gelernt?',
                        examples: ['Fehleranalyse', 'Lessons Learned', 'Verbesserung', 'Lernen']
                    },
                    { 
                        id: 'knowledgeManagement', 
                        title: 'Wissensmanagement',
                        description: 'Gibt es Wissensmanagement?',
                        examples: ['Wissen', 'Management', 'Sharing', 'Dokumentation']
                    },
                    { 
                        id: 'bestPractices', 
                        title: 'Best Practices Sharing',
                        description: 'Gibt es Best Practices Sharing?',
                        examples: ['Best Practices', 'Sharing', 'Austausch', 'Lernen']
                    },
                    { 
                        id: 'reflectionCulture', 
                        title: 'Reflexions-Kultur',
                        description: 'Gibt es eine Reflexions-Kultur?',
                        examples: ['Reflexion', 'Review', 'Retrospektive', 'Lernen']
                    }
                ]
            },
            {
                id: 'externalInnovation',
                title: 'Externe Innovation',
                description: 'Wie gut ist externe Innovation?',
                icon: 'fa-network-wired',
                subCriteria: [
                    { 
                        id: 'openInnovation', 
                        title: 'Open Innovation',
                        description: 'Gibt es Open Innovation?',
                        examples: ['Open Innovation', 'Externe Ideen', 'Partnerschaften', 'Kooperationen']
                    },
                    { 
                        id: 'startupPartnerships', 
                        title: 'Startup-Partnerschaften',
                        description: 'Gibt es Startup-Partnerschaften?',
                        examples: ['Startups', 'Partnerschaften', 'Kooperationen', 'Netzwerke']
                    },
                    { 
                        id: 'universityCooperation', 
                        title: 'Universitätskooperationen',
                        description: 'Gibt es Universitätskooperationen?',
                        examples: ['Universitäten', 'Forschung', 'Kooperationen', 'Netzwerke']
                    },
                    { 
                        id: 'innovationNetworks', 
                        title: 'Innovations-Netzwerke',
                        description: 'Gibt es Innovations-Netzwerke?',
                        examples: ['Netzwerke', 'Communities', 'Partnerschaften', 'Kooperationen']
                    },
                    { 
                        id: 'externalIdeas', 
                        title: 'Externe Ideen-Integration',
                        description: 'Werden externe Ideen integriert?',
                        examples: ['Externe Ideen', 'Integration', 'Openness', 'Partnerschaften']
                    }
                ]
            },
            {
                id: 'innovationResources',
                title: 'Innovations-Ressourcen',
                description: 'Wie gut sind Innovations-Ressourcen?',
                icon: 'fa-tools',
                subCriteria: [
                    { 
                        id: 'dedicatedBudget', 
                        title: 'Dediziertes Innovations-Budget',
                        description: 'Gibt es ein dediziertes Budget?',
                        examples: ['Budget', 'Ressourcen', 'Investitionen', 'Mittel']
                    },
                    { 
                        id: 'timeForInnovation', 
                        title: 'Zeit für Innovation',
                        description: 'Gibt es Zeit für Innovation?',
                        examples: ['Zeit', 'Freiheit', 'Räume', 'Möglichkeiten']
                    },
                    { 
                        id: 'innovationTools', 
                        title: 'Innovations-Tools und -Technologie',
                        description: 'Gibt es Innovations-Tools?',
                        examples: ['Tools', 'Technologie', 'Plattformen', 'Software']
                    },
                    { 
                        id: 'innovationSpaces', 
                        title: 'Innovations-Räume',
                        description: 'Gibt es Innovations-Räume?',
                        examples: ['Räume', 'Labs', 'Hubs', 'Environments']
                    },
                    { 
                        id: 'expertise', 
                        title: 'Innovations-Expertise',
                        description: 'Gibt es Innovations-Expertise?',
                        examples: ['Expertise', 'Kompetenzen', 'Skills', 'Wissen']
                    }
                ]
            },
            {
                id: 'innovationMeasurement',
                title: 'Innovations-Messung',
                description: 'Wie gut wird Innovation gemessen?',
                icon: 'fa-chart-line',
                subCriteria: [
                    { 
                        id: 'innovationKPIs', 
                        title: 'Innovations-KPIs',
                        description: 'Gibt es Innovations-KPIs?',
                        examples: ['KPIs', 'Metriken', 'Messung', 'Tracking']
                    },
                    { 
                        id: 'roiMeasurement', 
                        title: 'ROI-Messung',
                        description: 'Wird ROI gemessen?',
                        examples: ['ROI', 'Return', 'Impact', 'Wert']
                    },
                    { 
                        id: 'innovationPortfolio', 
                        title: 'Innovations-Portfolio',
                        description: 'Gibt es ein Innovations-Portfolio?',
                        examples: ['Portfolio', 'Übersicht', 'Management', 'Tracking']
                    },
                    { 
                        id: 'successMetrics', 
                        title: 'Erfolgs-Metriken',
                        description: 'Gibt es Erfolgs-Metriken?',
                        examples: ['Erfolg', 'Metriken', 'Messung', 'Evaluation']
                    },
                    { 
                        id: 'benchmarking', 
                        title: 'Benchmarking',
                        description: 'Gibt es Benchmarking?',
                        examples: ['Benchmarking', 'Vergleich', 'Best Practices', 'Standards']
                    }
                ]
            },
            {
                id: 'digitalInnovation',
                title: 'Digitale Innovation',
                description: 'Wie gut ist digitale Innovation?',
                icon: 'fa-digital-tacho',
                subCriteria: [
                    { 
                        id: 'digitalTransformation', 
                        title: 'Digitale Transformation',
                        description: 'Gibt es digitale Transformation?',
                        examples: ['Digital', 'Transformation', 'Innovation', 'Technologie']
                    },
                    { 
                        id: 'aiML', 
                        title: 'KI & Machine Learning',
                        description: 'Gibt es KI & ML?',
                        examples: ['KI', 'Machine Learning', 'AI', 'Technologie']
                    },
                    { 
                        id: 'dataAnalytics', 
                        title: 'Data Analytics & Insights',
                        description: 'Gibt es Data Analytics?',
                        examples: ['Analytics', 'Daten', 'Insights', 'Intelligence']
                    },
                    { 
                        id: 'automation', 
                        title: 'Automatisierung',
                        description: 'Gibt es Automatisierung?',
                        examples: ['Automatisierung', 'RPA', 'Effizienz', 'Technologie']
                    },
                    { 
                        id: 'digitalTools', 
                        title: 'Digitale Innovations-Tools',
                        description: 'Gibt es digitale Tools?',
                        examples: ['Tools', 'Plattformen', 'Software', 'Technologie']
                    }
                ]
            }
        ];
        
        let assessmentData = {};
        let assessmentExporter = null;
        
        function initializeAssessment() {
            // Load saved data
            const saved = localStorage.getItem('orgDevDetailAssessments');
            if (saved) {
                const allAssessments = JSON.parse(saved);
                if (allAssessments.innovation) {
                    assessmentData = allAssessments.innovation;
                }
            }
            
            // Initialize assessment data structure
            innovationCriteria.forEach(criterion => {
                if (!assessmentData[criterion.id]) {
                    assessmentData[criterion.id] = {};
                }
                criterion.subCriteria.forEach(subCriterion => {
                    if (!assessmentData[criterion.id][subCriterion.id]) {
                        assessmentData[criterion.id][subCriterion.id] = 1;
                    }
                });
            });
            
            renderCriteria();
            updateAggregatedScore();
            assessmentExporter = new AssessmentExporter();
        }
        
        function renderCriteria() {
            const container = document.getElementById('criteriaContainer');
            container.innerHTML = '';
            
            innovationCriteria.forEach(criterion => {
                const criterionCard = document.createElement('div');
                criterionCard.className = 'criterion-card';
                
                const averageScore = calculateCriterionAverage(criterion.id);
                
                criterionCard.innerHTML = `
                    <div class="criterion-header">
                        <div class="criterion-icon">
                            <i class="fas ${criterion.icon}"></i>
                        </div>
                        <div class="criterion-title-section">
                            <h3 class="criterion-title">${criterion.title}</h3>
                            <p class="criterion-description">${criterion.description}</p>
                        </div>
                        <div class="criterion-average">
                            <div class="criterion-average-value">${averageScore.toFixed(1)}</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">Durchschnitt</div>
                        </div>
                    </div>
                    
                    <div class="sub-criteria-container">
                        ${criterion.subCriteria.map(subCriterion => {
                            const value = assessmentData[criterion.id][subCriterion.id] || 1;
                            return `
                                <div class="sub-criterion-item">
                                    <div class="sub-criterion-label">
                                        <h4>${subCriterion.title}</h4>
                                        <p>${subCriterion.description}</p>
                                        <div class="criterion-examples">
                                            <strong>Beispiele:</strong>
                                            <ul>
                                                ${subCriterion.examples.map(ex => `<li>${ex}</li>`).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="sub-criterion-slider-wrapper">
                                        <input type="range" min="1" max="5" value="${value}" 
                                               class="sub-criterion-slider" 
                                               id="${criterion.id}_${subCriterion.id}"
                                               oninput="updateSubCriterionValue('${criterion.id}', '${subCriterion.id}', this.value)">
                                        <div class="sub-criterion-value">${value}</div>
                                        <div class="sub-criterion-scale">
                                            <span>1</span>
                                            <span>2</span>
                                            <span>3</span>
                                            <span>4</span>
                                            <span>5</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                container.appendChild(criterionCard);
            });
        }
        
        function updateSubCriterionValue(criterionId, subCriterionId, value) {
            if (!assessmentData[criterionId]) {
                assessmentData[criterionId] = {};
            }
            assessmentData[criterionId][subCriterionId] = parseInt(value);
            
            const valueDisplay = document.querySelector(`#${criterionId}_${subCriterionId}`).nextElementSibling;
            if (valueDisplay) {
                valueDisplay.textContent = value;
            }
            
            updateCriterionAverage(criterionId);
            updateAggregatedScore();
            saveAssessment().catch(err => console.warn('Fehler beim Speichern:', err));
        }
        
        function calculateCriterionAverage(criterionId) {
            const criterion = innovationCriteria.find(c => c.id === criterionId);
            if (!criterion || !assessmentData[criterionId]) return 1.0;
            
            const values = criterion.subCriteria.map(sub => 
                assessmentData[criterionId][sub.id] || 1
            );
            const sum = values.reduce((acc, val) => acc + val, 0);
            return sum / values.length;
        }
        
        function updateCriterionAverage(criterionId) {
            const average = calculateCriterionAverage(criterionId);
            const criterionCard = document.querySelector(`.criterion-card:has(#${criterionId}_${innovationCriteria.find(c => c.id === criterionId).subCriteria[0].id})`);
            if (criterionCard) {
                const averageDisplay = criterionCard.querySelector('.criterion-average-value');
                if (averageDisplay) {
                    averageDisplay.textContent = average.toFixed(1);
                }
            }
        }
        
        function updateAggregatedScore() {
            const averages = innovationCriteria.map(c => calculateCriterionAverage(c.id));
            const overallAverage = averages.reduce((acc, val) => acc + val, 0) / averages.length;
            
            const scoreDisplay = document.getElementById('aggregatedScore');
            const descriptionDisplay = document.getElementById('scoreDescription');
            
            if (scoreDisplay) {
                scoreDisplay.textContent = overallAverage.toFixed(1);
            }
            
            if (descriptionDisplay) {
                let description = '';
                if (overallAverage <= 1.5) {
                    description = 'Schwache Innovation - Erhebliche Verbesserung nötig';
                } else if (overallAverage <= 2.5) {
                    description = 'Teilweise entwickelte Innovation - Verbesserungen erforderlich';
                } else if (overallAverage <= 3.5) {
                    description = 'Gute Innovation - Weitere Optimierung möglich';
                } else if (overallAverage <= 4.5) {
                    description = 'Starke Innovation - Kleine Verbesserungen möglich';
                } else {
                    description = 'Hervorragende Innovation - Exzellente Innovationsfähigkeit';
                }
                descriptionDisplay.textContent = description;
            }
        }
        
        async function saveAssessment() {
            const aggregated = parseFloat(innovationCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / innovationCriteria.length).toFixed(1);
            const criterionAverages = innovationCriteria.map(criterion => ({
                criterionId: criterion.id,
                average: calculateCriterionAverage(criterion.id)
            }));
            
            const assessmentDataToSave = {
                aggregated: parseFloat(aggregated),
                details: assessmentData,
                criteria: assessmentData, // Legacy support
                criterionAverages: criterionAverages,
                timestamp: new Date().toISOString()
            };
            
            // Speichere in localStorage
            const allAssessments = JSON.parse(localStorage.getItem('orgDevDetailAssessments') || '{}');
            allAssessments.innovation = assessmentDataToSave;
            localStorage.setItem('orgDevDetailAssessments', JSON.stringify(allAssessments));
            
            // API-Call (mit Fallback - localStorage wurde bereits gespeichert)
            if (window.OrgDevAPI) {
                try {
                    const orgDevAPI = new OrgDevAPI();
                    await orgDevAPI.saveAssessment('innovation', assessmentDataToSave);
                } catch (error) {
                    console.warn('⚠️ API-Speicherung fehlgeschlagen, localStorage wurde verwendet:', error);
                }
            }
        }
        
        function saveAndReturn() {
            const aggregated = parseFloat(innovationCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / innovationCriteria.length).toFixed(1);
            
            // Save detailed assessment
            saveAssessment();
            
            // Also update main workflow (analog zu HR-Strategieentwicklung)
            let workflowData = JSON.parse(localStorage.getItem('orgDevWorkflow') || '{}');
            if (!workflowData.orgDevMaturityData) workflowData.orgDevMaturityData = {};
            workflowData.orgDevMaturityData.innovation = parseFloat(aggregated);
            localStorage.setItem('orgDevWorkflow', JSON.stringify(workflowData));
            
            window.location.href = 'organisationsentwicklung-workflow.html';
        }
        
        async function exportToExcel() {
            if (!assessmentExporter) {
                assessmentExporter = new AssessmentExporter();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            const data = prepareExportData();
            await assessmentExporter.exportToExcel(data, `Organisationsentwicklung-Innovation-&-Lernen-Assessment-${new Date().toISOString().split('T')[0]}`);
        }
        
        async function exportToPDF() {
            try {
                showNotification('PDF wird generiert...', 'info');
                
                if (!assessmentExporter) {
                    assessmentExporter = new AssessmentExporter();
                    await new Promise(resolve => setTimeout(resolve, 1000));
                }
                const data = prepareExportData();
                
                if (assessmentExporter.exportToPDFLambda) {
                    await assessmentExporter.exportToPDFLambda(
                        data, 
                        `Organisationsentwicklung-Innovation-Assessment-${new Date().toISOString().split('T')[0]}`,
                        'Innovation & Lernen'
                    );
                    showNotification('PDF erfolgreich generiert!', 'success');
                } else {
                    await assessmentExporter.exportToPDF(data, `Organisationsentwicklung-Innovation-Assessment-${new Date().toISOString().split('T')[0]}`);
                    showNotification('PDF erfolgreich generiert!', 'success');
                }
            } catch (error) {
                console.error('PDF Export Fehler:', error);
                showNotification('Fehler beim PDF-Export: ' + error.message, 'error');
            }
        }
        
        function showNotification(message, type = 'info') {
            if (typeof window.showNotification === 'function') {
                window.showNotification(message, type);
            } else if (window.UnifiedAWSAuth && window.UnifiedAWSAuth.getInstance) {
                const auth = window.UnifiedAWSAuth.getInstance();
                if (auth && auth.showNotification) {
                    auth.showNotification(message, type);
                } else {
                    alert(message);
                }
            } else {
                alert(message);
            }
        }
        
        function prepareExportData() {
            const aggregated = parseFloat(innovationCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / innovationCriteria.length).toFixed(1);
            
            return {
                dimension: 'innovation',
                dimensionName: 'Innovation & Lernen',
                overall: parseFloat(aggregated),
                criteria: innovationCriteria.map(criterion => ({
                    id: criterion.id,
                    title: criterion.title,
                    description: criterion.description,
                    average: calculateCriterionAverage(criterion.id),
                    subCriteria: criterion.subCriteria.map(sub => ({
                        id: sub.id,
                        title: sub.title,
                        description: sub.description,
                        examples: sub.examples,
                        score: assessmentData[criterion.id][sub.id] || 1
                    }))
                })),
                timestamp: new Date().toISOString()
            };
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initializeAssessment);
    </script>
    
    <!-- Assessment Export Script -->
    <script src="js/assessment-export.js"></script>
    
    <!-- Org Dev API Script -->
    <script src="js/org-dev-api.js"></script>
</body>
</html>
