<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kultur & Werte - Organisationsentwicklung Assessment - Manuel Weiss</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Detaillierte Bewertung der kultur & werte für Organisationsentwicklung.">
    <meta name="keywords" content="Unternehmenskultur, Werte, Kultur-Entwicklung, Organisationsentwicklung">
    <meta name="author" content="Manuel Weiss">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/ki-assessment-detail.css">
    <style>
        .detail-header {
            background: linear-gradient(135deg, #ec4899 0%, #be185d 100%);
        }
        
        .criterion-icon {
            background: linear-gradient(135deg, #ec4899, #be185d);
        }
        
        .detail-slider::-webkit-slider-thumb {
            background: linear-gradient(135deg, #ec4899, #be185d);
        }
        
        .detail-slider::-moz-range-thumb {
            background: linear-gradient(135deg, #ec4899, #be185d);
        }
        
        .sub-criterion-slider::-webkit-slider-thumb {
            background: linear-gradient(135deg, #ec4899, #be185d);
        }
        
        .sub-criterion-slider::-moz-range-thumb {
            background: linear-gradient(135deg, #ec4899, #be185d);
        }
        
        .slider-value-display {
            color: #be185d;
        }
        
        .sub-criterion-value {
            color: #be185d;
        }
        
        .criterion-average-value {
            color: #be185d;
        }
        
        .aggregated-score {
            background: linear-gradient(135deg, #ec4899, #be185d);
        }
        
        .save-button {
            color: #be185d;
        }
        
        .criterion-examples {
            border-left: 4px solid #ec4899;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="manuel-weiss-photo.svg" alt="Manuel Weiss" class="nav-logo">
                <span class="nav-name">Manuel Weiss</span>
            </div>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="hr-transformation.html">HR-Transformation</a>
                <a href="index.html#about">Über mich</a>
                <a href="index.html#contact">Kontakt</a>
            </div>
        </div>
    </nav>
    
    <div class="detail-assessment-container">
        <div class="detail-header">
            <a href="organisationsentwicklung-workflow.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
                Zurück zur Übersicht
            </a>
            <h1><i class="fas fa-heart"></i> Kultur & Werte</h1>
            <p>Bewerten Sie Ihre Unternehmenskultur und Werte. Wissenschaftlich fundierte Bewertung basierend auf modernen Kultur-Entwicklungs-Prinzipien.</p>
        </div>
        
        <div id="criteriaContainer">
            <!-- Criteria will be dynamically loaded -->
        </div>
        
        <div class="aggregated-score">
            <h3>Gesamtbewertung</h3>
            <div class="score-display">
                <div class="score-circle-large" id="aggregatedScore">1.0</div>
                <div class="score-description" id="scoreDescription">Bewerten Sie die Kriterien, um Ihre Gesamtbewertung zu sehen</div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                <button class="save-button" onclick="saveAndReturn()" style="flex: 1; min-width: 200px;">
                    <i class="fas fa-save"></i> Bewertung speichern und zurück
                </button>
                <button class="export-button excel" onclick="exportToExcel()" style="background: #217346; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; flex: 1; min-width: 150px;">
                    <i class="fas fa-file-excel"></i> Excel Export
                </button>
                <button class="export-button pdf" onclick="exportToPDF()" style="background: #dc3545; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; flex: 1; min-width: 150px;">
                    <i class="fas fa-file-pdf"></i> PDF Export
                </button>
            </div>
        </div>
    </div>
    
    <script>
        const cultureCriteria = [
            {
                id: 'coreValues',
                title: 'Kernwerte & Wertebasis',
                description: 'Wie klar sind die Kernwerte definiert und gelebt?',
                icon: 'fa-gem',
                subCriteria: [
                    { 
                        id: 'valuesDefined', 
                        title: 'Definierte und dokumentierte Kernwerte',
                        description: 'Sind die Kernwerte klar definiert und dokumentiert?',
                        examples: ['Werte-Charta vorhanden', 'Werte schriftlich festgehalten', 'Werte kommuniziert']
                    },
                    { 
                        id: 'valuesAlignment', 
                        title: 'Werte-Ausrichtung im gesamten Unternehmen',
                        description: 'Sind alle Bereiche und Mitarbeiter an den Werten ausgerichtet?',
                        examples: ['Konsistente Wertevermittlung', 'Werte in allen Bereichen', 'Alignment über Hierarchien']
                    },
                    { 
                        id: 'valuesIntegration', 
                        title: 'Werte-Integration in Prozesse und Entscheidungen',
                        description: 'Werden Werte in tägliche Prozesse und Entscheidungen integriert?',
                        examples: ['Wertebasierte Entscheidungen', 'Werte in Performance Reviews', 'Werte in Recruiting']
                    },
                    { 
                        id: 'valuesMeasurement', 
                        title: 'Werte-Messung und -Monitoring',
                        description: 'Werden die Werte regelmäßig gemessen und überwacht?',
                        examples: ['Werte-Assessments', 'Kultur-Umfragen', 'Werte-Metriken']
                    },
                    { 
                        id: 'valuesLiving', 
                        title: 'Gelebte Werte im Alltag',
                        description: 'Werden die Werte im täglichen Arbeitsalltag gelebt?',
                        examples: ['Sichtbare Wertepraxis', 'Werte in Interaktionen', 'Authentische Umsetzung']
                    }
                ]
            },
            {
                id: 'culturalIdentity',
                title: 'Kulturelle Identität & Einzigartigkeit',
                description: 'Wie stark und einzigartig ist die kulturelle Identität?',
                icon: 'fa-id-card',
                subCriteria: [
                    { 
                        id: 'strongIdentity', 
                        title: 'Starke und einzigartige Identität',
                        description: 'Gibt es eine starke, wiedererkennbare kulturelle Identität?',
                        examples: ['Klare Identität', 'Einzigartigkeit', 'Wiedererkennungswert']
                    },
                    { 
                        id: 'culturalNarrative', 
                        title: 'Kulturelle Erzählung und Geschichte',
                        description: 'Gibt es eine kulturelle Erzählung, die die Identität prägt?',
                        examples: ['Unternehmensgeschichte', 'Kulturelle Narrative', 'Traditionen']
                    },
                    { 
                        id: 'culturalSymbols', 
                        title: 'Kulturelle Symbole und Rituale',
                        description: 'Gibt es kulturelle Symbole und Rituale, die die Identität stärken?',
                        examples: ['Symbole', 'Rituale', 'Traditionen', 'Kulturelle Praktiken']
                    },
                    { 
                        id: 'culturalCohesion', 
                        title: 'Kulturelle Kohäsion und Zusammenhalt',
                        description: 'Wie stark ist der kulturelle Zusammenhalt?',
                        examples: ['Zusammengehörigkeit', 'Gemeinschaftsgefühl', 'Einheit']
                    },
                    { 
                        id: 'culturalEvolution', 
                        title: 'Kulturelle Evolution und Anpassung',
                        description: 'Kann sich die Kultur weiterentwickeln und anpassen?',
                        examples: ['Kulturelle Weiterentwicklung', 'Anpassungsfähigkeit', 'Evolution']
                    }
                ]
            },
            {
                id: 'trustTransparency',
                title: 'Vertrauen & Transparenz',
                description: 'Wie stark sind Vertrauen und Transparenz in der Organisation?',
                icon: 'fa-eye',
                subCriteria: [
                    { 
                        id: 'trustLevel', 
                        title: 'Hohes Vertrauensniveau',
                        description: 'Wie hoch ist das Vertrauen zwischen Mitarbeitern und Führung?',
                        examples: ['Hohes Vertrauen', 'Offene Kommunikation', 'Vertrauensbasis']
                    },
                    { 
                        id: 'transparentCommunication', 
                        title: 'Transparente Kommunikation',
                        description: 'Wie transparent ist die interne Kommunikation?',
                        examples: ['Offene Kommunikation', 'Information Sharing', 'Transparenz']
                    },
                    { 
                        id: 'psychologicalSafety', 
                        title: 'Psychologische Sicherheit',
                        description: 'Gibt es eine Umgebung psychologischer Sicherheit?',
                        examples: ['Sichere Umgebung', 'Offenheit', 'Keine Angst vor Fehlern']
                    },
                    { 
                        id: 'honestFeedback', 
                        title: 'Ehrliches und konstruktives Feedback',
                        description: 'Gibt es eine Kultur des ehrlichen Feedbacks?',
                        examples: ['Konstruktive Kritik', 'Offenes Feedback', 'Ehrlichkeit']
                    },
                    { 
                        id: 'informationAccess', 
                        title: 'Zugang zu Informationen',
                        description: 'Haben Mitarbeiter Zugang zu relevanten Informationen?',
                        examples: ['Informationszugang', 'Transparente Daten', 'Offene Kommunikation']
                    }
                ]
            },
            {
                id: 'diversityInclusion',
                title: 'Diversität & Inklusion',
                description: 'Wie gut sind Diversität und Inklusion in der Kultur verankert?',
                icon: 'fa-users',
                subCriteria: [
                    { 
                        id: 'diversityPrograms', 
                        title: 'Diversitäts-Programme und Initiativen',
                        description: 'Gibt es aktive Diversitäts-Programme?',
                        examples: ['D&I Initiativen', 'Diversitäts-Strategie', 'Programme']
                    },
                    { 
                        id: 'inclusiveCulture', 
                        title: 'Inklusive Kultur und Zugehörigkeit',
                        description: 'Ist die Kultur inklusiv und fördert Zugehörigkeit?',
                        examples: ['Inklusion', 'Zugehörigkeit', 'Akzeptanz', 'Respekt']
                    },
                    { 
                        id: 'diversityMetrics', 
                        title: 'Diversitäts-Metriken und Monitoring',
                        description: 'Werden Diversitäts-Metriken gemessen?',
                        examples: ['Messung', 'Tracking', 'Reporting', 'Diversitäts-Dashboard']
                    },
                    { 
                        id: 'equalOpportunities', 
                        title: 'Gleiche Chancen und Fairness',
                        description: 'Gibt es gleiche Chancen für alle?',
                        examples: ['Fairness', 'Gleichberechtigung', 'Chancengleichheit']
                    },
                    { 
                        id: 'diverseLeadership', 
                        title: 'Diverse Führungsebene',
                        description: 'Ist die Führungsebene divers?',
                        examples: ['Diverse Führung', 'Vielfältige Perspektiven', 'Inklusive Führung']
                    }
                ]
            },
            {
                id: 'innovationCulture',
                title: 'Innovationskultur',
                description: 'Wie stark ist die Innovationskultur ausgeprägt?',
                icon: 'fa-lightbulb',
                subCriteria: [
                    { 
                        id: 'innovationMindset', 
                        title: 'Innovations-Mindset und Kreativität',
                        description: 'Gibt es ein Innovations-Mindset in der Organisation?',
                        examples: ['Kreativität', 'Innovation', 'Experimentierfreude', 'Neugier']
                    },
                    { 
                        id: 'riskTolerance', 
                        title: 'Risikotoleranz und Fehlerkultur',
                        description: 'Wie hoch ist die Toleranz für Risiken und Fehler?',
                        examples: ['Risikobereitschaft', 'Fehlertoleranz', 'Lernen aus Fehlern']
                    },
                    { 
                        id: 'ideaGeneration', 
                        title: 'Ideen-Generierung und -Förderung',
                        description: 'Wie gut ist die Ideen-Generierung?',
                        examples: ['Brainstorming', 'Ideen-Plattformen', 'Kreativität', 'Innovation Labs']
                    },
                    { 
                        id: 'innovationRewards', 
                        title: 'Innovations-Belohnungen und Anerkennung',
                        description: 'Gibt es Belohnungen für Innovation?',
                        examples: ['Anerkennung', 'Incentives', 'Belohnungen', 'Innovation Awards']
                    },
                    { 
                        id: 'experimentationSpace', 
                        title: 'Experimentier-Räume und Freiheit',
                        description: 'Gibt es Räume für Experimente?',
                        examples: ['Test-Environments', 'Pilot-Projekte', 'Experimentier-Freiheit']
                    }
                ]
            },
            {
                id: 'learningCulture',
                title: 'Lernkultur & Entwicklung',
                description: 'Wie stark ist die Lernkultur ausgeprägt?',
                icon: 'fa-graduation-cap',
                subCriteria: [
                    { 
                        id: 'continuousLearning', 
                        title: 'Kontinuierliches Lernen und Entwicklung',
                        description: 'Gibt es eine Kultur des kontinuierlichen Lernens?',
                        examples: ['Lernangebote', 'Entwicklung', 'Bildung', 'Weiterbildung']
                    },
                    { 
                        id: 'knowledgeSharing', 
                        title: 'Wissensaustausch und -teilung',
                        description: 'Wie gut ist der Wissensaustausch?',
                        examples: ['Sharing', 'Communities', 'Austausch', 'Wissensplattformen']
                    },
                    { 
                        id: 'learningResources', 
                        title: 'Lernressourcen und -möglichkeiten',
                        description: 'Gibt es ausreichende Lernressourcen?',
                        examples: ['Ressourcen', 'Tools', 'Plattformen', 'Lernprogramme']
                    },
                    { 
                        id: 'learningSupport', 
                        title: 'Lernunterstützung und Mentoring',
                        description: 'Gibt es Unterstützung beim Lernen?',
                        examples: ['Mentoring', 'Coaching', 'Support', 'Lernbegleitung']
                    },
                    { 
                        id: 'learningFromFailure', 
                        title: 'Lernen aus Fehlern und Misserfolgen',
                        description: 'Wird aus Fehlern gelernt?',
                        examples: ['Fehleranalyse', 'Lessons Learned', 'Reflexion', 'Verbesserung']
                    }
                ]
            },
            {
                id: 'collaborationCulture',
                title: 'Kollaborationskultur',
                description: 'Wie stark ist die Kollaborationskultur?',
                icon: 'fa-handshake',
                subCriteria: [
                    { 
                        id: 'teamCollaboration', 
                        title: 'Team-Kollaboration und Zusammenarbeit',
                        description: 'Wie gut ist die Team-Kollaboration?',
                        examples: ['Zusammenarbeit', 'Teams', 'Kollaboration', 'Gemeinsame Projekte']
                    },
                    { 
                        id: 'crossFunctional', 
                        title: 'Cross-funktionale Zusammenarbeit',
                        description: 'Gibt es cross-funktionale Zusammenarbeit?',
                        examples: ['Cross-Functional', 'Interdisziplinär', 'Zusammenarbeit']
                    },
                    { 
                        id: 'collaborativeTools', 
                        title: 'Kollaborative Tools und Plattformen',
                        description: 'Werden kollaborative Tools genutzt?',
                        examples: ['Tools', 'Plattformen', 'Software', 'Collaboration Tools']
                    },
                    { 
                        id: 'sharedGoals', 
                        title: 'Gemeinsame Ziele und Alignment',
                        description: 'Gibt es gemeinsame Ziele?',
                        examples: ['Alignment', 'Gemeinsame Ziele', 'Zusammenarbeit', 'Team-Ziele']
                    },
                    { 
                        id: 'mutualSupport', 
                        title: 'Gegenseitige Unterstützung',
                        description: 'Gibt es gegenseitige Unterstützung?',
                        examples: ['Support', 'Hilfsbereitschaft', 'Zusammenarbeit', 'Teamgeist']
                    }
                ]
            },
            {
                id: 'performanceCulture',
                title: 'Performance-Kultur',
                description: 'Wie stark ist die Performance-Kultur?',
                icon: 'fa-trophy',
                subCriteria: [
                    { 
                        id: 'highPerformance', 
                        title: 'High Performance und Exzellenz',
                        description: 'Gibt es eine High-Performance-Kultur?',
                        examples: ['Exzellenz', 'Performance', 'Ergebnisse', 'Qualität']
                    },
                    { 
                        id: 'performanceStandards', 
                        title: 'Performance-Standards und Erwartungen',
                        description: 'Gibt es klare Performance-Standards?',
                        examples: ['Standards', 'Erwartungen', 'Ziele', 'Benchmarks']
                    },
                    { 
                        id: 'performanceRecognition', 
                        title: 'Performance-Anerkennung und Belohnung',
                        description: 'Gibt es Performance-Anerkennung?',
                        examples: ['Anerkennung', 'Belohnungen', 'Recognition', 'Awards']
                    },
                    { 
                        id: 'performanceDevelopment', 
                        title: 'Performance-Entwicklung und Coaching',
                        description: 'Gibt es Performance-Entwicklung?',
                        examples: ['Entwicklung', 'Coaching', 'Support', 'Förderung']
                    },
                    { 
                        id: 'accountability', 
                        title: 'Verantwortlichkeit und Ownership',
                        description: 'Gibt es eine Kultur der Verantwortlichkeit?',
                        examples: ['Accountability', 'Ownership', 'Verantwortung', 'Commitment']
                    }
                ]
            },
            {
                id: 'customerFocus',
                title: 'Kundenfokus & Service-Orientierung',
                description: 'Wie stark ist der Kundenfokus in der Kultur?',
                icon: 'fa-user-check',
                subCriteria: [
                    { 
                        id: 'customerCentricity', 
                        title: 'Kundenorientierung und Customer First',
                        description: 'Ist die Organisation kundenorientiert?',
                        examples: ['Kundenfokus', 'Customer First', 'Orientierung', 'Kundennähe']
                    },
                    { 
                        id: 'customerFeedback', 
                        title: 'Kundenfeedback und -integration',
                        description: 'Wie gut ist das Kundenfeedback integriert?',
                        examples: ['Feedback', 'Surveys', 'Input', 'Kundenmeinungen']
                    },
                    { 
                        id: 'customerValue', 
                        title: 'Kundenwert und Value Creation',
                        description: 'Wird Kundenwert geschaffen?',
                        examples: ['Value Creation', 'Kundennutzen', 'Wert', 'Kundenerfolg']
                    },
                    { 
                        id: 'customerRelationships', 
                        title: 'Kundenbeziehungen und Engagement',
                        description: 'Wie gut sind die Kundenbeziehungen?',
                        examples: ['Beziehungen', 'Partnerschaften', 'Engagement', 'Kundenbindung']
                    },
                    { 
                        id: 'serviceExcellence', 
                        title: 'Service-Exzellenz und Qualität',
                        description: 'Gibt es Service-Exzellenz?',
                        examples: ['Service-Qualität', 'Exzellenz', 'Kundenservice', 'Qualität']
                    }
                ]
            },
            {
                id: 'sustainabilityCulture',
                title: 'Nachhaltigkeitskultur',
                description: 'Wie stark ist die Nachhaltigkeitskultur?',
                icon: 'fa-leaf',
                subCriteria: [
                    { 
                        id: 'sustainabilityValues', 
                        title: 'Nachhaltigkeitswerte und -prinzipien',
                        description: 'Gibt es Nachhaltigkeitswerte?',
                        examples: ['Werte', 'Prinzipien', 'Commitment', 'Nachhaltigkeit']
                    },
                    { 
                        id: 'sustainabilityPractices', 
                        title: 'Nachhaltigkeitspraktiken und -initiativen',
                        description: 'Gibt es Nachhaltigkeitspraktiken?',
                        examples: ['Praktiken', 'Initiativen', 'Programme', 'Nachhaltige Prozesse']
                    },
                    { 
                        id: 'sustainabilityReporting', 
                        title: 'Nachhaltigkeits-Reporting und Transparenz',
                        description: 'Gibt es Nachhaltigkeits-Reporting?',
                        examples: ['Reporting', 'Transparenz', 'Kommunikation', 'ESG-Reports']
                    },
                    { 
                        id: 'longTermThinking', 
                        title: 'Langfristiges Denken und Zukunftsfähigkeit',
                        description: 'Wird langfristig gedacht?',
                        examples: ['Langfristigkeit', 'Zukunftsfähigkeit', 'Nachhaltigkeit', 'Strategie']
                    },
                    { 
                        id: 'environmentalAwareness', 
                        title: 'Umweltbewusstsein und -verantwortung',
                        description: 'Gibt es Umweltbewusstsein?',
                        examples: ['Umweltbewusstsein', 'Verantwortung', 'Green Initiatives', 'Nachhaltigkeit']
                    }
                ]
            }
        ];
        
        let assessmentData = {};
        let assessmentExporter = null;
        
        function initializeAssessment() {
            // Load saved data
            const saved = localStorage.getItem('orgDevDetailAssessments');
            if (saved) {
                const allAssessments = JSON.parse(saved);
                if (allAssessments.culture) {
                    assessmentData = allAssessments.culture;
                }
            }
            
            // Initialize assessment data structure
            cultureCriteria.forEach(criterion => {
                if (!assessmentData[criterion.id]) {
                    assessmentData[criterion.id] = {};
                }
                criterion.subCriteria.forEach(subCriterion => {
                    if (!assessmentData[criterion.id][subCriterion.id]) {
                        assessmentData[criterion.id][subCriterion.id] = 1;
                    }
                });
            });
            
            renderCriteria();
            updateAggregatedScore();
            assessmentExporter = new AssessmentExporter();
        }
        
        function renderCriteria() {
            const container = document.getElementById('criteriaContainer');
            container.innerHTML = '';
            
            cultureCriteria.forEach(criterion => {
                const criterionCard = document.createElement('div');
                criterionCard.className = 'criterion-card';
                
                const averageScore = calculateCriterionAverage(criterion.id);
                
                criterionCard.innerHTML = `
                    <div class="criterion-header">
                        <div class="criterion-icon">
                            <i class="fas ${criterion.icon}"></i>
                        </div>
                        <div class="criterion-title-section">
                            <h3 class="criterion-title">${criterion.title}</h3>
                            <p class="criterion-description">${criterion.description}</p>
                        </div>
                        <div class="criterion-average">
                            <div class="criterion-average-value">${averageScore.toFixed(1)}</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">Durchschnitt</div>
                        </div>
                    </div>
                    
                    <div class="sub-criteria-container">
                        ${criterion.subCriteria.map(subCriterion => {
                            const value = assessmentData[criterion.id][subCriterion.id] || 1;
                            return `
                                <div class="sub-criterion-item">
                                    <div class="sub-criterion-label">
                                        <h4>${subCriterion.title}</h4>
                                        <p>${subCriterion.description}</p>
                                        <div class="criterion-examples">
                                            <strong>Beispiele:</strong>
                                            <ul>
                                                ${subCriterion.examples.map(ex => `<li>${ex}</li>`).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="sub-criterion-slider-wrapper">
                                        <input type="range" min="1" max="5" value="${value}" 
                                               class="sub-criterion-slider" 
                                               id="${criterion.id}_${subCriterion.id}"
                                               oninput="updateSubCriterionValue('${criterion.id}', '${subCriterion.id}', this.value)">
                                        <div class="sub-criterion-value">${value}</div>
                                        <div class="sub-criterion-scale">
                                            <span>1</span>
                                            <span>2</span>
                                            <span>3</span>
                                            <span>4</span>
                                            <span>5</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                container.appendChild(criterionCard);
            });
        }
        
        function updateSubCriterionValue(criterionId, subCriterionId, value) {
            if (!assessmentData[criterionId]) {
                assessmentData[criterionId] = {};
            }
            assessmentData[criterionId][subCriterionId] = parseInt(value);
            
            const valueDisplay = document.querySelector(`#${criterionId}_${subCriterionId}`).nextElementSibling;
            if (valueDisplay) {
                valueDisplay.textContent = value;
            }
            
            updateCriterionAverage(criterionId);
            updateAggregatedScore();
            saveAssessment();
        }
        
        function calculateCriterionAverage(criterionId) {
            const criterion = cultureCriteria.find(c => c.id === criterionId);
            if (!criterion || !assessmentData[criterionId]) return 1.0;
            
            const values = criterion.subCriteria.map(sub => 
                assessmentData[criterionId][sub.id] || 1
            );
            const sum = values.reduce((acc, val) => acc + val, 0);
            return sum / values.length;
        }
        
        function updateCriterionAverage(criterionId) {
            const average = calculateCriterionAverage(criterionId);
            const criterionCard = document.querySelector(`.criterion-card:has(#${criterionId}_${cultureCriteria.find(c => c.id === criterionId).subCriteria[0].id})`);
            if (criterionCard) {
                const averageDisplay = criterionCard.querySelector('.criterion-average-value');
                if (averageDisplay) {
                    averageDisplay.textContent = average.toFixed(1);
                }
            }
        }
        
        function updateAggregatedScore() {
            const averages = cultureCriteria.map(c => calculateCriterionAverage(c.id));
            const overallAverage = averages.reduce((acc, val) => acc + val, 0) / averages.length;
            
            const scoreDisplay = document.getElementById('aggregatedScore');
            const descriptionDisplay = document.getElementById('scoreDescription');
            
            if (scoreDisplay) {
                scoreDisplay.textContent = overallAverage.toFixed(1);
            }
            
            if (descriptionDisplay) {
                let description = '';
                if (overallAverage <= 1.5) {
                    description = 'Schwache Kultur - Erhebliche Verbesserung der Unternehmenskultur nötig';
                } else if (overallAverage <= 2.5) {
                    description = 'Teilweise entwickelte Kultur - Kulturelle Verbesserungen erforderlich';
                } else if (overallAverage <= 3.5) {
                    description = 'Gute Kultur - Weitere kulturelle Entwicklung möglich';
                } else if (overallAverage <= 4.5) {
                    description = 'Starke Kultur - Kleine Verbesserungen möglich';
                } else {
                    description = 'Hervorragende Kultur - Exzellente Unternehmenskultur';
                }
                descriptionDisplay.textContent = description;
            }
        }
        
        function saveAssessment() {
            const aggregated = parseFloat(cultureCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / cultureCriteria.length).toFixed(1);
            const criterionAverages = cultureCriteria.map(criterion => ({
                criterionId: criterion.id,
                average: calculateCriterionAverage(criterion.id)
            }));
            
            const allAssessments = JSON.parse(localStorage.getItem('orgDevDetailAssessments') || '{}');
            allAssessments.culture = {
                aggregated: parseFloat(aggregated),
                details: assessmentData,
                criteria: assessmentData, // Legacy support
                criterionAverages: criterionAverages,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('orgDevDetailAssessments', JSON.stringify(allAssessments));
        }
        
        function saveAndReturn() {
            const aggregated = parseFloat(cultureCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / cultureCriteria.length).toFixed(1);
            
            // Save detailed assessment
            saveAssessment();
            
            // Also update main workflow (analog zu HR-Strategieentwicklung)
            let workflowData = JSON.parse(localStorage.getItem('orgDevWorkflow') || '{}');
            if (!workflowData.orgDevMaturityData) workflowData.orgDevMaturityData = {};
            workflowData.orgDevMaturityData.culture = parseFloat(aggregated);
            localStorage.setItem('orgDevWorkflow', JSON.stringify(workflowData));
            
            window.location.href = 'organisationsentwicklung-workflow.html';
        }
        
        async function exportToExcel() {
            if (!assessmentExporter) {
                assessmentExporter = new AssessmentExporter();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            const data = prepareExportData();
            await assessmentExporter.exportToExcel(data, `Organisationsentwicklung-Kultur-&-Werte-Assessment-${new Date().toISOString().split('T')[0]}`);
        }
        
        async function exportToPDF() {
            if (!assessmentExporter) {
                assessmentExporter = new AssessmentExporter();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            const data = prepareExportData();
            await assessmentExporter.exportToPDF(data, `Organisationsentwicklung-Kultur-&-Werte-Assessment-${new Date().toISOString().split('T')[0]}`);
        }
        
        function prepareExportData() {
            const aggregated = parseFloat(cultureCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / cultureCriteria.length).toFixed(1);
            
            return {
                dimension: 'culture',
                dimensionName: 'Kultur & Werte',
                overall: parseFloat(aggregated),
                criteria: cultureCriteria.map(criterion => ({
                    id: criterion.id,
                    title: criterion.title,
                    description: criterion.description,
                    average: calculateCriterionAverage(criterion.id),
                    subCriteria: criterion.subCriteria.map(sub => ({
                        id: sub.id,
                        title: sub.title,
                        description: sub.description,
                        examples: sub.examples,
                        score: assessmentData[criterion.id][sub.id] || 1
                    }))
                })),
                timestamp: new Date().toISOString()
            };
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initializeAssessment);
    </script>
    
    <!-- Assessment Export Script -->
    <script src="js/assessment-export.js"></script>
</body>
</html>
