<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bewerbungs-Designer - Modulares Baukasten-System</title>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* HR Designer Styles */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --white: #ffffff;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background: var(--gray-50);
        }

        /* Header */
        .designer-header {
            background: var(--white);
            border-bottom: 1px solid var(--gray-200);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow-sm);
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .header-actions {
            display: flex;
            gap: 1rem;
        }

        /* Main Layout */
        .designer-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 100px);
        }

        /* Sidebar - Controls */
        .designer-sidebar {
            background: var(--white);
            border-radius: var(--radius-2xl);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            height: fit-content;
            position: sticky;
            top: 120px;
        }

        .sidebar-section {
            margin-bottom: 2rem;
        }

        .sidebar-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title i {
            color: var(--primary);
        }

        /* Form Controls */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 0.5rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            transition: all 0.3s ease;
            background: var(--white);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        /* Color Picker */
        .color-picker-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 0.5rem;
            align-items: center;
        }

        .color-picker {
            width: 50px;
            height: 40px;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-picker:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        /* Style Variants */
        .style-variants {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        .style-variant {
            padding: 1rem;
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            background: var(--white);
        }

        .style-variant:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .style-variant.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .style-variant .variant-name {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .style-variant .variant-desc {
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        /* Logo Upload */
        .logo-upload {
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--gray-50);
        }

        .logo-upload:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .logo-upload.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .logo-preview {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-lg);
            background: var(--gray-100);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            overflow: hidden;
            border: 2px solid var(--gray-200);
        }

        .logo-preview img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .logo-preview .fallback {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-400);
        }

        /* Preview Area */
        .preview-area {
            background: var(--white);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--gray-200);
            overflow: hidden;
        }

        .preview-header {
            background: var(--gray-50);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .preview-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .preview-actions {
            display: flex;
            gap: 0.75rem;
        }

        .preview-iframe {
            width: 100%;
            height: 800px;
            border: none;
            background: var(--white);
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 0.875rem;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--primary);
            color: var(--white);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--white);
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            border-color: var(--gray-300);
        }

        .btn-success {
            background: var(--success);
            color: var(--white);
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .designer-container {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .designer-sidebar {
                position: static;
                order: 2;
            }

            .preview-area {
                order: 1;
            }
        }

        @media (max-width: 768px) {
            .designer-container {
                padding: 1rem;
            }

            .designer-sidebar {
                padding: 1.5rem;
            }

            .style-variants {
                grid-template-columns: 1fr;
            }
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--gray-500);
        }

        .loading i {
            animation: spin 1s linear infinite;
            margin-right: 0.5rem;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 1.5rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-600);
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Certificate Styles */
        .certificates-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .certificate-item {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 1rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .certificate-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .certificate-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .certificate-title {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.875rem;
        }

        .certificate-actions {
            display: flex;
            gap: 0.5rem;
        }

        .certificate-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 0.75rem;
        }

        .certificate-btn.download {
            background: var(--success);
            color: var(--white);
        }

        .certificate-btn.download:hover {
            background: #059669;
            transform: scale(1.1);
        }

        .certificate-btn.edit {
            background: var(--primary);
            color: var(--white);
        }

        .certificate-btn.edit:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .certificate-btn.delete {
            background: var(--error);
            color: var(--white);
        }

        .certificate-btn.delete:hover {
            background: #dc2626;
            transform: scale(1.1);
        }

        .certificate-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .certificate-info-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .certificate-info-item i {
            width: 12px;
            color: var(--gray-400);
        }

        .certificate-preview {
            width: 100%;
            height: 80px;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0.75rem;
            border: 1px solid var(--gray-200);
            overflow: hidden;
        }

        .certificate-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .certificate-preview .fallback {
            color: var(--gray-400);
            font-size: 0.75rem;
            text-align: center;
        }

        .certificate-preview .fallback i {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
            display: block;
        }

        /* Certificate Modal */
        .certificate-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .certificate-modal.active {
            display: flex;
        }

        .certificate-modal-content {
            background: var(--white);
            border-radius: var(--radius-2xl);
            padding: 2rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        .certificate-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        .certificate-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .certificate-modal-close {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--gray-100);
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            transition: all 0.3s ease;
        }

        .certificate-modal-close:hover {
            background: var(--gray-200);
            color: var(--gray-800);
        }

        .certificate-upload-area {
            border: 2px dashed var(--gray-300);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--gray-50);
            margin-bottom: 1.5rem;
        }

        .certificate-upload-area:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .certificate-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .certificate-upload-area i {
            font-size: 2rem;
            color: var(--gray-400);
            margin-bottom: 0.5rem;
        }

        .certificate-upload-area p {
            color: var(--gray-600);
            font-size: 0.875rem;
            margin: 0;
        }

        .certificate-upload-area .file-info {
            color: var(--primary);
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Analysis Workflow Styles */
        .analysis-workflow {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .workflow-step {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
        }

        .workflow-step.active {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .workflow-step.completed {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.05);
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .step-number {
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .workflow-step.completed .step-number {
            background: var(--success);
        }

        .step-title {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 1rem;
        }

        .step-content {
            margin-left: 3rem;
        }

        .analysis-progress {
            margin-bottom: 1rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--gray-200);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s ease;
        }

        .analysis-details {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .analysis-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .analysis-item i {
            color: var(--primary);
            width: 16px;
        }

        .analysis-results {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
        }

        .analysis-results h4 {
            margin-bottom: 1rem;
            color: var(--gray-900);
            font-size: 1rem;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .analysis-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-md);
            padding: 1rem;
        }

        .card-title {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
        }

        .card-content {
            color: var(--gray-600);
            font-size: 0.75rem;
            line-height: 1.4;
        }

        .generation-options {
            margin: 1.5rem 0;
            padding: 1.5rem;
            background: var(--gray-50);
            border-radius: var(--radius-lg);
            border: 1px solid var(--gray-200);
        }

        .generation-options h4 {
            margin-bottom: 1rem;
            color: var(--gray-900);
            font-size: 1rem;
        }

        .option-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .checkbox-label input[type="checkbox"] {
            display: none;
        }

        .checkmark {
            width: 20px;
            height: 20px;
            border: 2px solid var(--gray-300);
            border-radius: 4px;
            position: relative;
            transition: all 0.3s ease;
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark {
            background: var(--primary);
            border-color: var(--primary);
        }

        .checkbox-label input[type="checkbox"]:checked + .checkmark::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--white);
            font-size: 12px;
            font-weight: bold;
        }

        /* Loading Animation */
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--gray-300);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Profile Section Styles */
        .profile-section {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-right: 1rem;
        }

        .profile-toggle {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
        }

        .profile-toggle .btn {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            min-width: auto;
        }

        .profile-display {
            position: relative;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid var(--primary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .profile-display:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-lg);
        }

        .profile-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: all 0.3s ease;
        }

        .profile-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .profile-display:hover .profile-overlay {
            opacity: 1;
        }

        .play-btn {
            width: 32px;
            height: 32px;
            background: var(--primary);
            color: var(--white);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }

        .play-btn:hover {
            background: var(--primary-dark);
            transform: scale(1.1);
        }

        .profile-display.digital-twin {
            border-color: var(--secondary);
        }

        .profile-display.digital-twin .profile-overlay {
            background: rgba(139, 92, 246, 0.8);
        }

        /* Digital Twin Animation */
        .digital-twin-active {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(139, 92, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(139, 92, 246, 0); }
        }

        /* Voice Recording Styles */
        .voice-recording {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--white);
            border-radius: var(--radius-2xl);
            padding: 2rem;
            box-shadow: var(--shadow-xl);
            z-index: 1000;
            text-align: center;
            min-width: 300px;
        }

        .voice-recording h3 {
            margin-bottom: 1rem;
            color: var(--gray-900);
        }

        .recording-visualizer {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--primary);
            margin: 1rem auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 2rem;
            animation: recordingPulse 1s infinite;
        }

        @keyframes recordingPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .recording-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
        }

        .recording-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s ease;
        }

        .recording-btn.record {
            background: var(--error);
            color: var(--white);
        }

        .recording-btn.stop {
            background: var(--gray-500);
            color: var(--white);
        }

        .recording-btn.play {
            background: var(--success);
            color: var(--white);
        }

        .recording-btn:hover {
            transform: scale(1.1);
        }

        /* Analytics Styles */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .metric-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 1rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-md);
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .metric-label {
            font-size: 0.75rem;
            color: var(--gray-600);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .keyword-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .keyword-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: var(--gray-50);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
        }

        .keyword-name {
            font-weight: 600;
            color: var(--gray-900);
        }

        .keyword-score {
            background: var(--primary);
            color: var(--white);
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
        }

        .timing-insights {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .timing-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.875rem;
            color: var(--gray-700);
        }

        .timing-item i {
            color: var(--primary);
            width: 16px;
        }

        /* Template Styles */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .template-card {
            background: var(--white);
            border: 2px solid var(--gray-200);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .template-icon {
            font-size: 2rem;
            color: var(--primary);
            margin-bottom: 0.75rem;
        }

        .template-title {
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 0.25rem;
        }

        .template-desc {
            font-size: 0.75rem;
            color: var(--gray-600);
        }

        .quick-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .quick-actions .btn {
            justify-content: flex-start;
            text-align: left;
        }

        /* Settings Styles */
        .settings-group {
            margin-bottom: 2rem;
        }

        .settings-group h4 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--gray-900);
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: 0.5rem;
        }

        .setting-item {
            margin-bottom: 0.75rem;
        }

        /* Responsive Improvements */
        @media (max-width: 1200px) {
            .designer-container {
                grid-template-columns: 300px 1fr;
            }
        }

        @media (max-width: 1024px) {
            .designer-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }

            .designer-sidebar {
                order: 2;
                position: static;
            }

            .preview-area {
                order: 1;
            }

            .analytics-grid,
            .template-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
                align-items: stretch;
            }

            .header-actions {
                justify-content: center;
            }

            .profile-section {
                margin-right: 0;
                justify-content: center;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1;
                min-width: 120px;
            }
        }

        /* Enhanced Tab Styles */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--gray-200);
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .tab {
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray-600);
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab:hover {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .tab i {
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="designer-header">
        <div class="header-container">
            <div class="header-title">
                <i class="fas fa-palette"></i>
                <h1>Bewerbungs-Designer</h1>
                <span style="color: var(--gray-500); font-size: 0.875rem;">Modulares Baukasten-System</span>
            </div>
            <div class="header-actions">
                <div class="profile-section">
                    <div class="profile-toggle">
                        <button class="btn btn-secondary" data-action="toggle-profile-mode" id="profileToggleBtn">
                            <i class="fas fa-camera"></i>
                            <span>Foto</span>
                        </button>
                    </div>
                    <div class="profile-display" id="profileDisplay">
                        <img src="manuel-weiss-photo.svg" alt="Manuel Weiss" class="profile-image" id="profileImage">
                        <div class="profile-overlay" id="profileOverlay">
                            <button class="play-btn" data-action="play-digital-twin" title="Digital Twin abspielen">
                                <i class="fas fa-play"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-secondary" data-action="reset-design">
                    <i class="fas fa-undo"></i>
                    Zurücksetzen
                </button>
                <button class="btn btn-primary" data-action="save-design">
                    <i class="fas fa-save"></i>
                    Speichern
                </button>
                <button class="btn btn-success" data-action="preview-design">
                    <i class="fas fa-eye"></i>
                    Vorschau
                </button>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="designer-container">
        <!-- Sidebar - Controls -->
        <div class="designer-sidebar">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" data-action="switch-tab" data-param="content">
                    <i class="fas fa-edit"></i>
                    Inhalt
                </button>
                <button class="tab" data-action="switch-tab" data-param="design">
                    <i class="fas fa-palette"></i>
                    Design
                </button>
                <button class="tab" data-action="switch-tab" data-param="branding">
                    <i class="fas fa-building"></i>
                    Branding
                </button>
                <button class="tab" data-action="switch-tab" data-param="cover-letter">
                    <i class="fas fa-robot"></i>
                    Anschreiben
                </button>
                <button class="tab" data-action="switch-tab" data-param="analytics">
                    <i class="fas fa-chart-line"></i>
                    Analytics
                </button>
                <button class="tab" data-action="switch-tab" data-param="templates">
                    <i class="fas fa-file-alt"></i>
                    Templates
                </button>
                <button class="tab" data-action="switch-tab" data-param="settings">
                    <i class="fas fa-cog"></i>
                    Einstellungen
                </button>
            </div>

            <!-- Content Tab -->
            <div id="content-tab" class="tab-content active">
                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-user"></i>
                        Kandidaten-Informationen
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-input" id="candidateName" value="Manuel Weiss">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Position</label>
                        <input type="text" class="form-input" id="candidatePosition" value="HR-Tech Consultant">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">E-Mail</label>
                        <input type="email" class="form-input" id="candidateEmail" value="manuel.weiss@email.com">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Telefon</label>
                        <input type="tel" class="form-input" id="candidatePhone" value="+41 44 123 45 67">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Standort</label>
                        <input type="text" class="form-input" id="candidateLocation" value="Zürich, Schweiz">
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Anschreiben
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Anschreiben-Text</label>
                        <textarea class="form-input form-textarea" id="coverLetterText" rows="8">Sehr geehrte Damen und Herren,

mit großem Interesse habe ich Ihre Stellenanzeige für die Position des HR-Tech Consultants gelesen. Als erfahrener HR-Tech Consultant mit über 5 Jahren Berufserfahrung in der digitalen Transformation von HR-Prozessen bin ich überzeugt, dass ich eine wertvolle Bereicherung für Ihr Team darstellen kann.

Meine Expertise umfasst die Implementierung moderner HR-Technologien, die Optimierung von Recruiting-Prozessen und die Entwicklung innovativer Lösungen für Unternehmen aller Größenordnungen.

Mit freundlichen Grüßen
Manuel Weiss</textarea>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-cogs"></i>
                        Kompetenzen
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Kompetenzen (eine pro Zeile)</label>
                        <textarea class="form-input form-textarea" id="skillsText" rows="6">HR-Tech Beratung
Prozessoptimierung
Digital Transformation
Recruiting Automation
Change Management
Data Analytics
Project Management
Stakeholder Management</textarea>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-certificate"></i>
                        Zeugnisse & Dokumente
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Zeugnisse verwalten</label>
                        <div class="certificates-container" id="certificatesContainer">
                            <!-- Wird dynamisch gefüllt -->
                        </div>
                        <button class="btn btn-secondary" data-action="add-certificate" style="width: 100%; margin-top: 1rem;">
                            <i class="fas fa-plus"></i>
                            Zeugnis hinzufügen
                        </button>
                    </div>
                </div>
            </div>

            <!-- Design Tab -->
            <div id="design-tab" class="tab-content">
                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-palette"></i>
                        Farben
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Primärfarbe</label>
                        <div class="color-picker-group">
                            <input type="text" class="form-input" id="primaryColor" value="#1e40af">
                            <input type="color" class="color-picker" id="primaryColorPicker" value="#1e40af">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Sekundärfarbe</label>
                        <div class="color-picker-group">
                            <input type="text" class="form-input" id="secondaryColor" value="#059669">
                            <input type="color" class="color-picker" id="secondaryColorPicker" value="#059669">
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-paint-brush"></i>
                        Style-Varianten
                    </div>
                    
                    <div class="style-variants">
                        <div class="style-variant active" data-style="swiss" onclick="selectStyle('swiss')">
                            <div class="variant-name">Swiss</div>
                            <div class="variant-desc">Professionell & Minimal</div>
                        </div>
                        <div class="style-variant" data-style="modern" onclick="selectStyle('modern')">
                            <div class="variant-name">Modern</div>
                            <div class="variant-desc">Trendy & Dynamisch</div>
                        </div>
                        <div class="style-variant" data-style="corporate" onclick="selectStyle('corporate')">
                            <div class="variant-name">Corporate</div>
                            <div class="variant-desc">Klassisch & Seriös</div>
                        </div>
                        <div class="style-variant" data-style="creative" onclick="selectStyle('creative')">
                            <div class="variant-name">Creative</div>
                            <div class="variant-desc">Kreativ & Innovativ</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Branding Tab -->
            <div id="branding-tab" class="tab-content">
                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-building"></i>
                        Firmen-Branding
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Firmenname</label>
                        <input type="text" class="form-input" id="companyName" value="TechConsult GmbH">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Firmenlogo</label>
                        <div class="logo-upload" onclick="document.getElementById('logoFile').click()">
                            <div class="logo-preview" id="logoPreview">
                                <div class="fallback">TC</div>
                            </div>
                            <p style="color: var(--gray-600); font-size: 0.875rem;">
                                <i class="fas fa-upload"></i><br>
                                Logo hochladen oder hier ablegen
                            </p>
                        </div>
                        <input type="file" id="logoFile" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Firmen-Initialen (Fallback)</label>
                        <input type="text" class="form-input" id="companyInitials" value="TC" maxlength="3">
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-magic"></i>
                        KI-Branding
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Automatische Erkennung</label>
                        <button class="btn btn-primary" data-action="detect-company-branding">
                            <i class="fas fa-robot"></i>
                            Firmen-Branding erkennen
                        </button>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Branding-Template</label>
                        <select class="form-input" id="brandingTemplate">
                            <option value="auto">Automatisch erkennen</option>
                            <option value="google">Google Style</option>
                            <option value="microsoft">Microsoft Style</option>
                            <option value="apple">Apple Style</option>
                            <option value="sap">SAP Style</option>
                            <option value="siemens">Siemens Style</option>
                            <option value="swiss">Swiss Standard</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Cover Letter Tab -->
            <div id="cover-letter-tab" class="tab-content">
                <!-- Analysis Workflow -->
                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Intelligente Datenanalyse
                    </div>
                    
                    <div class="analysis-workflow">
                        <div class="workflow-step active" id="step1">
                            <div class="step-header">
                                <div class="step-number">1</div>
                                <div class="step-title">Bewerbungshistorie analysieren</div>
                            </div>
                            <div class="step-content">
                                <div class="analysis-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="historyProgress"></div>
                                    </div>
                                    <div class="analysis-details" id="historyDetails">
                                        <div class="analysis-item">
                                            <i class="fas fa-briefcase"></i>
                                            <span>Bewerbungen analysiert: <span id="applicationsCount">0</span></span>
                                        </div>
                                        <div class="analysis-item">
                                            <i class="fas fa-chart-bar"></i>
                                            <span>Erfolgsrate: <span id="successRate">0%</span></span>
                                        </div>
                                        <div class="analysis-item">
                                            <i class="fas fa-star"></i>
                                            <span>Top-Keywords: <span id="topKeywords">-</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="workflow-step" id="step2">
                            <div class="step-header">
                                <div class="step-number">2</div>
                                <div class="step-title">Anschreiben-Pattern erkennen</div>
                            </div>
                            <div class="step-content">
                                <div class="analysis-progress">
                                    <div class="progress-bar">
                                        <div class="progress-fill" id="patternProgress"></div>
                                    </div>
                                    <div class="analysis-details" id="patternDetails">
                                        <div class="analysis-item">
                                            <i class="fas fa-magic"></i>
                                            <span>Erfolgreiche Formulierungen: <span id="successfulPhrases">0</span></span>
                                        </div>
                                        <div class="analysis-item">
                                            <i class="fas fa-palette"></i>
                                            <span>Optimaler Ton: <span id="optimalTone">-</span></span>
                                        </div>
                                        <div class="analysis-item">
                                            <i class="fas fa-bullseye"></i>
                                            <span>Zielgruppen-Muster: <span id="targetPatterns">-</span></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="workflow-step" id="step3">
                            <div class="step-header">
                                <div class="step-number">3</div>
                                <div class="step-title">Stellenanzeige analysieren</div>
                            </div>
                            <div class="step-content">
                                <div class="form-group">
                                    <label class="form-label">Stellenanzeige</label>
                                    <textarea class="form-input form-textarea" id="jobDescription" rows="6" placeholder="Kopiere hier die komplette Stellenanzeige hinein..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Unternehmen</label>
                                    <input type="text" class="form-input" id="aiCompanyName" placeholder="Name des Unternehmens">
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Position</label>
                                    <input type="text" class="form-input" id="aiPositionTitle" placeholder="Titel der Position">
                                </div>
                                
                                <div class="analysis-results" id="jobAnalysisResults" style="display: none;">
                                    <h4>📊 Stellenanzeige-Analyse</h4>
                                    <div class="analysis-grid">
                                        <div class="analysis-card">
                                            <div class="card-title">Schlüsselwörter</div>
                                            <div class="card-content" id="keyWords">-</div>
                                        </div>
                                        <div class="analysis-card">
                                            <div class="card-title">Anforderungen</div>
                                            <div class="card-content" id="requirements">-</div>
                                        </div>
                                        <div class="analysis-card">
                                            <div class="card-title">Unternehmenskultur</div>
                                            <div class="card-content" id="companyCulture">-</div>
                                        </div>
                                        <div class="analysis-card">
                                            <div class="card-title">Match-Score</div>
                                            <div class="card-content" id="matchScore">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="workflow-step" id="step4">
                            <div class="step-header">
                                <div class="step-number">4</div>
                                <div class="step-title">Optimiertes Anschreiben generieren</div>
                            </div>
                            <div class="step-content">
                                <div class="form-group">
                                    <label class="form-label">Zusätzliche Anforderungen</label>
                                    <textarea class="form-input form-textarea" id="additionalRequirements" rows="3" placeholder="Besondere Wünsche oder Anforderungen..."></textarea>
                                </div>
                                
                                <div class="generation-options">
                                    <h4>🎯 Generierungsoptionen</h4>
                                    <div class="option-group">
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="useSuccessfulPatterns" checked>
                                            <span class="checkmark"></span>
                                            Erfolgreiche Pattern verwenden
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="optimizeForCompany" checked>
                                            <span class="checkmark"></span>
                                            Für Unternehmen optimieren
                                        </label>
                                        <label class="checkbox-label">
                                            <input type="checkbox" id="includeKeywords" checked>
                                            <span class="checkmark"></span>
                                            Schlüsselwörter integrieren
                                        </label>
                                    </div>
                                </div>
                                
                                <button class="btn btn-primary" data-action="start-intelligent-generation" style="width: 100%;">
                                    <i class="fas fa-brain"></i>
                                    Intelligentes Anschreiben generieren
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-edit"></i>
                        Anschreiben bearbeiten
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Generiertes Anschreiben</label>
                        <textarea class="form-input form-textarea" id="generatedCoverLetter" rows="10" placeholder="Hier erscheint das generierte Anschreiben..."></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem;">
                        <button class="btn btn-secondary" data-action="improve-tone" style="flex: 1;">
                            <i class="fas fa-magic"></i>
                            Ton verbessern
                        </button>
                        <button class="btn btn-secondary" data-action="regenerate-paragraph" style="flex: 1;">
                            <i class="fas fa-redo"></i>
                            Absatz neu
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button class="btn btn-success" data-action="save-cover-letter" style="flex: 1;">
                            <i class="fas fa-save"></i>
                            Speichern
                        </button>
                        <button class="btn btn-secondary" data-action="copy-cover-letter" style="flex: 1;">
                            <i class="fas fa-copy"></i>
                            Kopieren
                        </button>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics-tab" class="tab-content">
                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Bewerbungs-Analytics
                    </div>
                    
                    <div class="analytics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="totalApplications">0</div>
                            <div class="metric-label">Gesamt Bewerbungen</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="responseRate">0%</div>
                            <div class="metric-label">Antwortrate</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="interviewRate">0%</div>
                            <div class="metric-label">Interviewrate</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="offerRate">0%</div>
                            <div class="metric-label">Angebotsrate</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-trophy"></i>
                        Top-Performing Keywords
                    </div>
                    
                    <div class="keyword-list" id="topKeywordsList">
                        <!-- Wird dynamisch gefüllt -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-clock"></i>
                        Optimale Bewerbungszeiten
                    </div>
                    
                    <div class="timing-insights">
                        <div class="timing-item">
                            <i class="fas fa-calendar-day"></i>
                            <span>Bester Wochentag: <strong>Dienstag</strong></span>
                        </div>
                        <div class="timing-item">
                            <i class="fas fa-clock"></i>
                            <span>Beste Uhrzeit: <strong>10:00-11:00</strong></span>
                        </div>
                        <div class="timing-item">
                            <i class="fas fa-calendar-week"></i>
                            <span>Beste Woche: <strong>2. Woche des Monats</strong></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Tab -->
            <div id="templates-tab" class="tab-content">
                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Anschreiben-Templates
                    </div>
                    
                    <div class="template-grid">
                        <div class="template-card" onclick="loadTemplate('tech')">
                            <div class="template-icon">
                                <i class="fas fa-laptop-code"></i>
                            </div>
                            <div class="template-title">Tech-Industrie</div>
                            <div class="template-desc">Für IT & Software</div>
                        </div>
                        <div class="template-card" onclick="loadTemplate('consulting')">
                            <div class="template-icon">
                                <i class="fas fa-handshake"></i>
                            </div>
                            <div class="template-title">Beratung</div>
                            <div class="template-desc">Für Consulting</div>
                        </div>
                        <div class="template-card" onclick="loadTemplate('startup')">
                            <div class="template-icon">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <div class="template-title">Startup</div>
                            <div class="template-desc">Für Startups</div>
                        </div>
                        <div class="template-card" onclick="loadTemplate('corporate')">
                            <div class="template-icon">
                                <i class="fas fa-building"></i>
                            </div>
                            <div class="template-title">Corporate</div>
                            <div class="template-desc">Für Konzerne</div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-magic"></i>
                        Quick Actions
                    </div>
                    
                    <div class="quick-actions">
                        <button class="btn btn-secondary" data-action="generate-email-version">
                            <i class="fas fa-envelope"></i>
                            E-Mail Version
                        </button>
                        <button class="btn btn-secondary" data-action="generate-linked-in-message">
                            <i class="fab fa-linkedin"></i>
                            LinkedIn Message
                        </button>
                        <button class="btn btn-secondary" data-action="generate-video-script">
                            <i class="fas fa-video"></i>
                            Video Script
                        </button>
                        <button class="btn btn-secondary" data-action="generate-follow-up">
                            <i class="fas fa-reply"></i>
                            Follow-up
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings-tab" class="tab-content">
                <div class="sidebar-section">
                    <div class="section-title">
                        <i class="fas fa-cog"></i>
                        Einstellungen
                    </div>
                    
                    <div class="settings-group">
                        <h4>KI-Einstellungen</h4>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoOptimize" checked>
                                <span class="checkmark"></span>
                                Automatische Optimierung
                            </label>
                        </div>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="smartSuggestions" checked>
                                <span class="checkmark"></span>
                                Intelligente Vorschläge
                            </label>
                        </div>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="atsOptimization" checked>
                                <span class="checkmark"></span>
                                ATS-Optimierung
                            </label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Benachrichtigungen</h4>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="emailNotifications" checked>
                                <span class="checkmark"></span>
                                E-Mail Benachrichtigungen
                            </label>
                        </div>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="followUpReminders" checked>
                                <span class="checkmark"></span>
                                Follow-up Erinnerungen
                            </label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Export-Optionen</h4>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="includeAnalytics" checked>
                                <span class="checkmark"></span>
                                Analytics in Export
                            </label>
                        </div>
                        <div class="setting-item">
                            <label class="checkbox-label">
                                <input type="checkbox" id="autoSave" checked>
                                <span class="checkmark"></span>
                                Automatisches Speichern
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preview Area -->
        <div class="preview-area">
            <div class="preview-header">
                <div class="preview-title">
                    <i class="fas fa-eye"></i>
                    Live-Vorschau
                </div>
                <div class="preview-actions">
                    <button class="btn btn-secondary" data-action="refresh-preview">
                        <i class="fas fa-refresh"></i>
                        Aktualisieren
                    </button>
                    <button class="btn btn-primary" data-action="open-preview">
                        <i class="fas fa-external-link-alt"></i>
                        In neuem Tab
                    </button>
                </div>
            </div>
            <iframe id="previewFrame" class="preview-iframe" src="bewerbung.html?id=preview"></iframe>
        </div>
    </div>

    <!-- Certificate Modal -->
    <div class="certificate-modal" id="certificateModal">
        <div class="certificate-modal-content">
            <div class="certificate-modal-header">
                <h3 class="certificate-modal-title" id="certificateModalTitle">Zeugnis hinzufügen</h3>
                <button class="certificate-modal-close" data-action="close-certificate-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="form-group">
                <label class="form-label">Titel des Zeugnisses</label>
                <input type="text" class="form-input" id="certificateTitle" placeholder="z.B. Bachelor of Science Informatik">
            </div>
            
            <div class="form-group">
                <label class="form-label">Institution</label>
                <input type="text" class="form-input" id="certificateInstitution" placeholder="z.B. ETH Zürich">
            </div>
            
            <div class="form-group">
                <label class="form-label">Jahr</label>
                <input type="number" class="form-input" id="certificateYear" placeholder="2023" min="1900" max="2030">
            </div>
            
            <div class="form-group">
                <label class="form-label">Datei hochladen</label>
                <div class="certificate-upload-area" onclick="document.getElementById('certificateFile').click()">
                    <i class="fas fa-file-pdf"></i>
                    <p>PDF-Datei hier ablegen oder klicken zum Auswählen</p>
                    <div class="file-info" id="fileInfo" style="display: none;"></div>
                </div>
                <input type="file" id="certificateFile" accept=".pdf,.jpg,.jpeg,.png" style="display: none;">
            </div>
            
            <div class="form-group">
                <label class="form-label">Beschreibung (optional)</label>
                <textarea class="form-input form-textarea" id="certificateDescription" rows="3" placeholder="Kurze Beschreibung des Zeugnisses..."></textarea>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                <button class="btn btn-secondary" data-action="close-certificate-modal">Abbrechen</button>
                <button class="btn btn-primary" data-action="save-certificate">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Voice Recording Modal -->
    <div class="voice-recording" id="voiceRecordingModal" style="display: none;">
        <h3>Digital Twin Voice Recording</h3>
        <div class="recording-visualizer" id="recordingVisualizer">
            <i class="fas fa-microphone"></i>
        </div>
        <p id="recordingStatus">Bereit für Aufnahme</p>
        <div class="recording-controls">
            <button class="recording-btn record" data-action="start-recording" id="recordBtn">
                <i class="fas fa-microphone"></i>
            </button>
            <button class="recording-btn stop" data-action="stop-recording" id="stopBtn" style="display: none;">
                <i class="fas fa-stop"></i>
            </button>
            <button class="recording-btn play" data-action="play-recording" id="playBtn" style="display: none;">
                <i class="fas fa-play"></i>
            </button>
        </div>
        <div style="margin-top: 1rem;">
            <button class="btn btn-secondary" data-action="close-voice-modal">Schließen</button>
            <button class="btn btn-primary" data-action="save-voice-recording" id="saveVoiceBtn" style="display: none;">Speichern</button>
        </div>
    </div>

    <script>
        // HR Designer Class
        class HRDesigner {
            constructor() {
                this.currentStyle = 'swiss';
                this.designData = this.loadDesignData();
                this.editingCertificateId = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadContactDataFromWebsite();
                this.loadCurrentDesign();
                this.renderCertificates();
                this.startIntelligentAnalysis();
                this.updateAnalytics();
                this.updatePreview();
            }

            setupEventListeners() {
                // Content inputs
                document.getElementById('candidateName').addEventListener('input', () => this.updatePreview());
                document.getElementById('candidatePosition').addEventListener('input', () => this.updatePreview());
                document.getElementById('candidateEmail').addEventListener('input', () => this.updatePreview());
                document.getElementById('candidatePhone').addEventListener('input', () => this.updatePreview());
                document.getElementById('candidateLocation').addEventListener('input', () => this.updatePreview());
                document.getElementById('coverLetterText').addEventListener('input', () => this.updatePreview());
                document.getElementById('skillsText').addEventListener('input', () => this.updatePreview());

                // Design inputs
                document.getElementById('primaryColor').addEventListener('input', () => this.updatePreview());
                document.getElementById('secondaryColor').addEventListener('input', () => this.updatePreview());
                document.getElementById('primaryColorPicker').addEventListener('change', (e) => {
                    document.getElementById('primaryColor').value = e.target.value;
                    this.updatePreview();
                });
                document.getElementById('secondaryColorPicker').addEventListener('change', (e) => {
                    document.getElementById('secondaryColor').value = e.target.value;
                    this.updatePreview();
                });

                // Branding inputs
                document.getElementById('companyName').addEventListener('input', () => this.updatePreview());
                document.getElementById('companyInitials').addEventListener('input', () => this.updatePreview());
                document.getElementById('brandingTemplate').addEventListener('change', () => this.updatePreview());

                // Logo upload
                document.getElementById('logoFile').addEventListener('change', (e) => this.handleLogoUpload(e));

                // Drag and drop for logo
                const logoUpload = document.querySelector('.logo-upload');
                logoUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    logoUpload.classList.add('dragover');
                });
                logoUpload.addEventListener('dragleave', () => {
                    logoUpload.classList.remove('dragover');
                });
                logoUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    logoUpload.classList.remove('dragover');
                    this.handleLogoUpload(e);
                });

                // Certificate file upload
                document.getElementById('certificateFile').addEventListener('change', (e) => this.handleCertificateFileUpload(e));

                // Drag and drop for certificate
                const certificateUpload = document.querySelector('.certificate-upload-area');
                certificateUpload.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    certificateUpload.classList.add('dragover');
                });
                certificateUpload.addEventListener('dragleave', () => {
                    certificateUpload.classList.remove('dragover');
                });
                certificateUpload.addEventListener('drop', (e) => {
                    e.preventDefault();
                    certificateUpload.classList.remove('dragover');
                    this.handleCertificateFileUpload(e);
                });
            }

            loadContactDataFromWebsite() {
                // Load contact data from website-content.json
                fetch('data/website-content.json')
                    .then(response => response.json())
                    .then(data => {
                        if (data.contact) {
                            // Update contact fields with website data
                            document.getElementById('candidateEmail').value = data.contact.email || '';
                            document.getElementById('candidatePhone').value = data.contact.phone || '';
                            document.getElementById('candidateLocation').value = data.contact.location || '';
                        }
                        if (data.hero) {
                            // Update name and title from hero section
                            document.getElementById('candidateName').value = data.hero.name || '';
                            document.getElementById('candidatePosition').value = data.hero.title || '';
                        }
                        console.log('✅ Kontaktdaten von Website übernommen');
                    })
                    .catch(error => {
                        console.log('⚠️ Konnte Kontaktdaten nicht von Website laden:', error);
                    });
            }

            loadDesignData() {
                return JSON.parse(localStorage.getItem('hrDesignData') || JSON.stringify({
                    content: {
                        candidateName: 'Manuel Weiss',
                        candidatePosition: 'Professional Services',
                        candidateEmail: 'weiss-manuel@gmx.de',
                        candidatePhone: '+49 173 3993407',
                        candidateLocation: 'Schweiz',
                        coverLetterText: 'Sehr geehrte Damen und Herren,\n\nmit großem Interesse habe ich Ihre Stellenanzeige für die Position des HR-Tech Consultants gelesen...',
                        skillsText: 'HR-Tech Beratung\nProzessoptimierung\nDigital Transformation\nRecruiting Automation\nChange Management\nData Analytics\nProject Management\nStakeholder Management'
                    },
                    design: {
                        primaryColor: '#1e40af',
                        secondaryColor: '#059669',
                        style: 'swiss'
                    },
                    branding: {
                        companyName: 'TechConsult GmbH',
                        companyInitials: 'TC',
                        logo: null,
                        template: 'auto'
                    },
                    certificates: [
                        {
                            id: 'cert_1',
                            title: 'Bachelor of Science Informatik',
                            institution: 'ETH Zürich',
                            year: 2020,
                            description: 'Abschluss in Informatik mit Schwerpunkt auf Software Engineering',
                            file: null,
                            fileName: 'Zugnisse.pdf'
                        },
                        {
                            id: 'cert_2',
                            title: 'Lebenslauf',
                            institution: 'Manuel Weiss',
                            year: 2024,
                            description: 'Aktueller Lebenslauf mit allen relevanten Informationen',
                            file: null,
                            fileName: 'Manuel_Weiss_CV.pdf'
                        }
                    ]
                }));
            }

            loadCurrentDesign() {
                const data = this.designData;
                
                // Load content
                document.getElementById('candidateName').value = data.content.candidateName;
                document.getElementById('candidatePosition').value = data.content.candidatePosition;
                document.getElementById('candidateEmail').value = data.content.candidateEmail;
                document.getElementById('candidatePhone').value = data.content.candidatePhone;
                document.getElementById('candidateLocation').value = data.content.candidateLocation;
                document.getElementById('coverLetterText').value = data.content.coverLetterText;
                document.getElementById('skillsText').value = data.content.skillsText;

                // Load design
                document.getElementById('primaryColor').value = data.design.primaryColor;
                document.getElementById('secondaryColor').value = data.design.secondaryColor;
                document.getElementById('primaryColorPicker').value = data.design.primaryColor;
                document.getElementById('secondaryColorPicker').value = data.design.secondaryColor;
                this.selectStyle(data.design.style);

                // Load branding
                document.getElementById('companyName').value = data.branding.companyName;
                document.getElementById('companyInitials').value = data.branding.companyInitials;
                document.getElementById('brandingTemplate').value = data.branding.template;
                
                if (data.branding.logo) {
                    this.updateLogoPreview(data.branding.logo);
                }
            }

            updatePreview() {
                // Collect current data
                const currentData = {
                    content: {
                        candidateName: document.getElementById('candidateName').value,
                        candidatePosition: document.getElementById('candidatePosition').value,
                        candidateEmail: document.getElementById('candidateEmail').value,
                        candidatePhone: document.getElementById('candidatePhone').value,
                        candidateLocation: document.getElementById('candidateLocation').value,
                        coverLetterText: document.getElementById('coverLetterText').value,
                        skillsText: document.getElementById('skillsText').value
                    },
                    design: {
                        primaryColor: document.getElementById('primaryColor').value,
                        secondaryColor: document.getElementById('secondaryColor').value,
                        style: this.currentStyle
                    },
                    branding: {
                        companyName: document.getElementById('companyName').value,
                        companyInitials: document.getElementById('companyInitials').value,
                        logo: this.designData.branding.logo,
                        template: document.getElementById('brandingTemplate').value
                    }
                };

                // Save to localStorage
                this.designData = currentData;
                localStorage.setItem('hrDesignData', JSON.stringify(currentData));

                // Update preview iframe
                const iframe = document.getElementById('previewFrame');
                iframe.src = iframe.src; // Refresh iframe
            }

            selectStyle(style) {
                this.currentStyle = style;
                
                // Update active style variant
                document.querySelectorAll('.style-variant').forEach(variant => {
                    variant.classList.remove('active');
                });
                document.querySelector(`[data-style="${style}"]`).classList.add('active');

                // Apply style-specific colors
                const styleColors = this.getStyleColors(style);
                document.getElementById('primaryColor').value = styleColors.primary;
                document.getElementById('secondaryColor').value = styleColors.secondary;
                document.getElementById('primaryColorPicker').value = styleColors.primary;
                document.getElementById('secondaryColorPicker').value = styleColors.secondary;

                this.updatePreview();
            }

            getStyleColors(style) {
                const styleColors = {
                    swiss: { primary: '#1e40af', secondary: '#059669' },
                    modern: { primary: '#6366f1', secondary: '#8b5cf6' },
                    corporate: { primary: '#1f2937', secondary: '#374151' },
                    creative: { primary: '#dc2626', secondary: '#f59e0b' }
                };
                return styleColors[style] || styleColors.swiss;
            }

            handleLogoUpload(event) {
                const file = event.dataTransfer ? event.dataTransfer.files[0] : event.target.files[0];
                if (!file) return;

                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.designData.branding.logo = e.target.result;
                        this.updateLogoPreview(e.target.result);
                        this.updatePreview();
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('Bitte wählen Sie eine Bilddatei aus.');
                }
            }

            updateLogoPreview(logoData) {
                const preview = document.getElementById('logoPreview');
                if (logoData) {
                    preview.innerHTML = `<img src="${logoData}" alt="Company Logo">`;
                } else {
                    preview.innerHTML = `<div class="fallback">${document.getElementById('companyInitials').value}</div>`;
                }
            }

            async detectCompanyBranding() {
                const companyName = document.getElementById('companyName').value;
                if (!companyName) {
                    alert('Bitte geben Sie zuerst einen Firmennamen ein.');
                    return;
                }

                // Simulate AI detection
                const branding = await this.simulateAIDetection(companyName);
                
                // Apply detected branding
                document.getElementById('primaryColor').value = branding.primary;
                document.getElementById('secondaryColor').value = branding.secondary;
                document.getElementById('primaryColorPicker').value = branding.primary;
                document.getElementById('secondaryColorPicker').value = branding.secondary;
                document.getElementById('companyInitials').value = branding.initials;
                
                this.updateLogoPreview(null);
                this.updatePreview();
            }

            async simulateAIDetection(companyName) {
                // Simulate AI processing
                await new Promise(resolve => setTimeout(resolve, 1500));
                
                // Return simulated branding based on company name
                const lowerName = companyName.toLowerCase();
                
                if (lowerName.includes('google')) {
                    return { primary: '#4285f4', secondary: '#34a853', initials: 'G' };
                } else if (lowerName.includes('microsoft')) {
                    return { primary: '#0078d4', secondary: '#00bcf2', initials: 'M' };
                } else if (lowerName.includes('apple')) {
                    return { primary: '#000000', secondary: '#1d1d1f', initials: '🍎' };
                } else if (lowerName.includes('sap')) {
                    return { primary: '#0f7b0f', secondary: '#1e7e34', initials: 'SAP' };
                } else if (lowerName.includes('siemens')) {
                    return { primary: '#009999', secondary: '#00cccc', initials: 'S' };
                } else {
                    // Default Swiss branding
                    return { primary: '#1e40af', secondary: '#059669', initials: companyName.substring(0, 2).toUpperCase() };
                }
            }

            // Certificate Management
            renderCertificates() {
                const container = document.getElementById('certificatesContainer');
                const certificates = this.designData.certificates || [];
                
                container.innerHTML = '';
                
                certificates.forEach(cert => {
                    const certElement = this.createCertificateElement(cert);
                    container.appendChild(certElement);
                });
            }

            createCertificateElement(cert) {
                const div = document.createElement('div');
                div.className = 'certificate-item';
                div.innerHTML = `
                    <div class="certificate-header">
                        <div class="certificate-title">${cert.title}</div>
                        <div class="certificate-actions">
                            <button class="certificate-btn download" data-action="download-certificate" data-param="${cert.id}" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button class="certificate-btn edit" data-action="edit-certificate" data-param="${cert.id}" title="Bearbeiten">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="certificate-btn delete" data-action="delete-certificate" data-param="${cert.id}" title="Löschen">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="certificate-info">
                        <div class="certificate-info-item">
                            <i class="fas fa-university"></i>
                            <span>${cert.institution}</span>
                        </div>
                        <div class="certificate-info-item">
                            <i class="fas fa-calendar"></i>
                            <span>${cert.year}</span>
                        </div>
                    </div>
                    <div class="certificate-preview">
                        ${cert.file ? 
                            `<img src="${cert.file}" alt="${cert.title}">` : 
                            `<div class="fallback">
                                <i class="fas fa-file-pdf"></i>
                                <div>${cert.fileName || 'Keine Datei'}</div>
                            </div>`
                        }
                    </div>
                `;
                return div;
            }

            handleCertificateFileUpload(event) {
                const file = event.dataTransfer ? event.dataTransfer.files[0] : event.target.files[0];
                if (!file) return;

                if (file.type.startsWith('image/') || file.type === 'application/pdf') {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById('fileInfo').innerHTML = `
                            <i class="fas fa-check-circle"></i>
                            ${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)
                        `;
                        document.getElementById('fileInfo').style.display = 'block';
                        
                        // Store file data temporarily
                        this.tempCertificateFile = {
                            data: e.target.result,
                            name: file.name,
                            type: file.type
                        };
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('Bitte wählen Sie eine PDF- oder Bilddatei aus.');
                }
            }

            addCertificate() {
                this.editingCertificateId = null;
                this.openCertificateModal();
            }

            editCertificate(id) {
                const cert = this.designData.certificates.find(c => c.id === id);
                if (!cert) return;

                this.editingCertificateId = id;
                this.openCertificateModal(cert);
            }

            openCertificateModal(cert = null) {
                const modal = document.getElementById('certificateModal');
                const title = document.getElementById('certificateModalTitle');
                
                if (cert) {
                    title.textContent = 'Zeugnis bearbeiten';
                    document.getElementById('certificateTitle').value = cert.title;
                    document.getElementById('certificateInstitution').value = cert.institution;
                    document.getElementById('certificateYear').value = cert.year;
                    document.getElementById('certificateDescription').value = cert.description || '';
                    
                    if (cert.file) {
                        document.getElementById('fileInfo').innerHTML = `
                            <i class="fas fa-check-circle"></i>
                            ${cert.fileName || 'Datei geladen'}
                        `;
                        document.getElementById('fileInfo').style.display = 'block';
                    }
                } else {
                    title.textContent = 'Zeugnis hinzufügen';
                    document.getElementById('certificateTitle').value = '';
                    document.getElementById('certificateInstitution').value = '';
                    document.getElementById('certificateYear').value = '';
                    document.getElementById('certificateDescription').value = '';
                    document.getElementById('fileInfo').style.display = 'none';
                }
                
                modal.classList.add('active');
            }

            saveCertificate() {
                const title = document.getElementById('certificateTitle').value;
                const institution = document.getElementById('certificateInstitution').value;
                const year = document.getElementById('certificateYear').value;
                const description = document.getElementById('certificateDescription').value;

                if (!title || !institution || !year) {
                    alert('Bitte füllen Sie alle Pflichtfelder aus.');
                    return;
                }

                const certificate = {
                    id: this.editingCertificateId || 'cert_' + Date.now(),
                    title,
                    institution,
                    year: parseInt(year),
                    description,
                    file: this.tempCertificateFile ? this.tempCertificateFile.data : null,
                    fileName: this.tempCertificateFile ? this.tempCertificateFile.name : null
                };

                if (this.editingCertificateId) {
                    // Update existing certificate
                    const index = this.designData.certificates.findIndex(c => c.id === this.editingCertificateId);
                    if (index !== -1) {
                        this.designData.certificates[index] = certificate;
                    }
                } else {
                    // Add new certificate
                    this.designData.certificates.push(certificate);
                }

                this.tempCertificateFile = null;
                this.renderCertificates();
                this.updatePreview();
                this.closeCertificateModal();
            }

            deleteCertificate(id) {
                if (confirm('Möchten Sie dieses Zeugnis wirklich löschen?')) {
                    this.designData.certificates = this.designData.certificates.filter(c => c.id !== id);
                    this.renderCertificates();
                    this.updatePreview();
                }
            }

            downloadCertificate(id) {
                const cert = this.designData.certificates.find(c => c.id === id);
                if (!cert) return;

                if (cert.file) {
                    // Download from stored file data
                    const link = document.createElement('a');
                    link.href = cert.file;
                    link.download = cert.fileName || `${cert.title}.pdf`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else if (cert.fileName) {
                    // Try to download from server
                    const link = document.createElement('a');
                    link.href = cert.fileName;
                    link.download = cert.fileName;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    alert('Keine Datei verfügbar für Download.');
                }
            }

            closeCertificateModal() {
                document.getElementById('certificateModal').classList.remove('active');
                this.editingCertificateId = null;
                this.tempCertificateFile = null;
                
                // Reset form
                document.getElementById('certificateTitle').value = '';
                document.getElementById('certificateInstitution').value = '';
                document.getElementById('certificateYear').value = '';
                document.getElementById('certificateDescription').value = '';
                document.getElementById('fileInfo').style.display = 'none';
            }

            // Cover Letter Generator Functions
            async generateCoverLetter() {
                const jobDescription = document.getElementById('jobDescription').value;
                const companyName = document.getElementById('aiCompanyName').value;
                const positionTitle = document.getElementById('aiPositionTitle').value;
                const additionalRequirements = document.getElementById('additionalRequirements').value;

                if (!jobDescription || !companyName || !positionTitle) {
                    alert('Bitte füllen Sie alle Pflichtfelder aus.');
                    return;
                }

                // Get current candidate data
                const candidateData = {
                    name: document.getElementById('candidateName').value,
                    position: document.getElementById('candidatePosition').value,
                    email: document.getElementById('candidateEmail').value,
                    phone: document.getElementById('candidatePhone').value,
                    location: document.getElementById('candidateLocation').value,
                    skills: document.getElementById('skillsText').value
                };

                // Show loading state
                const generateBtn = document.querySelector('[onclick="generateCoverLetter()"]');
                const originalText = generateBtn.innerHTML;
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generiere...';

                try {
                    // Simulate AI generation (replace with actual OpenAI API call)
                    const coverLetter = await this.simulateCoverLetterGeneration(
                        jobDescription, companyName, positionTitle, additionalRequirements, candidateData
                    );
                    
                    document.getElementById('generatedCoverLetter').value = coverLetter;
                    console.log('✅ Anschreiben erfolgreich generiert');
                } catch (error) {
                    console.error('Fehler beim Generieren des Anschreibens:', error);
                    alert('Fehler beim Generieren des Anschreibens. Bitte versuchen Sie es erneut.');
                } finally {
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = originalText;
                }
            }

            async simulateCoverLetterGeneration(jobDescription, companyName, positionTitle, additionalRequirements, candidateData) {
                // Simulate AI processing time
                await new Promise(resolve => setTimeout(resolve, 2000));

                // Generate a realistic cover letter based on the input
                const coverLetter = `Sehr geehrte Damen und Herren,

mit großem Interesse habe ich Ihre Stellenanzeige für die Position "${positionTitle}" bei ${companyName} gelesen. Als erfahrener ${candidateData.position} mit über 6 Jahren Berufserfahrung in der digitalen Transformation von Geschäftsprozessen bin ich überzeugt, dass ich eine wertvolle Bereicherung für Ihr Team darstellen kann.

Meine Expertise umfasst die Implementierung moderner HR-Technologien, die Optimierung von Geschäftsprozessen und die Entwicklung innovativer Lösungen für Unternehmen aller Größenordnungen. Besonders begeistert mich die Möglichkeit, bei ${companyName} an zukunftsweisenden Projekten mitzuwirken.

In meiner bisherigen Laufbahn habe ich erfolgreich komplexe Digitalisierungsprojekte geleitet und dabei stets den Fokus auf nachhaltige Lösungen und Stakeholder-Zufriedenheit gelegt. Meine analytische Denkweise und meine Fähigkeit, technische Konzepte verständlich zu vermitteln, haben mir dabei geholfen, auch in herausfordernden Situationen erfolgreich zu sein.

${additionalRequirements ? `Besonders interessiert mich ${additionalRequirements}, da dies perfekt zu meinen Stärken und Interessen passt.` : ''}

Ich freue mich auf die Möglichkeit, in einem persönlichen Gespräch mehr über die Position und Ihre Erwartungen zu erfahren. Gerne stehe ich Ihnen für weitere Fragen zur Verfügung.

Mit freundlichen Grüßen
${candidateData.name}

Kontakt:
E-Mail: ${candidateData.email}
Telefon: ${candidateData.phone}
Standort: ${candidateData.location}`;

                return coverLetter;
            }

            improveTone() {
                const currentText = document.getElementById('generatedCoverLetter').value;
                if (!currentText) {
                    alert('Bitte generieren Sie zuerst ein Anschreiben.');
                    return;
                }

                // Simulate tone improvement
                const improvedText = currentText.replace(
                    /mit großem Interesse/g,
                    'mit außergewöhnlichem Interesse'
                ).replace(
                    /bin ich überzeugt/g,
                    'bin ich fest davon überzeugt'
                ).replace(
                    /wertvolle Bereicherung/g,
                    'außergewöhnliche Bereicherung'
                );

                document.getElementById('generatedCoverLetter').value = improvedText;
                console.log('✅ Ton des Anschreibens verbessert');
            }

            regenerateParagraph() {
                const currentText = document.getElementById('generatedCoverLetter').value;
                if (!currentText) {
                    alert('Bitte generieren Sie zuerst ein Anschreiben.');
                    return;
                }

                // Simulate paragraph regeneration
                const paragraphs = currentText.split('\n\n');
                if (paragraphs.length > 2) {
                    // Regenerate middle paragraph
                    const newParagraph = `Meine umfassende Erfahrung in der digitalen Transformation und mein tiefes Verständnis für moderne Geschäftsprozesse qualifizieren mich ideal für diese Position. Ich bringe nicht nur technische Expertise mit, sondern auch die Fähigkeit, komplexe Projekte erfolgreich zu leiten und Teams zu motivieren.`;
                    paragraphs[2] = newParagraph;
                    document.getElementById('generatedCoverLetter').value = paragraphs.join('\n\n');
                }
                console.log('✅ Absatz neu generiert');
            }

            saveCoverLetter() {
                const coverLetterText = document.getElementById('generatedCoverLetter').value;
                const companyName = document.getElementById('aiCompanyName').value;
                const positionTitle = document.getElementById('aiPositionTitle').value;

                if (!coverLetterText) {
                    alert('Bitte generieren Sie zuerst ein Anschreiben.');
                    return;
                }

                // Save to localStorage
                const savedLetters = JSON.parse(localStorage.getItem('coverLetters') || '[]');
                const newLetter = {
                    id: Date.now(),
                    company: companyName,
                    position: positionTitle,
                    content: coverLetterText,
                    createdAt: new Date().toISOString()
                };
                savedLetters.push(newLetter);
                localStorage.setItem('coverLetters', JSON.stringify(savedLetters));

                // Update cover letter text in content
                document.getElementById('coverLetterText').value = coverLetterText;
                this.updatePreview();

                alert('Anschreiben erfolgreich gespeichert!');
                console.log('✅ Anschreiben gespeichert');
            }

            copyCoverLetter() {
                const coverLetterText = document.getElementById('generatedCoverLetter').value;
                if (!coverLetterText) {
                    alert('Bitte generieren Sie zuerst ein Anschreiben.');
                    return;
                }

                navigator.clipboard.writeText(coverLetterText).then(() => {
                    alert('Anschreiben in die Zwischenablage kopiert!');
                    console.log('✅ Anschreiben kopiert');
                }).catch(err => {
                    console.error('Fehler beim Kopieren:', err);
                    alert('Fehler beim Kopieren. Bitte versuchen Sie es erneut.');
                });
            }

            // Intelligent Analysis Functions
            async startIntelligentAnalysis() {
                console.log('🧠 Starte intelligente Datenanalyse...');
                await this.analyzeApplicationHistory();
                await this.analyzeCoverLetterPatterns();
                this.setupJobDescriptionListener();
            }

            async analyzeApplicationHistory() {
                const applications = JSON.parse(localStorage.getItem('applications') || '[]');
                const coverLetters = JSON.parse(localStorage.getItem('coverLetters') || '[]');
                
                // Simulate analysis progress
                this.animateProgress('historyProgress', 100, 2000);
                
                // Calculate success rate
                const successfulApps = applications.filter(app => 
                    app.status === 'accepted' || app.status === 'interview'
                );
                const successRate = applications.length > 0 ? 
                    Math.round((successfulApps.length / applications.length) * 100) : 0;
                
                // Extract keywords from successful applications
                const keywords = this.extractKeywords(successfulApps, coverLetters);
                
                // Update UI
                setTimeout(() => {
                    document.getElementById('applicationsCount').textContent = applications.length;
                    document.getElementById('successRate').textContent = `${successRate}%`;
                    document.getElementById('topKeywords').textContent = keywords.slice(0, 3).join(', ');
                    
                    // Mark step as completed
                    document.getElementById('step1').classList.add('completed');
                    document.getElementById('step1').classList.remove('active');
                    document.getElementById('step2').classList.add('active');
                    
                    console.log('✅ Bewerbungshistorie analysiert');
                }, 2000);
            }

            async analyzeCoverLetterPatterns() {
                const coverLetters = JSON.parse(localStorage.getItem('coverLetters') || '[]');
                const applications = JSON.parse(localStorage.getItem('applications') || '[]');
                
                // Simulate analysis progress
                this.animateProgress('patternProgress', 100, 2500);
                
                // Analyze successful patterns
                const successfulLetters = coverLetters.filter(letter => {
                    const relatedApp = applications.find(app => 
                        app.coverLetterId === letter.id && 
                        (app.status === 'accepted' || app.status === 'interview')
                    );
                    return relatedApp;
                });
                
                const patterns = this.analyzeSuccessfulPatterns(successfulLetters);
                
                // Update UI
                setTimeout(() => {
                    document.getElementById('successfulPhrases').textContent = patterns.phrases.length;
                    document.getElementById('optimalTone').textContent = patterns.tone;
                    document.getElementById('targetPatterns').textContent = patterns.targets.join(', ');
                    
                    // Mark step as completed
                    document.getElementById('step2').classList.add('completed');
                    document.getElementById('step2').classList.remove('active');
                    document.getElementById('step3').classList.add('active');
                    
                    console.log('✅ Anschreiben-Pattern analysiert');
                }, 2500);
            }

            extractKeywords(applications, coverLetters) {
                const allText = [
                    ...applications.map(app => `${app.company} ${app.position} ${app.notes || ''}`),
                    ...coverLetters.map(letter => letter.content)
                ].join(' ').toLowerCase();
                
                // Common business keywords
                const businessKeywords = [
                    'digitalisierung', 'prozessoptimierung', 'hr-tech', 'beratung',
                    'projektmanagement', 'change management', 'stakeholder', 'analytics',
                    'transformation', 'innovation', 'strategie', 'implementierung',
                    'teamleitung', 'agile', 'scrum', 'kanban', 'lean', 'six sigma'
                ];
                
                const keywordCounts = {};
                businessKeywords.forEach(keyword => {
                    const regex = new RegExp(keyword, 'gi');
                    const matches = allText.match(regex);
                    if (matches) {
                        keywordCounts[keyword] = matches.length;
                    }
                });
                
                return Object.entries(keywordCounts)
                    .sort(([,a], [,b]) => b - a)
                    .slice(0, 5)
                    .map(([keyword]) => keyword);
            }

            analyzeSuccessfulPatterns(successfulLetters) {
                if (successfulLetters.length === 0) {
                    return {
                        phrases: [],
                        tone: 'Professionell',
                        targets: ['Allgemein']
                    };
                }
                
                // Analyze tone patterns
                const tones = ['Professionell', 'Enthusiastisch', 'Analytisch', 'Kreativ'];
                const tone = tones[Math.floor(Math.random() * tones.length)];
                
                // Extract successful phrases
                const phrases = [
                    'mit großem Interesse',
                    'wertvolle Bereicherung',
                    'umfassende Erfahrung',
                    'nachhaltige Lösungen',
                    'innovative Ansätze'
                ];
                
                // Analyze target patterns
                const targets = ['Tech-Unternehmen', 'Beratung', 'Startups', 'Konzerne'];
                
                return { phrases, tone, targets };
            }

            setupJobDescriptionListener() {
                const jobDescription = document.getElementById('jobDescription');
                if (jobDescription) {
                    jobDescription.addEventListener('input', () => {
                        if (jobDescription.value.length > 100) {
                            this.analyzeJobDescription(jobDescription.value);
                        }
                    });
                }
            }

            async analyzeJobDescription(jobText) {
                // Simulate job analysis
                const keywords = this.extractJobKeywords(jobText);
                const requirements = this.extractRequirements(jobText);
                const culture = this.analyzeCompanyCulture(jobText);
                const matchScore = this.calculateMatchScore(keywords, requirements);
                
                // Update analysis results
                document.getElementById('keyWords').textContent = keywords.slice(0, 5).join(', ');
                document.getElementById('requirements').textContent = requirements.slice(0, 3).join(', ');
                document.getElementById('companyCulture').textContent = culture;
                document.getElementById('matchScore').textContent = `${matchScore}%`;
                
                // Show results
                document.getElementById('jobAnalysisResults').style.display = 'block';
                
                // Mark step as completed
                document.getElementById('step3').classList.add('completed');
                document.getElementById('step3').classList.remove('active');
                document.getElementById('step4').classList.add('active');
                
                console.log('✅ Stellenanzeige analysiert');
            }

            extractJobKeywords(jobText) {
                const keywords = [
                    'javascript', 'python', 'java', 'react', 'angular', 'vue',
                    'agile', 'scrum', 'kanban', 'devops', 'cloud', 'aws',
                    'leadership', 'management', 'team', 'communication',
                    'analytics', 'data', 'ai', 'machine learning', 'blockchain'
                ];
                
                return keywords.filter(keyword => 
                    jobText.toLowerCase().includes(keyword)
                );
            }

            extractRequirements(jobText) {
                const requirements = [
                    'Studium', 'Bachelor', 'Master', 'Ausbildung',
                    'Erfahrung', 'Jahre', 'Kenntnisse', 'Skills',
                    'Sprachen', 'Englisch', 'Deutsch', 'Französisch'
                ];
                
                return requirements.filter(req => 
                    jobText.toLowerCase().includes(req)
                );
            }

            analyzeCompanyCulture(jobText) {
                const cultureIndicators = {
                    'startup': ['startup', 'agile', 'flexibel', 'dynamisch'],
                    'corporate': ['etabliert', 'traditionell', 'strukturiert', 'hierarchisch'],
                    'tech': ['innovation', 'technologie', 'digital', 'modern'],
                    'consulting': ['beratung', 'kunde', 'projekt', 'lösung']
                };
                
                for (const [culture, indicators] of Object.entries(cultureIndicators)) {
                    if (indicators.some(indicator => jobText.toLowerCase().includes(indicator))) {
                        return culture.charAt(0).toUpperCase() + culture.slice(1);
                    }
                }
                
                return 'Allgemein';
            }

            calculateMatchScore(keywords, requirements) {
                const candidateSkills = [
                    'digitalisierung', 'prozessoptimierung', 'hr-tech', 'beratung',
                    'projektmanagement', 'change management', 'analytics'
                ];
                
                const matchingKeywords = keywords.filter(keyword => 
                    candidateSkills.some(skill => 
                        keyword.toLowerCase().includes(skill) || 
                        skill.includes(keyword.toLowerCase())
                    )
                );
                
                return Math.min(95, Math.round((matchingKeywords.length / Math.max(keywords.length, 1)) * 100));
            }

            animateProgress(elementId, targetWidth, duration) {
                const element = document.getElementById(elementId);
                if (!element) return;
                
                let currentWidth = 0;
                const increment = targetWidth / (duration / 50);
                
                const timer = setInterval(() => {
                    currentWidth += increment;
                    element.style.width = `${Math.min(currentWidth, targetWidth)}%`;
                    
                    if (currentWidth >= targetWidth) {
                        clearInterval(timer);
                    }
                }, 50);
            }

            async startIntelligentGeneration() {
                const jobDescription = document.getElementById('jobDescription').value;
                const companyName = document.getElementById('aiCompanyName').value;
                const positionTitle = document.getElementById('aiPositionTitle').value;
                const additionalRequirements = document.getElementById('additionalRequirements').value;

                if (!jobDescription || !companyName || !positionTitle) {
                    alert('Bitte füllen Sie alle Pflichtfelder aus.');
                    return;
                }

                // Get analysis data
                const analysisData = this.getAnalysisData();
                const generationOptions = this.getGenerationOptions();

                // Show loading state
                const generateBtn = document.querySelector('[onclick="startIntelligentGeneration()"]');
                const originalText = generateBtn.innerHTML;
                generateBtn.disabled = true;
                generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generiere intelligentes Anschreiben...';

                try {
                    const coverLetter = await this.generateIntelligentCoverLetter(
                        jobDescription, companyName, positionTitle, additionalRequirements,
                        analysisData, generationOptions
                    );
                    
                    document.getElementById('generatedCoverLetter').value = coverLetter;
                    console.log('✅ Intelligentes Anschreiben generiert');
                } catch (error) {
                    console.error('Fehler beim Generieren:', error);
                    alert('Fehler beim Generieren des Anschreibens. Bitte versuchen Sie es erneut.');
                } finally {
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = originalText;
                }
            }

            getAnalysisData() {
                return {
                    successRate: document.getElementById('successRate').textContent,
                    topKeywords: document.getElementById('topKeywords').textContent.split(', '),
                    successfulPhrases: document.getElementById('successfulPhrases').textContent,
                    optimalTone: document.getElementById('optimalTone').textContent,
                    targetPatterns: document.getElementById('targetPatterns').textContent.split(', '),
                    keyWords: document.getElementById('keyWords').textContent.split(', '),
                    requirements: document.getElementById('requirements').textContent.split(', '),
                    companyCulture: document.getElementById('companyCulture').textContent,
                    matchScore: document.getElementById('matchScore').textContent
                };
            }

            getGenerationOptions() {
                return {
                    useSuccessfulPatterns: document.getElementById('useSuccessfulPatterns').checked,
                    optimizeForCompany: document.getElementById('optimizeForCompany').checked,
                    includeKeywords: document.getElementById('includeKeywords').checked
                };
            }

            async generateIntelligentCoverLetter(jobDescription, companyName, positionTitle, additionalRequirements, analysisData, options) {
                // Simulate AI processing time
                await new Promise(resolve => setTimeout(resolve, 3000));

                // Get current candidate data
                const candidateData = {
                    name: document.getElementById('candidateName').value,
                    position: document.getElementById('candidatePosition').value,
                    email: document.getElementById('candidateEmail').value,
                    phone: document.getElementById('candidatePhone').value,
                    location: document.getElementById('candidateLocation').value,
                    skills: document.getElementById('skillsText').value
                };

                // Build intelligent cover letter based on analysis
                let coverLetter = `Sehr geehrte Damen und Herren,

mit ${options.useSuccessfulPatterns ? 'außergewöhnlichem' : 'großem'} Interesse habe ich Ihre Stellenanzeige für die Position "${positionTitle}" bei ${companyName} gelesen. Als erfahrener ${candidateData.position} mit über 6 Jahren Berufserfahrung in der digitalen Transformation von Geschäftsprozessen bin ich ${options.useSuccessfulPatterns ? 'fest davon überzeugt' : 'überzeugt'}, dass ich eine ${options.useSuccessfulPatterns ? 'außergewöhnliche' : 'wertvolle'} Bereicherung für Ihr Team darstellen kann.

Meine Expertise umfasst die Implementierung moderner HR-Technologien, die Optimierung von Geschäftsprozessen und die Entwicklung innovativer Lösungen für Unternehmen aller Größenordnungen.`;

                // Add company-specific content
                if (options.optimizeForCompany) {
                    coverLetter += ` Besonders begeistert mich die Möglichkeit, bei ${companyName} an zukunftsweisenden Projekten mitzuwirken und dabei von der ${analysisData.companyCulture.toLowerCase()} Unternehmenskultur zu profitieren.`;
                }

                // Add keyword-optimized content
                if (options.includeKeywords && analysisData.keyWords.length > 0) {
                    const relevantKeywords = analysisData.keyWords.slice(0, 3);
                    coverLetter += ` Meine umfassende Erfahrung in den Bereichen ${relevantKeywords.join(', ')} qualifiziert mich ideal für diese Position.`;
                }

                coverLetter += `

In meiner bisherigen Laufbahn habe ich erfolgreich komplexe Digitalisierungsprojekte geleitet und dabei stets den Fokus auf nachhaltige Lösungen und Stakeholder-Zufriedenheit gelegt. Meine analytische Denkweise und meine Fähigkeit, technische Konzepte verständlich zu vermitteln, haben mir dabei geholfen, auch in herausfordernden Situationen erfolgreich zu sein.

${additionalRequirements ? `Besonders interessiert mich ${additionalRequirements}, da dies perfekt zu meinen Stärken und Interessen passt und mir die Möglichkeit bietet, meine Expertise in diesem Bereich weiter auszubauen.` : ''}

Ich freue mich auf die Möglichkeit, in einem persönlichen Gespräch mehr über die Position und Ihre Erwartungen zu erfahren. Gerne stehe ich Ihnen für weitere Fragen zur Verfügung.

Mit freundlichen Grüßen
${candidateData.name}

Kontakt:
E-Mail: ${candidateData.email}
Telefon: ${candidateData.phone}
Standort: ${candidateData.location}

---
📊 Generiert mit intelligenter Analyse:
• Erfolgsrate: ${analysisData.successRate}
• Match-Score: ${analysisData.matchScore}
• Optimiert für: ${analysisData.companyCulture} Kultur`;

                return coverLetter;
            }

            // Profile & Digital Twin Functions
            toggleProfileMode() {
                const profileDisplay = document.getElementById('profileDisplay');
                const toggleBtn = document.getElementById('profileToggleBtn');
                const isDigitalTwin = profileDisplay.classList.contains('digital-twin');
                
                if (isDigitalTwin) {
                    // Switch to photo mode
                    profileDisplay.classList.remove('digital-twin');
                    toggleBtn.innerHTML = '<i class="fas fa-camera"></i><span>Foto</span>';
                } else {
                    // Switch to digital twin mode
                    profileDisplay.classList.add('digital-twin');
                    toggleBtn.innerHTML = '<i class="fas fa-robot"></i><span>AI Twin</span>';
                }
            }

            playDigitalTwin() {
                const coverLetterText = document.getElementById('generatedCoverLetter').value;
                if (!coverLetterText) {
                    alert('Bitte generieren Sie zuerst ein Anschreiben.');
                    return;
                }
                
                // Show voice recording modal
                document.getElementById('voiceRecordingModal').style.display = 'block';
                this.startTextToSpeech(coverLetterText);
            }

            startTextToSpeech(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'de-DE';
                    utterance.rate = 0.9;
                    utterance.pitch = 1.0;
                    
                    utterance.onstart = () => {
                        document.getElementById('recordingStatus').textContent = 'Digital Twin spricht...';
                        document.getElementById('recordingVisualizer').innerHTML = '<i class="fas fa-volume-up"></i>';
                    };
                    
                    utterance.onend = () => {
                        document.getElementById('recordingStatus').textContent = 'Wiedergabe beendet';
                        document.getElementById('recordingVisualizer').innerHTML = '<i class="fas fa-microphone"></i>';
                    };
                    
                    speechSynthesis.speak(utterance);
                } else {
                    alert('Text-to-Speech wird von diesem Browser nicht unterstützt.');
                }
            }

            // Analytics Functions
            updateAnalytics() {
                const applications = JSON.parse(localStorage.getItem('applications') || '[]');
                const coverLetters = JSON.parse(localStorage.getItem('coverLetters') || '[]');
                
                // Calculate metrics
                const totalApps = applications.length;
                const responses = applications.filter(app => 
                    app.status === 'reviewed' || app.status === 'interview' || 
                    app.status === 'accepted' || app.status === 'rejected'
                ).length;
                const interviews = applications.filter(app => 
                    app.status === 'interview' || app.status === 'accepted'
                ).length;
                const offers = applications.filter(app => 
                    app.status === 'accepted'
                ).length;
                
                const responseRate = totalApps > 0 ? Math.round((responses / totalApps) * 100) : 0;
                const interviewRate = responses > 0 ? Math.round((interviews / responses) * 100) : 0;
                const offerRate = interviews > 0 ? Math.round((offers / interviews) * 100) : 0;
                
                // Update UI
                document.getElementById('totalApplications').textContent = totalApps;
                document.getElementById('responseRate').textContent = `${responseRate}%`;
                document.getElementById('interviewRate').textContent = `${interviewRate}%`;
                document.getElementById('offerRate').textContent = `${offerRate}%`;
                
                // Update keywords
                this.updateTopKeywords();
            }

            updateTopKeywords() {
                const applications = JSON.parse(localStorage.getItem('applications') || '[]');
                const keywords = this.extractKeywords(applications, []);
                const keywordList = document.getElementById('topKeywordsList');
                
                keywordList.innerHTML = '';
                keywords.slice(0, 5).forEach((keyword, index) => {
                    const item = document.createElement('div');
                    item.className = 'keyword-item';
                    item.innerHTML = `
                        <span class="keyword-name">${keyword}</span>
                        <span class="keyword-score">${Math.round(Math.random() * 40) + 60}%</span>
                    `;
                    keywordList.appendChild(item);
                });
            }

            // Template Functions
            loadTemplate(templateType) {
                const templates = {
                    tech: {
                        opening: "Als leidenschaftlicher Technologie-Enthusiast mit über 6 Jahren Erfahrung in der digitalen Transformation...",
                        body: "Meine Expertise in modernen Technologien und agilen Entwicklungsmethoden qualifiziert mich ideal für diese Position...",
                        closing: "Ich freue mich darauf, mit meiner technischen Expertise und meinem Innovationsgeist zu Ihrem Team beizutragen."
                    },
                    consulting: {
                        opening: "Mit großer Begeisterung für strategische Beratung und Prozessoptimierung...",
                        body: "Meine umfassende Erfahrung in der Beratung von Unternehmen verschiedener Branchen...",
                        closing: "Ich bin überzeugt, dass meine analytische Denkweise und mein Stakeholder-Management eine wertvolle Bereicherung darstellen."
                    },
                    startup: {
                        opening: "Als unternehmerisch denkender Experte mit einer Leidenschaft für Innovation und Wachstum...",
                        body: "Meine Erfahrung in dynamischen, schnell wachsenden Umgebungen...",
                        closing: "Ich bin bereit, in einem agilen Startup-Umfeld Verantwortung zu übernehmen und direkt zum Erfolg beizutragen."
                    },
                    corporate: {
                        opening: "Als erfahrener Professional mit einem starken Fokus auf strukturierte Prozesse und nachhaltige Ergebnisse...",
                        body: "Meine Expertise in der Führung komplexer Projekte in etablierten Unternehmensstrukturen...",
                        closing: "Ich freue mich darauf, meine Erfahrung in einem strukturierten, zielorientierten Umfeld einzubringen."
                    }
                };
                
                const template = templates[templateType];
                if (template) {
                    const currentText = document.getElementById('coverLetterText').value;
                    const newText = `${template.opening}\n\n${template.body}\n\n${template.closing}`;
                    document.getElementById('coverLetterText').value = newText;
                    this.updatePreview();
                    
                    // Switch to content tab
                    switchTab('content');
                }
            }

            // Quick Action Functions
            generateEmailVersion() {
                const coverLetter = document.getElementById('coverLetterText').value;
                if (!coverLetter) {
                    alert('Bitte erstellen Sie zuerst ein Anschreiben.');
                    return;
                }
                
                const emailVersion = `Betreff: Bewerbung als ${document.getElementById('aiPositionTitle').value || '[Position]'}

${coverLetter.replace(/Sehr geehrte Damen und Herren,/g, 'Hallo,').replace(/Mit freundlichen Grüßen/g, 'Beste Grüße')}`;
                
                document.getElementById('generatedCoverLetter').value = emailVersion;
                console.log('✅ E-Mail Version generiert');
            }

            generateLinkedInMessage() {
                const coverLetter = document.getElementById('coverLetterText').value;
                if (!coverLetter) {
                    alert('Bitte erstellen Sie zuerst ein Anschreiben.');
                    return;
                }
                
                const linkedinVersion = `Hallo,

ich habe Ihre Stellenanzeige für ${document.getElementById('aiPositionTitle').value || '[Position]'} gesehen und bin sehr interessiert.

${coverLetter.split('\n\n')[1] || 'Kurze Zusammenfassung der relevanten Erfahrung...'}

Würden Sie sich über ein kurzes Gespräch freuen?

Beste Grüße
${document.getElementById('candidateName').value}`;
                
                document.getElementById('generatedCoverLetter').value = linkedinVersion;
                console.log('✅ LinkedIn Message generiert');
            }

            generateVideoScript() {
                const coverLetter = document.getElementById('coverLetterText').value;
                if (!coverLetter) {
                    alert('Bitte erstellen Sie zuerst ein Anschreiben.');
                    return;
                }
                
                const videoScript = `🎥 VIDEO BEWERBUNG SCRIPT (60 Sekunden)

[0-10s] Einleitung
"Hallo, ich bin ${document.getElementById('candidateName').value}, und ich bewerbe mich für die Position ${document.getElementById('aiPositionTitle').value || '[Position]'} bei ${document.getElementById('aiCompanyName').value || '[Unternehmen]'}."

[10-30s] Erfahrung
"Mit über 6 Jahren Erfahrung in der digitalen Transformation habe ich bereits erfolgreich komplexe Projekte geleitet und Teams geführt."

[30-50s] Motivation
"Was mich besonders an dieser Position reizt, ist die Möglichkeit, innovative Lösungen zu entwickeln und direkt zum Unternehmenserfolg beizutragen."

[50-60s] Call-to-Action
"Ich freue mich auf ein persönliches Gespräch. Vielen Dank für Ihre Zeit!"

---
📝 TIPPS:
- Lächeln und Augenkontakt halten
- Professionelle Kleidung
- Gute Beleuchtung
- Ruhiger Hintergrund`;
                
                document.getElementById('generatedCoverLetter').value = videoScript;
                console.log('✅ Video Script generiert');
            }

            generateFollowUp() {
                const followUpText = `Sehr geehrte Damen und Herren,

vor zwei Wochen habe ich mich bei Ihnen für die Position ${document.getElementById('aiPositionTitle').value || '[Position]'} beworben und möchte gerne den aktuellen Stand erfragen.

Ich bin nach wie vor sehr interessiert an dieser Position und würde mich freuen, wenn wir die Möglichkeit eines persönlichen Gesprächs besprechen könnten.

Falls Sie noch weitere Informationen benötigen, stehe ich gerne zur Verfügung.

Mit freundlichen Grüßen
${document.getElementById('candidateName').value}

---
📅 TIPPS für Follow-ups:
- Nach 1-2 Wochen nachfragen
- Höflich und professionell bleiben
- Neuen Mehrwert bieten
- Nicht zu oft nachfragen`;
                
                document.getElementById('generatedCoverLetter').value = followUpText;
                console.log('✅ Follow-up generiert');
            }

            // Voice Recording Functions
            startRecording() {
                // Simulate recording start
                document.getElementById('recordingStatus').textContent = 'Aufnahme läuft...';
                document.getElementById('recordingVisualizer').innerHTML = '<i class="fas fa-microphone"></i>';
                document.getElementById('recordBtn').style.display = 'none';
                document.getElementById('stopBtn').style.display = 'inline-flex';
                
                // Simulate recording process
                setTimeout(() => {
                    this.stopRecording();
                }, 3000);
            }

            stopRecording() {
                document.getElementById('recordingStatus').textContent = 'Aufnahme beendet';
                document.getElementById('recordingVisualizer').innerHTML = '<i class="fas fa-check"></i>';
                document.getElementById('stopBtn').style.display = 'none';
                document.getElementById('playBtn').style.display = 'inline-flex';
                document.getElementById('saveVoiceBtn').style.display = 'inline-block';
            }

            playRecording() {
                document.getElementById('recordingStatus').textContent = 'Wiedergabe...';
                document.getElementById('recordingVisualizer').innerHTML = '<i class="fas fa-volume-up"></i>';
                
                // Simulate playback
                setTimeout(() => {
                    document.getElementById('recordingStatus').textContent = 'Wiedergabe beendet';
                    document.getElementById('recordingVisualizer').innerHTML = '<i class="fas fa-check"></i>';
                }, 2000);
            }

            saveVoiceRecording() {
                alert('Voice Recording gespeichert!');
                this.closeVoiceModal();
            }

            closeVoiceModal() {
                document.getElementById('voiceRecordingModal').style.display = 'none';
                // Reset modal state
                document.getElementById('recordingStatus').textContent = 'Bereit für Aufnahme';
                document.getElementById('recordingVisualizer').innerHTML = '<i class="fas fa-microphone"></i>';
                document.getElementById('recordBtn').style.display = 'inline-flex';
                document.getElementById('stopBtn').style.display = 'none';
                document.getElementById('playBtn').style.display = 'none';
                document.getElementById('saveVoiceBtn').style.display = 'none';
            }

            saveDesign() {
                // Design is already saved in updatePreview()
                alert('Design erfolgreich gespeichert!');
            }

            resetDesign() {
                if (confirm('Möchten Sie das Design wirklich zurücksetzen? Alle Änderungen gehen verloren.')) {
                    localStorage.removeItem('hrDesignData');
                    location.reload();
                }
            }

            previewDesign() {
                window.open('bewerbung.html?id=preview', '_blank');
            }
        }

        // Global Functions
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`${tabName}-tab`).classList.add('active');
        }

        function selectStyle(style) {
            hrDesigner.selectStyle(style);
        }

        function detectCompanyBranding() {
            hrDesigner.detectCompanyBranding();
        }

        function saveDesign() {
            hrDesigner.saveDesign();
        }

        function resetDesign() {
            hrDesigner.resetDesign();
        }

        function previewDesign() {
            hrDesigner.previewDesign();
        }

        function refreshPreview() {
            document.getElementById('previewFrame').src = document.getElementById('previewFrame').src;
        }

        function openPreview() {
            window.open('bewerbung.html?id=preview', '_blank');
        }

        // Certificate Functions
        function addCertificate() {
            hrDesigner.addCertificate();
        }

        function editCertificate(id) {
            hrDesigner.editCertificate(id);
        }

        function deleteCertificate(id) {
            hrDesigner.deleteCertificate(id);
        }

        function downloadCertificate(id) {
            hrDesigner.downloadCertificate(id);
        }

        function saveCertificate() {
            hrDesigner.saveCertificate();
        }

        function closeCertificateModal() {
            hrDesigner.closeCertificateModal();
        }

        // Cover Letter Functions
        function generateCoverLetter() {
            hrDesigner.generateCoverLetter();
        }

        function improveTone() {
            hrDesigner.improveTone();
        }

        function regenerateParagraph() {
            hrDesigner.regenerateParagraph();
        }

        function saveCoverLetter() {
            hrDesigner.saveCoverLetter();
        }

        function copyCoverLetter() {
            hrDesigner.copyCoverLetter();
        }

        function startIntelligentGeneration() {
            hrDesigner.startIntelligentGeneration();
        }

        // Global Functions for new features
        function toggleProfileMode() {
            hrDesigner.toggleProfileMode();
        }

        function playDigitalTwin() {
            hrDesigner.playDigitalTwin();
        }

        function loadTemplate(templateType) {
            hrDesigner.loadTemplate(templateType);
        }

        function generateEmailVersion() {
            hrDesigner.generateEmailVersion();
        }

        function generateLinkedInMessage() {
            hrDesigner.generateLinkedInMessage();
        }

        function generateVideoScript() {
            hrDesigner.generateVideoScript();
        }

        function generateFollowUp() {
            hrDesigner.generateFollowUp();
        }

        function startRecording() {
            hrDesigner.startRecording();
        }

        function stopRecording() {
            hrDesigner.stopRecording();
        }

        function playRecording() {
            hrDesigner.playRecording();
        }

        function saveVoiceRecording() {
            hrDesigner.saveVoiceRecording();
        }

        function closeVoiceModal() {
            hrDesigner.closeVoiceModal();
        }

        // Initialize HR Designer
        let hrDesigner;
        document.addEventListener('DOMContentLoaded', () => {
            hrDesigner = new HRDesigner();
        });
    </script>
</body>
</html>
