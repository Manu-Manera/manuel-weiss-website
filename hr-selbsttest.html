<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR-Standortbestimmung - Umfassende HR-Analyse | Manuel Weiss</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="HR-Standortbestimmung: Bewerten Sie Ihre HR-Organisation systematisch. Vision, Kultur, Organisation und Prozesse – mit konkreten Handlungsempfehlungen.">
    <meta name="keywords" content="HR-Standortbestimmung, Standortbestimmung, HR Assessment, Employee Experience, HR Analyse, Digitalisierung">
    <meta name="author" content="Manuel Weiss">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/starry-background.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* ═══════════════════════════════════════════════════════════════════════════
           HR SELBSTTEST - UMFASSENDE HR-ANALYSE
           ═══════════════════════════════════════════════════════════════════════════ */
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%) !important;
            min-height: 100vh;
            color: #e2e8f0;
            padding-top: 70px; /* Platz fuer fixierte Navbar */
        }
        
        /* Moderne Navbar wie Bewerbungsmanager */
        .navbar-selftest {
            position: fixed !important;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(15, 23, 42, 0.95) !important;
            backdrop-filter: blur(20px) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 2rem;
        }
        
        .navbar-selftest .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .navbar-selftest .nav-brand img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .navbar-selftest .nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }
        
        .navbar-selftest .nav-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .navbar-selftest .nav-link:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .navbar-selftest .nav-link.active {
            color: white;
            background: rgba(99, 102, 241, 0.3);
        }
        
        .navbar-selftest .nav-link i {
            margin-right: 0.5rem;
        }
        
        .navbar-selftest .nav-cta {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white !important;
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            font-weight: 600;
            margin-left: 1rem;
        }
        
        .navbar-selftest .nav-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        
        /* Mobile Home Button (links) */
        .mobile-home-btn {
            display: none;
            color: white;
            font-size: 1.25rem;
            padding: 0.5rem;
            text-decoration: none;
        }
        
        /* Desktop-only elements */
        @media (min-width: 769px) {
            .navbar-selftest .mobile-menu-btn { display: none; }
            .mobile-home-btn { display: none; }
            .mobile-export-footer { display: none !important; }
            .desktop-only { display: flex !important; }
        }
        
        @media (max-width: 768px) {
            .navbar-selftest {
                padding: 0 0.75rem;
                justify-content: space-between;
            }
            .navbar-selftest .nav-links { display: none; }
            .navbar-selftest .desktop-only { display: none !important; }
            .mobile-home-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 44px;
                height: 44px;
                background: rgba(99, 102, 241, 0.3);
                border-radius: 10px;
            }
            .navbar-selftest .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 44px;
                height: 44px;
                color: white;
                font-size: 1.25rem;
                cursor: pointer;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
            }
            
            /* Mobile Menu Overlay */
            .mobile-menu-overlay {
                display: none;
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                bottom: 80px; /* Platz für Footer */
                background: rgba(15, 23, 42, 0.98);
                backdrop-filter: blur(20px);
                z-index: 999;
                padding: 1rem;
                overflow-y: auto;
            }
            .mobile-menu-overlay.active { display: block; }
            .mobile-menu-link {
                display: flex;
                align-items: center;
                gap: 1rem;
                color: white;
                padding: 1rem;
                font-size: 1.1rem;
                text-decoration: none;
                border-bottom: 1px solid rgba(255,255,255,0.1);
                transition: background 0.2s;
            }
            .mobile-menu-link:hover, .mobile-menu-link:active {
                background: rgba(255,255,255,0.1);
            }
            .mobile-menu-link i { width: 24px; text-align: center; }
            .mobile-menu-cta {
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                border-radius: 12px;
                border: none;
                margin-top: 0.5rem;
                justify-content: center;
            }
            
            /* Mobile Export Footer */
            .mobile-export-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                padding: 1rem;
                background: rgba(15, 23, 42, 0.95);
                backdrop-filter: blur(20px);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                z-index: 999;
                transition: opacity 0.2s, visibility 0.2s;
            }
            /* Hide mobile export footer when any modal is open */
            .modal-overlay.active ~ .mobile-export-footer,
            body:has(.modal-overlay.active) .mobile-export-footer,
            body:has(.lead-capture-modal.active) .mobile-export-footer {
                opacity: 0;
                visibility: hidden;
                pointer-events: none;
            }
            .lead-capture-modal.active ~ .mobile-export-footer {
                display: none !important;
            }
            .mobile-export-btn {
                width: 100%;
                padding: 1rem;
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.75rem;
            }
            .mobile-export-btn:active {
                transform: scale(0.98);
            }
            
            /* Content padding for fixed footer */
            body { padding-bottom: 80px; }
        }
        
        /* Hero Section */
        .selftest-hero {
            background: rgba(99, 102, 241, 0.15);
            backdrop-filter: blur(20px);
            color: white;
            padding: 3rem 0;
            text-align: center;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            position: relative;
            z-index: 2;
        }
        
        .hero-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 8px 32px rgba(251, 191, 36, 0.3);
        }
        
        .hero-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #fde68a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-subtitle {
            font-size: 1.1rem;
            color: #c7d2fe;
            max-width: 700px;
            margin: 0 auto 1.5rem;
        }
        
        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-weight: 500;
            color: #fde68a;
        }
        
        /* Main Container */
        .selftest-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }
        
        /* Progress Overview */
        .progress-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .progress-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .progress-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .progress-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }
        
        .progress-card.active {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }
        
        .progress-card.completed {
            border-color: #10b981;
        }
        
        .progress-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .progress-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
        }
        
        .progress-card:nth-child(1) .progress-icon { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        .progress-card:nth-child(2) .progress-icon { background: linear-gradient(135deg, #10b981, #059669); }
        .progress-card:nth-child(3) .progress-icon { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .progress-card:nth-child(4) .progress-icon { background: linear-gradient(135deg, #ef4444, #dc2626); }
        
        .progress-title {
            font-weight: 600;
            color: #fff;
            font-size: 1rem;
        }
        
        .progress-bar-container {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .progress-card:nth-child(1) .progress-bar-fill { background: linear-gradient(90deg, #6366f1, #8b5cf6); }
        .progress-card:nth-child(2) .progress-bar-fill { background: linear-gradient(90deg, #10b981, #059669); }
        .progress-card:nth-child(3) .progress-bar-fill { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .progress-card:nth-child(4) .progress-bar-fill { background: linear-gradient(90deg, #ef4444, #dc2626); }
        
        .progress-text {
            font-size: 0.75rem;
            color: #a5b4fc;
            margin-top: 0.5rem;
        }
        
        /* Happy Company Yoga Teppich */
        .yoga-teppich-section {
            margin-bottom: 3rem;
        }
        
        .yoga-teppich-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            aspect-ratio: 1;
        }
        
        .yoga-teppich-svg {
            width: 100%;
            height: 100%;
        }
        
        /* Assessment Section */
        .assessment-section {
            display: none;
        }
        
        .assessment-section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-description {
            color: #a5b4fc;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Question Cards */
        .question-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .question-number {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }
        
        .question-content h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.5rem;
        }
        
        .question-content p {
            color: #a5b4fc;
            font-size: 0.9rem;
        }
        
        /* Rating Scale */
        .rating-scale {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .rating-option {
            flex: 1;
            min-width: 80px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .rating-option:hover {
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .rating-option.selected {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.2);
        }
        
        .rating-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0.25rem;
        }
        
        .rating-label {
            font-size: 0.75rem;
            color: #a5b4fc;
        }
        
        /* Slider Scale */
        .slider-container {
            margin: 1.5rem 0;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: #a5b4fc;
        }
        
        .slider-track {
            position: relative;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        
        .slider-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .slider-thumb {
            position: absolute;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }
        
        .slider-thumb:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .slider-value {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 700;
            color: #fff;
        }
        
        /* Tips Box - Nur in Auswertung anzeigen */
        .tips-box {
            display: none !important; /* Versteckt während Test, nur in Auswertung sichtbar */
        }
        
        .results-section .tips-box {
            display: block !important;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 1.25rem;
            margin-top: 1.5rem;
        }
        
        .tips-box-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            color: #6ee7b7;
            font-weight: 600;
        }
        
        .tips-box ul {
            margin: 0;
            padding-left: 1.25rem;
            color: #a7f3d0;
        }
        
        .tips-box li {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        /* Moderne interaktive Slider statt Buttons */
        .modern-slider-container {
            margin: 1.5rem 0;
            padding: 0 0.5rem;
        }
        
        .modern-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(90deg, #ef4444 0%, #fbbf24 50%, #22c55e 100%);
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        
        .modern-slider:hover {
            opacity: 1;
        }
        
        .modern-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 3px solid #6366f1;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .modern-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        
        .modern-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 3px solid #6366f1;
        }
        
        .slider-value-display {
            text-align: center;
            font-size: 2rem;
            font-weight: 800;
            color: #fff;
            margin: 1rem 0 0.5rem;
            text-shadow: 0 2px 10px rgba(99, 102, 241, 0.5);
        }
        
        .slider-labels-modern {
            display: flex;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        /* Lead Capture Modal */
        .lead-capture-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .lead-capture-modal.active {
            display: flex;
        }
        
        .lead-capture-content {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-radius: 24px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(99, 102, 241, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .lead-capture-content h2 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .lead-capture-content p {
            color: #a5b4fc;
            margin-bottom: 1.5rem;
        }
        
        .lead-form-group {
            margin-bottom: 1rem;
        }
        
        .lead-form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .lead-form-group input[type="text"],
        .lead-form-group input[type="email"] {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
        }
        
        .lead-form-group input:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .checkbox-group-lead {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin: 1rem 0;
        }
        
        .checkbox-group-lead input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            accent-color: #6366f1;
        }
        
        .checkbox-group-lead label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .lead-submit-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .lead-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }
        
        .lead-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Process Grid */
        .process-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        
        .process-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .process-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }
        
        .process-card.completed {
            border-color: #10b981;
        }
        
        .process-card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            margin-bottom: 1rem;
        }
        
        .process-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.5rem;
        }
        
        .process-card p {
            font-size: 0.85rem;
            color: #a5b4fc;
            margin-bottom: 1rem;
        }
        
        .process-card-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }
        
        .process-card-status.pending { color: #fbbf24; }
        .process-card-status.completed { color: #10b981; }
        
        /* Kategorisierte Prozesse */
        .process-category {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .process-category:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }
        
        .category-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .category-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        
        .category-info {
            flex: 1;
            min-width: 0;
        }
        
        .category-info h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin: 0 0 0.5rem 0;
        }
        
        .category-progress {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .category-progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .category-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .category-progress-text {
            font-size: 0.75rem;
            color: #a5b4fc;
            white-space: nowrap;
        }
        
        .category-toggle {
            color: rgba(255, 255, 255, 0.5);
            transition: transform 0.3s ease;
        }
        
        .process-category.expanded .category-toggle {
            transform: rotate(180deg);
        }
        
        .category-processes {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .process-category.expanded .category-processes {
            max-height: 400px;
        }
        
        .process-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.875rem 1.25rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .process-item-top {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .process-item:last-child {
            border-bottom: none;
        }
        
        .process-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .process-item-status {
            font-size: 0.9rem;
        }
        
        .process-item-status.pending { color: rgba(255, 255, 255, 0.3); }
        .process-item-status.completed { color: #10b981; }
        
        .process-item-name {
            flex: 1;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .process-item.completed .process-item-name {
            color: #fff;
        }
        .process-item-top .process-item-name-block {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        .process-item-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.55);
            font-weight: 400;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .process-item-details {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
            margin-top: 0.25rem;
        }
        .process-item-detail-row {
            font-size: 0.72rem;
            line-height: 1.25;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .process-item-detail-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            margin-right: 0.35rem;
        }
        .process-item-detail-value {
            color: rgba(255, 255, 255, 0.55);
            font-weight: 400;
        }
        .process-item-score {
            margin-left: auto;
        }
        
        .score-badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }
        
        .score-badge.pending {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.4);
        }
        
        .process-arrow {
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.7rem;
            transition: transform 0.2s ease;
        }
        
        .process-item:hover .process-arrow {
            transform: translateX(3px);
            color: rgba(255, 255, 255, 0.6);
        }
        
        /* Process Grid Update */
        #processGrid {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-nav {
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-back {
            background: rgba(255, 255, 255, 0.1);
            color: #a5b4fc;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-back:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        
        .btn-next {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        
        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        
        .btn-results {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-results:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        
        /* Results Section */
        .results-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 1024px) {
            .results-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }
        
        .result-score {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }
        
        .result-score.excellent { color: #10b981; }
        .result-score.good { color: #6366f1; }
        .result-score.moderate { color: #fbbf24; }
        .result-score.needs-work { color: #ef4444; }
        
        .result-label {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.25rem;
        }
        
        .result-description {
            font-size: 0.85rem;
            color: #a5b4fc;
        }
        
        /* Recommendations */
        .recommendations-section {
            margin-top: 2rem;
        }
        
        .recommendation-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
            border-color: #6366f1;
        }
        
        .recommendation-card.high-priority {
            border-color: #ef4444;
        }
        
        .recommendation-card.medium-priority {
            border-color: #fbbf24;
        }
        
        .recommendation-card.low-priority {
            border-color: #10b981;
        }
        
        .recommendation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        
        .recommendation-title {
            font-weight: 600;
            color: #fff;
        }
        
        .recommendation-priority {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .recommendation-priority.high { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .recommendation-priority.medium { background: rgba(251, 191, 36, 0.2); color: #fde68a; }
        .recommendation-priority.low { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }
        
        .recommendation-text {
            color: #a5b4fc;
            font-size: 0.9rem;
        }
        
        /* Deep Dive Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-radius: 24px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #a5b4fc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        /* Deep Dive Rating Groups */
        .rating-group {
            margin-bottom: 2rem;
        }
        
        .rating-group-title {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .rating-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .rating-column {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
        }
        
        .rating-column-label {
            font-size: 0.8rem;
            color: #a5b4fc;
            margin-bottom: 0.5rem;
        }
        
        /* Wizard Textarea - Larger Input Fields */
        .wizard-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .wizard-textarea:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }
        
        .wizard-textarea::placeholder {
            color: rgba(165, 180, 252, 0.6);
        }
        
        /* BPMN Workflow Viewer Styles */
        .workflow-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .workflow-generate-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #a5b4fc;
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.2s;
            margin-top: 0.75rem;
        }
        .workflow-generate-link:hover {
            color: #6366f1;
        }
        .workflow-generate-link.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .workflow-loading {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #a5b4fc;
            font-size: 0.9rem;
            margin-top: 0.75rem;
        }
        .workflow-loading .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .bpmn-viewer-container {
            margin-top: 1rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            overflow: hidden;
            display: none;
        }
        .bpmn-viewer-container.active {
            display: block;
        }
        .bpmn-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: rgba(99, 102, 241, 0.1);
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
        }
        .bpmn-viewer-title {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.9rem;
        }
        .bpmn-viewer-actions {
            display: flex;
            gap: 0.5rem;
        }
        .bpmn-viewer-btn {
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s;
        }
        .bpmn-viewer-btn.primary {
            background: #6366f1;
            color: white;
        }
        .bpmn-viewer-btn.primary:hover {
            background: #4f46e5;
        }
        .bpmn-viewer-btn.secondary {
            background: rgba(99, 102, 241, 0.15);
            color: #4f46e5;
        }
        .bpmn-viewer-btn.secondary:hover {
            background: rgba(99, 102, 241, 0.25);
        }
        #bpmnViewerCanvas {
            width: 100%;
            height: 300px;
            background: white;
            overflow: hidden;
            position: relative;
        }
        .bpmn-zoom-controls {
            position: absolute;
            bottom: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            z-index: 10;
            background: rgba(255, 255, 255, 0.95);
            padding: 5px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }
        .bpmn-zoom-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #e2e8f0;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #4f46e5;
            transition: all 0.2s;
        }
        .bpmn-zoom-btn:hover {
            background: #f1f5f9;
            border-color: #4f46e5;
        }
        .bpmn-zoom-btn:active {
            transform: scale(0.95);
        }
        .bpmn-zoom-level {
            font-size: 11px;
            color: #64748b;
            min-width: 40px;
            text-align: center;
            line-height: 32px;
        }
        @media (max-width: 768px) {
            .bpmn-viewer-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            #bpmnViewerCanvas {
                min-width: 500px;
                height: 250px;
            }
            .bpmn-zoom-controls {
                bottom: 5px;
                right: 5px;
                padding: 3px;
            }
            .bpmn-zoom-btn {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
        }
        .workflow-error {
            color: #ef4444;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Workflow Dashboard Styles */
        .workflow-dashboard {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.08));
            border: 1px solid rgba(99, 102, 241, 0.25);
            border-radius: 20px;
            padding: 1.75rem;
            margin: 2rem 0;
        }
        .dashboard-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .dashboard-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.35);
        }
        .dashboard-icon i {
            color: white;
            font-size: 1.5rem;
        }
        .dashboard-title {
            color: #fff;
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }
        .dashboard-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin: 0.25rem 0 0 0;
        }
        .workflow-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.25rem;
        }
        .workflow-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .workflow-card:hover {
            transform: translateY(-4px);
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.2);
        }
        .workflow-card-preview {
            background: linear-gradient(145deg, #f8fafc, #e2e8f0);
            height: 160px;
            position: relative;
            overflow: hidden;
        }
        .workflow-card-preview canvas,
        .workflow-card-preview .bpmn-preview {
            width: 100%;
            height: 100%;
        }
        .workflow-card-body {
            padding: 1rem 1.25rem;
        }
        .workflow-card-title {
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 0 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .workflow-card-title i {
            color: #6366f1;
            font-size: 0.9rem;
        }
        .workflow-card-desc {
            color: rgba(255, 255, 255, 0.65);
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 0 0 1rem 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .workflow-card-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }
        .workflow-card-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.3rem 0.6rem;
            background: rgba(99, 102, 241, 0.15);
            border-radius: 6px;
            font-size: 0.75rem;
            color: #a5b4fc;
        }
        .workflow-card-actions {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
        }
        .workflow-card-btn {
            padding: 0.4rem 0.65rem;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: all 0.2s;
        }
        .workflow-card-btn.primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        .workflow-card-btn.primary:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        .workflow-card-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }
        .workflow-card-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        @media (max-width: 768px) {
            .workflow-cards {
                grid-template-columns: 1fr;
            }
            .workflow-card-preview {
                height: 140px;
            }
        }
        
        /* Enhanced Modal Rating Scale */
        .modal-body .rating-scale {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
        }
        
        .modal-body .rating-option {
            padding: 1.25rem 0.75rem;
            min-width: auto;
        }
        
        .modal-body .rating-value {
            font-size: 1.75rem;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero-title { font-size: 1.75rem; }
            .yoga-teppich-container { max-width: 100%; }
            .question-card { padding: 1rem; }
            .rating-scale { 
                gap: 0.25rem; 
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }
            .rating-option { 
                min-width: 55px; 
                padding: 0.6rem 0.4rem;
                flex-shrink: 0;
            }
            .rating-value { font-size: 1.1rem; }
            .rating-label { font-size: 0.65rem; }
            .nav-buttons { flex-direction: column; gap: 1rem; }
            .btn-nav { width: 100%; justify-content: center; }
            .results-overview { grid-template-columns: 1fr; }
            .rating-row { grid-template-columns: 1fr; }
            .process-grid { grid-template-columns: 1fr; }
            .progress-overview { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 0.75rem;
            }
            .progress-card { padding: 1rem; }
            .progress-title { font-size: 0.9rem; }
            .selftest-container { padding: 1rem; }
            
            /* Lead Modal Mobile */
            .lead-capture-content {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            /* Modern Slider Mobile */
            .modern-slider {
                height: 12px !important;
            }
            .modern-slider::-webkit-slider-thumb {
                width: 36px !important;
                height: 36px !important;
            }
        }
        
        @media (max-width: 480px) {
            .progress-overview { 
                grid-template-columns: 1fr; 
            }
            .rating-option { 
                min-width: 50px; 
                padding: 0.5rem 0.3rem;
            }
            .rating-value { font-size: 1rem; }
        }
    </style>
</head>
<body class="starry-theme">
    <!-- Navigation - Moderne Navbar -->
    <nav class="navbar-selftest">
        <!-- Desktop: Full navbar -->
        <a href="index.html" class="nav-brand desktop-only">
            <img src="manuel-weiss-portrait.jpg" alt="MW">
            <span>Manuel Weiss</span>
        </a>
        
        <!-- Mobile: Only icons -->
        <a href="index.html" class="mobile-home-btn" title="Zur Startseite">
            <i class="fas fa-home"></i>
        </a>
        
        <div class="nav-links">
            <a href="index.html" class="nav-link"><i class="fas fa-home"></i>Start</a>
            <a href="#progress-overview" class="nav-link"><i class="fas fa-tasks"></i>Fortschritt</a>
            <a href="#results-section" class="nav-link"><i class="fas fa-chart-bar"></i>Ergebnisse</a>
            <a href="hr-automation-workflow.html" class="nav-link"><i class="fas fa-pencil-alt"></i>Prozesse zeichnen</a>
            <a href="ki-strategieentwicklung.html" class="nav-link"><i class="fas fa-brain"></i>KI-Strategie</a>
            <a href="#" class="nav-link nav-cta" onclick="downloadResults()"><i class="fas fa-download"></i>Export</a>
        </div>
        <div class="mobile-menu-btn" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </div>
    </nav>
    
    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="mobile-menu-overlay">
        <a href="index.html" class="mobile-menu-link"><i class="fas fa-home"></i>Start</a>
        <a href="#progress-overview" onclick="toggleMobileMenu()" class="mobile-menu-link"><i class="fas fa-tasks"></i>Fortschritt</a>
        <a href="#results-section" onclick="toggleMobileMenu()" class="mobile-menu-link"><i class="fas fa-chart-bar"></i>Ergebnisse</a>
        <a href="hr-automation-workflow.html" class="mobile-menu-link"><i class="fas fa-pencil-alt"></i>Prozesse zeichnen</a>
        <a href="ki-strategieentwicklung.html" class="mobile-menu-link"><i class="fas fa-brain"></i>KI-Strategie</a>
        <div style="border-top: 1px solid rgba(255,255,255,0.2); margin: 1rem 0;"></div>
        <a href="#" onclick="saveToProfile(); toggleMobileMenu();" class="mobile-menu-link"><i class="fas fa-save"></i>Im Profil speichern</a>
        <a href="login.html" class="mobile-menu-link"><i class="fas fa-sign-in-alt"></i>Anmelden</a>
        <a href="#" onclick="downloadResults(); toggleMobileMenu();" class="mobile-menu-link mobile-menu-cta"><i class="fas fa-download"></i>PDF Export</a>
    </div>
    
    <!-- Mobile Fixed Footer: PDF Export -->
    <div class="mobile-export-footer">
        <button onclick="downloadResults()" class="mobile-export-btn">
            <i class="fas fa-download"></i> PDF Export
        </button>
    </div>
    
    <script>
        function toggleMobileMenu() {
            const overlay = document.getElementById('mobileMenuOverlay');
            overlay.classList.toggle('active');
        }
        
        function saveToProfile() {
            // Prüfen ob eingeloggt
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (!isLoggedIn) {
                if (confirm('Um die Ergebnisse im Profil zu speichern, müssen Sie sich anmelden. Jetzt anmelden?')) {
                    window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href);
                }
                return;
            }
            
            // Ergebnisse speichern
            const scores = calculateScores();
            const profileData = {
                type: 'hr-selbsttest',
                timestamp: new Date().toISOString(),
                scores: scores,
                assessmentData: assessmentData
            };
            
            // Lokal speichern (für spätere Sync mit AWS)
            let savedTests = JSON.parse(localStorage.getItem('userHRTests') || '[]');
            savedTests.unshift(profileData);
            localStorage.setItem('userHRTests', JSON.stringify(savedTests));
            
            alert('Ergebnisse wurden im Profil gespeichert!');
        }
    </script>

    <!-- Hero Section -->
    <section class="selftest-hero">
        <div class="container">
            <div class="hero-icon">
                <i class="fas fa-chart-pie"></i>
            </div>
            <h1 class="hero-title">HR-Standortbestimmung</h1>
            <p class="hero-subtitle">
                Analysieren Sie Ihre HR-Organisation systematisch. 
                Vision, Kultur, Organisation und Prozesse - umfassend bewertet mit konkreten Handlungsempfehlungen.
            </p>
            <div class="hero-badge">
                <i class="fas fa-clipboard-check"></i>
                <span>Wissenschaftlich fundierte HR-Analyse</span>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="selftest-container">
        <!-- Progress Overview -->
        <div class="progress-overview">
            <div class="progress-card active" onclick="showSection('vision')">
                <div class="progress-card-header">
                    <div class="progress-icon"><i class="fas fa-eye"></i></div>
                    <div class="progress-title">Vision</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-vision" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-vision-text">0/4</span> Fragen beantwortet</div>
            </div>
            
            <div class="progress-card" onclick="showSection('kultur')">
                <div class="progress-card-header">
                    <div class="progress-icon"><i class="fas fa-heart"></i></div>
                    <div class="progress-title">Kultur</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-kultur" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-kultur-text">0/9</span> Fragen beantwortet</div>
            </div>
            
            <div class="progress-card" onclick="showSection('organisation')">
                <div class="progress-card-header">
                    <div class="progress-icon"><i class="fas fa-sitemap"></i></div>
                    <div class="progress-title">Organisation</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-organisation" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-organisation-text">0/7</span> Fragen beantwortet</div>
            </div>
            
            <div class="progress-card" onclick="showSection('prozesse')">
                <div class="progress-card-header">
                    <div class="progress-icon"><i class="fas fa-cogs"></i></div>
                    <div class="progress-title">Prozesse</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-prozesse" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-prozesse-text">0/32</span> Bereiche bewertet</div>
            </div>
        </div>

        <!-- HR Dimensionen Übersicht - AUSGEBLENDET -->
        <div class="yoga-teppich-section" id="yoga-teppich" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">HR-Dimensionen im Überblick</h2>
                <p class="section-description">Klicken Sie auf einen Bereich, um mit der Bewertung zu beginnen</p>
            </div>
            
            <div class="yoga-teppich-container">
                <svg class="yoga-teppich-svg" viewBox="0 0 500 500">
                    <!-- Outer Ring - HR Bereiche -->
                    <circle cx="250" cy="250" r="240" fill="rgba(99, 102, 241, 0.1)" stroke="rgba(99, 102, 241, 0.3)" stroke-width="2"/>
                    
                    <!-- Middle Ring - Employee Experience -->
                    <circle cx="250" cy="250" r="180" fill="rgba(139, 92, 246, 0.15)" stroke="rgba(139, 92, 246, 0.3)" stroke-width="2"/>
                    
                    <!-- Inner Ring - Persönliches Wachstum -->
                    <circle cx="250" cy="250" r="120" fill="rgba(251, 191, 36, 0.2)" stroke="rgba(251, 191, 36, 0.4)" stroke-width="2"/>
                    
                    <!-- Center - Smiley -->
                    <circle cx="250" cy="250" r="60" fill="rgba(251, 191, 36, 0.4)" stroke="#fbbf24" stroke-width="3"/>
                    
                    <!-- Smiley Face -->
                    <circle cx="225" cy="240" r="8" fill="#1e1b4b"/>
                    <circle cx="275" cy="240" r="8" fill="#1e1b4b"/>
                    <path d="M 220 270 Q 250 300 280 270" stroke="#1e1b4b" stroke-width="4" fill="none" stroke-linecap="round"/>
                    
                    <!-- Labels - Outer Ring -->
                    <text x="250" y="30" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Analytics & Reporting</text>
                    <text x="400" y="80" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Strategie & Kultur</text>
                    <text x="470" y="180" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Recruiting</text>
                    <text x="470" y="320" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Onboarding</text>
                    <text x="400" y="420" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">HR Admin</text>
                    <text x="250" y="480" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Performance Management</text>
                    <text x="100" y="420" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Compensation</text>
                    <text x="30" y="320" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Learning</text>
                    <text x="30" y="180" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Leadership</text>
                    <text x="100" y="80" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">BGM</text>
                    
                    <!-- Labels - Middle Ring -->
                    <text x="250" y="90" text-anchor="middle" fill="#c7d2fe" font-size="9">Employee Experience</text>
                    <text x="330" y="140" text-anchor="middle" fill="#c7d2fe" font-size="8">Wellbeing</text>
                    <text x="360" y="210" text-anchor="middle" fill="#c7d2fe" font-size="8">Identifikation</text>
                    <text x="360" y="290" text-anchor="middle" fill="#c7d2fe" font-size="8">Veränderung</text>
                    <text x="330" y="360" text-anchor="middle" fill="#c7d2fe" font-size="8">Zugehörigkeit</text>
                    <text x="250" y="400" text-anchor="middle" fill="#c7d2fe" font-size="8">Unbesorgtheit</text>
                    <text x="170" y="360" text-anchor="middle" fill="#c7d2fe" font-size="8">Partner</text>
                    <text x="140" y="290" text-anchor="middle" fill="#c7d2fe" font-size="8">Purpose</text>
                    <text x="140" y="210" text-anchor="middle" fill="#c7d2fe" font-size="8">Fairness</text>
                    <text x="170" y="140" text-anchor="middle" fill="#c7d2fe" font-size="8">Wertschätzung</text>
                    
                    <!-- Center Label -->
                    <text x="250" y="340" text-anchor="middle" fill="#fde68a" font-size="11" font-weight="600">Persönliches Wachstum</text>
                    
                    <!-- Clickable Areas -->
                    <circle cx="250" cy="250" r="60" fill="transparent" style="cursor: pointer;" onclick="showSection('vision')"/>
                </svg>
            </div>
        </div>

        <!-- Vision Section -->
        <div class="assessment-section active" id="section-vision">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-eye"></i> Vision</h2>
                <p class="section-description">Wo wollen Sie mit HR hin? So bringen Sie Strategie und Alltag zusammen.</p>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">1</div>
                    <div class="question-content">
                        <h3>HR und Unternehmensstrategie im Einklang</h3>
                        <p>Wie gut ist Ihre HR-Strategie mit der Gesamtstrategie Ihres Unternehmens verzahnt?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="vision-1">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value">1</div>
                        <div class="rating-label">Trifft gar nicht zu</div>
                    </div>
                    <div class="rating-option" data-value="2" onclick="selectRating(this)">
                        <div class="rating-value">2</div>
                        <div class="rating-label">Trifft wenig zu</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value">3</div>
                        <div class="rating-label">Teils/teils</div>
                    </div>
                    <div class="rating-option" data-value="4" onclick="selectRating(this)">
                        <div class="rating-value">4</div>
                        <div class="rating-label">Trifft zu</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value">5</div>
                        <div class="rating-label">Trifft voll zu</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps zur Verbesserung</div>
                    <ul>
                        <li>Analysieren Sie die Unternehmensvision und leiten Sie HR-spezifische Ziele ab</li>
                        <li>Erstellen Sie eine HR-Vision-Roadmap mit messbaren Meilensteinen</li>
                        <li>Präsentieren Sie die HR-Vision regelmäßig in Management-Meetings</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">2</div>
                    <div class="question-content">
                        <h3>Strategie, die im Alltag ankommt</h3>
                        <p>Spüren Sie und Ihre Kolleg:innen die strategische Ausrichtung in der täglichen Arbeit?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="vision-2">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value">1</div>
                        <div class="rating-label">Trifft gar nicht zu</div>
                    </div>
                    <div class="rating-option" data-value="2" onclick="selectRating(this)">
                        <div class="rating-value">2</div>
                        <div class="rating-label">Trifft wenig zu</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value">3</div>
                        <div class="rating-label">Teils/teils</div>
                    </div>
                    <div class="rating-option" data-value="4" onclick="selectRating(this)">
                        <div class="rating-value">4</div>
                        <div class="rating-label">Trifft zu</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value">5</div>
                        <div class="rating-label">Trifft voll zu</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps zur Verbesserung</div>
                    <ul>
                        <li>Integrieren Sie die Vision in Team-Meetings und Entscheidungsprozesse</li>
                        <li>Nutzen Sie visuelle Erinnerungen (Poster, Screensaver, Intranet)</li>
                        <li>Verknüpfen Sie Projekterfolge mit der Vision</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">3</div>
                    <div class="question-content">
                        <h3>Klare Roadmap für die HR-Strategie</h3>
                        <p>Haben Sie einen verbindlichen Plan mit konkreten Schritten und Zeitrahmen?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="vision-3">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value">1</div>
                        <div class="rating-label">Trifft gar nicht zu</div>
                    </div>
                    <div class="rating-option" data-value="2" onclick="selectRating(this)">
                        <div class="rating-value">2</div>
                        <div class="rating-label">Trifft wenig zu</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value">3</div>
                        <div class="rating-label">Teils/teils</div>
                    </div>
                    <div class="rating-option" data-value="4" onclick="selectRating(this)">
                        <div class="rating-value">4</div>
                        <div class="rating-label">Trifft zu</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value">5</div>
                        <div class="rating-label">Trifft voll zu</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps zur Verbesserung</div>
                    <ul>
                        <li>Erstellen Sie eine 3-Jahres-Roadmap mit Quartalsmeilensteinen</li>
                        <li>Definieren Sie KPIs für jedes strategische Ziel</li>
                        <li>Führen Sie regelmäßige Strategy-Review-Meetings durch</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">4</div>
                    <div class="question-content">
                        <h3>„Was macht eigentlich das HR?“ – Bekanntheit im Unternehmen</h3>
                        <p>Wie gut wissen die anderen im Unternehmen, welchen Mehrwert Ihre Abteilung schafft?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="vision-4">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value">1</div>
                        <div class="rating-label">Trifft gar nicht zu</div>
                    </div>
                    <div class="rating-option" data-value="2" onclick="selectRating(this)">
                        <div class="rating-value">2</div>
                        <div class="rating-label">Trifft wenig zu</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value">3</div>
                        <div class="rating-label">Teils/teils</div>
                    </div>
                    <div class="rating-option" data-value="4" onclick="selectRating(this)">
                        <div class="rating-value">4</div>
                        <div class="rating-label">Trifft zu</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value">5</div>
                        <div class="rating-label">Trifft voll zu</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps zur Verbesserung</div>
                    <ul>
                        <li>Führen Sie eine HR-Awareness-Kampagne durch</li>
                        <li>Kommunizieren Sie HR-Erfolge regelmäßig im Intranet</li>
                        <li>Erstellen Sie einen HR-Newsletter für alle Mitarbeitenden</li>
                    </ul>
                </div>
            </div>
            
            <div class="nav-buttons">
                <div></div>
                <button class="btn-nav btn-next" onclick="showSection('kultur')">
                    Weiter zu Kultur <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Kultur Section -->
        <div class="assessment-section" id="section-kultur">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-heart"></i> Kultur</h2>
                <p class="section-description">Wie Sie führen, kommunizieren und mit Wandel umgehen – das prägt Ihre HR-Organisation.</p>
            </div>
            
            <!-- Leadership -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">1</div>
                    <div class="question-content">
                        <h3>Entscheidungen: oben oder nah dran?</h3>
                        <p>Wo werden in Ihrem Umfeld die Weichen gestellt – eher bei der Führung oder bei den Menschen, die die Arbeit machen?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-leadership-1-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Führung entscheidet</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div><div class="rating-label">Eher Führung</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div><div class="rating-label">Teils/teils</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div><div class="rating-label">Eher Teams</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Teams entscheiden</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-leadership-1-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Führung entscheidet</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div><div class="rating-label">Eher Führung</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div><div class="rating-label">Teils/teils</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div><div class="rating-label">Eher Teams</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Teams entscheiden</div></div>
                        </div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps: Mehr Eigenverantwortung ermöglichen</div>
                    <ul>
                        <li>Führen Sie ein Empowerment-Programm ein, das Mitarbeitenden mehr Entscheidungsbefugnis gibt</li>
                        <li>Schulen Sie Führungskräfte in Coaching-Methoden</li>
                        <li>Implementieren Sie dezentrale Entscheidungsstrukturen für Routinethemen</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">2</div>
                    <div class="question-content">
                        <h3>Führung von Teams: steuern oder begleiten?</h3>
                        <p>Wie erleben Sie die Führung Ihrer Teams – eher als klare Steuerung oder als Begleitung und Coaching?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-leadership-2-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Klare Steuerung</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div><div class="rating-label">Eher Steuerung</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div><div class="rating-label">Teils/teils</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div><div class="rating-label">Eher Coaching</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Coaching & Begleitung</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-leadership-2-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Klare Steuerung</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div><div class="rating-label">Eher Steuerung</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div><div class="rating-label">Teils/teils</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div><div class="rating-label">Eher Coaching</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Coaching & Begleitung</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">3</div>
                    <div class="question-content">
                        <h3>Ziele: einzeln oder im Team?</h3>
                        <p>Woran orientieren Sie sich bei der Zielsetzung – eher an individuellen oder an gemeinsamen Teamzielen?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-leadership-3-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-leadership-3-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps: Ziele und Ergebnisse strukturieren</div>
                    <ul>
                        <li>Erwägen Sie die Einführung von OKRs (Objectives and Key Results)</li>
                        <li>Kombinieren Sie Team- und individuelle Ziele für ausgewogene Anreize</li>
                        <li>Führen Sie regelmäßige Team-Retrospektiven ein</li>
                    </ul>
                </div>
            </div>
            
            <!-- Communication -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">4</div>
                    <div class="question-content">
                        <h3>Transparenz: Wie offen wird kommuniziert?</h3>
                        <p>Erleben Sie in Ihrem Unternehmen eher „Need-to-know“ oder echte Transparenz?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Zurückhaltend</span>
                        <span>Sehr transparent</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-comm-1-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-comm-1-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">5</div>
                    <div class="question-content">
                        <h3>Feedback: von wem und wie?</h3>
                        <p>Woher kommt bei Ihnen Feedback – vor allem von der Führungskraft oder aus mehreren Richtungen?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Vor allem von der Führung</span>
                        <span>Mehrere Perspektiven (z. B. 360°)</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-comm-2-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-comm-2-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps: Mehrperspektivisches Feedback</div>
                    <ul>
                        <li>Implementieren Sie anonyme Peer-Feedback-Tools</li>
                        <li>Schulen Sie Mitarbeitende im Geben und Empfangen von Feedback</li>
                        <li>Führen Sie regelmäßige Feedback-Gespräche außerhalb des MAG ein</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">6</div>
                    <div class="question-content">
                        <h3>Einbindung bei Entscheidungen</h3>
                        <p>Wer wird bei wichtigen Entscheidungen gehört – eher die Spitze oder verschiedene Ebenen?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Entscheidung „oben“</span>
                        <span>Viele Stimmen einbezogen</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-comm-3-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-comm-3-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Change -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">7</div>
                    <div class="question-content">
                        <h3>Veränderung: wie offen geht Ihr Unternehmen damit um?</h3>
                        <p>Wird Neues eher skeptisch betrachtet oder aktiv ausprobiert?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Bewährtes optimieren</span>
                        <span>Neues ausprobieren</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-change-1-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-change-1-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">8</div>
                    <div class="question-content">
                        <h3>Fehlerkultur: was passiert, wenn etwas schiefgeht?</h3>
                        <p>Werden Fehler versteckt und vermieden – oder als Chance zum Lernen genutzt?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Fehler vermeiden</span>
                        <span>Aus Fehlern lernen</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-change-2-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-change-2-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps: Sicheren Umgang mit Fehlern stärken</div>
                    <ul>
                        <li>Führen Sie "Fail Forward"-Sessions ein, in denen aus Fehlern gelernt wird</li>
                        <li>Etablieren Sie eine "No Blame"-Kultur bei Post-Mortems</li>
                        <li>Feiern Sie Experimente, auch wenn sie scheitern</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">9</div>
                    <div class="question-content">
                        <h3>Spielraum für eigene Ideen</h3>
                        <p>Haben Ihre Mitarbeitenden echten Freiraum für eigene Ideen – oder kommen die Themen vor allem von oben?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Themen von oben</span>
                        <span>Eigene Ideen willkommen</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-change-3-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-change-3-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn-nav btn-back" onclick="showSection('vision')">
                    <i class="fas fa-arrow-left"></i> Zurück zu Vision
                </button>
                <button class="btn-nav btn-next" onclick="showSection('organisation')">
                    Weiter zu Organisation <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Organisation Section -->
        <div class="assessment-section" id="section-organisation">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-sitemap"></i> Organisation</h2>
                <p class="section-description">Wie Ihre HR-Abteilung aufgestellt ist und wo die Schwerpunkte liegen.</p>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">1</div>
                    <div class="question-content">
                        <h3>Reaktiv oder proaktiv unterwegs?</h3>
                        <p>Arbeitet HR bei Ihnen eher auf Anfrage – oder geht die Initiative von der Abteilung selbst aus?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand: Reaktiv ← → Proaktiv</div>
                        <div class="rating-scale" data-question="org-reactive-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Sehr reaktiv</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Sehr proaktiv</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="org-reactive-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">2</div>
                    <div class="question-content">
                        <h3>Alles inhouse oder mit externer Unterstützung?</h3>
                        <p>Wird HR-Arbeit bei Ihnen vor allem intern erledigt oder stark mit externen Partnern?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand: Inhouse ← → Extern</div>
                        <div class="rating-scale" data-question="org-inhouse-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Alles intern</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Viel extern</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="org-inhouse-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">3</div>
                    <div class="question-content">
                        <h3>Prozess oder Mensch im Fokus?</h3>
                        <p>Steht bei Ihnen eher der reibungslose Ablauf im Vordergrund oder die individuelle Betreuung?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand: Prozess ← → Kunde</div>
                        <div class="rating-scale" data-question="org-process-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Prozessfokus</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Kundenfokus</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="org-process-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">4</div>
                    <div class="question-content">
                        <h3>Generalisten oder Spezialist:innen?</h3>
                        <p>Sind Ihre HR-Mitarbeitenden eher breit aufgestellt oder in bestimmten Themen tief spezialisiert?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand: Generalist ← → Spezialist</div>
                        <div class="rating-scale" data-question="org-generalist-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Generalisten</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Spezialisten</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="org-generalist-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">5</div>
                    <div class="question-content">
                        <h3>Ist HR am strategischen Tisch dabei?</h3>
                        <p>Hat die HR-Abteilung in Ihrer Geschäftsleitung eine Stimme?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="org-gl">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value"><i class="fas fa-times"></i></div>
                        <div class="rating-label">Nein, nicht vertreten</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value"><i class="fas fa-minus"></i></div>
                        <div class="rating-label">Teilweise / als Gast</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value"><i class="fas fa-check"></i></div>
                        <div class="rating-label">Ja, vollwertiges Mitglied</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> HR auf Führungsebene</div>
                    <ul>
                        <li>HR auf Führungsebene stärkt die Bedeutung von People-Themen</li>
                        <li>Regelmäßige strategische Einblicke für die Leitung aufbereiten</li>
                        <li>Wirkung von HR-Initiativen mit Kennzahlen sichtbar machen</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">6</div>
                    <div class="question-content">
                        <h3>Wo geht die Zeit heute hin?</h3>
                        <p>Wie verteilt sich die Arbeitszeit Ihrer HR-Abteilung aktuell auf diese drei Bereiche? (zusammen 100%)</p>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
                    <div class="rating-column">
                        <div class="rating-column-label">Administration</div>
                        <input type="number" id="effort-admin-ist" value="70" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('ist')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Talent / People Management</div>
                        <input type="number" id="effort-talent-ist" value="20" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('ist')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Strategie</div>
                        <input type="number" id="effort-strategy-ist" value="10" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('ist')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                </div>
                <div id="effort-total-ist" style="text-align: center; color: #10b981; font-weight: 600;">Total: 100%</div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">7</div>
                    <div class="question-content">
                        <h3>Wie soll die Verteilung idealerweise aussehen?</h3>
                        <p>Wenn Sie es frei wählen könnten: Wie würden Sie die Kapazitäten auf die drei Bereiche verteilen?</p>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
                    <div class="rating-column">
                        <div class="rating-column-label">Administration</div>
                        <input type="number" id="effort-admin-soll" value="20" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('soll')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Talent / People Management</div>
                        <input type="number" id="effort-talent-soll" value="60" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('soll')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Strategie</div>
                        <input type="number" id="effort-strategy-soll" value="20" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('soll')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                </div>
                <div id="effort-total-soll" style="text-align: center; color: #10b981; font-weight: 600;">Total: 100%</div>
                
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Orientierungswerte für die Verteilung</div>
                    <ul>
                        <li>Viele HR-Abteilungen streben etwa 20% Administration, 60% Talent/People, 20% Strategie an</li>
                        <li>Automatisierung und Self-Service können den Verwaltungsanteil auf unter 25% senken</li>
                        <li>Damit entsteht mehr Spielraum für strategische Themen und Mitarbeiterentwicklung</li>
                    </ul>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn-nav btn-back" onclick="showSection('kultur')">
                    <i class="fas fa-arrow-left"></i> Zurück zu Kultur
                </button>
                <button class="btn-nav btn-next" onclick="showSection('prozesse')">
                    Weiter zu Prozesse <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Prozesse Section -->
        <div class="assessment-section" id="section-prozesse">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-cogs"></i> Prozesse</h2>
                <p class="section-description">Bewerten Sie jeden HR-Prozess nach Digitalisierungslevel, Prozessqualität und Wichtigkeit</p>
            </div>
            
            <div class="process-grid" id="processGrid">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <div class="nav-buttons">
                <button class="btn-nav btn-back" onclick="showSection('organisation')">
                    <i class="fas fa-arrow-left"></i> Zurück zu Organisation
                </button>
                <button class="btn-nav btn-results" onclick="showSection('results')">
                    <i class="fas fa-chart-pie"></i> Ergebnisse anzeigen
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div class="assessment-section" id="section-results" style="scroll-margin-top: 80px;">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-chart-pie"></i> Ihre Ergebnisse</h2>
                <p class="section-description">Übersicht über Ihre Standortbestimmung</p>
            </div>
            
            <!-- Prozess-Statistik Box -->
            <div id="processStatsBox" style="background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), rgba(245, 158, 11, 0.1)); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #fbbf24, #f59e0b); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-cogs" style="color: white; font-size: 1.25rem;"></i>
                    </div>
                    <div>
                        <h4 style="color: #fde68a; font-size: 1.1rem; margin: 0;">Prozess-Digitalisierung</h4>
                        <p style="color: rgba(255,255,255,0.7); margin: 0; font-size: 0.9rem;">Ihr aktueller Stand der HR-Prozessdigitalisierung</p>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div id="processesRatedCount" style="font-size: 2rem; font-weight: 800; color: #10b981;">0</div>
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.85rem;">Prozesse bewertet</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div id="processesTotalCount" style="font-size: 2rem; font-weight: 800; color: #6366f1;">32</div>
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.85rem;">Prozesse gesamt</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div id="digitalProcessesCount" style="font-size: 2rem; font-weight: 800; color: #22c55e;">0</div>
                        <div style="color: rgba(255,255,255,0.7); font-size: 0.85rem;">digital (>60%)</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 1rem; text-align: center;">
                        <div id="potentialProcessesCount" style="font-size: 2rem; font-weight: 800; color: #ef4444;">0</div>
                        <div id="potentialProcessesLabel" style="color: rgba(255,255,255,0.7); font-size: 0.85rem;">Potenzial (<40%)</div>
                    </div>
                </div>
                <div id="processManualEntriesBox" style="display: none; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid rgba(251, 191, 36, 0.2);">
                    <h4 style="color: #fde68a; font-size: 1rem; margin: 0 0 0.75rem 0;"><i class="fas fa-edit"></i> Ihre Angaben zu den bewerteten Prozessen</h4>
                    <div id="processManualEntriesList"></div>
                </div>
                <div id="notRatedProcessesList" style="margin-top: 1rem; display: none;">
                    <p style="color: #fbbf24; font-size: 0.9rem; margin-bottom: 0.5rem;"><i class="fas fa-exclamation-triangle"></i> Noch nicht bewertete Prozesse:</p>
                    <div id="notRatedList" style="color: rgba(255,255,255,0.7); font-size: 0.85rem;"></div>
                </div>
            </div>
            
            <!-- BPMN Workflow Dashboard -->
            <div id="workflowDashboard" class="workflow-dashboard" style="display: none;">
                <div class="dashboard-header">
                    <div class="dashboard-icon">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div>
                        <h3 class="dashboard-title">Ihre Prozess-Workflows</h3>
                        <p class="dashboard-subtitle">Automatisch generierte Ablaufdiagramme Ihrer HR-Prozesse</p>
                    </div>
                </div>
                
                <div class="workflow-cards" id="workflowCards">
                    <!-- Wird dynamisch befüllt -->
                </div>
            </div>
            
            <div class="results-overview" id="resultsOverview">
                <!-- Will be populated by JavaScript -->
            
            <div class="recommendations-section" id="recommendationsSection">
                <h3 style="font-size: 1.5rem; font-weight: 700; color: #fff; margin-bottom: 1.5rem;">
                    <i class="fas fa-lightbulb" style="color: #fbbf24;"></i> Handlungsempfehlungen
                </h3>
                <div id="recommendationsList">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="nav-buttons" style="flex-wrap: wrap; gap: 0.75rem;">
                <button class="btn-nav btn-back" onclick="showSection('prozesse')">
                    <i class="fas fa-arrow-left"></i> Zurück bearbeiten
                </button>
                <button class="btn-nav btn-next" onclick="saveResultsToProfile()" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <i class="fas fa-save"></i> Im Profil speichern
                </button>
                <button class="btn-nav btn-next" onclick="downloadResults()">
                    <i class="fas fa-download"></i> PDF herunterladen
                </button>
            </div>
        </div>
    </div>

    <!-- Process Deep Dive Modal -->
    <div class="modal-overlay" id="processModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Prozess bewerten</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn-nav btn-back" onclick="closeModal()">Abbrechen</button>
                <button class="btn-nav btn-next" onclick="saveProcessRating()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/shooting-stars.js"></script>
    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <!-- BPMN Viewer Library -->
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@17.4.0/dist/assets/diagram-js.css">
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@17.4.0/dist/assets/bpmn-font/css/bpmn-embedded.css">
    <script src="https://unpkg.com/bpmn-js@17.4.0/dist/bpmn-viewer.development.js"></script>
    <!-- AWS API Configuration -->
    <script src="js/aws-app-config.js"></script>
    <script src="js/aws-api-settings.js"></script>
    <script>
        // HR Selbsttest Data - 8 Kategorien mit je 4 Prozessen = 32 Prozesse
        const hrCategories = [
            {
                id: 'recruiting',
                name: 'Recruiting & Onboarding',
                color: '#6366f1',
                icon: 'fa-user-plus',
                processes: [
                    { id: 'bewerbermanagement', name: 'Bewerbermanagement' },
                    { id: 'onboarding', name: 'Onboarding / Eintritt' },
                    { id: 'anbindung-bm', name: 'Anbindung Bewerbermanagement' },
                    { id: 'digitaler-vertrag', name: 'Digitaler Arbeitsvertrag' }
                ]
            },
            {
                id: 'talent',
                name: 'Talent & Performance',
                color: '#8b5cf6',
                icon: 'fa-star',
                processes: [
                    { id: 'talentmanagement', name: 'Talentmanagement' },
                    { id: 'performance', name: 'Performance Management' },
                    { id: 'zielvereinbarungen', name: 'Zielvereinbarungen' },
                    { id: 'mitarbeitergespraeche', name: 'Mitarbeitergespräche' }
                ]
            },
            {
                id: 'development',
                name: 'Aus- und Weiterbildung',
                color: '#ec4899',
                icon: 'fa-graduation-cap',
                processes: [
                    { id: 'lms', name: 'Lernmanagement (LMS)' },
                    { id: 'schulungsplanung', name: 'Schulungsplanung' },
                    { id: 'zertifikatsverwaltung', name: 'Zertifikatsverwaltung' },
                    { id: 'elearning', name: 'E-Learning' }
                ]
            },
            {
                id: 'compensation',
                name: 'Vergütung & Benefits',
                color: '#f59e0b',
                icon: 'fa-coins',
                processes: [
                    { id: 'gehaltsabrechnung', name: 'Gehaltsabrechnung' },
                    { id: 'zulagen-spesen', name: 'Zulagen & Spesen' },
                    { id: 'benefits', name: 'Benefits Management' },
                    { id: 'bonusabrechnung', name: 'Bonusabrechnung' }
                ]
            },
            {
                id: 'admin',
                name: 'HR Administration',
                color: '#10b981',
                icon: 'fa-folder-open',
                processes: [
                    { id: 'personaldossier', name: 'Digitales Personaldossier' },
                    { id: 'mutationen', name: 'Mutationen & Stammdaten' },
                    { id: 'dokumentengenerierung', name: 'Dokumentengenerierung' },
                    { id: 'arbeitszeugnisse', name: 'Arbeitszeugnisse' }
                ]
            },
            {
                id: 'time',
                name: 'Zeit & Abwesenheit',
                color: '#06b6d4',
                icon: 'fa-clock',
                processes: [
                    { id: 'zeitwirtschaft', name: 'Zeitwirtschaft' },
                    { id: 'anwesenheit', name: 'Anwesenheitsmanagement' },
                    { id: 'urlaubsverwaltung', name: 'Urlaubsverwaltung' },
                    { id: 'krankmeldungen', name: 'Krankmeldungen' }
                ]
            },
            {
                id: 'analytics',
                name: 'People Analytics',
                color: '#84cc16',
                icon: 'fa-chart-line',
                processes: [
                    { id: 'hr-reporting', name: 'HR Reporting' },
                    { id: 'hr-controlling', name: 'HR Controlling' },
                    { id: 'workforce-analytics', name: 'Workforce Analytics' },
                    { id: 'dashboards', name: 'Dashboards' }
                ]
            },
            {
                id: 'offboarding',
                name: 'Nachfolge & Offboarding',
                color: '#ef4444',
                icon: 'fa-user-minus',
                processes: [
                    { id: 'nachfolgeplanung', name: 'Nachfolgeplanung' },
                    { id: 'karriereplanung', name: 'Karriereplanung' },
                    { id: 'austrittsmanagement', name: 'Austrittsmanagement' },
                    { id: 'offboarding-workflow', name: 'Offboarding Workflow' }
                ]
            }
        ];

        // Flatten für einfache Lookups
        const hrProcesses = hrCategories.flatMap(cat => 
            cat.processes.map(p => ({ ...p, categoryId: cat.id, categoryName: cat.name, color: cat.color, icon: cat.icon }))
        );

        let assessmentData = {
            vision: {},
            kultur: {},
            organisation: {},
            prozesse: {}
        };

        // Load saved data
        function loadSavedData() {
            const saved = localStorage.getItem('hrSelbsttest');
            if (saved) {
                assessmentData = JSON.parse(saved);
                updateAllProgress();
            }
        }

        // Save data
        function saveData() {
            localStorage.setItem('hrSelbsttest', JSON.stringify(assessmentData));
            updateAllProgress();
        }

        // Select rating
        function selectRating(element) {
            const scale = element.closest('.rating-scale');
            const question = scale.dataset.question;
            const value = parseInt(element.dataset.value);
            
            scale.querySelectorAll('.rating-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            // Determine category
            let category = 'vision';
            if (question.startsWith('kultur')) category = 'kultur';
            else if (question.startsWith('org')) category = 'organisation';
            else if (question.startsWith('process')) category = 'prozesse';
            
            assessmentData[category][question] = value;
            saveData();
        }

        // Update effort total
        function updateEffortTotal(type) {
            const admin = parseInt(document.getElementById(`effort-admin-${type}`).value) || 0;
            const talent = parseInt(document.getElementById(`effort-talent-${type}`).value) || 0;
            const strategy = parseInt(document.getElementById(`effort-strategy-${type}`).value) || 0;
            const total = admin + talent + strategy;
            
            const totalElement = document.getElementById(`effort-total-${type}`);
            totalElement.textContent = `Total: ${total}%`;
            totalElement.style.color = total === 100 ? '#10b981' : '#ef4444';
            
            assessmentData.organisation[`effort-${type}`] = { admin, talent, strategy };
            saveData();
        }

        // Show section
        function showSection(sectionId) {
            document.querySelectorAll('.assessment-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.progress-card').forEach(c => c.classList.remove('active'));
            
            const section = document.getElementById(`section-${sectionId}`);
            if (section) {
                section.classList.add('active');
                
                // Update progress card
                const progressCard = document.querySelector(`.progress-card[onclick*="${sectionId}"]`);
                if (progressCard) progressCard.classList.add('active');
            }
            
            // Special handling for results
            if (sectionId === 'results') {
                generateResults();
            }
            
            // Scroll to top
            window.scrollTo({ top: 200, behavior: 'smooth' });
        }

        // Hilfsfunktion: Text für Übersicht escapen und kürzen
        function formatOverviewText(str, maxLen) {
            if (!str || !String(str).trim()) return { short: '', full: '' };
            const d = String(str).trim().replace(/\s+/g, ' ');
            const esc = d.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
            const short = esc.length > (maxLen || 80) ? esc.slice(0, maxLen || 80) + '…' : esc;
            return { short, full: d };
        }
        // Übersicht: Tools, Pain-Points und Kurzbeschreibung mit Bezeichnung
        function getProcessDetailsHtml(processId) {
            const p = assessmentData.prozesse[processId];
            if (!p) return '';
            const rows = [];
            const maxLen = 80;
            if (p.tools && String(p.tools).trim()) {
                const { short, full } = formatOverviewText(p.tools, maxLen);
                rows.push({ label: 'Aktuell:', value: short, title: full.length > maxLen ? full : '' });
            }
            if (p.notes && String(p.notes).trim()) {
                const { short, full } = formatOverviewText(p.notes, maxLen);
                rows.push({ label: 'Pain-Points:', value: short, title: full.length > maxLen ? full : '' });
            }
            if (p.description && String(p.description).trim()) {
                const { short, full } = formatOverviewText(p.description, maxLen);
                rows.push({ label: 'Kurzbeschr.:', value: short, title: full.length > maxLen ? full : '' });
            }
            if (rows.length === 0) return '';
            return '<div class="process-item-details">' + rows.map(r => {
                const t = r.title ? ' title="' + r.title.replace(/"/g, '&quot;') + '"' : '';
                return '<div class="process-item-detail-row"><span class="process-item-detail-label">' + r.label + '</span><span class="process-item-detail-value"' + t + '>' + r.value + '</span></div>';
            }).join('') + '</div>';
        }

        // Initialize process grid
        function initProcessGrid() {
            const grid = document.getElementById('processGrid');
            
            grid.innerHTML = hrCategories.map(category => {
                const ratedInCategory = category.processes.filter(p => assessmentData.prozesse[p.id]).length;
                const totalInCategory = category.processes.length;
                const progressPercent = (ratedInCategory / totalInCategory) * 100;
                
                return `
                <div class="process-category" data-category="${category.id}">
                    <div class="category-header" onclick="toggleCategory('${category.id}')" style="--cat-color: ${category.color}">
                        <div class="category-icon" style="background: ${category.color};">
                            <i class="fas ${category.icon}"></i>
                        </div>
                        <div class="category-info">
                            <h3>${category.name}</h3>
                            <div class="category-progress">
                                <div class="category-progress-bar">
                                    <div class="category-progress-fill" style="width: ${progressPercent}%; background: ${category.color};"></div>
                                </div>
                                <span class="category-progress-text">${ratedInCategory}/${totalInCategory} bewertet</span>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down category-toggle"></i>
                    </div>
                    <div class="category-processes">
                        ${category.processes.map(process => `
                            <div class="process-item ${assessmentData.prozesse[process.id] ? 'completed' : ''}" onclick="openProcessModal('${process.id}')">
                                <div class="process-item-top">
                                    <div class="process-item-status ${assessmentData.prozesse[process.id] ? 'completed' : 'pending'}">
                                        <i class="fas ${assessmentData.prozesse[process.id] ? 'fa-check-circle' : 'fa-circle'}"></i>
                                    </div>
                                    <div class="process-item-name-block">
                                        <span class="process-item-name">${process.name}</span>
                                        ${getProcessDetailsHtml(process.id)}
                                    </div>
                                    <div class="process-item-score">
                                        ${assessmentData.prozesse[process.id] ? 
                                            `<span class="score-badge" style="background: ${getScoreColorCSS(assessmentData.prozesse[process.id])}">${getProcessScore(process.id)}</span>` : 
                                            '<span class="score-badge pending">-</span>'}
                                    </div>
                                    <i class="fas fa-chevron-right process-arrow"></i>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                `;
            }).join('');
        }

        function toggleCategory(categoryId) {
            const category = document.querySelector(`.process-category[data-category="${categoryId}"]`);
            category.classList.toggle('expanded');
        }

        function getProcessScore(processId) {
            const data = assessmentData.prozesse[processId];
            if (!data) return '-';
            const avg = ((data.digiIst || 0) + (data.qualIst || 0)) / 2;
            return avg.toFixed(1);
        }

        function getScoreColorCSS(data) {
            if (!data) return 'rgba(255,255,255,0.1)';
            const avg = ((data.digiIst || 0) + (data.qualIst || 0)) / 2;
            if (avg < 2) return 'rgba(239, 68, 68, 0.8)';
            if (avg < 3.5) return 'rgba(245, 158, 11, 0.8)';
            return 'rgba(34, 197, 94, 0.8)';
        }

        // Open process modal
        function openProcessModal(processId) {
            const process = hrProcesses.find(p => p.id === processId);
            const data = assessmentData.prozesse[processId] || {};
            
            document.getElementById('modalTitle').textContent = process.name;
            document.getElementById('modalBody').innerHTML = `
                <input type="hidden" id="currentProcessId" value="${processId}">
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-digital-tachograph" style="color: #6366f1;"></i>
                        Digitalisierungslevel
                    </div>
                    <div class="rating-row">
                        <div class="rating-column">
                            <div class="rating-column-label">IST-Zustand (1 = sehr niedrig, 5 = voll digitalisiert)</div>
                            <div class="rating-scale" data-question="modal-digi-ist">
                                ${[1,2,3,4,5].map(v => `
                                    <div class="rating-option ${data.digiIst === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                        <div class="rating-value">${v}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="rating-column">
                            <div class="rating-column-label">SOLL-Zustand</div>
                            <div class="rating-scale" data-question="modal-digi-soll">
                                ${[1,2,3,4,5].map(v => `
                                    <div class="rating-option ${data.digiSoll === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                        <div class="rating-value">${v}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-star" style="color: #fbbf24;"></i>
                        Prozessqualität
                    </div>
                    <div class="rating-row">
                        <div class="rating-column">
                            <div class="rating-column-label">IST-Zustand (1 = sehr schlecht, 5 = ausgezeichnet)</div>
                            <div class="rating-scale" data-question="modal-qual-ist">
                                ${[1,2,3,4,5].map(v => `
                                    <div class="rating-option ${data.qualIst === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                        <div class="rating-value">${v}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="rating-column">
                            <div class="rating-column-label">SOLL-Zustand</div>
                            <div class="rating-scale" data-question="modal-qual-soll">
                                ${[1,2,3,4,5].map(v => `
                                    <div class="rating-option ${data.qualSoll === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                        <div class="rating-value">${v}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                        Wichtigkeit für Ihr Unternehmen
                    </div>
                    <div class="rating-scale" data-question="modal-wichtigkeit" style="max-width: 400px;">
                        ${[1,2,3,4,5].map(v => `
                            <div class="rating-option ${data.wichtigkeit === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                <div class="rating-value">${v}</div>
                                <div class="rating-label">${v === 1 ? 'Gering' : v === 3 ? 'Mittel' : v === 5 ? 'Sehr hoch' : ''}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-tools" style="color: #10b981;"></i>
                        Aktuell verwendete Tools
                    </div>
                    <textarea class="wizard-textarea" id="modalTools" placeholder="z.B. SAP, Workday, Excel...">${data.tools || ''}</textarea>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-comment-alt" style="color: #06b6d4;"></i>
                        Anmerkungen / Pain-Points
                    </div>
                    <textarea class="wizard-textarea" id="modalNotes" placeholder="Beschreiben Sie Herausforderungen und Verbesserungsideen...">${data.notes || ''}</textarea>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-align-left" style="color: #8b5cf6;"></i>
                        Kurzbeschreibung Prozess
                    </div>
                    <textarea class="wizard-textarea" id="modalProcessDescription" placeholder="Wer macht was, womit, wann, warum?" oninput="updateWorkflowLinkVisibility()">${data.description || ''}</textarea>
                    
                    <div class="workflow-section">
                        <div id="workflowGenerateLink" class="workflow-generate-link ${data.description ? '' : 'disabled'}" onclick="generateWorkflow('${processId}')">
                            <i class="fas fa-project-diagram"></i>
                            <span>Workflow zeichnen</span>
                        </div>
                        <div id="workflowLoading" class="workflow-loading" style="display: none;">
                            <div class="spinner"></div>
                            <span>Workflow wird generiert...</span>
                        </div>
                        <div id="workflowError" class="workflow-error" style="display: none;"></div>
                        
                        <div id="bpmnViewerContainer" class="bpmn-viewer-container ${data.bpmnXml ? 'active' : ''}">
                            <div class="bpmn-viewer-header">
                                <span class="bpmn-viewer-title"><i class="fas fa-sitemap"></i> Prozess-Workflow</span>
                                <div class="bpmn-viewer-actions">
                                    <button class="bpmn-viewer-btn secondary" onclick="generateWorkflow('${processId}')">
                                        <i class="fas fa-sync-alt"></i> Neu generieren
                                    </button>
                                    <button class="bpmn-viewer-btn primary" onclick="downloadBpmn('${processId}')">
                                        <i class="fas fa-download"></i> .bpmn
                                    </button>
                                </div>
                            </div>
                            <div id="bpmnViewerCanvas"></div>
                            <div class="bpmn-zoom-controls">
                                <button class="bpmn-zoom-btn" onclick="bpmnZoom('out')" title="Verkleinern"><i class="fas fa-minus"></i></button>
                                <span id="bpmnZoomLevel" class="bpmn-zoom-level">100%</span>
                                <button class="bpmn-zoom-btn" onclick="bpmnZoom('in')" title="Vergrößern"><i class="fas fa-plus"></i></button>
                                <button class="bpmn-zoom-btn" onclick="bpmnZoom('fit')" title="Einpassen"><i class="fas fa-expand"></i></button>
                                <button class="bpmn-zoom-btn" onclick="bpmnZoom('reset')" title="Zurücksetzen"><i class="fas fa-undo"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('processModal').classList.add('active');
            
            // Initialize BPMN viewer if there's existing XML
            if (data.bpmnXml) {
                setTimeout(() => initBpmnViewer(data.bpmnXml), 100);
            }
            // Hide mobile export footer when modal is open
            const mobileFooter = document.querySelector('.mobile-export-footer');
            if (mobileFooter) mobileFooter.style.display = 'none';
        }

        // Select modal rating
        function selectModalRating(element) {
            const scale = element.closest('.rating-scale');
            scale.querySelectorAll('.rating-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
        }

        // Close modal
        function closeModal() {
            document.getElementById('processModal').classList.remove('active');
            // Show mobile export footer again
            const mobileFooter = document.querySelector('.mobile-export-footer');
            if (mobileFooter) mobileFooter.style.display = '';
        }

        // Save process rating
        function saveProcessRating() {
            const processId = document.getElementById('currentProcessId').value;
            
            const getSelectedValue = (question) => {
                const selected = document.querySelector(`[data-question="${question}"] .rating-option.selected`);
                return selected ? parseInt(selected.dataset.value) : null;
            };
            
            // Preserve existing data if present
            const existingData = assessmentData.prozesse[processId] || {};
            
            // Get values from form, fallback to existing values if empty
            const descriptionField = document.getElementById('modalProcessDescription');
            const toolsField = document.getElementById('modalTools');
            const notesField = document.getElementById('modalNotes');
            
            const newDescription = descriptionField?.value?.trim() || '';
            const newTools = toolsField?.value?.trim() || '';
            const newNotes = notesField?.value?.trim() || '';
            
            assessmentData.prozesse[processId] = {
                digiIst: getSelectedValue('modal-digi-ist'),
                digiSoll: getSelectedValue('modal-digi-soll'),
                qualIst: getSelectedValue('modal-qual-ist'),
                qualSoll: getSelectedValue('modal-qual-soll'),
                wichtigkeit: getSelectedValue('modal-wichtigkeit'),
                // Behalte bestehende Werte, wenn Felder leer sind
                description: newDescription || existingData.description || '',
                tools: newTools || existingData.tools || '',
                notes: newNotes || existingData.notes || '',
                bpmnXml: existingData.bpmnXml || null
            };
            
            saveData();
            closeModal();
            initProcessGrid();
        }

        // Update all progress bars
        function updateAllProgress() {
            // Vision progress
            const visionQuestions = ['vision-1', 'vision-2', 'vision-3', 'vision-4'];
            const visionAnswered = visionQuestions.filter(q => assessmentData.vision[q]).length;
            document.getElementById('progress-vision').style.width = `${(visionAnswered / 4) * 100}%`;
            document.getElementById('progress-vision-text').textContent = `${visionAnswered}/4`;
            
            // Kultur progress (9 question pairs = 18 total, but counting as 9)
            const kulturKeys = Object.keys(assessmentData.kultur).length;
            const kulturProgress = Math.min((kulturKeys / 18) * 100, 100);
            document.getElementById('progress-kultur').style.width = `${kulturProgress}%`;
            document.getElementById('progress-kultur-text').textContent = `${Math.floor(kulturKeys/2)}/9`;
            
            // Organisation progress
            const orgKeys = Object.keys(assessmentData.organisation).length;
            const orgProgress = Math.min((orgKeys / 10) * 100, 100);
            document.getElementById('progress-organisation').style.width = `${orgProgress}%`;
            document.getElementById('progress-organisation-text').textContent = `${orgKeys}/7`;
            
            // Prozesse progress (32 Prozesse in 8 Kategorien)
            const processesCompleted = Object.keys(assessmentData.prozesse).length;
            document.getElementById('progress-prozesse').style.width = `${(processesCompleted / 32) * 100}%`;
            document.getElementById('progress-prozesse-text').textContent = `${processesCompleted}/32`;
            
            // Auch die Prozess-Statistik Box in Results aktualisieren
            updateProcessStats();
        }

        // Generate results
        function generateResults() {
            const resultsOverview = document.getElementById('resultsOverview');
            
            // Calculate scores
            const visionScore = calculateCategoryScore('vision', 4);
            const kulturScore = calculateCategoryScore('kultur', 18);
            const orgScore = calculateCategoryScore('organisation', 10);
            const processScore = calculateProcessScore();
            
            resultsOverview.innerHTML = `
                <div class="result-card">
                    <div class="result-score ${getScoreClass(visionScore)}">${visionScore}%</div>
                    <div class="result-label">Vision</div>
                    <div class="result-description">Strategie & Ausrichtung</div>
                </div>
                <div class="result-card">
                    <div class="result-score ${getScoreClass(kulturScore)}">${kulturScore}%</div>
                    <div class="result-label">Kultur</div>
                    <div class="result-description">Leadership & Change</div>
                </div>
                <div class="result-card">
                    <div class="result-score ${getScoreClass(orgScore)}">${orgScore}%</div>
                    <div class="result-label">Organisation</div>
                    <div class="result-description">HR-Struktur</div>
                </div>
                <div class="result-card">
                    <div class="result-score ${getScoreClass(processScore)}">${processScore}%</div>
                    <div class="result-label">Prozesse</div>
                    <div class="result-description">Digitalisierungsgrad</div>
                </div>
            `;
            
            // Generate recommendations
            generateRecommendations();
            
            // Update process statistics
            updateProcessStats();
            
            // Render workflow dashboard
            renderWorkflowDashboard();
        }
        
        // Prozess-Statistik aktualisieren
        function updateProcessStats() {
            const totalProcesses = hrProcesses.length; // 32 Prozesse (8 Kategorien × 4)
            const ratedProcesses = Object.keys(assessmentData.prozesse || {});
            const ratedCount = ratedProcesses.length;
            
            let digitalCount = 0;
            let potentialCount = 0;
            
            ratedProcesses.forEach(id => {
                const data = assessmentData.prozesse[id];
                if (data) {
                    const avgScore = ((data.digiIst || 0) + (data.qualIst || 0)) / 2;
                    const percent = (avgScore / 5) * 100;
                    
                    if (percent >= 60) digitalCount++;
                    if (percent < 40) potentialCount++;
                }
            });
            
            // Nicht bewertete Prozesse (für Potenzial-Logik)
            const notRated = hrProcesses.filter(p => !(assessmentData.prozesse && assessmentData.prozesse[p.id]));
            const notRatedCount = notRated.length;
            const totalPotential = potentialCount + notRatedCount; // Verbesserungspotenzial = niedrig digitalisiert + noch nicht bewertet
            
            // UI aktualisieren (mit Null-Check)
            const ratedEl = document.getElementById('processesRatedCount');
            const totalEl = document.getElementById('processesTotalCount');
            const digitalEl = document.getElementById('digitalProcessesCount');
            const potentialEl = document.getElementById('potentialProcessesCount');
            const potentialLabelEl = document.getElementById('potentialProcessesLabel');
            
            if (ratedEl) ratedEl.textContent = ratedCount;
            if (totalEl) totalEl.textContent = totalProcesses;
            if (digitalEl) digitalEl.textContent = digitalCount;
            if (potentialEl) {
                if (totalPotential >= 20) {
                    potentialEl.textContent = 'Extrem hoch';
                    potentialEl.style.fontSize = '1.25rem';
                } else if (totalPotential >= 10) {
                    potentialEl.textContent = 'Sehr hoch';
                    potentialEl.style.fontSize = '1.35rem';
                } else if (totalPotential >= 5) {
                    potentialEl.textContent = 'Hoch';
                    potentialEl.style.fontSize = '1.5rem';
                } else {
                    potentialEl.textContent = potentialCount;
                    potentialEl.style.fontSize = '2rem';
                }
            }
            if (potentialLabelEl) potentialLabelEl.textContent = totalPotential > 0 ? totalPotential + ' Prozesse mit Verbesserungspotenzial' : 'Potenzial (<40%)';
            
            // Manuelle Angaben (Tools, Pain-Points, Kurzbeschreibung) in den Ergebnissen anzeigen
            const manualBox = document.getElementById('processManualEntriesBox');
            const manualList = document.getElementById('processManualEntriesList');
            if (manualBox && manualList) {
                const entries = [];
                (ratedProcesses || []).forEach(id => {
                    const data = assessmentData.prozesse[id];
                    const process = hrProcesses.find(p => p.id === id);
                    if (!process || !data) return;
                    const tools = (data.tools && String(data.tools).trim()) || '';
                    const notes = (data.notes && String(data.notes).trim()) || '';
                    const desc = (data.description && String(data.description).trim()) || '';
                    if (!tools && !notes && !desc) return;
                    entries.push({ name: process.name, tools, notes, desc });
                });
                if (entries.length > 0) {
                    manualBox.style.display = 'block';
                    manualList.innerHTML = entries.map(e => {
                        const parts = [];
                        if (e.desc) parts.push('<strong>Kurzbeschr.:</strong> ' + escapeHtml(e.desc));
                        if (e.tools) parts.push('<strong>Aktuell:</strong> ' + escapeHtml(e.tools));
                        if (e.notes) parts.push('<strong>Pain-Points:</strong> ' + escapeHtml(e.notes));
                        return '<div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 0.75rem 1rem; margin-bottom: 0.5rem;"><div style="color: #fde68a; font-weight: 600; margin-bottom: 0.35rem;">' + escapeHtml(e.name) + '</div><div style="color: rgba(255,255,255,0.8); font-size: 0.85rem; line-height: 1.4;">' + parts.join(' &nbsp;|&nbsp; ') + '</div></div>';
                    }).join('');
                } else {
                    manualBox.style.display = 'none';
                }
            }
            
            // Nicht bewertete Prozesse anzeigen
            const notRatedBox = document.getElementById('notRatedProcessesList');
            const notRatedList = document.getElementById('notRatedList');
            if (notRatedBox && notRatedList) {
                if (notRatedCount > 0 && notRatedCount < totalProcesses) {
                    notRatedBox.style.display = 'block';
                    notRatedList.textContent = notRated.map(p => p.name).join(', ');
                } else {
                    notRatedBox.style.display = 'none';
                }
            }
        }
        
        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function calculateCategoryScore(category, maxQuestions) {
            const values = Object.values(assessmentData[category]).filter(v => typeof v === 'number');
            if (values.length === 0) return 0;
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            return Math.round((avg / 5) * 100);
        }

        function calculateProcessScore() {
            const processes = Object.values(assessmentData.prozesse);
            if (processes.length === 0) return 0;
            
            let totalScore = 0;
            processes.forEach(p => {
                if (p.digiIst) totalScore += p.digiIst;
                if (p.qualIst) totalScore += p.qualIst;
            });
            
            return Math.round((totalScore / (processes.length * 10)) * 100);
        }

        function getScoreClass(score) {
            if (score >= 80) return 'excellent';
            if (score >= 60) return 'good';
            if (score >= 40) return 'moderate';
            return 'needs-work';
        }

        function generateRecommendations() {
            const list = document.getElementById('recommendationsList');
            const recommendations = [];
            
            // Process-based recommendations
            Object.entries(assessmentData.prozesse).forEach(([id, data]) => {
                const process = hrProcesses.find(p => p.id === id);
                if (!process) return;
                
                const digiGap = (data.digiSoll || 0) - (data.digiIst || 0);
                const qualGap = (data.qualSoll || 0) - (data.qualIst || 0);
                const totalGap = digiGap + qualGap;
                const priority = totalGap * (data.wichtigkeit || 1);
                
                if (totalGap > 0) {
                    recommendations.push({
                        title: process.name,
                        text: `Gap von ${totalGap} Punkten identifiziert. ${digiGap > 0 ? `Digitalisierung um ${digiGap} Stufen verbessern.` : ''} ${qualGap > 0 ? `Prozessqualität um ${qualGap} Stufen verbessern.` : ''}`,
                        priority: priority > 6 ? 'high' : priority > 3 ? 'medium' : 'low',
                        score: priority
                    });
                }
            });
            
            // Sort by priority score
            recommendations.sort((a, b) => b.score - a.score);
            
            list.innerHTML = recommendations.length > 0 ? recommendations.slice(0, 10).map(rec => `
                <div class="recommendation-card ${rec.priority}-priority">
                    <div class="recommendation-header">
                        <div class="recommendation-title">${rec.title}</div>
                        <span class="recommendation-priority ${rec.priority}">${rec.priority === 'high' ? 'Hohe Priorität' : rec.priority === 'medium' ? 'Mittlere Priorität' : 'Niedrige Priorität'}</span>
                    </div>
                    <div class="recommendation-text">${rec.text}</div>
                </div>
            `).join('') : '<p style="color: #a5b4fc; text-align: center;">Bitte bewerten Sie mehr Prozesse, um Handlungsempfehlungen zu erhalten.</p>';
        }

        // Download results - öffnet Lead Capture Modal
        function downloadResults() {
            document.getElementById('leadCaptureModal').classList.add('active');
        }
        
        // Ergebnisse im Profil speichern - prüft Auth
        function saveResultsToProfile() {
            // Prüfe ob Benutzer angemeldet ist
            const userToken = localStorage.getItem('userToken') || sessionStorage.getItem('userToken');
            const userData = localStorage.getItem('userData');
            
            if (userToken && userData) {
                // Benutzer ist angemeldet - speichere direkt
                saveTestResults();
            } else {
                // Benutzer muss sich anmelden
                document.getElementById('authModal').classList.add('active');
            }
        }
        
        // Test-Ergebnisse speichern
        function saveTestResults() {
            const scores = calculateScores();
            const timestamp = new Date().toISOString();
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            
            const testResult = {
                id: 'hr-selbsttest-' + Date.now(),
                type: 'HR-Selbsttest',
                date: timestamp,
                scores: scores,
                gesamtscore: ((scores.vision + scores.kultur + scores.organisation + scores.prozesse) / 4).toFixed(2),
                answers: collectAllAnswers()
            };
            
            // Hole bestehende gespeicherte Tests
            let savedTests = JSON.parse(localStorage.getItem('savedHRTests') || '[]');
            savedTests.unshift(testResult); // Neueste zuerst
            if (savedTests.length > 10) savedTests = savedTests.slice(0, 10); // Max 10 behalten
            
            localStorage.setItem('savedHRTests', JSON.stringify(savedTests));
            
            // Zeige Erfolgsmeldung
            showSaveSuccess();
        }
        
        // Alle Antworten sammeln (inkl. Prozessdaten)
        function collectAllAnswers() {
            // Alle assessmentData einschließen (enthält alle 32 Prozesse)
            const fullData = JSON.parse(JSON.stringify(assessmentData));
            
            // Zusätzlich DOM-Inputs sammeln
            const domInputs = {};
            document.querySelectorAll('input[type="range"], input[type="radio"]:checked, select').forEach(input => {
                if (input.id || input.name) {
                    domInputs[input.id || input.name] = input.value;
                }
            });
            
            return {
                assessmentData: fullData,
                prozesseBewertet: Object.keys(fullData.prozesse || {}).length,
                prozesseGesamt: hrProcesses.length,
                kategorien: hrCategories.map(cat => ({
                    name: cat.name,
                    bewertet: cat.processes.filter(p => fullData.prozesse[p.id]).length,
                    gesamt: cat.processes.length
                })),
                domInputs: domInputs
            };
        }
        
        // Erfolgs-Feedback anzeigen
        function showSaveSuccess() {
            const successDiv = document.createElement('div');
            successDiv.className = 'save-success-toast';
            successDiv.innerHTML = '<i class="fas fa-check-circle"></i> Ergebnisse erfolgreich gespeichert!';
            successDiv.style.cssText = 'position: fixed; top: 100px; right: 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1rem 1.5rem; border-radius: 12px; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4); z-index: 10001; animation: slideIn 0.3s ease;';
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => successDiv.remove(), 300);
            }, 3000);
        }
        
        // Auth Modal schließen
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
        }
        
        // Login-Funktion
        async function handleLogin() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            if (!email || !password) {
                showAuthError('Bitte E-Mail und Passwort eingeben.');
                return;
            }
            
            try {
                // Versuche Login über Cognito/Auth API
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('userToken', data.token);
                    localStorage.setItem('userData', JSON.stringify({ email, name: data.name || email.split('@')[0] }));
                    closeAuthModal();
                    saveTestResults();
                } else {
                    // Fallback: Lokaler Login für Demo
                    localStorage.setItem('userToken', 'demo-token-' + Date.now());
                    localStorage.setItem('userData', JSON.stringify({ email, name: email.split('@')[0] }));
                    closeAuthModal();
                    saveTestResults();
                }
            } catch (e) {
                // Offline/Demo-Modus
                localStorage.setItem('userToken', 'demo-token-' + Date.now());
                localStorage.setItem('userData', JSON.stringify({ email, name: email.split('@')[0] }));
                closeAuthModal();
                saveTestResults();
            }
        }
        
        // Registrierung
        async function handleRegister() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            if (!name || !email || !password) {
                showAuthError('Bitte alle Felder ausfüllen.');
                return;
            }
            
            if (password.length < 6) {
                showAuthError('Passwort muss mindestens 6 Zeichen haben.');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('userToken', data.token || 'demo-token-' + Date.now());
                    localStorage.setItem('userData', JSON.stringify({ email, name }));
                    closeAuthModal();
                    saveTestResults();
                } else {
                    // Fallback für Demo
                    localStorage.setItem('userToken', 'demo-token-' + Date.now());
                    localStorage.setItem('userData', JSON.stringify({ email, name }));
                    closeAuthModal();
                    saveTestResults();
                }
            } catch (e) {
                // Demo-Modus
                localStorage.setItem('userToken', 'demo-token-' + Date.now());
                localStorage.setItem('userData', JSON.stringify({ email, name }));
                closeAuthModal();
                saveTestResults();
            }
        }
        
        // Auth-Tab wechseln
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.querySelector(`.auth-tab[data-tab="${tab}"]`).classList.add('active');
            document.getElementById(tab + 'Form').classList.add('active');
        }
        
        // Auth Fehler anzeigen
        function showAuthError(msg) {
            const errDiv = document.getElementById('authError');
            errDiv.textContent = msg;
            errDiv.style.display = 'block';
            setTimeout(() => errDiv.style.display = 'none', 4000);
        }
        
        // Lead Capture Formular validieren
        // Fake E-Mail Domains Blacklist
        const fakeEmailDomains = [
            'yopmail.com', 'tempmail.com', 'guerrillamail.com', 'mailinator.com',
            'temp-mail.org', 'fakeinbox.com', 'throwaway.email', 'maildrop.cc',
            'dispostable.com', 'getnada.com', 'tempail.com', '10minutemail.com',
            'trashmail.com', 'sharklasers.com', 'guerrillamail.info', 'grr.la',
            'spam4.me', 'mailnesia.com', 'mytemp.email', 'mohmal.com',
            'emailondeck.com', 'temp.email', 'fakemailgenerator.com', 'tempr.email'
        ];

        function isValidEmail(email) {
            // Standard E-Mail Regex
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) return { valid: false, reason: 'Ungültiges E-Mail-Format' };
            
            // Domain extrahieren
            const domain = email.split('@')[1].toLowerCase();
            
            // Fake-Domain Check
            if (fakeEmailDomains.some(fake => domain.includes(fake))) {
                return { valid: false, reason: 'Bitte verwenden Sie eine geschäftliche E-Mail-Adresse' };
            }
            
            return { valid: true };
        }

        function validateLeadForm() {
            const name = document.getElementById('leadName').value.trim();
            const email = document.getElementById('leadEmail').value.trim();
            const consent = document.getElementById('leadConsent').checked;
            const submitBtn = document.getElementById('leadSubmitBtn');
            const emailError = document.getElementById('leadEmailError');
            
            // E-Mail validieren
            let emailValid = false;
            if (email) {
                const validation = isValidEmail(email);
                emailValid = validation.valid;
                if (emailError) {
                    emailError.textContent = validation.valid ? '' : validation.reason;
                    emailError.style.display = validation.valid ? 'none' : 'block';
                }
            } else if (emailError) {
                emailError.style.display = 'none';
            }
            
            submitBtn.disabled = !(name && email && emailValid && consent);
        }
        
        // KI-generiertes Management Summary abrufen
        async function generateAISummary(scores, name) {
            const apiKey = localStorage.getItem('openai_api_key');
            if (!apiKey) {
                return generateFallbackSummary(scores);
            }
            
            const prompt = `Du bist ein HR-Digitalexperte. Erstelle ein professionelles Management Summary (max 150 Worte) fuer folgende HR-Digital-Readiness-Analyse:

Ergebnisse fuer ${name}:
- Vision: ${scores.vision.toFixed(1)}/5.0 (${((scores.vision/5)*100).toFixed(0)}%)
- Kultur: ${scores.kultur.toFixed(1)}/5.0 (${((scores.kultur/5)*100).toFixed(0)}%)
- Organisation: ${scores.organisation.toFixed(1)}/5.0 (${((scores.organisation/5)*100).toFixed(0)}%)
- Prozesse: ${scores.prozesse.toFixed(1)}/5.0 (${((scores.prozesse/5)*100).toFixed(0)}%)
- Gesamt: ${scores.total.toFixed(1)}/5.0 (${((scores.total/5)*100).toFixed(0)}%)

Schreibe das Summary in professionellem Deutsch ohne Emojis. Beginne mit einer Gesamteinschaetzung, dann die wichtigsten Staerken und Entwicklungsfelder.`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.choices[0].message.content;
                }
            } catch (e) {
                console.log('KI-Summary nicht verfuegbar, nutze Fallback');
            }
            
            return generateFallbackSummary(scores);
        }
        
        // Fallback Summary ohne KI
        function generateFallbackSummary(scores) {
            const totalPercent = (scores.total / 5) * 100;
            let level = 'fortgeschritten';
            if (totalPercent < 40) level = 'am Anfang der Digitalisierungsreise';
            else if (totalPercent < 60) level = 'auf gutem Weg';
            else if (totalPercent < 80) level = 'fortgeschritten';
            else level = 'hervorragend aufgestellt';
            
            const dims = [
                { name: 'Vision', score: scores.vision },
                { name: 'Kultur', score: scores.kultur },
                { name: 'Organisation', score: scores.organisation },
                { name: 'Prozesse', score: scores.prozesse }
            ].sort((a, b) => b.score - a.score);
            
            return `Mit einem Gesamtscore von ${scores.total.toFixed(1)}/5.0 (${totalPercent.toFixed(0)}%) ist Ihre HR-Organisation ${level}. Besondere Stärke zeigt sich im Bereich ${dims[0].name} (${dims[0].score.toFixed(1)}/5.0). Das größte Entwicklungspotenzial liegt im Bereich ${dims[3].name} (${dims[3].score.toFixed(1)}/5.0). Durch gezielte Maßnahmen in diesem Bereich können Sie Ihre digitale HR-Reife signifikant steigern.`;
        }
        
        // Detaillierte Tipps pro Dimension
        function getDetailedTips(dimension, score) {
            const tips = {
                vision: {
                    low: [
                        'Definieren Sie eine klare 3-Jahres-Vision für Ihre HR-Digitalisierung',
                        'Führen Sie Interviews mit Führungskräften zur Erwartungshaltung durch',
                        'Benchmarken Sie sich mit Wettbewerbern und Best-Practice-Unternehmen',
                        'Erstellen Sie ein Vision-Statement und kommunizieren Sie es breit'
                    ],
                    medium: [
                        'Schärfen Sie Ihre Vision mit messbaren KPIs und Meilensteinen',
                        'Binden Sie Stakeholder aus allen Unternehmensbereichen ein',
                        'Entwickeln Sie eine Roadmap mit konkreten Initiativen',
                        'Prüfen Sie neue Technologietrends wie KI und Automatisierung'
                    ],
                    high: [
                        'Positionieren Sie HR als strategischen Innovationstreiber',
                        'Teilen Sie Ihre Vision auf Konferenzen und in Fachmedien',
                        'Explorieren Sie emerging Technologies wie Generative AI',
                        'Bauen Sie ein Innovations-Lab oder Pilotprogramm auf'
                    ]
                },
                kultur: {
                    low: [
                        'Starten Sie ein Digital-Fitness-Programm für HR-Mitarbeitende',
                        'Identifizieren Sie Change-Agents und Digital Champions',
                        'Schaffen Sie psychologische Sicherheit für Experimente',
                        'Kommunizieren Sie Erfolgsgeschichten und Quick Wins'
                    ],
                    medium: [
                        'Etablieren Sie eine Lernkultur mit regelmäßigen Schulungen',
                        'Fördern Sie bereichsübergreifende Zusammenarbeit',
                        'Implementieren Sie Feedback-Mechanismen und Retrospektiven',
                        'Belohnen Sie Innovation und kalkulierte Risikobereitschaft'
                    ],
                    high: [
                        'Nutzen Sie Ihre Kultur aktiv im Employer Branding',
                        'Exportieren Sie Best Practices in andere Unternehmensbereiche',
                        'Bauen Sie Communities of Practice auf',
                        'Investieren Sie in kontinuierliches Lernen und Upskilling'
                    ]
                },
                organisation: {
                    low: [
                        'Klären Sie Rollen und Verantwortlichkeiten für die Digitalisierung',
                        'Definieren Sie klare Entscheidungswege und Governance',
                        'Prüfen Sie die Ressourcenausstattung (Budget, Personal)',
                        'Etablieren Sie ein Steering Committee für HR-Tech'
                    ],
                    medium: [
                        'Optimieren Sie die Zusammenarbeit zwischen HR und IT',
                        'Schaffen Sie dedizierte HR-Tech-Rollen oder -Teams',
                        'Implementieren Sie agile Arbeitsmethoden in HR-Projekten',
                        'Bauen Sie Partnerschaften mit HR-Tech-Anbietern auf'
                    ],
                    high: [
                        'Positionieren Sie HR als Center of Excellence',
                        'Skalieren Sie erfolgreiche Strukturen unternehmensweit',
                        'Investieren Sie in spezialisierte HR-Tech-Expertise',
                        'Evaluieren Sie ein HR-Analytics- oder Data-Science-Team'
                    ]
                },
                prozesse: {
                    low: [
                        'Dokumentieren und analysieren Sie Ihre HR-Kernprozesse',
                        'Identifizieren Sie Quick Wins mit hohem Automatisierungspotenzial',
                        'Starten Sie mit einfachen RPA-Anwendungen (z.B. Dateneingabe)',
                        'Eliminieren Sie manuelle, papierbasierte Workflows'
                    ],
                    medium: [
                        'Implementieren Sie End-to-End-Prozessautomatisierung',
                        'Nutzen Sie Workflow-Tools wie Power Automate oder Zapier',
                        'Integrieren Sie Ihre HR-Systeme für nahtlosen Datenfluss',
                        'Messen Sie Prozesseffizienz mit klaren KPIs'
                    ],
                    high: [
                        'Explorieren Sie KI-gestützte Prozessoptimierung',
                        'Implementieren Sie Predictive Analytics in HR-Prozessen',
                        'Nutzen Sie Chatbots und Self-Service-Portale',
                        'Streben Sie hyperautomatisierte End-to-End-Journeys an'
                    ]
                }
            };
            
            const level = score < 2 ? 'low' : (score < 3.5 ? 'medium' : 'high');
            return tips[dimension][level];
        }
        
        // PDF Export Funktion - Premium C-Level Design
        async function generatePDFReport(name, email, scores) {
            if (!window.jspdf) {
                await new Promise((resolve) => {
                    const checkInterval = setInterval(() => {
                        if (window.jspdf) { clearInterval(checkInterval); resolve(); }
                    }, 100);
                    setTimeout(() => { clearInterval(checkInterval); resolve(); }, 5000);
                });
            }
            if (!window.jspdf) throw new Error('jsPDF konnte nicht geladen werden.');

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 15;
            const contentWidth = pageWidth - (2 * margin);
            let yPos = 0;
            
            // Pre-render BPMN diagrams
            let bpmnImages = {};
            try {
                bpmnImages = await preRenderBpmnImages();
            } catch (err) {
                console.warn('Could not pre-render BPMN images:', err);
            }

            // Profilbild laden (asynchron)
            let profileImageData = null;
            try {
                const loadImage = () => new Promise((resolve) => {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const size = Math.min(img.width, img.height);
                        canvas.width = size;
                        canvas.height = size;
                        const ctx = canvas.getContext('2d');
                        
                        // Runde Ecken mit Canvas zeichnen
                        const radius = size * 0.12;
                        ctx.beginPath();
                        ctx.moveTo(radius, 0);
                        ctx.lineTo(size - radius, 0);
                        ctx.quadraticCurveTo(size, 0, size, radius);
                        ctx.lineTo(size, size - radius);
                        ctx.quadraticCurveTo(size, size, size - radius, size);
                        ctx.lineTo(radius, size);
                        ctx.quadraticCurveTo(0, size, 0, size - radius);
                        ctx.lineTo(0, radius);
                        ctx.quadraticCurveTo(0, 0, radius, 0);
                        ctx.closePath();
                        ctx.clip();
                        
                        // Bild oben ausrichten (Kopf sichtbar, unten abschneiden)
                        const sx = (img.width - size) / 2;
                        const sy = 0; // Oben starten, nicht zentrieren
                        ctx.drawImage(img, sx, sy, size, size, 0, 0, size, size);
                        
                        resolve(canvas.toDataURL('image/png'));
                    };
                    img.onerror = () => resolve(null);
                    img.src = 'https://manuel-weiss.ch/images/manuel-weiss-profile.png';
                    setTimeout(() => resolve(null), 3000);
                });
                profileImageData = await loadImage();
            } catch (e) {
                console.log('Profilbild konnte nicht geladen werden');
            }

            // Premium Farbpalette
            const colors = {
                primary: [79, 70, 229],      // Indigo
                secondary: [139, 92, 246],   // Purple
                accent: [20, 184, 166],      // Teal
                gold: [245, 158, 11],        // Amber
                success: [16, 185, 129],     // Green
                warning: [251, 146, 60],     // Orange
                danger: [239, 68, 68],       // Red
                dark: [15, 23, 42],          // Slate 900
                light: [248, 250, 252],      // Slate 50
                muted: [100, 116, 139]       // Slate 500
            };

            const getScoreColor = (score) => {
                if (score < 2) return colors.danger;
                if (score < 3.5) return colors.warning;
                return colors.success;
            };

            const getScoreLabel = (score) => {
                if (score < 2) return 'Kritisch';
                if (score < 3) return 'Entwicklungsbedarf';
                if (score < 4) return 'Fortgeschritten';
                return 'Exzellent';
            };

            // Glaseffekt-Box zeichnen
            const drawGlassBox = (x, y, w, h, baseColor, opacity = 0.9) => {
                // Hauptfarbe mit leichter Transparenz
                doc.setFillColor(baseColor[0], baseColor[1], baseColor[2]);
                doc.roundedRect(x, y, w, h, 4, 4, 'F');
                // Subtiler heller Rand oben für Glas-Effekt
                doc.setFillColor(255, 255, 255);
                doc.setGState(new doc.GState({ opacity: 0.15 }));
                doc.roundedRect(x, y, w, 2, 2, 2, 'F');
                doc.setGState(new doc.GState({ opacity: 1 }));
            };

            // KI-Summary parallel generieren
            const summaryPromise = generateAISummary(scores, name);

            // Prozess-Statistiken berechnen
            const ratedProcessIds = Object.keys(assessmentData.prozesse || {});
            const totalProcessCount = hrProcesses.length;
            const ratedCount = ratedProcessIds.length;
            let digitalCount = 0, potentialCount = 0;
            ratedProcessIds.forEach(id => {
                const d = assessmentData.prozesse[id];
                if (d) {
                    const avg = ((d.digiIst || 0) + (d.qualIst || 0)) / 2;
                    if ((avg / 5) * 100 >= 60) digitalCount++;
                    if ((avg / 5) * 100 < 40) potentialCount++;
                }
            });

            // ========== SEITE 1: EXECUTIVE COVER ==========
            // Premium Gradient Header
            doc.setFillColor(...colors.primary);
            doc.rect(0, 0, pageWidth, 85, 'F');
            doc.setFillColor(...colors.secondary);
            doc.rect(0, 75, pageWidth, 15, 'F');

            // Titel
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(32);
            doc.setFont('helvetica', 'bold');
            doc.text('HR Digital Readiness', pageWidth / 2, 35, { align: 'center' });
            doc.setFontSize(14);
            doc.setFont('helvetica', 'normal');
            doc.text('Executive Assessment Report', pageWidth / 2, 48, { align: 'center' });

            // Datum Badge
            doc.setFillColor(255, 255, 255);
            doc.roundedRect(pageWidth / 2 - 35, 58, 70, 10, 5, 5, 'F');
            doc.setTextColor(...colors.primary);
            doc.setFontSize(9);
            doc.text(new Date().toLocaleDateString('de-CH', { year: 'numeric', month: 'long', day: 'numeric' }), pageWidth / 2, 65, { align: 'center' });

            yPos = 100;

            // Client Info Box
            doc.setFillColor(...colors.light);
            doc.roundedRect(margin, yPos, contentWidth, 32, 4, 4, 'F');
            doc.setDrawColor(226, 232, 240);
            doc.setLineWidth(0.5);
            doc.roundedRect(margin, yPos, contentWidth, 32, 4, 4, 'D');

            doc.setTextColor(...colors.muted);
            doc.setFontSize(8);
            doc.text('ERSTELLT FÜR', margin + 10, yPos + 8);
            doc.setTextColor(...colors.dark);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text(name, margin + 10, yPos + 18);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...colors.muted);
            doc.text(email, margin + 10, yPos + 26);

            yPos += 45;

            // Executive Score Card
            const totalScore = scores.total;
            const totalPercent = (totalScore / 5) * 100;
            const scoreColor = getScoreColor(totalScore);

            doc.setFillColor(...scoreColor);
            doc.roundedRect(margin, yPos, contentWidth, 55, 6, 6, 'F');

            // Score Ring simulieren
            doc.setFillColor(255, 255, 255);
            doc.circle(margin + 40, yPos + 27, 22, 'F');
            doc.setFillColor(...scoreColor);
            doc.circle(margin + 40, yPos + 27, 18, 'F');
            doc.setFillColor(255, 255, 255);
            doc.circle(margin + 40, yPos + 27, 14, 'F');

            doc.setTextColor(...scoreColor);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text(totalScore.toFixed(1), margin + 40, yPos + 30, { align: 'center' });

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(11);
            doc.text('GESAMTSCORE', margin + 75, yPos + 15);
            doc.setFontSize(28);
            doc.setFont('helvetica', 'bold');
            doc.text(totalPercent.toFixed(0) + '%', margin + 75, yPos + 32);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('Digital Readiness', margin + 75, yPos + 42);

            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text(getScoreLabel(totalScore), pageWidth - margin - 10, yPos + 30, { align: 'right' });

            yPos += 70;

            // Dimensionen Overview
            doc.setTextColor(...colors.dark);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('DIMENSIONEN IM ÜBERBLICK', margin, yPos);
            yPos += 10;

            const dimensions = [
                { key: 'vision', name: 'Vision & Strategie', score: scores.vision, icon: '◉' },
                { key: 'kultur', name: 'Kultur & Zusammenarbeit', score: scores.kultur, icon: '◈' },
                { key: 'organisation', name: 'Organisation & Ressourcen', score: scores.organisation, icon: '◇' },
                { key: 'prozesse', name: 'Prozesse & Digitalisierung', score: scores.prozesse, icon: '○' }
            ];

            dimensions.forEach((dim, idx) => {
                const color = getScoreColor(dim.score);
                const pct = (dim.score / 5) * 100;

                doc.setFillColor(...colors.light);
                doc.roundedRect(margin, yPos, contentWidth, 16, 3, 3, 'F');

                // Score Indicator
                doc.setFillColor(...color);
                doc.roundedRect(margin + 2, yPos + 2, 12, 12, 2, 2, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.score.toFixed(1), margin + 8, yPos + 10, { align: 'center' });

                doc.setTextColor(...colors.dark);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.name, margin + 18, yPos + 10);

                // Progress Bar
                const barX = margin + 95;
                const barW = contentWidth - 115;
                doc.setFillColor(226, 232, 240);
                doc.roundedRect(barX, yPos + 5, barW, 6, 3, 3, 'F');
                doc.setFillColor(...color);
                const fillW = (barW * pct) / 100;
                if (fillW > 3) doc.roundedRect(barX, yPos + 5, fillW, 6, 3, 3, 'F');

                doc.setTextColor(...color);
                doc.setFontSize(9);
                doc.text(pct.toFixed(0) + '%', pageWidth - margin - 5, yPos + 10, { align: 'right' });

                yPos += 20;
            });

            yPos += 5;

            // Prozess-Digitalisierung Kompakt
            doc.setFillColor(254, 252, 232);
            doc.roundedRect(margin, yPos, contentWidth, 28, 4, 4, 'F');
            doc.setDrawColor(...colors.gold);
            doc.setLineWidth(0.5);
            doc.roundedRect(margin, yPos, contentWidth, 28, 4, 4, 'D');

            doc.setTextColor(161, 98, 7);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.text('PROZESS-DIGITALISIERUNG', margin + 8, yPos + 8);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.text(ratedCount + ' von ' + totalProcessCount + ' Prozessen bewertet  |  ' + digitalCount + ' digitalisiert (>60%)  |  ' + potentialCount + ' mit Potenzial (<40%)', margin + 8, yPos + 18);
            if (ratedCount < totalProcessCount) {
                doc.setTextColor(180, 83, 9);
                doc.text('→ ' + (totalProcessCount - ratedCount) + ' Prozesse noch nicht bewertet', margin + 8, yPos + 25);
            }

            // ========== SEITE 2: EXECUTIVE SUMMARY ==========
            doc.addPage();
            
            // Header Bar
            doc.setFillColor(...colors.primary);
            doc.rect(0, 0, pageWidth, 12, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });

            yPos = 25;
            doc.setTextColor(...colors.dark);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Executive Summary', margin, yPos);
            doc.setFillColor(...colors.accent);
            doc.roundedRect(margin, yPos + 3, 35, 2, 1, 1, 'F');

            yPos += 18;

            // KI-Summary Box
            const aiSummary = await summaryPromise;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            const summaryLines = doc.splitTextToSize(aiSummary, contentWidth - 20);
            const summaryBoxHeight = Math.max(45, summaryLines.length * 5 + 16);
            
            doc.setFillColor(...colors.light);
            doc.roundedRect(margin, yPos, contentWidth, summaryBoxHeight, 5, 5, 'F');
            doc.setDrawColor(226, 232, 240);
            doc.setLineWidth(0.3);
            doc.roundedRect(margin, yPos, contentWidth, summaryBoxHeight, 5, 5, 'D');
            
            doc.setTextColor(...colors.dark);
            let lineY = yPos + 12;
            summaryLines.forEach((line) => {
                doc.text(line, margin + 10, lineY);
                lineY += 5;
            });

            yPos += summaryBoxHeight + 12;

            // Key Metrics Grid
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('KEY PERFORMANCE INDICATORS', margin, yPos);
            yPos += 12;

            const metrics = [
                { label: 'Gesamtscore', value: totalScore.toFixed(1) + '/5.0', color: scoreColor },
                { label: 'Readiness', value: totalPercent.toFixed(0) + '%', color: scoreColor },
                { label: 'Prozesse Digital', value: digitalCount + '/' + ratedCount, color: digitalCount > ratedCount/2 ? colors.success : colors.warning },
                { label: 'Handlungsbedarf', value: potentialCount + ' Bereiche', color: potentialCount > 3 ? colors.danger : colors.success }
            ];

            const metricW = (contentWidth - 15) / 4;
            metrics.forEach((m, i) => {
                const x = margin + i * (metricW + 5);
                doc.setFillColor(...m.color);
                doc.roundedRect(x, yPos, metricW, 35, 4, 4, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'normal');
                doc.text(m.label.toUpperCase(), x + metricW/2, yPos + 10, { align: 'center' });
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(m.value, x + metricW/2, yPos + 25, { align: 'center' });
            });

            yPos += 50;

            // Dimensions Detail Cards
            doc.setTextColor(...colors.dark);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('BEWERTUNGSÜBERSICHT NACH DIMENSIONEN', margin, yPos);
            yPos += 10;

            dimensions.forEach((dim) => {
                const color = getScoreColor(dim.score);
                const pct = (dim.score / 5) * 100;
                const boxH = 24;

                // Card mit Schatten-Effekt
                doc.setFillColor(240, 240, 245);
                doc.roundedRect(margin + 1, yPos + 1, contentWidth, boxH, 5, 5, 'F');
                doc.setFillColor(...colors.light);
                doc.roundedRect(margin, yPos, contentWidth, boxH, 5, 5, 'F');

                // Score Badge - perfekt zentriert
                const badgeW = 28;
                const badgeH = 16;
                const badgeX = margin + 5;
                const badgeY = yPos + (boxH - badgeH) / 2;
                doc.setFillColor(...color);
                doc.roundedRect(badgeX, badgeY, badgeW, badgeH, 4, 4, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.score.toFixed(1), badgeX + badgeW/2, badgeY + badgeH/2 + 3.5, { align: 'center' });

                // Dimension Name
                doc.setTextColor(...colors.dark);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.name, margin + 40, yPos + 10);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...colors.muted);
                doc.text(getScoreLabel(dim.score), margin + 40, yPos + 18);

                // Mini Bar
                doc.setFillColor(226, 232, 240);
                doc.roundedRect(pageWidth - margin - 55, yPos + 8, 50, 6, 3, 3, 'F');
                doc.setFillColor(...color);
                doc.roundedRect(pageWidth - margin - 55, yPos + 8, (50 * pct) / 100, 6, 3, 3, 'F');

                yPos += 26;
            });

            // ========== SEITE 3: PROZESS-KATEGORIEN ÜBERSICHT ==========
            doc.addPage();

            // Header
            doc.setFillColor(...colors.primary);
            doc.rect(0, 0, pageWidth, 12, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });

            yPos = 25;
            doc.setTextColor(...colors.dark);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Prozess-Digitalisierung nach Kategorien', margin, yPos);
            doc.setFillColor(...colors.accent);
            doc.roundedRect(margin, yPos + 3, 55, 2, 1, 1, 'F');

            yPos += 20;

            // Kategorie Cards
            hrCategories.forEach((cat, catIdx) => {
                const catProcesses = cat.processes;
                const ratedInCat = catProcesses.filter(p => assessmentData.prozesse && assessmentData.prozesse[p.id]).length;
                const catProgress = (ratedInCat / catProcesses.length) * 100;

                // Neue Seite wenn nötig - Kategorie-Header braucht mind. 80mm Platz
                // damit nicht nur die Überschrift am Ende der Seite steht
                if (yPos > pageHeight - 80) {
                    doc.addPage();
                    doc.setFillColor(...colors.primary);
                    doc.rect(0, 0, pageWidth, 12, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(8);
                    doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });
                    yPos = 25;
                }

                // Kategorie Header
                const catColor = cat.color ? [parseInt(cat.color.slice(1,3),16), parseInt(cat.color.slice(3,5),16), parseInt(cat.color.slice(5,7),16)] : colors.primary;
                
                doc.setFillColor(...catColor);
                doc.roundedRect(margin, yPos, contentWidth, 12, 3, 3, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text(cat.name, margin + 8, yPos + 8);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'normal');
                doc.text(ratedInCat + '/' + catProcesses.length + ' bewertet', pageWidth - margin - 8, yPos + 8, { align: 'right' });

                yPos += 15;

                // Prozess Items
                catProcesses.forEach((proc, procIdx) => {
                    const procData = assessmentData.prozesse ? assessmentData.prozesse[proc.id] : null;
                    const isRated = !!procData;
                    const procScore = procData ? ((procData.digiIst || 0) + (procData.qualIst || 0)) / 2 : 0;
                    const procPct = (procScore / 5) * 100;
                    const procColor = isRated ? getScoreColor(procScore) : [200, 200, 200];
                    
                    // Berechne Box-Höhe basierend auf Kurzbeschreibung, Tools, Notes und BPMN
                    const descStr = procData && procData.description ? String(procData.description).trim() : '';
                    const toolsStr = procData && procData.tools ? String(procData.tools).trim() : '';
                    const notesStr = procData && procData.notes ? String(procData.notes).trim() : '';
                    const bpmnData = bpmnImages[proc.id];
                    const hasBpmn = bpmnData ? true : false;
                    let boxHeight = 10;
                    let bpmnImgHeight = 0;
                    if (descStr || toolsStr || notesStr || hasBpmn) {
                        if (descStr) {
                            doc.setFontSize(7);
                            const dl = doc.splitTextToSize(descStr, contentWidth - 55);
                            boxHeight += 6 + Math.min(dl.length, 20) * 3.5;
                        }
                        if (toolsStr) {
                            doc.setFontSize(7);
                            const tl = doc.splitTextToSize(toolsStr, contentWidth - 55);
                            boxHeight += 6 + Math.min(tl.length, 2) * 3.5;
                        }
                        if (notesStr) {
                            doc.setFontSize(7);
                            const nl = doc.splitTextToSize(notesStr, contentWidth - 55);
                            boxHeight += 6 + Math.min(nl.length, 3) * 3.5;
                        }
                        if (hasBpmn) {
                            // Calculate actual image height based on aspect ratio
                            const aspectRatio = bpmnData.aspectRatio || 2;
                            const maxWidth = contentWidth - 30;
                            const maxHeight = 38;
                            bpmnImgHeight = Math.min(maxWidth / aspectRatio, maxHeight);
                            boxHeight += 8 + bpmnImgHeight; // Label + image + padding
                        }
                    }
                    
                    // Prüfe ob neue Seite nötig (mit Sicherheitspuffer)
                    const safetyMargin = 35; // Mehr Platz am Seitenende
                    if (yPos + boxHeight > pageHeight - safetyMargin) {
                        doc.addPage();
                        doc.setFillColor(...colors.primary);
                        doc.rect(0, 0, pageWidth, 12, 'F');
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(8);
                        doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });
                        yPos = 25;
                    }

                    doc.setFillColor(...colors.light);
                    doc.roundedRect(margin + 5, yPos, contentWidth - 10, boxHeight, 2, 2, 'F');

                    // Status Dot
                    doc.setFillColor(...procColor);
                    doc.circle(margin + 12, yPos + 5, 2.5, 'F');

                    doc.setTextColor(...colors.dark);
                    doc.setFontSize(8);
                    doc.setFont('helvetica', 'normal');
                    doc.text(proc.name, margin + 20, yPos + 6.5);

                    if (isRated) {
                        // Mini Score
                        doc.setTextColor(...procColor);
                        doc.setFont('helvetica', 'bold');
                        doc.text(procScore.toFixed(1), pageWidth - margin - 25, yPos + 6.5, { align: 'right' });
                        doc.setTextColor(...colors.muted);
                        doc.setFont('helvetica', 'normal');
                        doc.text(procPct.toFixed(0) + '%', pageWidth - margin - 8, yPos + 6.5, { align: 'right' });
                        
                        // Aktuelle Applikation / Tools (manuell eingegeben)
                        let detailY = yPos + 12;
                        const toolsStr = (procData.tools && String(procData.tools).trim()) || '';
                        if (toolsStr) {
                            doc.setFillColor(...colors.primary);
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(6);
                            doc.roundedRect(margin + 20, detailY - 2, 28, 5, 1, 1, 'F');
                            doc.text('Aktuell:', margin + 22, detailY + 1.5);
                            doc.setTextColor(...colors.dark);
                            doc.setFontSize(7);
                            const toolLines = doc.splitTextToSize(toolsStr, contentWidth - 55);
                            toolLines.slice(0, 2).forEach((line, idx) => {
                                doc.text(line, margin + 50, detailY + 1.5 + (idx * 3.5));
                            });
                            detailY += 6 + (Math.min(toolLines.length, 2) * 3.5);
                        }
                        // Pain-Points / Anmerkungen (manuell eingegeben)
                        const notesStr = (procData.notes && String(procData.notes).trim()) || '';
                        if (notesStr) {
                            doc.setFillColor(...colors.warning);
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(6);
                            doc.roundedRect(margin + 20, detailY - 2, 28, 5, 1, 1, 'F');
                            doc.text('Pain-Points:', margin + 22, detailY + 1.5);
                            doc.setTextColor(...colors.muted);
                            doc.setFontSize(7);
                            const noteLines = doc.splitTextToSize(notesStr, contentWidth - 55);
                            noteLines.slice(0, 3).forEach((line, idx) => {
                                doc.text(line, margin + 50, detailY + 1.5 + (idx * 3.5));
                            });
                            detailY += 6 + (Math.min(noteLines.length, 3) * 3.5);
                        }
                        // Kurzbeschreibung Prozess
                        const descStr = (procData.description && String(procData.description).trim()) || '';
                        if (descStr) {
                            doc.setFillColor(139, 92, 246);
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(6);
                            doc.roundedRect(margin + 20, detailY - 2, 28, 5, 1, 1, 'F');
                            doc.text('Kurzbeschr.:', margin + 22, detailY + 1.5);
                            doc.setTextColor(...colors.dark);
                            doc.setFontSize(7);
                            const descLines = doc.splitTextToSize(descStr, contentWidth - 55);
                            descLines.slice(0, 20).forEach((line, idx) => {
                                doc.text(line, margin + 50, detailY + 1.5 + (idx * 3.5));
                            });
                            detailY += 6 + (Math.min(descLines.length, 20) * 3.5);
                        }
                        
                        // BPMN Workflow Diagramm (wenn vorhanden)
                        if (bpmnImages[proc.id]) {
                            doc.setFillColor(16, 185, 129);
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(6);
                            doc.roundedRect(margin + 20, detailY - 2, 28, 5, 1, 1, 'F');
                            doc.text('Workflow:', margin + 22, detailY + 1.5);
                            
                            try {
                                const bpmnData = bpmnImages[proc.id];
                                const imgDataUrl = bpmnData.dataUrl || bpmnData;
                                const aspectRatio = bpmnData.aspectRatio || 2;
                                
                                // Calculate dimensions maintaining aspect ratio
                                const maxWidth = contentWidth - 30;
                                const maxHeight = 38;
                                
                                let imgWidth, imgHeight;
                                if (maxWidth / aspectRatio <= maxHeight) {
                                    imgWidth = maxWidth;
                                    imgHeight = maxWidth / aspectRatio;
                                } else {
                                    imgHeight = maxHeight;
                                    imgWidth = maxHeight * aspectRatio;
                                }
                                
                                doc.addImage(imgDataUrl, 'PNG', margin + 20, detailY + 4, imgWidth, imgHeight);
                            } catch (imgErr) {
                                console.warn('Could not add BPMN image to PDF:', imgErr);
                            }
                        }
                    } else {
                        doc.setTextColor(...colors.muted);
                        doc.setFontSize(7);
                        doc.text('nicht bewertet', pageWidth - margin - 8, yPos + 6.5, { align: 'right' });
                    }

                    yPos += boxHeight + 2;
                });

                yPos += 8;
            });

            // ========== DETAIL-SEITEN PRO DIMENSION ==========
            dimensions.forEach((dim) => {
                doc.addPage();

                // Header
                doc.setFillColor(...colors.primary);
                doc.rect(0, 0, pageWidth, 12, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(8);
                doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });

                yPos = 25;
                const color = getScoreColor(dim.score);
                const pct = (dim.score / 5) * 100;

                // Dimension Title
                doc.setTextColor(...colors.dark);
                doc.setFontSize(18);
                doc.setFont('helvetica', 'bold');
                doc.text('Bereich: ' + dim.name, margin, yPos);
                doc.setFillColor(...color);
                doc.roundedRect(margin, yPos + 3, 40, 2, 1, 1, 'F');

                yPos += 20;

                // Score Card
                doc.setFillColor(...color);
                doc.roundedRect(margin, yPos, 50, 40, 5, 5, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(28);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.score.toFixed(1), margin + 25, yPos + 22, { align: 'center' });
                doc.setFontSize(10);
                doc.text('von 5.0', margin + 25, yPos + 32, { align: 'center' });

                // Status Box
                doc.setFillColor(...colors.light);
                doc.roundedRect(margin + 58, yPos, contentWidth - 58, 40, 5, 5, 'F');
                doc.setTextColor(...colors.dark);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(getScoreLabel(dim.score), margin + 68, yPos + 15);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...colors.muted);
                doc.text(pct.toFixed(0) + '% der maximalen Punktzahl erreicht', margin + 68, yPos + 26);

                // Progress Bar
                doc.setFillColor(226, 232, 240);
                doc.roundedRect(margin + 68, yPos + 32, contentWidth - 80, 5, 2.5, 2.5, 'F');
                doc.setFillColor(...color);
                doc.roundedRect(margin + 68, yPos + 32, ((contentWidth - 80) * pct) / 100, 5, 2.5, 2.5, 'F');

                yPos += 55;

                // Handlungsempfehlungen
                doc.setTextColor(...colors.dark);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('HANDLUNGSEMPFEHLUNGEN', margin, yPos);
                yPos += 12;

                const tips = getDetailedTips(dim.key, dim.score);
                tips.forEach((tip, idx) => {
                    // Berechne Textzeilen für dynamische Höhe
                    doc.setFontSize(9);
                    const tipLines = doc.splitTextToSize(tip, contentWidth - 35);
                    const boxHeight = Math.max(18, tipLines.length * 4 + 10);
                    
                    doc.setFillColor(...colors.light);
                    doc.roundedRect(margin, yPos, contentWidth, boxHeight, 4, 4, 'F');

                    // Number Badge - vertikal zentriert
                    const badgeY = yPos + (boxHeight - 14) / 2;
                    doc.setFillColor(...color);
                    doc.roundedRect(margin + 5, badgeY, 14, 14, 3, 3, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'bold');
                    doc.text((idx + 1).toString(), margin + 12, badgeY + 9.5, { align: 'center' });

                    // Text - auf einer Baseline
                    doc.setTextColor(...colors.dark);
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'normal');
                    const textY = yPos + (boxHeight / 2) - ((tipLines.length - 1) * 2);
                    tipLines.forEach((line, lineIdx) => {
                        doc.text(line, margin + 25, textY + (lineIdx * 4));
                    });

                    yPos += boxHeight + 4;
                });

                yPos += 5;

                // Quick Win Box
                doc.setFillColor(236, 253, 245);
                doc.roundedRect(margin, yPos, contentWidth, 25, 4, 4, 'F');
                doc.setDrawColor(...colors.success);
                doc.setLineWidth(0.5);
                doc.roundedRect(margin, yPos, contentWidth, 25, 4, 4, 'D');

                doc.setTextColor(22, 101, 52);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('>> QUICK WIN', margin + 8, yPos + 9);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                const qwLines = doc.splitTextToSize('Starten Sie mit: ' + tips[0], contentWidth - 16);
                doc.text(qwLines, margin + 8, yPos + 17);
            });

            // ========== LETZTE SEITE: NEXT STEPS & CTA ==========
            doc.addPage();

            doc.setFillColor(...colors.primary);
            doc.rect(0, 0, pageWidth, 12, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });

            yPos = 25;
            doc.setTextColor(...colors.dark);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Nächste Schritte', margin, yPos);
            doc.setFillColor(...colors.accent);
            doc.roundedRect(margin, yPos + 3, 30, 2, 1, 1, 'F');

            yPos += 20;

            // Priority Actions
            const sortedDims = [...dimensions].sort((a, b) => a.score - b.score);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('TOP 3 HANDLUNGSFELDER', margin, yPos);
            yPos += 10;

            sortedDims.slice(0, 3).forEach((dim, idx) => {
                const color = getScoreColor(dim.score);
                doc.setFillColor(...colors.light);
                doc.roundedRect(margin, yPos, contentWidth, 18, 3, 3, 'F');

                doc.setFillColor(...color);
                doc.roundedRect(margin + 4, yPos + 4, 10, 10, 2, 2, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text((idx + 1).toString(), margin + 9, yPos + 11, { align: 'center' });

                doc.setTextColor(...colors.dark);
                doc.setFontSize(10);
                doc.text(dim.name, margin + 20, yPos + 10);
                doc.setTextColor(...color);
                doc.text(dim.score.toFixed(1) + '/5.0', pageWidth - margin - 8, yPos + 10, { align: 'right' });

                yPos += 22;
            });

            yPos += 15;

            // CTA Box
            doc.setFillColor(...colors.primary);
            doc.roundedRect(margin, yPos, contentWidth, 50, 6, 6, 'F');

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Kostenloses Strategiegespräch', pageWidth / 2, yPos + 18, { align: 'center' });
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text('Lassen Sie uns gemeinsam Ihre HR-Digitalisierung vorantreiben', pageWidth / 2, yPos + 30, { align: 'center' });
            doc.text('und konkrete Maßnahmen für Ihre Organisation definieren.', pageWidth / 2, yPos + 38, { align: 'center' });

            yPos += 65;

            // Contact Card mit Profilbild
            const cardHeight = 48;
            const imgSize = 38;
            doc.setFillColor(...colors.light);
            doc.roundedRect(margin, yPos, contentWidth, cardHeight, 5, 5, 'F');

            // Profilbild (bereits mit abgerundeten Ecken via Canvas)
            const imgX = margin + 6;
            const imgY = yPos + 5;
            
            if (profileImageData) {
                doc.addImage(profileImageData, 'PNG', imgX, imgY, imgSize, imgSize);
            } else {
                // Fallback: Platzhalter-Kreis
                doc.setFillColor(...colors.primary);
                doc.roundedRect(imgX, imgY, imgSize, imgSize, 6, 6, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('MW', imgX + imgSize/2, imgY + imgSize/2 + 5, { align: 'center' });
            }

            // Text rechts vom Bild - linksbündig
            const textX = imgX + imgSize + 12;
            doc.setTextColor(...colors.muted);
            doc.setFontSize(8);
            doc.text('IHR ANSPRECHPARTNER', textX, yPos + 10);
            doc.setTextColor(...colors.dark);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Manuel Weiss', textX, yPos + 20);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text('mail@manuel-weiss.ch', textX, yPos + 28);
            doc.text('www.manuel-weiss.ch', textX, yPos + 35);
            doc.setTextColor(...colors.muted);
            doc.setFontSize(8);
            doc.text('HR Consultant & Digitalisierungsexperte', textX, yPos + 43);

            // Footer auf allen Seiten
            const totalPages = doc.internal.pages.length - 1;
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFillColor(...colors.light);
                doc.rect(0, pageHeight - 15, pageWidth, 15, 'F');
                doc.setTextColor(...colors.muted);
                doc.setFontSize(7);
                doc.text('Seite ' + i + ' von ' + totalPages, margin, pageHeight - 6);
                doc.text('www.manuel-weiss.ch', pageWidth / 2, pageHeight - 6, { align: 'center' });
                doc.text('Vertraulich', pageWidth - margin, pageHeight - 6, { align: 'right' });
            }

            return doc;
        }

        // Lead Capture absenden und Download starten
        async function submitLeadAndDownload() {
            const name = document.getElementById('leadName').value.trim();
            const email = document.getElementById('leadEmail').value.trim();
            const wantsConsultation = document.getElementById('leadConsultation').checked;
            
            // Scores berechnen
            const scores = calculateScores();
            
            // PDF generieren (vor dem Speichern, um Base64 zu bekommen)
            let pdfBase64 = null;
            let doc = null;
            try {
                doc = await generatePDFReport(name, email, scores);
                // PDF als Base64 extrahieren
                pdfBase64 = doc.output('datauristring').split(',')[1];
            } catch (pdfError) {
                console.warn('PDF konnte nicht generiert werden:', pdfError);
            }
            
            // Prozess-Details aufbereiten (ohne zu große BPMN-XMLs für die Übersicht)
            const prozessDetails = {};
            for (const [processId, data] of Object.entries(assessmentData.prozesse || {})) {
                if (data) {
                    // Prozessname finden
                    let processName = processId;
                    let categoryName = '';
                    for (const cat of hrCategories) {
                        const proc = cat.processes.find(p => p.id === processId);
                        if (proc) {
                            processName = proc.name;
                            categoryName = cat.name;
                            break;
                        }
                    }
                    
                    prozessDetails[processId] = {
                        name: processName,
                        category: categoryName,
                        digiIst: data.digiIst,
                        digiSoll: data.digiSoll,
                        qualIst: data.qualIst,
                        qualSoll: data.qualSoll,
                        wichtigkeit: data.wichtigkeit,
                        description: data.description || '',
                        tools: data.tools || '',
                        notes: data.notes || '',
                        hasBpmn: !!data.bpmnXml,
                        bpmnXml: data.bpmnXml || null
                    };
                }
            }
            
            // Vollständige Lead-Daten
            const leadData = {
                name: name,
                email: email,
                wantsConsultation: wantsConsultation,
                scores: {
                    total: parseFloat(scores.total.toFixed(2)),
                    vision: parseFloat(scores.vision.toFixed(2)),
                    kultur: parseFloat(scores.kultur.toFixed(2)),
                    organisation: parseFloat(scores.organisation.toFixed(2)),
                    prozesse: parseFloat(scores.prozesse.toFixed(2))
                },
                // Alle Antworten speichern
                answers: {
                    vision: assessmentData.vision || {},
                    kultur: assessmentData.kultur || {},
                    organisation: assessmentData.organisation || {}
                },
                // Prozess-Details
                prozessDetails: prozessDetails,
                prozesseBewertet: Object.keys(assessmentData.prozesse || {}).length,
                prozesseGesamt: 32,
                // PDF als Base64
                pdfBase64: pdfBase64,
                timestamp: new Date().toISOString()
            };

            // Lead zentral in AWS S3 speichern (über API)
            const apiBaseUrl = window.AWS_API_URL || 'https://6i6ysj9c8c.execute-api.eu-central-1.amazonaws.com/v1';
            try {
                const response = await fetch(`${apiBaseUrl}/hr-leads/save`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(leadData)
                });
                const result = await response.json();
                if (result.success) {
                    console.log('✅ Lead in AWS gespeichert:', result.leadId);
                } else {
                    throw new Error(result.error || 'Speichern fehlgeschlagen');
                }
            } catch (e) {
                console.log('HR-Leads API Fehler, speichere lokal:', e);
                // Fallback: Lokal speichern (ohne PDF wegen Größe)
                const localLeadData = { ...leadData };
                delete localLeadData.pdfBase64; // Zu groß für localStorage
                delete localLeadData.prozessDetails; // Kompakte Version
                localLeadData.prozesseBewertet = Object.keys(assessmentData.prozesse || {}).length;
                
                let savedLeads = JSON.parse(localStorage.getItem('hrSelbsttestLeads') || '[]');
                savedLeads.unshift(localLeadData);
                if (savedLeads.length > 100) savedLeads = savedLeads.slice(0, 100);
                localStorage.setItem('hrSelbsttestLeads', JSON.stringify(savedLeads));
            }
            
            // PDF herunterladen
            try {
                if (doc) {
                    doc.save(`HR-Digital-Readiness-Report-${name.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`);
                }
                
                // Modal schließen
                document.getElementById('leadCaptureModal').classList.remove('active');
                
                // Danke-Nachricht
                alert('Vielen Dank! Ihr PDF-Report wurde erfolgreich generiert und heruntergeladen.' + (wantsConsultation ? '\n\nWir melden uns zeitnah für ein Beratungsgespräch bei Ihnen.' : ''));
            } catch (error) {
                console.error('PDF Export Fehler:', error);
                alert('Fehler beim PDF-Export: ' + error.message + '\n\nBitte versuchen Sie es erneut oder kontaktieren Sie uns direkt.');
            }
        }
        
        // Scores berechnen
        function calculateScores() {
            const calcAvg = (obj) => {
                const values = Object.values(obj).filter(v => typeof v === 'number');
                return values.length ? values.reduce((a, b) => a + b, 0) / values.length : 0;
            };
            
            const vision = calcAvg(assessmentData.vision);
            const kultur = calcAvg(assessmentData.kultur);
            const organisation = calcAvg(assessmentData.organisation);
            const prozesse = Object.values(assessmentData.prozesse).reduce((sum, p) => {
                if (p && p.digiIst) sum += (p.digiIst + (p.qualIst || 3)) / 2;
                return sum;
            }, 0) / Math.max(Object.keys(assessmentData.prozesse).length, 1);
            
            return {
                vision,
                kultur,
                organisation,
                prozesse: prozesse || 0,
                total: (vision + kultur + organisation + (prozesse || 0)) / 4
            };
        }
        
        // Modal schließen
        function closeLeadModal() {
            document.getElementById('leadCaptureModal').classList.remove('active');
        }

        // Initialize
        // Admin: Leads anzeigen (Ctrl+Shift+L)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'L') {
                showLeadsAdmin();
            }
        });

        function showLeadsAdmin() {
            const leads = JSON.parse(localStorage.getItem('hrSelbsttestLeads') || '[]');
            if (leads.length === 0) {
                alert('Keine Leads vorhanden.');
                return;
            }
            
            // Modal für Leads erstellen
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:99999;overflow:auto;padding:2rem;';
            
            let html = `
                <div style="max-width:900px;margin:0 auto;background:#1e293b;border-radius:16px;padding:2rem;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
                        <h2 style="color:#10b981;margin:0;">📊 HR-Selbsttest Leads (${leads.length})</h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background:#ef4444;color:white;border:none;padding:0.5rem 1rem;border-radius:8px;cursor:pointer;">Schließen</button>
                    </div>
                    <button onclick="navigator.clipboard.writeText(JSON.stringify(JSON.parse(localStorage.getItem('hrSelbsttestLeads')||'[]'),null,2));alert('Leads kopiert!')" style="background:#6366f1;color:white;border:none;padding:0.5rem 1rem;border-radius:8px;cursor:pointer;margin-bottom:1rem;">📋 Alle als JSON kopieren</button>
                    <button onclick="if(confirm('Alle Leads löschen?')){localStorage.removeItem('hrSelbsttestLeads');this.closest('div').parentElement.remove();}" style="background:#ef4444;color:white;border:none;padding:0.5rem 1rem;border-radius:8px;cursor:pointer;margin-left:0.5rem;margin-bottom:1rem;">🗑️ Alle löschen</button>
                    <div style="overflow-x:auto;">
                        <table style="width:100%;border-collapse:collapse;font-size:0.9rem;">
                            <thead>
                                <tr style="background:#334155;">
                                    <th style="padding:0.75rem;text-align:left;color:#10b981;">Datum</th>
                                    <th style="padding:0.75rem;text-align:left;color:#10b981;">Name</th>
                                    <th style="padding:0.75rem;text-align:left;color:#10b981;">E-Mail</th>
                                    <th style="padding:0.75rem;text-align:center;color:#10b981;">Beratung?</th>
                                    <th style="padding:0.75rem;text-align:center;color:#10b981;">Score</th>
                                    <th style="padding:0.75rem;text-align:center;color:#10b981;">Prozesse</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            leads.forEach((lead, i) => {
                const date = new Date(lead.timestamp).toLocaleString('de-CH');
                const scoreColor = lead.scores.total >= 3.5 ? '#10b981' : lead.scores.total >= 2 ? '#f59e0b' : '#ef4444';
                html += `
                    <tr style="border-bottom:1px solid #475569;${i%2?'background:#1e293b':'background:#0f172a'}">
                        <td style="padding:0.75rem;color:#94a3b8;">${date}</td>
                        <td style="padding:0.75rem;color:#fff;font-weight:600;">${lead.name}</td>
                        <td style="padding:0.75rem;"><a href="mailto:${lead.email}" style="color:#60a5fa;">${lead.email}</a></td>
                        <td style="padding:0.75rem;text-align:center;">${lead.wantsConsultation ? '✅' : '❌'}</td>
                        <td style="padding:0.75rem;text-align:center;color:${scoreColor};font-weight:700;">${lead.scores.total}/5</td>
                        <td style="padding:0.75rem;text-align:center;color:#94a3b8;">${lead.prozesseBewertet}/${lead.prozesseGesamt}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div></div>';
            modal.innerHTML = html;
            document.body.appendChild(modal);
        }

        // ========================================
        // BPMN Workflow Generation Functions
        // ========================================
        
        let bpmnViewer = null;
        let currentWorkflowProcessId = null;
        
        // Update workflow link visibility based on description input
        function updateWorkflowLinkVisibility() {
            const description = document.getElementById('modalProcessDescription')?.value?.trim();
            const link = document.getElementById('workflowGenerateLink');
            if (link) {
                if (description && description.length > 10) {
                    link.classList.remove('disabled');
                } else {
                    link.classList.add('disabled');
                }
            }
        }
        
        // Get API URL for BPMN generation
        function getBpmnApiUrl() {
            return (window.getApiUrl && window.getApiUrl('TEXT_TO_BPMN_GPT')) ||
                (window.AWS_APP_CONFIG && window.AWS_APP_CONFIG.API_BASE ? window.AWS_APP_CONFIG.API_BASE + '/text-to-bpmn-gpt' : '');
        }
        
        // Get OpenAI API Key from admin settings
        async function getOpenAIApiKey() {
            if (window.awsAPISettings && typeof window.awsAPISettings.getFullApiKey === 'function') {
                try {
                    const key = await window.awsAPISettings.getFullApiKey('openai');
                    if (key && typeof key === 'string' && key.length > 10) return key;
                } catch (e) {
                    console.warn('OpenAI-Key nicht geladen:', e);
                }
            }
            return '';
        }
        
        // Generate workflow from process description
        async function generateWorkflow(processId) {
            const description = document.getElementById('modalProcessDescription')?.value?.trim();
            if (!description || description.length < 10) {
                showWorkflowError('Bitte geben Sie zuerst eine Kurzbeschreibung ein.');
                return;
            }
            
            currentWorkflowProcessId = processId;
            
            // Show loading state
            document.getElementById('workflowGenerateLink').style.display = 'none';
            document.getElementById('workflowLoading').style.display = 'flex';
            document.getElementById('workflowError').style.display = 'none';
            
            // Clear the viewer canvas but keep container visible for smooth transition
            const viewerCanvas = document.getElementById('bpmnViewerCanvas');
            if (viewerCanvas) viewerCanvas.innerHTML = '';
            
            try {
                const apiKey = await getOpenAIApiKey();
                const apiUrl = getBpmnApiUrl();
                
                if (!apiUrl) {
                    throw new Error('API-URL ist nicht konfiguriert.');
                }
                
                if (!apiKey) {
                    throw new Error('OpenAI API-Key nicht konfiguriert. Bitte im Admin-Panel unter API Keys hinterlegen.');
                }
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: description,
                        openaiApiKey: apiKey,
                        processId: processId
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || response.statusText || 'Unbekannter Fehler');
                }
                
                if (!data.success || !data.bpmnXml) {
                    throw new Error(data.error || 'Kein gültiges BPMN-XML erhalten.');
                }
                
                // Store BPMN XML AND description in assessment data
                if (!assessmentData.prozesse[processId]) {
                    assessmentData.prozesse[processId] = {};
                }
                assessmentData.prozesse[processId].bpmnXml = data.bpmnXml;
                // Speichere auch die Beschreibung, die für den Workflow verwendet wurde
                assessmentData.prozesse[processId].description = description;
                saveData();
                
                // Hide loading before showing viewer
                document.getElementById('workflowLoading').style.display = 'none';
                
                // Show the viewer container first to ensure it has dimensions
                document.getElementById('bpmnViewerContainer').classList.add('active');
                
                // Wait for CSS transition and container to be visible
                await new Promise(resolve => setTimeout(resolve, 150));
                
                // Now initialize the viewer
                await initBpmnViewer(data.bpmnXml);
                
            } catch (error) {
                console.error('Workflow generation error:', error);
                showWorkflowError(error.message);
                document.getElementById('workflowLoading').style.display = 'none';
            } finally {
                document.getElementById('workflowGenerateLink').style.display = 'flex';
            }
        }
        
        // Initialize BPMN viewer with XML
        async function initBpmnViewer(xml) {
            const container = document.getElementById('bpmnViewerCanvas');
            const viewerContainer = document.getElementById('bpmnViewerContainer');
            if (!container) return;
            
            // Hide error message
            const errorEl = document.getElementById('workflowError');
            if (errorEl) errorEl.style.display = 'none';
            
            // Clear previous viewer
            container.innerHTML = '';
            
            // Make sure container is visible before rendering
            if (viewerContainer) {
                viewerContainer.classList.add('active');
            }
            
            // Wait for container to be visible and have dimensions
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Create new viewer
            bpmnViewer = new BpmnJS({
                container: container
            });
            
            try {
                await bpmnViewer.importXML(xml);
                
                // Wait a bit more for the diagram to be fully rendered
                await new Promise(resolve => setTimeout(resolve, 50));
                
                // Fit to viewport with error handling
                const canvas = bpmnViewer.get('canvas');
                
                // Reset zoom level for new diagram
                currentZoomLevel = 1;
                
                // Check if container has valid dimensions
                const rect = container.getBoundingClientRect();
                if (rect.width > 0 && rect.height > 0) {
                    try {
                        canvas.zoom('fit-viewport');
                        currentZoomLevel = canvas.zoom();
                        updateZoomDisplay();
                    } catch (zoomErr) {
                        console.warn('Zoom error, using fallback:', zoomErr);
                        canvas.zoom(0.8);
                        currentZoomLevel = 0.8;
                        updateZoomDisplay();
                    }
                } else {
                    // Container not visible yet, retry after a delay
                    setTimeout(() => {
                        try {
                            const newRect = container.getBoundingClientRect();
                            if (newRect.width > 0 && newRect.height > 0) {
                                canvas.zoom('fit-viewport');
                            } else {
                                canvas.zoom(0.8);
                            }
                        } catch (e) {
                            console.warn('Delayed zoom failed:', e);
                        }
                    }, 300);
                }
            } catch (err) {
                console.error('BPMN import error:', err);
                showWorkflowError('Diagramm konnte nicht geladen werden: ' + (err.message || err));
            }
        }
        
        // Show workflow error message
        function showWorkflowError(message) {
            const errorEl = document.getElementById('workflowError');
            if (errorEl) {
                errorEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> ' + message;
                errorEl.style.display = 'flex';
            }
        }
        
        // BPMN Zoom Functions
        let currentZoomLevel = 1;
        
        function bpmnZoom(action) {
            if (!bpmnViewer) return;
            
            try {
                const canvas = bpmnViewer.get('canvas');
                
                switch(action) {
                    case 'in':
                        currentZoomLevel = Math.min(currentZoomLevel * 1.2, 4);
                        canvas.zoom(currentZoomLevel);
                        break;
                    case 'out':
                        currentZoomLevel = Math.max(currentZoomLevel / 1.2, 0.2);
                        canvas.zoom(currentZoomLevel);
                        break;
                    case 'fit':
                        canvas.zoom('fit-viewport');
                        currentZoomLevel = canvas.zoom();
                        break;
                    case 'reset':
                        currentZoomLevel = 1;
                        canvas.zoom(1);
                        canvas.scroll({ dx: 0, dy: 0 });
                        break;
                }
                
                // Update zoom level display
                updateZoomDisplay();
            } catch (e) {
                console.warn('Zoom error:', e);
            }
        }
        
        function updateZoomDisplay() {
            const zoomEl = document.getElementById('bpmnZoomLevel');
            if (zoomEl) {
                zoomEl.textContent = Math.round(currentZoomLevel * 100) + '%';
            }
        }
        
        // Render Workflow Dashboard in Results Section
        function renderWorkflowDashboard() {
            const dashboard = document.getElementById('workflowDashboard');
            const cardsContainer = document.getElementById('workflowCards');
            
            if (!dashboard || !cardsContainer) return;
            
            // Find all processes with BPMN workflows
            const workflowProcesses = [];
            const prozesse = assessmentData.prozesse || {};
            
            for (const [processId, data] of Object.entries(prozesse)) {
                if (data && data.bpmnXml) {
                    // Find process name from hrCategories
                    let processName = processId;
                    let categoryName = '';
                    for (const cat of hrCategories) {
                        const proc = cat.processes.find(p => p.id === processId);
                        if (proc) {
                            processName = proc.name;
                            categoryName = cat.name;
                            break;
                        }
                    }
                    workflowProcesses.push({
                        id: processId,
                        name: processName,
                        category: categoryName,
                        description: data.description || '',
                        bpmnXml: data.bpmnXml
                    });
                }
            }
            
            // Hide dashboard if no workflows
            if (workflowProcesses.length === 0) {
                dashboard.style.display = 'none';
                return;
            }
            
            dashboard.style.display = 'block';
            
            // Generate cards HTML
            cardsContainer.innerHTML = workflowProcesses.map(proc => `
                <div class="workflow-card" data-process-id="${proc.id}">
                    <div class="workflow-card-preview">
                        <div class="bpmn-preview" id="preview-${proc.id}"></div>
                    </div>
                    <div class="workflow-card-body">
                        <h4 class="workflow-card-title">
                            <i class="fas fa-sitemap"></i>
                            ${escapeHtml(proc.name)}
                        </h4>
                        <p class="workflow-card-desc">
                            ${proc.description ? escapeHtml(proc.description) : '<em>Automatisch generierter Workflow basierend auf Ihrer Prozessbeschreibung</em>'}
                        </p>
                        <div class="workflow-card-meta">
                            <span class="workflow-card-badge">
                                <i class="fas fa-folder"></i> ${escapeHtml(proc.category)}
                            </span>
                            <div class="workflow-card-actions">
                                <button class="workflow-card-btn secondary" onclick="downloadBpmnFromDashboard('${proc.id}')" title="BPMN herunterladen">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="workflow-card-btn primary" onclick="openWorkflowDetail('${proc.id}')" title="Details anzeigen">
                                    <i class="fas fa-expand"></i> Öffnen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Render BPMN previews
            setTimeout(() => {
                workflowProcesses.forEach(proc => {
                    renderBpmnPreview(proc.id, proc.bpmnXml);
                });
            }, 100);
        }
        
        // Render BPMN preview in a card
        async function renderBpmnPreview(processId, bpmnXml) {
            const container = document.getElementById(`preview-${processId}`);
            if (!container || !bpmnXml) return;
            
            try {
                const viewer = new BpmnJS({
                    container: container
                });
                
                await viewer.importXML(bpmnXml);
                
                const canvas = viewer.get('canvas');
                canvas.zoom('fit-viewport');
            } catch (err) {
                console.warn('Could not render preview for', processId, err);
                container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #94a3b8; font-size: 0.85rem;"><i class="fas fa-exclamation-circle" style="margin-right: 0.5rem;"></i> Vorschau nicht verfügbar</div>';
            }
        }
        
        // Download BPMN from dashboard
        function downloadBpmnFromDashboard(processId) {
            const data = assessmentData.prozesse[processId];
            if (!data || !data.bpmnXml) {
                alert('Kein Workflow vorhanden.');
                return;
            }
            
            // Find process name
            let processName = processId;
            for (const cat of hrCategories) {
                const proc = cat.processes.find(p => p.id === processId);
                if (proc) {
                    processName = proc.name.replace(/[^a-zA-Z0-9äöüÄÖÜß]/g, '-');
                    break;
                }
            }
            
            const blob = new Blob([data.bpmnXml], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workflow-${processName}.bpmn`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Open workflow detail modal
        function openWorkflowDetail(processId) {
            // Open the process modal to show the workflow
            openProcessModal(processId);
        }
        
        // Download BPMN file
        function downloadBpmn(processId) {
            const data = assessmentData.prozesse[processId];
            if (!data || !data.bpmnXml) {
                alert('Kein Workflow vorhanden.');
                return;
            }
            
            const blob = new Blob([data.bpmnXml], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workflow-${processId}-${Date.now()}.bpmn`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Convert BPMN XML to PNG image (base64)
        async function bpmnToImage(bpmnXml) {
            // Timeout wrapper to prevent hanging
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('BPMN rendering timeout')), 10000);
            });
            
            const renderPromise = new Promise(async (resolve, reject) => {
                let tempContainer = null;
                let viewer = null;
                
                try {
                    // Create temporary container - smaller for mobile
                    const isMobile = window.innerWidth < 768;
                    const containerWidth = isMobile ? 800 : 1200;
                    const containerHeight = isMobile ? 400 : 600;
                    
                    tempContainer = document.createElement('div');
                    tempContainer.style.cssText = `position: absolute; left: -9999px; top: -9999px; width: ${containerWidth}px; height: ${containerHeight}px;`;
                    document.body.appendChild(tempContainer);
                    
                    // Create viewer
                    viewer = new BpmnJS({ container: tempContainer });
                    
                    await viewer.importXML(bpmnXml);
                    
                    // Fit to viewport to get proper bounds
                    const canvas = viewer.get('canvas');
                    canvas.zoom('fit-viewport');
                    
                    // Get SVG with viewBox for proper scaling
                    const { svg } = await viewer.saveSVG();
                    
                    // Parse SVG to get dimensions
                    const parser = new DOMParser();
                    const svgDoc = parser.parseFromString(svg, 'image/svg+xml');
                    const svgEl = svgDoc.documentElement;
                    
                    // Get viewBox or width/height
                    let svgWidth = 800;
                    let svgHeight = 400;
                    const viewBox = svgEl.getAttribute('viewBox');
                    if (viewBox) {
                        const parts = viewBox.split(' ').map(Number);
                        if (parts.length === 4) {
                            svgWidth = parts[2];
                            svgHeight = parts[3];
                        }
                    }
                    
                    // Scale factor for quality (reduced for mobile compatibility)
                    const scale = isMobile ? 1 : 1.5;
                    const maxWidth = isMobile ? 1200 : 2000;
                    const maxHeight = isMobile ? 800 : 1200;
                    const outputWidth = Math.min(Math.max(svgWidth * scale, 800), maxWidth);
                    const outputHeight = Math.min(Math.max(svgHeight * scale, 400), maxHeight);
                    
                    // Set explicit dimensions on SVG for proper rendering
                    svgEl.setAttribute('width', outputWidth);
                    svgEl.setAttribute('height', outputHeight);
                    
                    const modifiedSvg = new XMLSerializer().serializeToString(svgDoc);
                    
                    // Convert SVG to PNG via canvas
                    const imgCanvas = document.createElement('canvas');
                    const ctx = imgCanvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = () => {
                        // Set canvas size to match image
                        imgCanvas.width = img.width;
                        imgCanvas.height = img.height;
                        
                        // White background
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, imgCanvas.width, imgCanvas.height);
                        
                        // Draw image
                        ctx.drawImage(img, 0, 0);
                        
                        // Get base64 with high quality
                        const dataUrl = imgCanvas.toDataURL('image/png', 1.0);
                        
                        // Store aspect ratio for PDF
                        const aspectRatio = img.width / img.height;
                        
                        // Cleanup
                        viewer.destroy();
                        document.body.removeChild(tempContainer);
                        URL.revokeObjectURL(img.src);
                        
                        resolve({ dataUrl, aspectRatio, width: img.width, height: img.height });
                    };
                    
                    img.onerror = (err) => {
                        if (viewer) viewer.destroy();
                        if (tempContainer && tempContainer.parentNode) {
                            document.body.removeChild(tempContainer);
                        }
                        reject(err);
                    };
                    
                    // Create blob URL from modified SVG
                    const svgBlob = new Blob([modifiedSvg], { type: 'image/svg+xml;charset=utf-8' });
                    img.src = URL.createObjectURL(svgBlob);
                    
                } catch (err) {
                    // Cleanup on error
                    if (viewer) {
                        try { viewer.destroy(); } catch (e) {}
                    }
                    if (tempContainer && tempContainer.parentNode) {
                        try { document.body.removeChild(tempContainer); } catch (e) {}
                    }
                    reject(err);
                }
            });
            
            // Race between render and timeout
            return Promise.race([renderPromise, timeoutPromise]);
        }
        
        // Pre-render all BPMN diagrams for PDF export
        async function preRenderBpmnImages() {
            const images = {};
            const prozesse = assessmentData.prozesse || {};
            
            for (const [processId, data] of Object.entries(prozesse)) {
                if (data && data.bpmnXml) {
                    try {
                        images[processId] = await bpmnToImage(data.bpmnXml);
                    } catch (err) {
                        console.warn('Could not render BPMN for', processId, err);
                    }
                }
            }
            
            return images;
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadSavedData();
            initProcessGrid();
            
            // Remove all slider-container elements (they are redundant with rating labels)
            document.querySelectorAll('.slider-container').forEach(el => el.remove());
            
            // Add rating labels to all rating-options that don't have them
            const defaultLabels = {
                1: 'Trifft gar nicht zu',
                2: 'Trifft wenig zu',
                3: 'Teils/teils',
                4: 'Trifft zu',
                5: 'Trifft voll zu'
            };
            
            document.querySelectorAll('.rating-option').forEach(option => {
                if (!option.querySelector('.rating-label')) {
                    const value = option.dataset.value;
                    const label = document.createElement('div');
                    label.className = 'rating-label';
                    label.textContent = defaultLabels[value] || '';
                    option.appendChild(label);
                }
            });
            
            // Restore selected ratings
            Object.entries(assessmentData.vision).forEach(([question, value]) => {
                const scale = document.querySelector(`[data-question="${question}"]`);
                if (scale) {
                    const option = scale.querySelector(`[data-value="${value}"]`);
                    if (option) option.classList.add('selected');
                }
            });
            
            Object.entries(assessmentData.kultur).forEach(([question, value]) => {
                const scale = document.querySelector(`[data-question="${question}"]`);
                if (scale) {
                    const option = scale.querySelector(`[data-value="${value}"]`);
                    if (option) option.classList.add('selected');
                }
            });
            
            Object.entries(assessmentData.organisation).forEach(([question, value]) => {
                if (typeof value === 'number') {
                    const scale = document.querySelector(`[data-question="${question}"]`);
                    if (scale) {
                        const option = scale.querySelector(`[data-value="${value}"]`);
                        if (option) option.classList.add('selected');
                    }
                }
            });
        });
    </script>
    
    <!-- Auth Modal für Profil-Speicherung -->
    <div class="lead-capture-modal" id="authModal">
        <div class="lead-capture-content" style="max-width: 420px;">
            <h2><i class="fas fa-user-circle"></i> Anmelden oder Registrieren</h2>
            <p style="margin-bottom: 1.5rem;">Melden Sie sich an, um Ihre Ergebnisse dauerhaft zu speichern und später wieder aufzurufen.</p>
            
            <div class="auth-tabs" style="display: flex; margin-bottom: 1.5rem; border-radius: 12px; overflow: hidden; background: rgba(255,255,255,0.1);">
                <button class="auth-tab active" data-tab="login" onclick="switchAuthTab('login')" style="flex: 1; padding: 0.75rem; border: none; background: transparent; color: white; cursor: pointer; font-weight: 600; transition: all 0.3s;">Anmelden</button>
                <button class="auth-tab" data-tab="register" onclick="switchAuthTab('register')" style="flex: 1; padding: 0.75rem; border: none; background: transparent; color: rgba(255,255,255,0.6); cursor: pointer; font-weight: 600; transition: all 0.3s;">Registrieren</button>
            </div>
            
            <style>
                .auth-tab.active { background: rgba(99, 102, 241, 0.5) !important; color: white !important; }
                .auth-form { display: none; }
                .auth-form.active { display: block; }
                @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
                @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100px); opacity: 0; } }
            </style>
            
            <div id="authError" style="display: none; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); color: #fca5a5; padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; font-size: 0.9rem;"></div>
            
            <!-- Login Form -->
            <div class="auth-form active" id="loginForm">
                <div class="lead-form-group">
                    <label for="authEmail">E-Mail</label>
                    <input type="email" id="authEmail" placeholder="ihre@email.ch">
                </div>
                <div class="lead-form-group">
                    <label for="authPassword">Passwort</label>
                    <input type="password" id="authPassword" placeholder="Ihr Passwort">
                </div>
                <button class="lead-submit-btn" onclick="handleLogin()" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                    <i class="fas fa-sign-in-alt"></i> Anmelden
                </button>
            </div>
            
            <!-- Register Form -->
            <div class="auth-form" id="registerForm">
                <div class="lead-form-group">
                    <label for="regName">Name</label>
                    <input type="text" id="regName" placeholder="Ihr Name">
                </div>
                <div class="lead-form-group">
                    <label for="regEmail">E-Mail</label>
                    <input type="email" id="regEmail" placeholder="ihre@email.ch">
                </div>
                <div class="lead-form-group">
                    <label for="regPassword">Passwort (min. 6 Zeichen)</label>
                    <input type="password" id="regPassword" placeholder="Neues Passwort">
                </div>
                <button class="lead-submit-btn" onclick="handleRegister()" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <i class="fas fa-user-plus"></i> Registrieren & Speichern
                </button>
            </div>
            
            <button class="btn-nav btn-back" onclick="closeAuthModal()" style="width: 100%; margin-top: 1rem;">
                Abbrechen
            </button>
        </div>
    </div>
    
    <!-- Lead Capture Modal -->
    <div class="lead-capture-modal" id="leadCaptureModal">
        <div class="lead-capture-content">
            <h2><i class="fas fa-download"></i> Ergebnisse herunterladen</h2>
            <p>Bitte geben Sie Ihre Kontaktdaten ein, um Ihre personalisierten HR-Analyse-Ergebnisse herunterzuladen.</p>
            
            <div class="lead-form-group">
                <label for="leadName">Name *</label>
                <input type="text" id="leadName" placeholder="Ihr vollständiger Name" oninput="validateLeadForm()">
            </div>
            
            <div class="lead-form-group">
                <label for="leadEmail">E-Mail * (geschäftlich)</label>
                <input type="email" id="leadEmail" placeholder="ihre.email@firma.ch" oninput="validateLeadForm()">
                <div id="leadEmailError" style="display: none; color: #ef4444; font-size: 0.8rem; margin-top: 4px;"></div>
            </div>
            
            <div class="checkbox-group-lead">
                <input type="checkbox" id="leadConsent" onchange="validateLeadForm()">
                <label for="leadConsent">Ich erlaube Manuel Weiss, mich bezüglich meiner HR-Analyse zu kontaktieren. *</label>
            </div>
            
            <div class="checkbox-group-lead">
                <input type="checkbox" id="leadConsultation">
                <label for="leadConsultation">Ich möchte ein kostenloses Beratungsgespräch buchen.</label>
            </div>
            
            <button class="lead-submit-btn" id="leadSubmitBtn" onclick="submitLeadAndDownload()" disabled>
                <i class="fas fa-download"></i> Ergebnisse herunterladen
            </button>
            
            <button class="btn-nav btn-back" onclick="closeLeadModal()" style="width: 100%; margin-top: 0.5rem;">
                Abbrechen
            </button>
        </div>
    </div>
</body>
</html>
