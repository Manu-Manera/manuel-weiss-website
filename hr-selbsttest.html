<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HR-Standortbestimmung - Umfassende HR-Analyse | Manuel Weiss</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="HR-Standortbestimmung: Bewerten Sie Ihre HR-Organisation systematisch. Vision, Kultur, Organisation und Prozesse – mit konkreten Handlungsempfehlungen.">
    <meta name="keywords" content="HR-Standortbestimmung, Standortbestimmung, HR Assessment, Employee Experience, HR Analyse, Digitalisierung">
    <meta name="author" content="Manuel Weiss">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="css/starry-background.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        /* ═══════════════════════════════════════════════════════════════════════════
           HR SELBSTTEST - UMFASSENDE HR-ANALYSE
           ═══════════════════════════════════════════════════════════════════════════ */
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%) !important;
            min-height: 100vh;
            color: #e2e8f0;
            padding-top: 70px; /* Platz fuer fixierte Navbar */
        }
        
        /* Moderne Navbar wie Bewerbungsmanager */
        .navbar-selftest {
            position: fixed !important;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(15, 23, 42, 0.95) !important;
            backdrop-filter: blur(20px) !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            z-index: 1000;
            display: flex;
            align-items: center;
            padding: 0 2rem;
        }
        
        .navbar-selftest .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        .navbar-selftest .nav-brand img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Fortschritts-Kuchendiagramm im Header */
        .progress-pie {
            width: 40px;
            height: 40px;
            position: relative;
        }
        
        .progress-pie svg {
            transform: rotate(-90deg);
            width: 40px;
            height: 40px;
        }
        
        .progress-pie-bg {
            fill: none;
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 4;
        }
        
        .progress-pie-fill {
            fill: none;
            stroke: #10b981;
            stroke-width: 4;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.5s ease;
        }
        
        .progress-pie-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 0.6rem;
            font-weight: 700;
            color: white;
        }
        
        .nav-brand-info {
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }
        
        .nav-brand-title {
            font-size: 1rem;
            font-weight: 700;
        }
        
        .nav-brand-subtitle {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 400;
        }
        
        .navbar-selftest .nav-links {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }
        
        .navbar-selftest .nav-link {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        
        .navbar-selftest .nav-link:hover {
            color: white;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .navbar-selftest .nav-link.active {
            color: white;
            background: rgba(99, 102, 241, 0.3);
        }
        
        .navbar-selftest .nav-link i {
            margin-right: 0.5rem;
        }
        
        .navbar-selftest .nav-cta {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white !important;
            padding: 0.5rem 1.25rem;
            border-radius: 8px;
            font-weight: 600;
            margin-left: 1rem;
        }
        
        .navbar-selftest .nav-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        
        /* Mobile Home Button (links) */
        .mobile-home-btn {
            display: none;
            color: white;
            font-size: 1.25rem;
            padding: 0.5rem;
            text-decoration: none;
        }
        
        /* Desktop-only elements */
        @media (min-width: 769px) {
            .navbar-selftest .mobile-menu-btn { display: none; }
            .mobile-home-btn { display: none; }
            .mobile-export-footer { display: none !important; }
            .desktop-only { display: flex !important; }
        }
        
        @media (max-width: 768px) {
            .navbar-selftest {
                padding: 0 0.75rem;
                justify-content: space-between;
            }
            .navbar-selftest .nav-links { display: none; }
            .navbar-selftest .desktop-only { display: none !important; }
            .mobile-home-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 44px;
                height: 44px;
                background: rgba(99, 102, 241, 0.3);
                border-radius: 10px;
            }
            .navbar-selftest .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
                width: 44px;
                height: 44px;
                color: white;
                font-size: 1.25rem;
                cursor: pointer;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 10px;
            }
            
            /* Mobile Menu Overlay */
            .mobile-menu-overlay {
                display: none;
                position: fixed;
                top: 70px;
                left: 0;
                right: 0;
                bottom: 80px; /* Platz für Footer */
                background: rgba(15, 23, 42, 0.98);
                backdrop-filter: blur(20px);
                z-index: 999;
                padding: 1rem;
                overflow-y: auto;
            }
            .mobile-menu-overlay.active { display: block; }
            .mobile-menu-link {
                display: flex;
                align-items: center;
                gap: 1rem;
                color: white;
                padding: 1rem;
                font-size: 1.1rem;
                text-decoration: none;
                border-bottom: 1px solid rgba(255,255,255,0.1);
                transition: background 0.2s;
            }
            .mobile-menu-link:hover, .mobile-menu-link:active {
                background: rgba(255,255,255,0.1);
            }
            .mobile-menu-link i { width: 24px; text-align: center; }
            .mobile-menu-cta {
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                border-radius: 12px;
                border: none;
                margin-top: 0.5rem;
                justify-content: center;
            }
            
            /* Mobile Export Footer */
            .mobile-export-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                padding: 1rem;
                background: rgba(15, 23, 42, 0.95);
                backdrop-filter: blur(20px);
                border-top: 1px solid rgba(255, 255, 255, 0.1);
                z-index: 999;
                transition: opacity 0.2s, visibility 0.2s;
            }
            /* Hide mobile export footer when any modal is open */
            .modal-overlay.active ~ .mobile-export-footer,
            body:has(.modal-overlay.active) .mobile-export-footer,
            body:has(.lead-capture-modal.active) .mobile-export-footer {
                opacity: 0;
                visibility: hidden;
                pointer-events: none;
            }
            .lead-capture-modal.active ~ .mobile-export-footer {
                display: none !important;
            }
            .mobile-export-btn {
                width: 100%;
                padding: 1rem;
                background: linear-gradient(135deg, #6366f1, #8b5cf6);
                color: white;
                border: none;
                border-radius: 12px;
                font-size: 1.1rem;
                font-weight: 600;
                cursor: pointer;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.75rem;
            }
            .mobile-export-btn:active {
                transform: scale(0.98);
            }
            
            /* Content padding for fixed footer */
            body { padding-bottom: 80px; }
        }
        
        /* Hero Section */
        .selftest-hero {
            background: rgba(99, 102, 241, 0.15);
            backdrop-filter: blur(20px);
            color: white;
            padding: 3rem 0;
            text-align: center;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            position: relative;
            z-index: 2;
        }
        
        .hero-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            box-shadow: 0 8px 32px rgba(251, 191, 36, 0.3);
        }
        
        .hero-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #fde68a 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .hero-subtitle {
            font-size: 1.1rem;
            color: #c7d2fe;
            max-width: 700px;
            margin: 0 auto 1.5rem;
        }
        
        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid rgba(251, 191, 36, 0.3);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-weight: 500;
            color: #fde68a;
        }
        
        /* Main Container */
        .selftest-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }
        
        /* Progress Overview */
        .progress-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 768px) {
            .progress-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .progress-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .progress-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }
        
        .progress-card.active {
            border-color: #fbbf24;
            background: rgba(251, 191, 36, 0.1);
        }
        
        .progress-card.completed {
            border-color: #10b981;
        }
        
        .progress-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }
        
        .progress-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
        }
        
        .progress-card:nth-child(1) .progress-icon { background: linear-gradient(135deg, #6366f1, #8b5cf6); }
        .progress-card:nth-child(2) .progress-icon { background: linear-gradient(135deg, #10b981, #059669); }
        .progress-card:nth-child(3) .progress-icon { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .progress-card:nth-child(4) .progress-icon { background: linear-gradient(135deg, #ef4444, #dc2626); }
        
        .progress-title {
            font-weight: 600;
            color: #fff;
            font-size: 1rem;
        }
        
        .progress-bar-container {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .progress-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .progress-card:nth-child(1) .progress-bar-fill { background: linear-gradient(90deg, #6366f1, #8b5cf6); }
        .progress-card:nth-child(2) .progress-bar-fill { background: linear-gradient(90deg, #10b981, #059669); }
        .progress-card:nth-child(3) .progress-bar-fill { background: linear-gradient(90deg, #f59e0b, #d97706); }
        .progress-card:nth-child(4) .progress-bar-fill { background: linear-gradient(90deg, #ef4444, #dc2626); }
        
        .progress-text {
            font-size: 0.75rem;
            color: #a5b4fc;
            margin-top: 0.5rem;
        }
        
        /* Happy Company Yoga Teppich */
        .yoga-teppich-section {
            margin-bottom: 3rem;
        }
        
        .yoga-teppich-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin: 0 auto;
            aspect-ratio: 1;
        }
        
        .yoga-teppich-svg {
            width: 100%;
            height: 100%;
        }
        
        /* Assessment Section */
        .assessment-section {
            display: none;
        }
        
        .assessment-section.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #fff 0%, #a5b4fc 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .section-description {
            color: #a5b4fc;
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Question Cards */
        .question-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .question-number {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
            flex-shrink: 0;
        }
        
        .question-content h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.5rem;
        }
        
        .question-content p {
            color: #a5b4fc;
            font-size: 0.9rem;
        }
        
        /* Rating Scale */
        .rating-scale {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .rating-option {
            flex: 1;
            min-width: 80px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .rating-option:hover {
            border-color: rgba(99, 102, 241, 0.5);
            background: rgba(99, 102, 241, 0.1);
        }
        
        .rating-option.selected {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.2);
        }
        
        .rating-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 0.25rem;
        }
        
        .rating-label {
            font-size: 0.75rem;
            color: #a5b4fc;
        }
        
        /* Slider Scale */
        .slider-container {
            margin: 1.5rem 0;
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: #a5b4fc;
        }
        
        .slider-track {
            position: relative;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }
        
        .slider-fill {
            position: absolute;
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        .slider-thumb {
            position: absolute;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            cursor: grab;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }
        
        .slider-thumb:hover {
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .slider-value {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 700;
            color: #fff;
        }
        
        /* Tips Box - Nur in Auswertung anzeigen */
        .tips-box {
            display: none !important; /* Versteckt während Test, nur in Auswertung sichtbar */
        }
        
        .results-section .tips-box {
            display: block !important;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 1.25rem;
            margin-top: 1.5rem;
        }
        
        .tips-box-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            color: #6ee7b7;
            font-weight: 600;
        }
        
        .tips-box ul {
            margin: 0;
            padding-left: 1.25rem;
            color: #a7f3d0;
        }
        
        .tips-box li {
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        /* Moderne interaktive Slider statt Buttons */
        .modern-slider-container {
            margin: 1.5rem 0;
            padding: 0 0.5rem;
        }
        
        .modern-slider {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            border-radius: 5px;
            background: linear-gradient(90deg, #ef4444 0%, #fbbf24 50%, #22c55e 100%);
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }
        
        .modern-slider:hover {
            opacity: 1;
        }
        
        .modern-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 3px solid #6366f1;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .modern-slider::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        
        .modern-slider::-moz-range-thumb {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 3px solid #6366f1;
        }
        
        .slider-value-display {
            text-align: center;
            font-size: 2rem;
            font-weight: 800;
            color: #fff;
            margin: 1rem 0 0.5rem;
            text-shadow: 0 2px 10px rgba(99, 102, 241, 0.5);
        }
        
        .slider-labels-modern {
            display: flex;
            justify-content: space-between;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.85rem;
            margin-top: 0.5rem;
        }
        
        /* Lead Capture Modal */
        .lead-capture-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }
        
        .lead-capture-modal.active {
            display: flex;
        }
        
        .lead-capture-content {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-radius: 24px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(99, 102, 241, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .lead-capture-content h2 {
            color: white;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        .lead-capture-content p {
            color: #a5b4fc;
            margin-bottom: 1.5rem;
        }
        
        .lead-form-group {
            margin-bottom: 1rem;
        }
        
        .lead-form-group label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        .lead-form-group input[type="text"],
        .lead-form-group input[type="email"] {
            width: 100%;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            color: white;
            font-size: 1rem;
        }
        
        .lead-form-group input:focus {
            outline: none;
            border-color: #6366f1;
        }
        
        .checkbox-group-lead {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin: 1rem 0;
        }
        
        .checkbox-group-lead input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            accent-color: #6366f1;
        }
        
        .checkbox-group-lead label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            cursor: pointer;
        }
        
        .lead-submit-btn {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            margin-top: 1rem;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .lead-submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }
        
        .lead-submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Process Grid */
        .process-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        
        .process-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .process-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-4px);
        }
        
        .process-card.completed {
            border-color: #10b981;
        }
        
        .process-card-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            margin-bottom: 1rem;
        }
        
        .process-card h4 {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.5rem;
        }
        
        .process-card p {
            font-size: 0.85rem;
            color: #a5b4fc;
            margin-bottom: 1rem;
        }
        
        .process-card-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
        }
        
        .process-card-status.pending { color: #fbbf24; }
        .process-card-status.completed { color: #10b981; }
        
        /* Kategorisierte Prozesse */
        .process-category {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .process-category:hover {
            border-color: rgba(255, 255, 255, 0.15);
        }
        
        .category-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-header:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .category-icon {
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.1rem;
            flex-shrink: 0;
        }
        
        .category-info {
            flex: 1;
            min-width: 0;
        }
        
        .category-info h3 {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin: 0 0 0.5rem 0;
        }
        
        .category-progress {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .category-progress-bar {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .category-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }
        
        .category-progress-text {
            font-size: 0.75rem;
            color: #a5b4fc;
            white-space: nowrap;
        }
        
        .category-toggle {
            color: rgba(255, 255, 255, 0.5);
            transition: transform 0.3s ease;
        }
        
        .process-category.expanded .category-toggle {
            transform: rotate(180deg);
        }
        
        .category-processes {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .process-category.expanded .category-processes {
            max-height: 400px;
        }
        
        .process-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 0.875rem 1.25rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .process-item-top {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .process-item:last-child {
            border-bottom: none;
        }
        
        .process-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .process-item-status {
            font-size: 0.9rem;
        }
        
        .process-item-status.pending { color: rgba(255, 255, 255, 0.3); }
        .process-item-status.completed { color: #10b981; }
        
        .process-item-name {
            flex: 1;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .process-item.completed .process-item-name {
            color: #fff;
        }
        .process-item-top .process-item-name-block {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        .process-item-desc {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.55);
            font-weight: 400;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .process-item-details {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
            margin-top: 0.25rem;
        }
        .process-item-detail-row {
            font-size: 0.72rem;
            line-height: 1.25;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .process-item-detail-label {
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            margin-right: 0.35rem;
        }
        .process-item-detail-value {
            color: rgba(255, 255, 255, 0.55);
            font-weight: 400;
        }
        .process-item-score {
            margin-left: auto;
        }
        
        .score-badge {
            display: inline-block;
            padding: 0.25rem 0.6rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
        }
        
        .score-badge.pending {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.4);
        }
        
        .process-arrow {
            color: rgba(255, 255, 255, 0.3);
            font-size: 0.7rem;
            transition: transform 0.2s ease;
        }
        
        .process-item:hover .process-arrow {
            transform: translateX(3px);
            color: rgba(255, 255, 255, 0.6);
        }

        /* Add Process Button */
        .add-process-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            margin: 0.5rem 0.75rem 0.75rem;
            background: rgba(99, 102, 241, 0.1);
            border: 1px dashed rgba(99, 102, 241, 0.4);
            border-radius: 10px;
            color: rgba(99, 102, 241, 0.8);
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .add-process-btn:hover {
            background: rgba(99, 102, 241, 0.2);
            border-color: rgba(99, 102, 241, 0.6);
            color: #818cf8;
        }
        .add-process-btn i {
            font-size: 0.9rem;
        }

        /* Custom Process Item (deletable) */
        .process-item.custom-process {
            position: relative;
        }
        .process-item.custom-process .delete-process-btn {
            position: absolute;
            right: 2.5rem;
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: #ef4444;
            font-size: 0.7rem;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .process-item.custom-process:hover .delete-process-btn {
            opacity: 1;
        }
        .process-item.custom-process .delete-process-btn:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        /* Add Category Section */
        .add-category-section {
            margin-top: 1rem;
            padding: 1rem;
        }
        .add-category-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            padding: 1.25rem;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.08), rgba(139, 92, 246, 0.08));
            border: 2px dashed rgba(99, 102, 241, 0.3);
            border-radius: 16px;
            color: rgba(99, 102, 241, 0.7);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .add-category-btn:hover {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
            border-color: rgba(99, 102, 241, 0.5);
            color: #818cf8;
            transform: translateY(-2px);
        }
        .add-category-btn i {
            font-size: 1.2rem;
        }

        /* Custom Category Header (with delete) */
        .category-header.custom-category {
            position: relative;
        }
        .category-header.custom-category .delete-category-btn {
            position: absolute;
            right: 3rem;
            top: 50%;
            transform: translateY(-50%);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.2);
            border: none;
            color: #ef4444;
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .category-header.custom-category:hover .delete-category-btn {
            opacity: 1;
        }
        .category-header.custom-category .delete-category-btn:hover {
            background: rgba(239, 68, 68, 0.4);
        }

        /* Add Process/Category Modal */
        .add-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            z-index: 10000;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        .add-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .add-modal {
            background: linear-gradient(145deg, #1e1b4b, #312e81);
            border-radius: 20px;
            padding: 2rem;
            width: 90%;
            max-width: 450px;
            border: 1px solid rgba(99, 102, 241, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s ease;
        }
        .add-modal-overlay.active .add-modal {
            transform: scale(1) translateY(0);
        }
        .add-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #fff;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .add-modal-title i {
            color: #818cf8;
        }
        .add-modal-input {
            width: 100%;
            padding: 1rem 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }
        .add-modal-input:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
        }
        .add-modal-input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }
        .add-modal-colors {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }
        .add-modal-color {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.2s ease;
        }
        .add-modal-color:hover {
            transform: scale(1.1);
        }
        .add-modal-color.selected {
            border-color: #fff;
            box-shadow: 0 0 12px currentColor;
        }
        .add-modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }
        .add-modal-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s ease;
        }
        .add-modal-btn.cancel {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
        }
        .add-modal-btn.cancel:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .add-modal-btn.confirm {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: #fff;
        }
        .add-modal-btn.confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        .add-modal-btn.confirm:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        /* Edit/Delete Buttons für Kategorien und Prozesse */
        .category-edit-btns, .process-edit-btns {
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        .category-header:hover .category-edit-btns,
        .process-item:hover .process-edit-btns {
            opacity: 1;
        }
        .edit-btn, .delete-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            transition: all 0.2s ease;
        }
        .edit-btn {
            background: rgba(99, 102, 241, 0.2);
            color: #818cf8;
        }
        .edit-btn:hover {
            background: rgba(99, 102, 241, 0.4);
        }
        .delete-btn {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }
        .delete-btn:hover {
            background: rgba(239, 68, 68, 0.4);
        }
        .edit-btn.small, .delete-btn.small {
            width: 24px;
            height: 24px;
            font-size: 0.65rem;
        }
        
        /* Restore Hidden Button */
        .restore-hidden-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            padding: 0.75rem;
            margin-top: 0.75rem;
            background: rgba(245, 158, 11, 0.1);
            border: 1px dashed rgba(245, 158, 11, 0.4);
            border-radius: 12px;
            color: rgba(245, 158, 11, 0.8);
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .restore-hidden-btn:hover {
            background: rgba(245, 158, 11, 0.2);
            border-color: rgba(245, 158, 11, 0.6);
        }
        
        /* Restore Hidden Modal */
        .restore-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        .restore-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        .restore-item-info {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .restore-item-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
        }
        .restore-item-name {
            color: #fff;
            font-weight: 500;
        }
        .restore-item-type {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.75rem;
        }
        .restore-item-btn {
            padding: 0.4rem 0.8rem;
            background: rgba(34, 197, 94, 0.2);
            border: none;
            border-radius: 6px;
            color: #4ade80;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .restore-item-btn:hover {
            background: rgba(34, 197, 94, 0.4);
        }
        
        /* Process Grid Update */
        #processGrid {
            display: flex;
            flex-direction: column;
            gap: 0;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn-nav {
            padding: 1rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: none;
            transition: all 0.3s ease;
        }
        
        .btn-back {
            background: rgba(255, 255, 255, 0.1);
            color: #a5b4fc;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-back:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        
        .btn-next {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        
        .btn-next:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        
        .btn-results {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .btn-results:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
        }
        
        /* Results Section */
        .results-overview {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        @media (max-width: 1024px) {
            .results-overview {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .result-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .result-card:hover {
            transform: translateY(-4px);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 8px 30px rgba(99, 102, 241, 0.2);
        }
        
        .result-card:hover .result-expand-hint {
            opacity: 1;
        }
        
        .result-expand-hint {
            position: absolute;
            bottom: 8px;
            right: 8px;
            font-size: 0.75rem;
            color: #a5b4fc;
            opacity: 0;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        /* Aktive Kachel Styling */
        .result-card.active {
            border: 2px solid #6366f1;
            box-shadow: 0 0 25px rgba(99, 102, 241, 0.4);
            transform: translateY(-2px);
        }
        
        .result-card.active::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 12px solid transparent;
            border-right: 12px solid transparent;
            border-top: 12px solid #6366f1;
        }
        
        /* Inline-Detail Container */
        .category-detail-inline {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.05));
            border: 1px solid rgba(99, 102, 241, 0.3);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            display: none;
        }
        
        .category-detail-inline.active {
            display: block;
            animation: fadeInUp 0.3s ease;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .detail-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
        }
        
        .detail-header-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }
        
        .detail-header-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
        }
        
        .detail-header-subtitle {
            font-size: 0.9rem;
            color: #a5b4fc;
        }
        
        .detail-header-score {
            margin-left: auto;
            font-size: 2rem;
            font-weight: 800;
        }
        
        .detail-section {
            margin-bottom: 1.5rem;
        }
        
        .detail-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #a5b4fc;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* PDF Loading Overlay */
        .pdf-loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        
        .pdf-loading-overlay.active {
            display: flex;
        }
        
        .pdf-loading-content {
            text-align: center;
            max-width: 400px;
            padding: 2rem;
        }
        
        .pdf-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(99, 102, 241, 0.2);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: pdfSpin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }
        
        @keyframes pdfSpin {
            to { transform: rotate(360deg); }
        }
        
        .pdf-loading-text {
            font-size: 1.25rem;
            font-weight: 600;
            color: white;
            margin-bottom: 1rem;
        }
        
        .pdf-loading-subtext {
            font-size: 0.9rem;
            color: #a5b4fc;
            margin-bottom: 1.5rem;
        }
        
        .pdf-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .pdf-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* Category Detail Modal */
        .category-detail-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            z-index: 9999;
            display: none;
            align-items: flex-start;
            justify-content: center;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .category-detail-modal.active {
            display: flex;
        }
        
        .category-detail-content {
            background: rgba(30, 27, 75, 0.95);
            border-radius: 24px;
            max-width: 800px;
            width: 100%;
            margin: 2rem auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }
        
        .category-detail-header {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.3), rgba(139, 92, 246, 0.3));
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .category-detail-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .category-detail-title h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
            margin: 0;
        }
        
        .category-detail-score {
            font-size: 2.5rem;
            font-weight: 800;
        }
        
        .category-detail-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.25rem;
            transition: all 0.2s;
        }
        
        .category-detail-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .category-detail-body {
            padding: 2rem;
        }
        
        .subcategory-section {
            margin-bottom: 2rem;
        }
        
        .subcategory-section h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #a5b4fc;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .subcategory-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .subcategory-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .subcategory-name {
            font-weight: 500;
            color: white;
        }
        
        .subcategory-score {
            font-weight: 700;
            font-size: 0.9rem;
        }
        
        .subcategory-bar {
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .subcategory-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .recommendations-list {
            margin-top: 1.5rem;
        }
        
        .recommendations-list h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: #a5b4fc;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .recommendation-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border-left: 3px solid #6366f1;
        }
        
        .recommendation-item-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .recommendation-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
        }
        
        .recommendation-item-title {
            font-weight: 600;
            color: white;
            font-size: 1rem;
            margin-bottom: 0.25rem;
        }
        
        .recommendation-item-desc {
            font-size: 0.9rem;
            color: #a5b4fc;
            line-height: 1.5;
        }
        
        .recommendation-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .recommendation-btn {
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .recommendation-btn.primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        
        .recommendation-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }
        
        .recommendation-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .recommendation-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        @media (max-width: 768px) {
            .category-detail-modal {
                padding: 1rem;
            }
            
            .category-detail-content {
                margin: 1rem auto;
            }
            
            .category-detail-header {
                padding: 1.5rem;
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .category-detail-title {
                flex-direction: column;
            }
            
            .category-detail-close {
                position: absolute;
                top: 1rem;
                right: 1rem;
            }
            
            .recommendation-actions {
                flex-direction: column;
            }
        }
        
        .result-score {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }
        
        .result-score.excellent { color: #10b981; }
        .result-score.good { color: #6366f1; }
        .result-score.moderate { color: #fbbf24; }
        .result-score.needs-work { color: #ef4444; }
        
        .result-label {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 0.25rem;
        }
        
        .result-description {
            font-size: 0.85rem;
            color: #a5b4fc;
        }
        
        /* Recommendations */
        .recommendations-section {
            margin-top: 2rem;
        }
        
        .recommendation-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
            border-color: #6366f1;
        }
        
        .recommendation-card.high-priority {
            border-color: #ef4444;
        }
        
        .recommendation-card.medium-priority {
            border-color: #fbbf24;
        }
        
        .recommendation-card.low-priority {
            border-color: #10b981;
        }
        
        .recommendation-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        
        .recommendation-title {
            font-weight: 600;
            color: #fff;
        }
        
        .recommendation-priority {
            font-size: 0.75rem;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .recommendation-priority.high { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .recommendation-priority.medium { background: rgba(251, 191, 36, 0.2); color: #fde68a; }
        .recommendation-priority.low { background: rgba(16, 185, 129, 0.2); color: #6ee7b7; }
        
        .recommendation-text {
            color: #a5b4fc;
            font-size: 0.9rem;
        }
        
        /* Deep Dive Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 2rem;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 100%);
            border-radius: 24px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #fff;
        }
        
        .modal-close {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #a5b4fc;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            color: #fff;
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        /* Deep Dive Rating Groups */
        .rating-group {
            margin-bottom: 2rem;
        }
        
        .rating-group-title {
            font-size: 1rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .rating-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .rating-column {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1rem;
        }
        
        .rating-column-label {
            font-size: 0.8rem;
            color: #a5b4fc;
            margin-bottom: 0.5rem;
        }
        
        /* Wizard Textarea - Larger Input Fields */
        .wizard-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: 2px solid rgba(255, 255, 255, 0.15);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }
        
        .wizard-textarea:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.1);
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.2);
        }
        
        .wizard-textarea::placeholder {
            color: rgba(165, 180, 252, 0.6);
        }
        
        /* BPMN Workflow Viewer Styles */
        .workflow-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        .workflow-generate-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: #a5b4fc;
            font-size: 0.9rem;
            cursor: pointer;
            transition: color 0.2s;
            margin-top: 0.75rem;
        }
        .workflow-generate-link:hover {
            color: #6366f1;
        }
        .workflow-generate-link.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        .workflow-loading {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            color: #a5b4fc;
            font-size: 0.9rem;
            margin-top: 0.75rem;
        }
        .workflow-loading .spinner {
            width: 18px;
            height: 18px;
            border: 2px solid rgba(99, 102, 241, 0.3);
            border-top-color: #6366f1;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .bpmn-viewer-container {
            margin-top: 1rem;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            overflow: hidden;
            display: none;
        }
        .bpmn-viewer-container.active {
            display: block;
        }
        .bpmn-viewer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: rgba(99, 102, 241, 0.1);
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
        }
        .bpmn-viewer-title {
            font-weight: 600;
            color: #1e293b;
            font-size: 0.9rem;
        }
        .bpmn-viewer-actions {
            display: flex;
            gap: 0.5rem;
        }
        .bpmn-viewer-btn {
            padding: 0.4rem 0.75rem;
            font-size: 0.8rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s;
        }
        .bpmn-viewer-btn.primary {
            background: #6366f1;
            color: white;
        }
        .bpmn-viewer-btn.primary:hover {
            background: #4f46e5;
        }
        .bpmn-viewer-btn.secondary {
            background: rgba(99, 102, 241, 0.15);
            color: #4f46e5;
        }
        .bpmn-viewer-btn.secondary:hover {
            background: rgba(99, 102, 241, 0.25);
        }
        #bpmnViewerCanvas {
            width: 100%;
            height: 300px;
            background: white;
            overflow: hidden;
            position: relative;
        }
        .bpmn-hint {
            position: absolute;
            bottom: 8px;
            left: 8px;
            right: 8px;
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 11px;
            color: #475569;
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            z-index: 10;
            pointer-events: none;
            text-align: center;
            line-height: 1.4;
        }
        .bpmn-hint i {
            margin-right: 4px;
            color: #4f46e5;
        }
        .bpmn-hint-desktop { display: inline; }
        .bpmn-hint-mobile { display: none; }
        #bpmnViewerCanvas {
            cursor: grab;
        }
        #bpmnViewerCanvas:active {
            cursor: grabbing;
        }
        #bpmnViewerCanvas.dragging {
            cursor: grabbing;
        }
        @media (max-width: 768px) {
            .bpmn-viewer-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            #bpmnViewerCanvas {
                min-width: 500px;
                height: 250px;
            }
            .bpmn-hint {
                font-size: 10px;
                padding: 6px 10px;
                left: 5px;
                right: 5px;
                bottom: 5px;
            }
            .bpmn-hint-desktop { display: none; }
            .bpmn-hint-mobile { display: inline; }
        }
        .workflow-error {
            color: #ef4444;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Workflow Dashboard Styles */
        .workflow-dashboard {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(139, 92, 246, 0.08));
            border: 1px solid rgba(99, 102, 241, 0.25);
            border-radius: 20px;
            padding: 1.75rem;
            margin: 2rem 0;
        }
        .dashboard-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .dashboard-icon {
            width: 56px;
            height: 56px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 24px rgba(99, 102, 241, 0.35);
        }
        .dashboard-icon i {
            color: white;
            font-size: 1.5rem;
        }
        .dashboard-title {
            color: #fff;
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }
        .dashboard-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            margin: 0.25rem 0 0 0;
        }
        .workflow-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.25rem;
        }
        .workflow-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        .workflow-card:hover {
            transform: translateY(-4px);
            border-color: rgba(99, 102, 241, 0.4);
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.2);
        }
        .workflow-card-preview {
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            height: 180px;
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid rgba(99, 102, 241, 0.1);
        }
        .workflow-card-preview canvas,
        .workflow-card-preview .bpmn-preview {
            width: 100%;
            height: 100%;
        }
        .workflow-card-preview .bpmn-preview .djs-container {
            background: transparent !important;
        }
        .workflow-card-preview .bjs-powered-by {
            display: none !important;
        }
        .workflow-card-body {
            padding: 1rem 1.25rem;
        }
        .workflow-card-title {
            color: #fff;
            font-size: 1rem;
            font-weight: 600;
            margin: 0 0 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .workflow-card-title i {
            color: #6366f1;
            font-size: 0.9rem;
        }
        .workflow-card-desc {
            color: rgba(255, 255, 255, 0.65);
            font-size: 0.85rem;
            line-height: 1.5;
            margin: 0 0 1rem 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .workflow-card-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.08);
        }
        .workflow-card-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.3rem 0.6rem;
            background: rgba(99, 102, 241, 0.15);
            border-radius: 6px;
            font-size: 0.75rem;
            color: #a5b4fc;
        }
        .workflow-card-actions {
            display: flex;
            gap: 0.5rem;
            margin-left: auto;
        }
        .workflow-card-btn {
            padding: 0.4rem 0.65rem;
            border: none;
            border-radius: 6px;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: all 0.2s;
        }
        .workflow-card-btn.primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        .workflow-card-btn.primary:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
        }
        .workflow-card-btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.8);
        }
        .workflow-card-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        @media (max-width: 768px) {
            .workflow-cards {
                grid-template-columns: 1fr;
            }
            .workflow-card-preview {
                height: 140px;
            }
        }
        
        /* Enhanced Modal Rating Scale */
        .modal-body .rating-scale {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
        }
        
        .modal-body .rating-option {
            padding: 1.25rem 0.75rem;
            min-width: auto;
        }
        
        .modal-body .rating-value {
            font-size: 1.75rem;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            .hero-title { font-size: 1.75rem; }
            .yoga-teppich-container { max-width: 100%; }
            .question-card { padding: 1rem; }
            .rating-scale { 
                gap: 0.25rem; 
                flex-wrap: nowrap;
                overflow-x: auto;
                padding-bottom: 0.5rem;
            }
            .rating-option { 
                min-width: 55px; 
                padding: 0.6rem 0.4rem;
                flex-shrink: 0;
            }
            .rating-value { font-size: 1.1rem; }
            .rating-label { font-size: 0.65rem; }
            .nav-buttons { flex-direction: column; gap: 1rem; }
            .btn-nav { width: 100%; justify-content: center; }
            .results-overview { grid-template-columns: 1fr; }
            .rating-row { grid-template-columns: 1fr; }
            .process-grid { grid-template-columns: 1fr; }
            .progress-overview { 
                grid-template-columns: repeat(2, 1fr); 
                gap: 0.75rem;
            }
            .progress-card { padding: 1rem; }
            .progress-title { font-size: 0.9rem; }
            .selftest-container { padding: 1rem; }
            
            /* Lead Modal Mobile */
            .lead-capture-content {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            /* Modern Slider Mobile */
            .modern-slider {
                height: 12px !important;
            }
            .modern-slider::-webkit-slider-thumb {
                width: 36px !important;
                height: 36px !important;
            }
        }
        
        @media (max-width: 480px) {
            .progress-overview { 
                grid-template-columns: 1fr; 
            }
            .rating-option { 
                min-width: 50px; 
                padding: 0.5rem 0.3rem;
            }
            .rating-value { font-size: 1rem; }
        }
    </style>
</head>
<body class="starry-theme">
    <!-- Navigation - Moderne Navbar -->
    <nav class="navbar-selftest">
        <!-- Desktop: Full navbar mit Fortschritts-Kuchendiagramm -->
        <div class="nav-brand desktop-only">
            <div class="progress-pie" id="headerProgressPie">
                <svg viewBox="0 0 36 36">
                    <circle class="progress-pie-bg" cx="18" cy="18" r="16"></circle>
                    <circle class="progress-pie-fill" id="headerProgressCircle" cx="18" cy="18" r="16" 
                            stroke-dasharray="100.53" stroke-dashoffset="100.53"></circle>
                </svg>
                <span class="progress-pie-text" id="headerProgressText">0%</span>
            </div>
            <div class="nav-brand-info">
                <span class="nav-brand-title">HR-Coach</span>
                <span class="nav-brand-subtitle" id="headerProgressLabel">Fortschritt</span>
            </div>
        </div>
        
        <!-- Mobile: Only icons -->
        <a href="index.html" class="mobile-home-btn" title="Zur Startseite">
            <i class="fas fa-home"></i>
        </a>
        
        <div class="nav-links">
            <a href="index.html" class="nav-link"><i class="fas fa-home"></i>Start</a>
            <a href="#progress-overview" class="nav-link"><i class="fas fa-tasks"></i>Fortschritt</a>
            <a href="#results-section" class="nav-link"><i class="fas fa-chart-bar"></i>Ergebnisse</a>
            <a href="hr-automation-workflow.html" class="nav-link"><i class="fas fa-pencil-alt"></i>Prozesse zeichnen</a>
            <a href="ki-strategieentwicklung.html" class="nav-link"><i class="fas fa-brain"></i>KI-Strategie</a>
            <a href="#" class="nav-link nav-cta" onclick="downloadResults()"><i class="fas fa-download"></i>Export</a>
        </div>
        <div class="mobile-menu-btn" onclick="toggleMobileMenu()">
            <i class="fas fa-bars"></i>
        </div>
    </nav>
    
    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="mobile-menu-overlay">
        <a href="index.html" class="mobile-menu-link"><i class="fas fa-home"></i>Start</a>
        <a href="#progress-overview" onclick="toggleMobileMenu()" class="mobile-menu-link"><i class="fas fa-tasks"></i>Fortschritt</a>
        <a href="#results-section" onclick="toggleMobileMenu()" class="mobile-menu-link"><i class="fas fa-chart-bar"></i>Ergebnisse</a>
        <a href="hr-automation-workflow.html" class="mobile-menu-link"><i class="fas fa-pencil-alt"></i>Prozesse zeichnen</a>
        <a href="ki-strategieentwicklung.html" class="mobile-menu-link"><i class="fas fa-brain"></i>KI-Strategie</a>
        <div style="border-top: 1px solid rgba(255,255,255,0.2); margin: 1rem 0;"></div>
        <a href="#" onclick="saveToProfile(); toggleMobileMenu();" class="mobile-menu-link"><i class="fas fa-save"></i>Im Profil speichern</a>
        <a href="login.html" class="mobile-menu-link"><i class="fas fa-sign-in-alt"></i>Anmelden</a>
        <a href="#" onclick="downloadResults(); toggleMobileMenu();" class="mobile-menu-link mobile-menu-cta"><i class="fas fa-download"></i>PDF Export</a>
    </div>
    
    <!-- Mobile Fixed Footer: PDF Export -->
    <div class="mobile-export-footer">
        <button onclick="downloadResults()" class="mobile-export-btn">
            <i class="fas fa-download"></i> PDF Export
        </button>
    </div>
    
    <script>
        function toggleMobileMenu() {
            const overlay = document.getElementById('mobileMenuOverlay');
            overlay.classList.toggle('active');
        }
        
        function saveToProfile() {
            // Prüfen ob eingeloggt
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            if (!isLoggedIn) {
                if (confirm('Um die Ergebnisse im Profil zu speichern, müssen Sie sich anmelden. Jetzt anmelden?')) {
                    window.location.href = 'login.html?redirect=' + encodeURIComponent(window.location.href);
                }
                return;
            }
            
            // Ergebnisse speichern
            const scores = calculateScores();
            const profileData = {
                type: 'hr-selbsttest',
                timestamp: new Date().toISOString(),
                scores: scores,
                assessmentData: assessmentData
            };
            
            // Lokal speichern (für spätere Sync mit AWS)
            let savedTests = JSON.parse(localStorage.getItem('userHRTests') || '[]');
            savedTests.unshift(profileData);
            localStorage.setItem('userHRTests', JSON.stringify(savedTests));
            
            alert('Ergebnisse wurden im Profil gespeichert!');
        }
    </script>

    <!-- Hero Section -->
    <section class="selftest-hero">
        <div class="container">
            <div class="hero-icon">
                <i class="fas fa-chart-pie"></i>
            </div>
            <h1 class="hero-title">HR-Standortbestimmung</h1>
            <p class="hero-subtitle">
                Analysieren Sie Ihre HR-Organisation systematisch. 
                Vision, Kultur, Organisation und Prozesse - umfassend bewertet mit konkreten Handlungsempfehlungen.
            </p>
            <div class="hero-badge">
                <i class="fas fa-clipboard-check"></i>
                <span>Wissenschaftlich fundierte HR-Analyse</span>
            </div>
        </div>
    </section>

    <!-- Main Container -->
    <div class="selftest-container">
        <!-- Management Dashboard Kachel -->
        <div class="dashboard-banner" onclick="showSection('results')" style="margin-bottom: 1.5rem; cursor: pointer;">
            <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(139, 92, 246, 0.2)); border-radius: 16px; padding: 1.25rem 1.5rem; border: 1px solid rgba(99, 102, 241, 0.3); display: flex; align-items: center; justify-content: space-between; transition: all 0.3s ease;">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #6366f1, #8b5cf6); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <i class="fas fa-chart-pie" style="color: white; font-size: 1.5rem;"></i>
                    </div>
                    <div>
                        <div style="font-weight: 700; font-size: 1.1rem; color: white;">Management Dashboard</div>
                        <div style="font-size: 0.85rem; color: #a5b4fc;">Ergebnisse, Analysen & Handlungsempfehlungen</div>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <div id="dashboardScorePreview" style="text-align: right;">
                        <div style="font-size: 1.5rem; font-weight: 800; color: #fbbf24;" id="dashboardTotalScore">--%</div>
                        <div style="font-size: 0.75rem; color: #a5b4fc;">Gesamtscore</div>
                    </div>
                    <i class="fas fa-chevron-right" style="color: #a5b4fc; font-size: 1.25rem;"></i>
                </div>
            </div>
        </div>
        
        <!-- Progress Overview -->
        <div class="progress-overview">
            <div class="progress-card active" onclick="showSection('vision')">
                <div class="progress-card-header">
                    <div class="progress-icon"><i class="fas fa-eye"></i></div>
                    <div class="progress-title">Vision</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-vision" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-vision-text">0/4</span> Fragen beantwortet</div>
            </div>
            
            <div class="progress-card" onclick="showSection('kultur')">
                <div class="progress-card-header">
                    <div class="progress-icon"><i class="fas fa-heart"></i></div>
                    <div class="progress-title">Kultur</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-kultur" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-kultur-text">0/9</span> Fragen beantwortet</div>
            </div>
            
            <div class="progress-card" onclick="showSection('organisation')">
                <div class="progress-card-header">
                    <div class="progress-icon"><i class="fas fa-sitemap"></i></div>
                    <div class="progress-title">Organisation</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-organisation" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-organisation-text">0/7</span> Fragen beantwortet</div>
            </div>
            
            <div class="progress-card" onclick="showSection('prozesse')">
                <div class="progress-card-header">
                    <div class="progress-icon"><i class="fas fa-cogs"></i></div>
                    <div class="progress-title">Prozesse</div>
                </div>
                <div class="progress-bar-container">
                    <div class="progress-bar-fill" id="progress-prozesse" style="width: 0%"></div>
                </div>
                <div class="progress-text"><span id="progress-prozesse-text">0/32</span> Bereiche bewertet</div>
            </div>
        </div>

        <!-- HR Dimensionen Übersicht - AUSGEBLENDET -->
        <div class="yoga-teppich-section" id="yoga-teppich" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">HR-Dimensionen im Überblick</h2>
                <p class="section-description">Klicken Sie auf einen Bereich, um mit der Bewertung zu beginnen</p>
            </div>
            
            <div class="yoga-teppich-container">
                <svg class="yoga-teppich-svg" viewBox="0 0 500 500">
                    <!-- Outer Ring - HR Bereiche -->
                    <circle cx="250" cy="250" r="240" fill="rgba(99, 102, 241, 0.1)" stroke="rgba(99, 102, 241, 0.3)" stroke-width="2"/>
                    
                    <!-- Middle Ring - Employee Experience -->
                    <circle cx="250" cy="250" r="180" fill="rgba(139, 92, 246, 0.15)" stroke="rgba(139, 92, 246, 0.3)" stroke-width="2"/>
                    
                    <!-- Inner Ring - Persönliches Wachstum -->
                    <circle cx="250" cy="250" r="120" fill="rgba(251, 191, 36, 0.2)" stroke="rgba(251, 191, 36, 0.4)" stroke-width="2"/>
                    
                    <!-- Center - Smiley -->
                    <circle cx="250" cy="250" r="60" fill="rgba(251, 191, 36, 0.4)" stroke="#fbbf24" stroke-width="3"/>
                    
                    <!-- Smiley Face -->
                    <circle cx="225" cy="240" r="8" fill="#1e1b4b"/>
                    <circle cx="275" cy="240" r="8" fill="#1e1b4b"/>
                    <path d="M 220 270 Q 250 300 280 270" stroke="#1e1b4b" stroke-width="4" fill="none" stroke-linecap="round"/>
                    
                    <!-- Labels - Outer Ring -->
                    <text x="250" y="30" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Analytics & Reporting</text>
                    <text x="400" y="80" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Strategie & Kultur</text>
                    <text x="470" y="180" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Recruiting</text>
                    <text x="470" y="320" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Onboarding</text>
                    <text x="400" y="420" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">HR Admin</text>
                    <text x="250" y="480" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Performance Management</text>
                    <text x="100" y="420" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Compensation</text>
                    <text x="30" y="320" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Learning</text>
                    <text x="30" y="180" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">Leadership</text>
                    <text x="100" y="80" text-anchor="middle" fill="#a5b4fc" font-size="10" font-weight="600">BGM</text>
                    
                    <!-- Labels - Middle Ring -->
                    <text x="250" y="90" text-anchor="middle" fill="#c7d2fe" font-size="9">Employee Experience</text>
                    <text x="330" y="140" text-anchor="middle" fill="#c7d2fe" font-size="8">Wellbeing</text>
                    <text x="360" y="210" text-anchor="middle" fill="#c7d2fe" font-size="8">Identifikation</text>
                    <text x="360" y="290" text-anchor="middle" fill="#c7d2fe" font-size="8">Veränderung</text>
                    <text x="330" y="360" text-anchor="middle" fill="#c7d2fe" font-size="8">Zugehörigkeit</text>
                    <text x="250" y="400" text-anchor="middle" fill="#c7d2fe" font-size="8">Unbesorgtheit</text>
                    <text x="170" y="360" text-anchor="middle" fill="#c7d2fe" font-size="8">Partner</text>
                    <text x="140" y="290" text-anchor="middle" fill="#c7d2fe" font-size="8">Purpose</text>
                    <text x="140" y="210" text-anchor="middle" fill="#c7d2fe" font-size="8">Fairness</text>
                    <text x="170" y="140" text-anchor="middle" fill="#c7d2fe" font-size="8">Wertschätzung</text>
                    
                    <!-- Center Label -->
                    <text x="250" y="340" text-anchor="middle" fill="#fde68a" font-size="11" font-weight="600">Persönliches Wachstum</text>
                    
                    <!-- Clickable Areas -->
                    <circle cx="250" cy="250" r="60" fill="transparent" style="cursor: pointer;" onclick="showSection('vision')"/>
                </svg>
            </div>
        </div>

        <!-- Vision Section -->
        <div class="assessment-section active" id="section-vision">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-eye"></i> Vision</h2>
                <p class="section-description">Wo wollen Sie mit HR hin? So bringen Sie Strategie und Alltag zusammen.</p>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">1</div>
                    <div class="question-content">
                        <h3>HR und Unternehmensstrategie im Einklang</h3>
                        <p>Wie gut ist Ihre HR-Strategie mit der Gesamtstrategie Ihres Unternehmens verzahnt?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="vision-1">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value">1</div>
                        <div class="rating-label">Trifft gar nicht zu</div>
                    </div>
                    <div class="rating-option" data-value="2" onclick="selectRating(this)">
                        <div class="rating-value">2</div>
                        <div class="rating-label">Trifft wenig zu</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value">3</div>
                        <div class="rating-label">Teils/teils</div>
                    </div>
                    <div class="rating-option" data-value="4" onclick="selectRating(this)">
                        <div class="rating-value">4</div>
                        <div class="rating-label">Trifft zu</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value">5</div>
                        <div class="rating-label">Trifft voll zu</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps zur Verbesserung</div>
                    <ul>
                        <li>Analysieren Sie die Unternehmensvision und leiten Sie HR-spezifische Ziele ab</li>
                        <li>Erstellen Sie eine HR-Vision-Roadmap mit messbaren Meilensteinen</li>
                        <li>Präsentieren Sie die HR-Vision regelmäßig in Management-Meetings</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">2</div>
                    <div class="question-content">
                        <h3>Strategie, die im Alltag ankommt</h3>
                        <p>Spüren Sie und Ihre Kolleg:innen die strategische Ausrichtung in der täglichen Arbeit?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="vision-2">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value">1</div>
                        <div class="rating-label">Trifft gar nicht zu</div>
                    </div>
                    <div class="rating-option" data-value="2" onclick="selectRating(this)">
                        <div class="rating-value">2</div>
                        <div class="rating-label">Trifft wenig zu</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value">3</div>
                        <div class="rating-label">Teils/teils</div>
                    </div>
                    <div class="rating-option" data-value="4" onclick="selectRating(this)">
                        <div class="rating-value">4</div>
                        <div class="rating-label">Trifft zu</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value">5</div>
                        <div class="rating-label">Trifft voll zu</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps zur Verbesserung</div>
                    <ul>
                        <li>Integrieren Sie die Vision in Team-Meetings und Entscheidungsprozesse</li>
                        <li>Nutzen Sie visuelle Erinnerungen (Poster, Screensaver, Intranet)</li>
                        <li>Verknüpfen Sie Projekterfolge mit der Vision</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">3</div>
                    <div class="question-content">
                        <h3>Klare Roadmap für die HR-Strategie</h3>
                        <p>Haben Sie einen verbindlichen Plan mit konkreten Schritten und Zeitrahmen?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="vision-3">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value">1</div>
                        <div class="rating-label">Trifft gar nicht zu</div>
                    </div>
                    <div class="rating-option" data-value="2" onclick="selectRating(this)">
                        <div class="rating-value">2</div>
                        <div class="rating-label">Trifft wenig zu</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value">3</div>
                        <div class="rating-label">Teils/teils</div>
                    </div>
                    <div class="rating-option" data-value="4" onclick="selectRating(this)">
                        <div class="rating-value">4</div>
                        <div class="rating-label">Trifft zu</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value">5</div>
                        <div class="rating-label">Trifft voll zu</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps zur Verbesserung</div>
                    <ul>
                        <li>Erstellen Sie eine 3-Jahres-Roadmap mit Quartalsmeilensteinen</li>
                        <li>Definieren Sie KPIs für jedes strategische Ziel</li>
                        <li>Führen Sie regelmäßige Strategy-Review-Meetings durch</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">4</div>
                    <div class="question-content">
                        <h3>„Was macht eigentlich das HR?“ – Bekanntheit im Unternehmen</h3>
                        <p>Wie gut wissen die anderen im Unternehmen, welchen Mehrwert Ihre Abteilung schafft?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="vision-4">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value">1</div>
                        <div class="rating-label">Trifft gar nicht zu</div>
                    </div>
                    <div class="rating-option" data-value="2" onclick="selectRating(this)">
                        <div class="rating-value">2</div>
                        <div class="rating-label">Trifft wenig zu</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value">3</div>
                        <div class="rating-label">Teils/teils</div>
                    </div>
                    <div class="rating-option" data-value="4" onclick="selectRating(this)">
                        <div class="rating-value">4</div>
                        <div class="rating-label">Trifft zu</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value">5</div>
                        <div class="rating-label">Trifft voll zu</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps zur Verbesserung</div>
                    <ul>
                        <li>Führen Sie eine HR-Awareness-Kampagne durch</li>
                        <li>Kommunizieren Sie HR-Erfolge regelmäßig im Intranet</li>
                        <li>Erstellen Sie einen HR-Newsletter für alle Mitarbeitenden</li>
                    </ul>
                </div>
            </div>
            
            <div class="nav-buttons">
                <div></div>
                <button class="btn-nav btn-next" onclick="showSection('kultur')">
                    Weiter zu Kultur <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Kultur Section -->
        <div class="assessment-section" id="section-kultur">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-heart"></i> Kultur</h2>
                <p class="section-description">Wie Sie führen, kommunizieren und mit Wandel umgehen – das prägt Ihre HR-Organisation.</p>
            </div>
            
            <!-- Leadership -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">1</div>
                    <div class="question-content">
                        <h3>Entscheidungen: oben oder nah dran?</h3>
                        <p>Wo werden in Ihrem Umfeld die Weichen gestellt – eher bei der Führung oder bei den Menschen, die die Arbeit machen?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-leadership-1-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Führung entscheidet</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div><div class="rating-label">Eher Führung</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div><div class="rating-label">Teils/teils</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div><div class="rating-label">Eher Teams</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Teams entscheiden</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-leadership-1-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Führung entscheidet</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div><div class="rating-label">Eher Führung</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div><div class="rating-label">Teils/teils</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div><div class="rating-label">Eher Teams</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Teams entscheiden</div></div>
                        </div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps: Mehr Eigenverantwortung ermöglichen</div>
                    <ul>
                        <li>Führen Sie ein Empowerment-Programm ein, das Mitarbeitenden mehr Entscheidungsbefugnis gibt</li>
                        <li>Schulen Sie Führungskräfte in Coaching-Methoden</li>
                        <li>Implementieren Sie dezentrale Entscheidungsstrukturen für Routinethemen</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">2</div>
                    <div class="question-content">
                        <h3>Führung von Teams: steuern oder begleiten?</h3>
                        <p>Wie erleben Sie die Führung Ihrer Teams – eher als klare Steuerung oder als Begleitung und Coaching?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-leadership-2-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Klare Steuerung</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div><div class="rating-label">Eher Steuerung</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div><div class="rating-label">Teils/teils</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div><div class="rating-label">Eher Coaching</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Coaching & Begleitung</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-leadership-2-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Klare Steuerung</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div><div class="rating-label">Eher Steuerung</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div><div class="rating-label">Teils/teils</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div><div class="rating-label">Eher Coaching</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Coaching & Begleitung</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">3</div>
                    <div class="question-content">
                        <h3>Ziele: einzeln oder im Team?</h3>
                        <p>Woran orientieren Sie sich bei der Zielsetzung – eher an individuellen oder an gemeinsamen Teamzielen?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-leadership-3-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-leadership-3-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps: Ziele und Ergebnisse strukturieren</div>
                    <ul>
                        <li>Erwägen Sie die Einführung von OKRs (Objectives and Key Results)</li>
                        <li>Kombinieren Sie Team- und individuelle Ziele für ausgewogene Anreize</li>
                        <li>Führen Sie regelmäßige Team-Retrospektiven ein</li>
                    </ul>
                </div>
            </div>
            
            <!-- Communication -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">4</div>
                    <div class="question-content">
                        <h3>Transparenz: Wie offen wird kommuniziert?</h3>
                        <p>Erleben Sie in Ihrem Unternehmen eher „Need-to-know“ oder echte Transparenz?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Zurückhaltend</span>
                        <span>Sehr transparent</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-comm-1-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-comm-1-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">5</div>
                    <div class="question-content">
                        <h3>Feedback: von wem und wie?</h3>
                        <p>Woher kommt bei Ihnen Feedback – vor allem von der Führungskraft oder aus mehreren Richtungen?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Vor allem von der Führung</span>
                        <span>Mehrere Perspektiven (z. B. 360°)</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-comm-2-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-comm-2-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps: Mehrperspektivisches Feedback</div>
                    <ul>
                        <li>Implementieren Sie anonyme Peer-Feedback-Tools</li>
                        <li>Schulen Sie Mitarbeitende im Geben und Empfangen von Feedback</li>
                        <li>Führen Sie regelmäßige Feedback-Gespräche außerhalb des MAG ein</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">6</div>
                    <div class="question-content">
                        <h3>Einbindung bei Entscheidungen</h3>
                        <p>Wer wird bei wichtigen Entscheidungen gehört – eher die Spitze oder verschiedene Ebenen?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Entscheidung „oben“</span>
                        <span>Viele Stimmen einbezogen</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-comm-3-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-comm-3-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Change -->
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">7</div>
                    <div class="question-content">
                        <h3>Veränderung: wie offen geht Ihr Unternehmen damit um?</h3>
                        <p>Wird Neues eher skeptisch betrachtet oder aktiv ausprobiert?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Bewährtes optimieren</span>
                        <span>Neues ausprobieren</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-change-1-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-change-1-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">8</div>
                    <div class="question-content">
                        <h3>Fehlerkultur: was passiert, wenn etwas schiefgeht?</h3>
                        <p>Werden Fehler versteckt und vermieden – oder als Chance zum Lernen genutzt?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Fehler vermeiden</span>
                        <span>Aus Fehlern lernen</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-change-2-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-change-2-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Tipps: Sicheren Umgang mit Fehlern stärken</div>
                    <ul>
                        <li>Führen Sie "Fail Forward"-Sessions ein, in denen aus Fehlern gelernt wird</li>
                        <li>Etablieren Sie eine "No Blame"-Kultur bei Post-Mortems</li>
                        <li>Feiern Sie Experimente, auch wenn sie scheitern</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">9</div>
                    <div class="question-content">
                        <h3>Spielraum für eigene Ideen</h3>
                        <p>Haben Ihre Mitarbeitenden echten Freiraum für eigene Ideen – oder kommen die Themen vor allem von oben?</p>
                    </div>
                </div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Themen von oben</span>
                        <span>Eigene Ideen willkommen</span>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand (Heute)</div>
                        <div class="rating-scale" data-question="kultur-change-3-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="kultur-change-3-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn-nav btn-back" onclick="showSection('vision')">
                    <i class="fas fa-arrow-left"></i> Zurück zu Vision
                </button>
                <button class="btn-nav btn-next" onclick="showSection('organisation')">
                    Weiter zu Organisation <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Organisation Section -->
        <div class="assessment-section" id="section-organisation">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-sitemap"></i> Organisation</h2>
                <p class="section-description">Wie Ihre HR-Abteilung aufgestellt ist und wo die Schwerpunkte liegen.</p>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">1</div>
                    <div class="question-content">
                        <h3>Reaktiv oder proaktiv unterwegs?</h3>
                        <p>Arbeitet HR bei Ihnen eher auf Anfrage – oder geht die Initiative von der Abteilung selbst aus?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand: Reaktiv ← → Proaktiv</div>
                        <div class="rating-scale" data-question="org-reactive-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Sehr reaktiv</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Sehr proaktiv</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="org-reactive-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">2</div>
                    <div class="question-content">
                        <h3>Alles inhouse oder mit externer Unterstützung?</h3>
                        <p>Wird HR-Arbeit bei Ihnen vor allem intern erledigt oder stark mit externen Partnern?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand: Inhouse ← → Extern</div>
                        <div class="rating-scale" data-question="org-inhouse-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Alles intern</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Viel extern</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="org-inhouse-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">3</div>
                    <div class="question-content">
                        <h3>Prozess oder Mensch im Fokus?</h3>
                        <p>Steht bei Ihnen eher der reibungslose Ablauf im Vordergrund oder die individuelle Betreuung?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand: Prozess ← → Kunde</div>
                        <div class="rating-scale" data-question="org-process-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Prozessfokus</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Kundenfokus</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="org-process-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">4</div>
                    <div class="question-content">
                        <h3>Generalisten oder Spezialist:innen?</h3>
                        <p>Sind Ihre HR-Mitarbeitenden eher breit aufgestellt oder in bestimmten Themen tief spezialisiert?</p>
                    </div>
                </div>
                <div class="rating-row">
                    <div class="rating-column">
                        <div class="rating-column-label">Aktueller Stand: Generalist ← → Spezialist</div>
                        <div class="rating-scale" data-question="org-generalist-ist">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div><div class="rating-label">Generalisten</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div><div class="rating-label">Spezialisten</div></div>
                        </div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Ziel</div>
                        <div class="rating-scale" data-question="org-generalist-soll">
                            <div class="rating-option" data-value="1" onclick="selectRating(this)"><div class="rating-value">1</div></div>
                            <div class="rating-option" data-value="2" onclick="selectRating(this)"><div class="rating-value">2</div></div>
                            <div class="rating-option" data-value="3" onclick="selectRating(this)"><div class="rating-value">3</div></div>
                            <div class="rating-option" data-value="4" onclick="selectRating(this)"><div class="rating-value">4</div></div>
                            <div class="rating-option" data-value="5" onclick="selectRating(this)"><div class="rating-value">5</div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">5</div>
                    <div class="question-content">
                        <h3>Ist HR am strategischen Tisch dabei?</h3>
                        <p>Hat die HR-Abteilung in Ihrer Geschäftsleitung eine Stimme?</p>
                    </div>
                </div>
                <div class="rating-scale" data-question="org-gl">
                    <div class="rating-option" data-value="1" onclick="selectRating(this)">
                        <div class="rating-value"><i class="fas fa-times"></i></div>
                        <div class="rating-label">Nein, nicht vertreten</div>
                    </div>
                    <div class="rating-option" data-value="3" onclick="selectRating(this)">
                        <div class="rating-value"><i class="fas fa-minus"></i></div>
                        <div class="rating-label">Teilweise / als Gast</div>
                    </div>
                    <div class="rating-option" data-value="5" onclick="selectRating(this)">
                        <div class="rating-value"><i class="fas fa-check"></i></div>
                        <div class="rating-label">Ja, vollwertiges Mitglied</div>
                    </div>
                </div>
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> HR auf Führungsebene</div>
                    <ul>
                        <li>HR auf Führungsebene stärkt die Bedeutung von People-Themen</li>
                        <li>Regelmäßige strategische Einblicke für die Leitung aufbereiten</li>
                        <li>Wirkung von HR-Initiativen mit Kennzahlen sichtbar machen</li>
                    </ul>
                </div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">6</div>
                    <div class="question-content">
                        <h3>Wo geht die Zeit heute hin?</h3>
                        <p>Wie verteilt sich die Arbeitszeit Ihrer HR-Abteilung aktuell auf diese drei Bereiche? (zusammen 100%)</p>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
                    <div class="rating-column">
                        <div class="rating-column-label">Administration</div>
                        <input type="number" id="effort-admin-ist" value="70" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('ist')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Talent / People Management</div>
                        <input type="number" id="effort-talent-ist" value="20" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('ist')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Strategie</div>
                        <input type="number" id="effort-strategy-ist" value="10" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('ist')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                </div>
                <div id="effort-total-ist" style="text-align: center; color: #10b981; font-weight: 600;">Total: 100%</div>
            </div>
            
            <div class="question-card">
                <div class="question-header">
                    <div class="question-number">7</div>
                    <div class="question-content">
                        <h3>Wie soll die Verteilung idealerweise aussehen?</h3>
                        <p>Wenn Sie es frei wählen könnten: Wie würden Sie die Kapazitäten auf die drei Bereiche verteilen?</p>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
                    <div class="rating-column">
                        <div class="rating-column-label">Administration</div>
                        <input type="number" id="effort-admin-soll" value="20" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('soll')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Talent / People Management</div>
                        <input type="number" id="effort-talent-soll" value="60" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('soll')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                    <div class="rating-column">
                        <div class="rating-column-label">Strategie</div>
                        <input type="number" id="effort-strategy-soll" value="20" min="0" max="100" style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; color: white; font-size: 1.5rem; text-align: center;" onchange="updateEffortTotal('soll')">
                        <div style="text-align: center; color: #a5b4fc; font-size: 0.8rem;">%</div>
                    </div>
                </div>
                <div id="effort-total-soll" style="text-align: center; color: #10b981; font-weight: 600;">Total: 100%</div>
                
                <div class="tips-box">
                    <div class="tips-box-header"><i class="fas fa-lightbulb"></i> Orientierungswerte für die Verteilung</div>
                    <ul>
                        <li>Viele HR-Abteilungen streben etwa 20% Administration, 60% Talent/People, 20% Strategie an</li>
                        <li>Automatisierung und Self-Service können den Verwaltungsanteil auf unter 25% senken</li>
                        <li>Damit entsteht mehr Spielraum für strategische Themen und Mitarbeiterentwicklung</li>
                    </ul>
                </div>
            </div>
            
            <div class="nav-buttons">
                <button class="btn-nav btn-back" onclick="showSection('kultur')">
                    <i class="fas fa-arrow-left"></i> Zurück zu Kultur
                </button>
                <button class="btn-nav btn-next" onclick="showSection('prozesse')">
                    Weiter zu Prozesse <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- Prozesse Section -->
        <div class="assessment-section" id="section-prozesse">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-cogs"></i> Prozesse</h2>
                <p class="section-description">Bewerten Sie jeden HR-Prozess nach Digitalisierungslevel, Prozessqualität und Wichtigkeit</p>
            </div>
            
            <div class="process-grid" id="processGrid">
                <!-- Will be populated by JavaScript -->
            </div>
            
            <div class="nav-buttons">
                <button class="btn-nav btn-back" onclick="showSection('organisation')">
                    <i class="fas fa-arrow-left"></i> Zurück zu Organisation
                </button>
                <button class="btn-nav btn-results" onclick="showSection('results')">
                    <i class="fas fa-chart-pie"></i> Ergebnisse anzeigen
                </button>
            </div>
        </div>

        <!-- Results Section -->
        <div class="assessment-section" id="section-results" style="scroll-margin-top: 80px;">
            <div class="section-header">
                <h2 class="section-title"><i class="fas fa-chart-pie"></i> Ihre Ergebnisse</h2>
                <p class="section-description">Übersicht über Ihre Standortbestimmung</p>
            </div>
            
            <!-- Ergebnis-Kacheln und Inline-Detail -->
            <div class="results-overview" id="resultsOverview">
                <!-- Wird dynamisch von generateResults() befüllt -->
            </div>
            
            <!-- Inline-Detail-Container für Kategorie-Details -->
            <div id="categoryDetailInline" class="category-detail-inline">
                <!-- Wird dynamisch befüllt wenn Kachel angeklickt -->
            </div>
            
            <!-- BPMN Workflow Dashboard (wird bei Prozesse-Kategorie angezeigt) -->
            <div id="workflowDashboard" class="workflow-dashboard" style="display: none;">
                <div class="dashboard-header">
                    <div class="dashboard-icon">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div>
                        <h3 class="dashboard-title">Ihre Prozess-Workflows</h3>
                        <p class="dashboard-subtitle">Automatisch generierte Ablaufdiagramme Ihrer HR-Prozesse</p>
                    </div>
                </div>
                
                <div class="workflow-cards" id="workflowCards">
                    <!-- Wird dynamisch befüllt -->
                </div>
            </div>
            
            <div class="nav-buttons" style="flex-wrap: wrap; gap: 0.75rem;">
                <button class="btn-nav btn-back" onclick="showSection('prozesse')">
                    <i class="fas fa-arrow-left"></i> Zurück bearbeiten
                </button>
                <button class="btn-nav btn-next" onclick="saveResultsToProfile()" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <i class="fas fa-save"></i> Im Profil speichern
                </button>
                <button class="btn-nav btn-next" onclick="downloadResults()">
                    <i class="fas fa-download"></i> PDF herunterladen
                </button>
            </div>
        </div>
    </div>

    <!-- Add Process Modal -->
    <div class="add-modal-overlay" id="addProcessModal">
        <div class="add-modal">
            <div class="add-modal-title">
                <i class="fas fa-plus-circle"></i> Eigenen Prozess hinzufügen
            </div>
            <input type="hidden" id="addProcessCategoryId">
            <input type="text" class="add-modal-input" id="addProcessName" placeholder="Name des Prozesses eingeben..." maxlength="100">
            <div class="add-modal-actions">
                <button class="add-modal-btn cancel" onclick="closeAddProcessModal()">Abbrechen</button>
                <button class="add-modal-btn confirm" id="confirmAddProcess" onclick="confirmAddProcess()" disabled>Hinzufügen</button>
            </div>
        </div>
    </div>

    <!-- Add Category Modal -->
    <div class="add-modal-overlay" id="addCategoryModal">
        <div class="add-modal">
            <div class="add-modal-title">
                <i class="fas fa-folder-plus"></i> Eigene Kategorie hinzufügen
            </div>
            <input type="text" class="add-modal-input" id="addCategoryName" placeholder="Name der Kategorie eingeben..." maxlength="50">
            <label style="color: rgba(255,255,255,0.7); font-size: 0.85rem; margin-bottom: 0.5rem; display: block;">Farbe wählen:</label>
            <div class="add-modal-colors" id="categoryColorPicker">
                <div class="add-modal-color selected" style="background: #6366f1;" data-color="#6366f1"></div>
                <div class="add-modal-color" style="background: #8b5cf6;" data-color="#8b5cf6"></div>
                <div class="add-modal-color" style="background: #ec4899;" data-color="#ec4899"></div>
                <div class="add-modal-color" style="background: #f59e0b;" data-color="#f59e0b"></div>
                <div class="add-modal-color" style="background: #10b981;" data-color="#10b981"></div>
                <div class="add-modal-color" style="background: #06b6d4;" data-color="#06b6d4"></div>
                <div class="add-modal-color" style="background: #84cc16;" data-color="#84cc16"></div>
                <div class="add-modal-color" style="background: #ef4444;" data-color="#ef4444"></div>
                <div class="add-modal-color" style="background: #f97316;" data-color="#f97316"></div>
                <div class="add-modal-color" style="background: #14b8a6;" data-color="#14b8a6"></div>
            </div>
            <div class="add-modal-actions">
                <button class="add-modal-btn cancel" onclick="closeAddCategoryModal()">Abbrechen</button>
                <button class="add-modal-btn confirm" id="confirmAddCategory" onclick="confirmAddCategory()" disabled>Hinzufügen</button>
            </div>
        </div>
    </div>

    <!-- Rename Process Modal -->
    <div class="add-modal-overlay" id="renameProcessModal">
        <div class="add-modal">
            <div class="add-modal-title">
                <i class="fas fa-pen"></i> Prozess umbenennen
            </div>
            <input type="hidden" id="renameProcessId">
            <input type="text" class="add-modal-input" id="renameProcessName" placeholder="Neuer Name..." maxlength="100">
            <div class="add-modal-actions">
                <button class="add-modal-btn cancel" onclick="closeRenameProcessModal()">Abbrechen</button>
                <button class="add-modal-btn confirm" id="confirmRenameProcess" onclick="confirmRenameProcess()" disabled>Speichern</button>
            </div>
        </div>
    </div>

    <!-- Rename Category Modal -->
    <div class="add-modal-overlay" id="renameCategoryModal">
        <div class="add-modal">
            <div class="add-modal-title">
                <i class="fas fa-pen"></i> Kategorie umbenennen
            </div>
            <input type="hidden" id="renameCategoryId">
            <input type="text" class="add-modal-input" id="renameCategoryName" placeholder="Neuer Name..." maxlength="50">
            <div class="add-modal-actions">
                <button class="add-modal-btn cancel" onclick="closeRenameCategoryModal()">Abbrechen</button>
                <button class="add-modal-btn confirm" id="confirmRenameCategory" onclick="confirmRenameCategory()" disabled>Speichern</button>
            </div>
        </div>
    </div>

    <!-- Restore Hidden Modal -->
    <div class="add-modal-overlay" id="restoreHiddenModal">
        <div class="add-modal" style="max-width: 500px;">
            <div class="add-modal-title">
                <i class="fas fa-eye"></i> Ausgeblendete wiederherstellen
            </div>
            <div class="restore-list" id="restoreHiddenList">
                <!-- Wird dynamisch befüllt -->
            </div>
            <div class="add-modal-actions">
                <button class="add-modal-btn cancel" onclick="closeRestoreHiddenModal()">Schließen</button>
            </div>
        </div>
    </div>

    <!-- Process Deep Dive Modal -->
    <div class="modal-overlay" id="processModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">Prozess bewerten</h2>
                <button class="modal-close" onclick="closeModal()"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn-nav btn-back" onclick="closeModal()">Abbrechen</button>
                <button class="btn-nav btn-next" onclick="saveProcessRating()">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/shooting-stars.js"></script>
    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
    <!-- BPMN Viewer Library -->
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@17.4.0/dist/assets/diagram-js.css">
    <link rel="stylesheet" href="https://unpkg.com/bpmn-js@17.4.0/dist/assets/bpmn-font/css/bpmn-embedded.css">
    <script src="https://unpkg.com/bpmn-js@17.4.0/dist/bpmn-viewer.development.js"></script>
    <!-- AWS API Configuration -->
    <script src="js/aws-app-config.js"></script>
    <script src="js/aws-api-settings.js"></script>
    <script>
        // HR Selbsttest Data - 8 Kategorien mit je 4 Prozessen = 32 Prozesse
        const hrCategories = [
            {
                id: 'recruiting',
                name: 'Recruiting & Onboarding',
                color: '#6366f1',
                icon: 'fa-user-plus',
                processes: [
                    { id: 'bewerbermanagement', name: 'Bewerbermanagement' },
                    { id: 'onboarding', name: 'Onboarding / Eintritt' },
                    { id: 'anbindung-bm', name: 'Anbindung Bewerbermanagement' },
                    { id: 'digitaler-vertrag', name: 'Digitaler Arbeitsvertrag' }
                ]
            },
            {
                id: 'talent',
                name: 'Talent & Performance',
                color: '#8b5cf6',
                icon: 'fa-star',
                processes: [
                    { id: 'talentmanagement', name: 'Talentmanagement' },
                    { id: 'performance', name: 'Performance Management' },
                    { id: 'zielvereinbarungen', name: 'Zielvereinbarungen' },
                    { id: 'mitarbeitergespraeche', name: 'Mitarbeitergespräche' }
                ]
            },
            {
                id: 'development',
                name: 'Aus- und Weiterbildung',
                color: '#ec4899',
                icon: 'fa-graduation-cap',
                processes: [
                    { id: 'lms', name: 'Lernmanagement (LMS)' },
                    { id: 'schulungsplanung', name: 'Schulungsplanung' },
                    { id: 'zertifikatsverwaltung', name: 'Zertifikatsverwaltung' },
                    { id: 'elearning', name: 'E-Learning' }
                ]
            },
            {
                id: 'compensation',
                name: 'Vergütung & Benefits',
                color: '#f59e0b',
                icon: 'fa-coins',
                processes: [
                    { id: 'gehaltsabrechnung', name: 'Gehaltsabrechnung' },
                    { id: 'zulagen-spesen', name: 'Zulagen & Spesen' },
                    { id: 'benefits', name: 'Benefits Management' },
                    { id: 'bonusabrechnung', name: 'Bonusabrechnung' }
                ]
            },
            {
                id: 'admin',
                name: 'HR Administration',
                color: '#10b981',
                icon: 'fa-folder-open',
                processes: [
                    { id: 'personaldossier', name: 'Digitales Personaldossier' },
                    { id: 'mutationen', name: 'Mutationen & Stammdaten' },
                    { id: 'dokumentengenerierung', name: 'Dokumentengenerierung' },
                    { id: 'arbeitszeugnisse', name: 'Arbeitszeugnisse' }
                ]
            },
            {
                id: 'time',
                name: 'Zeit & Abwesenheit',
                color: '#06b6d4',
                icon: 'fa-clock',
                processes: [
                    { id: 'zeitwirtschaft', name: 'Zeitwirtschaft' },
                    { id: 'anwesenheit', name: 'Anwesenheitsmanagement' },
                    { id: 'urlaubsverwaltung', name: 'Urlaubsverwaltung' },
                    { id: 'krankmeldungen', name: 'Krankmeldungen' }
                ]
            },
            {
                id: 'analytics',
                name: 'People Analytics',
                color: '#84cc16',
                icon: 'fa-chart-line',
                processes: [
                    { id: 'hr-reporting', name: 'HR Reporting' },
                    { id: 'hr-controlling', name: 'HR Controlling' },
                    { id: 'workforce-analytics', name: 'Workforce Analytics' },
                    { id: 'dashboards', name: 'Dashboards' }
                ]
            },
            {
                id: 'offboarding',
                name: 'Nachfolge & Offboarding',
                color: '#ef4444',
                icon: 'fa-user-minus',
                processes: [
                    { id: 'nachfolgeplanung', name: 'Nachfolgeplanung' },
                    { id: 'karriereplanung', name: 'Karriereplanung' },
                    { id: 'austrittsmanagement', name: 'Austrittsmanagement' },
                    { id: 'offboarding-workflow', name: 'Offboarding Workflow' }
                ]
            }
        ];

        // Flatten für einfache Lookups
        const hrProcesses = hrCategories.flatMap(cat => 
            cat.processes.map(p => ({ ...p, categoryId: cat.id, categoryName: cat.name, color: cat.color, icon: cat.icon }))
        );

        // Hilfsfunktion: Finde Prozess (Standard oder Custom)
        function findProcessById(processId) {
            // Erst in Standard-Prozessen suchen
            let process = hrProcesses.find(p => p.id === processId);
            if (process) return process;
            
            // Dann in Custom-Prozessen suchen
            if (assessmentData && assessmentData.customProcesses) {
                for (const catId of Object.keys(assessmentData.customProcesses)) {
                    const found = assessmentData.customProcesses[catId].find(p => p.id === processId);
                    if (found) {
                        // Finde die Kategorie
                        const cat = hrCategories.find(c => c.id === catId) || 
                                   (assessmentData.customCategories || []).find(c => c.id === catId);
                        return {
                            ...found,
                            categoryId: catId,
                            categoryName: cat?.name || 'Eigene Kategorie',
                            color: cat?.color || '#6366f1',
                            icon: cat?.icon || 'fa-cogs'
                        };
                    }
                }
            }
            return null;
        }
        
        // Hilfsfunktion: Finde Kategorie und Prozessname (berücksichtigt Umbenennungen)
        function findProcessInfo(processId) {
            // Prüfe auf umbenannten Prozessnamen
            const renamedProcess = assessmentData?.renamedProcesses?.[processId];
            
            // Standard-Kategorien durchsuchen
            for (const cat of hrCategories) {
                const proc = cat.processes.find(p => p.id === processId);
                if (proc) {
                    const renamedCat = assessmentData?.renamedCategories?.[cat.id];
                    return { 
                        processName: renamedProcess || proc.name, 
                        categoryName: renamedCat || cat.name, 
                        color: cat.color 
                    };
                }
            }
            
            // Custom-Kategorien durchsuchen
            if (assessmentData && assessmentData.customCategories) {
                for (const cat of assessmentData.customCategories) {
                    // Prozesse in der Custom-Kategorie
                    const customProcs = (assessmentData.customProcesses && assessmentData.customProcesses[cat.id]) || [];
                    const proc = customProcs.find(p => p.id === processId);
                    if (proc) {
                        const renamedCat = assessmentData?.renamedCategories?.[cat.id];
                        return { 
                            processName: renamedProcess || proc.name, 
                            categoryName: renamedCat || cat.name, 
                            color: cat.color 
                        };
                    }
                }
            }
            
            // Custom-Prozesse in Standard-Kategorien
            if (assessmentData && assessmentData.customProcesses) {
                for (const catId of Object.keys(assessmentData.customProcesses)) {
                    const proc = assessmentData.customProcesses[catId].find(p => p.id === processId);
                    if (proc) {
                        const cat = hrCategories.find(c => c.id === catId);
                        const renamedCat = assessmentData?.renamedCategories?.[catId];
                        return { 
                            processName: renamedProcess || proc.name, 
                            categoryName: renamedCat || cat?.name || 'Eigene Kategorie',
                            color: cat?.color || '#6366f1'
                        };
                    }
                }
            }
            
            return { processName: processId, categoryName: 'Sonstige', color: '#6366f1' };
        }

        let assessmentData = {
            vision: {},
            kultur: {},
            organisation: {},
            prozesse: {},
            customProcesses: {}, // { categoryId: [{ id, name }] }
            customCategories: [], // [{ id, name, color, icon, processes: [] }]
            hiddenProcesses: [], // IDs von ausgeblendeten Standard-Prozessen
            hiddenCategories: [], // IDs von ausgeblendeten Standard-Kategorien
            renamedProcesses: {}, // { processId: "Neuer Name" }
            renamedCategories: {} // { categoryId: "Neuer Name" }
        };

        // Load saved data
        function loadSavedData() {
            const saved = localStorage.getItem('hrSelbsttest');
            if (saved) {
                assessmentData = JSON.parse(saved);
                // Stelle sicher, dass neue Felder existieren
                if (!assessmentData.customProcesses) assessmentData.customProcesses = {};
                if (!assessmentData.customCategories) assessmentData.customCategories = [];
                if (!assessmentData.hiddenProcesses) assessmentData.hiddenProcesses = [];
                if (!assessmentData.hiddenCategories) assessmentData.hiddenCategories = [];
                if (!assessmentData.renamedProcesses) assessmentData.renamedProcesses = {};
                if (!assessmentData.renamedCategories) assessmentData.renamedCategories = {};
                updateAllProgress();
            }
        }

        // Save data
        function saveData() {
            localStorage.setItem('hrSelbsttest', JSON.stringify(assessmentData));
            updateAllProgress();
        }

        // Select rating
        function selectRating(element) {
            const scale = element.closest('.rating-scale');
            const question = scale.dataset.question;
            const value = parseInt(element.dataset.value);
            
            scale.querySelectorAll('.rating-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            // Determine category
            let category = 'vision';
            if (question.startsWith('kultur')) category = 'kultur';
            else if (question.startsWith('org')) category = 'organisation';
            else if (question.startsWith('process')) category = 'prozesse';
            
            assessmentData[category][question] = value;
            saveData();
        }

        // Update effort total
        function updateEffortTotal(type) {
            const admin = parseInt(document.getElementById(`effort-admin-${type}`).value) || 0;
            const talent = parseInt(document.getElementById(`effort-talent-${type}`).value) || 0;
            const strategy = parseInt(document.getElementById(`effort-strategy-${type}`).value) || 0;
            const total = admin + talent + strategy;
            
            const totalElement = document.getElementById(`effort-total-${type}`);
            totalElement.textContent = `Total: ${total}%`;
            totalElement.style.color = total === 100 ? '#10b981' : '#ef4444';
            
            assessmentData.organisation[`effort-${type}`] = { admin, talent, strategy };
            saveData();
        }

        // Show section
        function showSection(sectionId) {
            document.querySelectorAll('.assessment-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.progress-card').forEach(c => c.classList.remove('active'));
            
            const section = document.getElementById(`section-${sectionId}`);
            if (section) {
                section.classList.add('active');
                
                // Update progress card
                const progressCard = document.querySelector(`.progress-card[onclick*="${sectionId}"]`);
                if (progressCard) progressCard.classList.add('active');
            }
            
            // Special handling for results
            if (sectionId === 'results') {
                generateResults();
            }
            
            // Scroll to top
            window.scrollTo({ top: 200, behavior: 'smooth' });
        }

        // Hilfsfunktion: Text für Übersicht escapen und kürzen
        function formatOverviewText(str, maxLen) {
            if (!str || !String(str).trim()) return { short: '', full: '' };
            const d = String(str).trim().replace(/\s+/g, ' ');
            const esc = d.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
            const short = esc.length > (maxLen || 80) ? esc.slice(0, maxLen || 80) + '…' : esc;
            return { short, full: d };
        }
        // Übersicht: Tools, Pain-Points und Kurzbeschreibung mit Bezeichnung
        function getProcessDetailsHtml(processId) {
            const p = assessmentData.prozesse[processId];
            if (!p) return '';
            const rows = [];
            const maxLen = 80;
            if (p.tools && String(p.tools).trim()) {
                const { short, full } = formatOverviewText(p.tools, maxLen);
                rows.push({ label: 'Aktuell:', value: short, title: full.length > maxLen ? full : '' });
            }
            if (p.notes && String(p.notes).trim()) {
                const { short, full } = formatOverviewText(p.notes, maxLen);
                rows.push({ label: 'Pain-Points:', value: short, title: full.length > maxLen ? full : '' });
            }
            if (p.description && String(p.description).trim()) {
                const { short, full } = formatOverviewText(p.description, maxLen);
                rows.push({ label: 'Kurzbeschr.:', value: short, title: full.length > maxLen ? full : '' });
            }
            if (rows.length === 0) return '';
            return '<div class="process-item-details">' + rows.map(r => {
                const t = r.title ? ' title="' + r.title.replace(/"/g, '&quot;') + '"' : '';
                return '<div class="process-item-detail-row"><span class="process-item-detail-label">' + r.label + '</span><span class="process-item-detail-value"' + t + '>' + r.value + '</span></div>';
            }).join('') + '</div>';
        }

        // Initialize process grid
        function initProcessGrid() {
            const grid = document.getElementById('processGrid');
            
            // Kombiniere Standard-Kategorien mit Custom-Kategorien, filtere versteckte
            const hiddenCats = assessmentData.hiddenCategories || [];
            const allCategories = [
                ...hrCategories.filter(c => !hiddenCats.includes(c.id)),
                ...(assessmentData.customCategories || [])
            ];
            
            const hiddenProcs = assessmentData.hiddenProcesses || [];
            
            grid.innerHTML = allCategories.map(category => {
                const isCustomCategory = (assessmentData.customCategories || []).some(c => c.id === category.id);
                const isStandardCategory = hrCategories.some(c => c.id === category.id);
                
                // Hole umbenannten Kategorienamen falls vorhanden
                const displayCategoryName = (assessmentData.renamedCategories && assessmentData.renamedCategories[category.id]) || category.name;
                
                // Kombiniere Standard-Prozesse mit Custom-Prozessen, filtere versteckte
                const customProcs = (assessmentData.customProcesses && assessmentData.customProcesses[category.id]) || [];
                const standardProcs = category.processes.filter(p => !hiddenProcs.includes(p.id));
                const allProcesses = [...standardProcs, ...customProcs];
                
                if (allProcesses.length === 0 && !isCustomCategory) return ''; // Leere Standard-Kategorien ausblenden
                
                const ratedInCategory = allProcesses.filter(p => assessmentData.prozesse[p.id]).length;
                const totalInCategory = allProcesses.length;
                const progressPercent = totalInCategory > 0 ? (ratedInCategory / totalInCategory) * 100 : 0;
                
                return `
                <div class="process-category" data-category="${category.id}">
                    <div class="category-header editable-category" onclick="toggleCategory('${category.id}')" style="--cat-color: ${category.color}">
                        <div class="category-icon" style="background: ${category.color};">
                            <i class="fas ${category.icon}"></i>
                        </div>
                        <div class="category-info">
                            <h3>${escapeHtml(displayCategoryName)}</h3>
                            <div class="category-progress">
                                <div class="category-progress-bar">
                                    <div class="category-progress-fill" style="width: ${progressPercent}%; background: ${category.color};"></div>
                                </div>
                                <span class="category-progress-text">${ratedInCategory}/${totalInCategory} bewertet</span>
                            </div>
                        </div>
                        <div class="category-edit-btns">
                            <button class="edit-btn" onclick="event.stopPropagation(); openRenameCategoryModal('${category.id}', '${escapeHtml(displayCategoryName).replace(/'/g, "\\'")}')" title="Umbenennen"><i class="fas fa-pen"></i></button>
                            <button class="delete-btn" onclick="event.stopPropagation(); ${isCustomCategory ? `deleteCustomCategory('${category.id}')` : `hideCategory('${category.id}')`}" title="${isCustomCategory ? 'Löschen' : 'Ausblenden'}"><i class="fas ${isCustomCategory ? 'fa-trash' : 'fa-eye-slash'}"></i></button>
                        </div>
                        <i class="fas fa-chevron-down category-toggle"></i>
                    </div>
                    <div class="category-processes">
                        ${allProcesses.map(process => {
                            const isCustomProcess = customProcs.some(p => p.id === process.id);
                            const isStandardProcess = standardProcs.some(p => p.id === process.id);
                            // Hole umbenannten Prozessnamen falls vorhanden
                            const displayProcessName = (assessmentData.renamedProcesses && assessmentData.renamedProcesses[process.id]) || process.name;
                            
                            return `
                            <div class="process-item editable-process ${assessmentData.prozesse[process.id] ? 'completed' : ''}" onclick="openProcessModal('${process.id}', '${category.id}')">
                                <div class="process-item-top">
                                    <div class="process-item-status ${assessmentData.prozesse[process.id] ? 'completed' : 'pending'}">
                                        <i class="fas ${assessmentData.prozesse[process.id] ? 'fa-check-circle' : 'fa-circle'}"></i>
                                    </div>
                                    <div class="process-item-name-block">
                                        <span class="process-item-name">${escapeHtml(displayProcessName)}</span>
                                        ${getProcessDetailsHtml(process.id)}
                                    </div>
                                    <div class="process-edit-btns">
                                        <button class="edit-btn small" onclick="event.stopPropagation(); openRenameProcessModal('${process.id}', '${escapeHtml(displayProcessName).replace(/'/g, "\\'")}')" title="Umbenennen"><i class="fas fa-pen"></i></button>
                                        <button class="delete-btn small" onclick="event.stopPropagation(); ${isCustomProcess ? `deleteCustomProcess('${category.id}', '${process.id}')` : `hideProcess('${process.id}')`}" title="${isCustomProcess ? 'Löschen' : 'Ausblenden'}"><i class="fas ${isCustomProcess ? 'fa-times' : 'fa-eye-slash'}"></i></button>
                                    </div>
                                    <div class="process-item-score">
                                        ${assessmentData.prozesse[process.id] ? 
                                            `<span class="score-badge" style="background: ${getScoreColorCSS(assessmentData.prozesse[process.id])}">${getProcessScore(process.id)}</span>` : 
                                            '<span class="score-badge pending">-</span>'}
                                    </div>
                                    <i class="fas fa-chevron-right process-arrow"></i>
                                </div>
                            </div>
                        `}).join('')}
                        <button class="add-process-btn" onclick="event.stopPropagation(); openAddProcessModal('${category.id}')">
                            <i class="fas fa-plus"></i> Eigenen Prozess hinzufügen
                        </button>
                    </div>
                </div>
                `;
            }).join('');
            
            // Add "Eigene Kategorie hinzufügen" und "Ausgeblendete wiederherstellen" Buttons
            const hasHidden = (assessmentData.hiddenCategories?.length > 0) || (assessmentData.hiddenProcesses?.length > 0);
            grid.innerHTML += `
                <div class="add-category-section">
                    <button class="add-category-btn" onclick="openAddCategoryModal()">
                        <i class="fas fa-folder-plus"></i> Eigene Kategorie hinzufügen
                    </button>
                    ${hasHidden ? `
                    <button class="restore-hidden-btn" onclick="openRestoreHiddenModal()">
                        <i class="fas fa-eye"></i> Ausgeblendete wiederherstellen (${(assessmentData.hiddenCategories?.length || 0) + (assessmentData.hiddenProcesses?.length || 0)})
                    </button>
                    ` : ''}
                </div>
            `;
        }

        function toggleCategory(categoryId) {
            const category = document.querySelector(`.process-category[data-category="${categoryId}"]`);
            category.classList.toggle('expanded');
        }

        // ========== Custom Process Functions ==========
        
        function openAddProcessModal(categoryId) {
            document.getElementById('addProcessCategoryId').value = categoryId;
            document.getElementById('addProcessName').value = '';
            document.getElementById('confirmAddProcess').disabled = true;
            document.getElementById('addProcessModal').classList.add('active');
            setTimeout(() => document.getElementById('addProcessName').focus(), 100);
        }
        
        function closeAddProcessModal() {
            document.getElementById('addProcessModal').classList.remove('active');
        }
        
        function confirmAddProcess() {
            const categoryId = document.getElementById('addProcessCategoryId').value;
            const processName = document.getElementById('addProcessName').value.trim();
            
            if (!processName) return;
            
            // Initialisiere customProcesses falls nicht vorhanden
            if (!assessmentData.customProcesses) {
                assessmentData.customProcesses = {};
            }
            if (!assessmentData.customProcesses[categoryId]) {
                assessmentData.customProcesses[categoryId] = [];
            }
            
            // Generiere eindeutige ID
            const processId = 'custom-' + categoryId + '-' + Date.now();
            
            // Füge neuen Prozess hinzu
            assessmentData.customProcesses[categoryId].push({
                id: processId,
                name: processName
            });
            
            saveData();
            closeAddProcessModal();
            initProcessGrid();
            
            // Öffne die Kategorie
            const catElement = document.querySelector(`.process-category[data-category="${categoryId}"]`);
            if (catElement && !catElement.classList.contains('expanded')) {
                catElement.classList.add('expanded');
            }
        }
        
        function deleteCustomProcess(categoryId, processId) {
            if (!confirm('Möchten Sie diesen Prozess wirklich löschen? Alle Bewertungen gehen verloren.')) return;
            
            if (assessmentData.customProcesses && assessmentData.customProcesses[categoryId]) {
                assessmentData.customProcesses[categoryId] = assessmentData.customProcesses[categoryId].filter(p => p.id !== processId);
            }
            
            // Lösche auch die Bewertungsdaten
            if (assessmentData.prozesse[processId]) {
                delete assessmentData.prozesse[processId];
            }
            
            saveData();
            initProcessGrid();
        }
        
        // ========== Custom Category Functions ==========
        
        let selectedCategoryColor = '#6366f1';
        
        function openAddCategoryModal() {
            document.getElementById('addCategoryName').value = '';
            document.getElementById('confirmAddCategory').disabled = true;
            selectedCategoryColor = '#6366f1';
            
            // Reset color selection
            document.querySelectorAll('#categoryColorPicker .add-modal-color').forEach(el => {
                el.classList.remove('selected');
                if (el.dataset.color === '#6366f1') el.classList.add('selected');
            });
            
            document.getElementById('addCategoryModal').classList.add('active');
            setTimeout(() => document.getElementById('addCategoryName').focus(), 100);
        }
        
        function closeAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.remove('active');
        }
        
        function confirmAddCategory() {
            const categoryName = document.getElementById('addCategoryName').value.trim();
            
            if (!categoryName) return;
            
            // Initialisiere customCategories falls nicht vorhanden
            if (!assessmentData.customCategories) {
                assessmentData.customCategories = [];
            }
            
            // Generiere eindeutige ID
            const categoryId = 'custom-cat-' + Date.now();
            
            // Icon basierend auf Farbe auswählen
            const iconMap = {
                '#6366f1': 'fa-cogs',
                '#8b5cf6': 'fa-puzzle-piece',
                '#ec4899': 'fa-heart',
                '#f59e0b': 'fa-lightbulb',
                '#10b981': 'fa-leaf',
                '#06b6d4': 'fa-water',
                '#84cc16': 'fa-seedling',
                '#ef4444': 'fa-fire',
                '#f97316': 'fa-sun',
                '#14b8a6': 'fa-gem'
            };
            
            // Füge neue Kategorie hinzu
            assessmentData.customCategories.push({
                id: categoryId,
                name: categoryName,
                color: selectedCategoryColor,
                icon: iconMap[selectedCategoryColor] || 'fa-folder',
                processes: []
            });
            
            saveData();
            closeAddCategoryModal();
            initProcessGrid();
            
            // Öffne die neue Kategorie
            setTimeout(() => {
                const catElement = document.querySelector(`.process-category[data-category="${categoryId}"]`);
                if (catElement) {
                    catElement.classList.add('expanded');
                    catElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }, 100);
        }
        
        function deleteCustomCategory(categoryId) {
            if (!confirm('Möchten Sie diese Kategorie wirklich löschen? Alle Prozesse und Bewertungen darin gehen verloren.')) return;
            
            // Lösche alle Prozessbewertungen dieser Kategorie
            if (assessmentData.customProcesses && assessmentData.customProcesses[categoryId]) {
                assessmentData.customProcesses[categoryId].forEach(p => {
                    if (assessmentData.prozesse[p.id]) {
                        delete assessmentData.prozesse[p.id];
                    }
                });
                delete assessmentData.customProcesses[categoryId];
            }
            
            // Lösche die Kategorie selbst
            if (assessmentData.customCategories) {
                assessmentData.customCategories = assessmentData.customCategories.filter(c => c.id !== categoryId);
            }
            
            saveData();
            initProcessGrid();
        }
        
        // ========== Hide/Show Standard Elements ==========
        
        function hideProcess(processId) {
            if (!confirm('Möchten Sie diesen Prozess ausblenden? Sie können ihn später wiederherstellen.')) return;
            
            if (!assessmentData.hiddenProcesses) assessmentData.hiddenProcesses = [];
            if (!assessmentData.hiddenProcesses.includes(processId)) {
                assessmentData.hiddenProcesses.push(processId);
            }
            
            saveData();
            initProcessGrid();
        }
        
        function hideCategory(categoryId) {
            if (!confirm('Möchten Sie diese Kategorie ausblenden? Alle Prozesse darin werden ebenfalls ausgeblendet. Sie können sie später wiederherstellen.')) return;
            
            if (!assessmentData.hiddenCategories) assessmentData.hiddenCategories = [];
            if (!assessmentData.hiddenCategories.includes(categoryId)) {
                assessmentData.hiddenCategories.push(categoryId);
            }
            
            saveData();
            initProcessGrid();
        }
        
        function restoreProcess(processId) {
            if (assessmentData.hiddenProcesses) {
                assessmentData.hiddenProcesses = assessmentData.hiddenProcesses.filter(id => id !== processId);
            }
            saveData();
            openRestoreHiddenModal(); // Refresh list
            initProcessGrid();
        }
        
        function restoreCategory(categoryId) {
            if (assessmentData.hiddenCategories) {
                assessmentData.hiddenCategories = assessmentData.hiddenCategories.filter(id => id !== categoryId);
            }
            saveData();
            openRestoreHiddenModal(); // Refresh list
            initProcessGrid();
        }
        
        function openRestoreHiddenModal() {
            const list = document.getElementById('restoreHiddenList');
            let html = '';
            
            // Versteckte Kategorien
            (assessmentData.hiddenCategories || []).forEach(catId => {
                const cat = hrCategories.find(c => c.id === catId);
                if (cat) {
                    html += `
                        <div class="restore-item">
                            <div class="restore-item-info">
                                <div class="restore-item-icon" style="background: ${cat.color}; color: white;">
                                    <i class="fas ${cat.icon}"></i>
                                </div>
                                <div>
                                    <div class="restore-item-name">${escapeHtml(cat.name)}</div>
                                    <div class="restore-item-type">Kategorie</div>
                                </div>
                            </div>
                            <button class="restore-item-btn" onclick="restoreCategory('${catId}')">
                                <i class="fas fa-eye"></i> Wiederherstellen
                            </button>
                        </div>
                    `;
                }
            });
            
            // Versteckte Prozesse
            (assessmentData.hiddenProcesses || []).forEach(procId => {
                const processInfo = findProcessInfo(procId);
                const cat = hrCategories.find(c => c.processes.some(p => p.id === procId));
                html += `
                    <div class="restore-item">
                        <div class="restore-item-info">
                            <div class="restore-item-icon" style="background: ${cat?.color || '#6366f1'}; color: white;">
                                <i class="fas fa-cog"></i>
                            </div>
                            <div>
                                <div class="restore-item-name">${escapeHtml(processInfo.processName)}</div>
                                <div class="restore-item-type">Prozess in ${escapeHtml(processInfo.categoryName)}</div>
                            </div>
                        </div>
                        <button class="restore-item-btn" onclick="restoreProcess('${procId}')">
                            <i class="fas fa-eye"></i> Wiederherstellen
                        </button>
                    </div>
                `;
            });
            
            if (!html) {
                html = '<p style="color: rgba(255,255,255,0.5); text-align: center; padding: 2rem;">Keine ausgeblendeten Elemente vorhanden.</p>';
            }
            
            list.innerHTML = html;
            document.getElementById('restoreHiddenModal').classList.add('active');
        }
        
        function closeRestoreHiddenModal() {
            document.getElementById('restoreHiddenModal').classList.remove('active');
        }
        
        // ========== Rename Functions ==========
        
        function openRenameProcessModal(processId, currentName) {
            document.getElementById('renameProcessId').value = processId;
            document.getElementById('renameProcessName').value = currentName;
            document.getElementById('confirmRenameProcess').disabled = false;
            document.getElementById('renameProcessModal').classList.add('active');
            setTimeout(() => document.getElementById('renameProcessName').focus(), 100);
        }
        
        function closeRenameProcessModal() {
            document.getElementById('renameProcessModal').classList.remove('active');
        }
        
        function confirmRenameProcess() {
            const processId = document.getElementById('renameProcessId').value;
            const newName = document.getElementById('renameProcessName').value.trim();
            
            if (!newName) return;
            
            if (!assessmentData.renamedProcesses) assessmentData.renamedProcesses = {};
            assessmentData.renamedProcesses[processId] = newName;
            
            // Falls es ein Custom-Prozess ist, auch dort umbenennen
            for (const catId of Object.keys(assessmentData.customProcesses || {})) {
                const proc = assessmentData.customProcesses[catId].find(p => p.id === processId);
                if (proc) {
                    proc.name = newName;
                    break;
                }
            }
            
            saveData();
            closeRenameProcessModal();
            initProcessGrid();
        }
        
        function openRenameCategoryModal(categoryId, currentName) {
            document.getElementById('renameCategoryId').value = categoryId;
            document.getElementById('renameCategoryName').value = currentName;
            document.getElementById('confirmRenameCategory').disabled = false;
            document.getElementById('renameCategoryModal').classList.add('active');
            setTimeout(() => document.getElementById('renameCategoryName').focus(), 100);
        }
        
        function closeRenameCategoryModal() {
            document.getElementById('renameCategoryModal').classList.remove('active');
        }
        
        function confirmRenameCategory() {
            const categoryId = document.getElementById('renameCategoryId').value;
            const newName = document.getElementById('renameCategoryName').value.trim();
            
            if (!newName) return;
            
            if (!assessmentData.renamedCategories) assessmentData.renamedCategories = {};
            assessmentData.renamedCategories[categoryId] = newName;
            
            // Falls es eine Custom-Kategorie ist, auch dort umbenennen
            const customCat = (assessmentData.customCategories || []).find(c => c.id === categoryId);
            if (customCat) {
                customCat.name = newName;
            }
            
            saveData();
            closeRenameCategoryModal();
            initProcessGrid();
        }
        
        // Event Listeners für Modals
        document.addEventListener('DOMContentLoaded', function() {
            // Add Process Modal - Input validation
            const addProcessInput = document.getElementById('addProcessName');
            if (addProcessInput) {
                addProcessInput.addEventListener('input', function() {
                    document.getElementById('confirmAddProcess').disabled = !this.value.trim();
                });
                addProcessInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && this.value.trim()) {
                        confirmAddProcess();
                    }
                });
            }
            
            // Add Category Modal - Input validation
            const addCategoryInput = document.getElementById('addCategoryName');
            if (addCategoryInput) {
                addCategoryInput.addEventListener('input', function() {
                    document.getElementById('confirmAddCategory').disabled = !this.value.trim();
                });
                addCategoryInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && this.value.trim()) {
                        confirmAddCategory();
                    }
                });
            }
            
            // Color picker
            document.querySelectorAll('#categoryColorPicker .add-modal-color').forEach(el => {
                el.addEventListener('click', function() {
                    document.querySelectorAll('#categoryColorPicker .add-modal-color').forEach(c => c.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedCategoryColor = this.dataset.color;
                });
            });
            
            // Rename Process Modal - Input validation
            const renameProcessInput = document.getElementById('renameProcessName');
            if (renameProcessInput) {
                renameProcessInput.addEventListener('input', function() {
                    document.getElementById('confirmRenameProcess').disabled = !this.value.trim();
                });
                renameProcessInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && this.value.trim()) {
                        confirmRenameProcess();
                    }
                });
            }
            
            // Rename Category Modal - Input validation
            const renameCategoryInput = document.getElementById('renameCategoryName');
            if (renameCategoryInput) {
                renameCategoryInput.addEventListener('input', function() {
                    document.getElementById('confirmRenameCategory').disabled = !this.value.trim();
                });
                renameCategoryInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && this.value.trim()) {
                        confirmRenameCategory();
                    }
                });
            }
            
            // Close modals on overlay click
            document.getElementById('addProcessModal')?.addEventListener('click', function(e) {
                if (e.target === this) closeAddProcessModal();
            });
            document.getElementById('addCategoryModal')?.addEventListener('click', function(e) {
                if (e.target === this) closeAddCategoryModal();
            });
            document.getElementById('renameProcessModal')?.addEventListener('click', function(e) {
                if (e.target === this) closeRenameProcessModal();
            });
            document.getElementById('renameCategoryModal')?.addEventListener('click', function(e) {
                if (e.target === this) closeRenameCategoryModal();
            });
            document.getElementById('restoreHiddenModal')?.addEventListener('click', function(e) {
                if (e.target === this) closeRestoreHiddenModal();
            });
        });

        function getProcessScore(processId) {
            const data = assessmentData.prozesse[processId];
            if (!data) return '-';
            const avg = ((data.digiIst || 0) + (data.qualIst || 0)) / 2;
            return avg.toFixed(1);
        }

        function getScoreColorCSS(data) {
            if (!data) return 'rgba(255,255,255,0.1)';
            const avg = ((data.digiIst || 0) + (data.qualIst || 0)) / 2;
            if (avg < 2) return 'rgba(239, 68, 68, 0.8)';
            if (avg < 3.5) return 'rgba(245, 158, 11, 0.8)';
            return 'rgba(34, 197, 94, 0.8)';
        }

        // Open process modal
        function openProcessModal(processId, categoryId) {
            // Suche in Standard-Prozessen
            let process = hrProcesses.find(p => p.id === processId);
            
            // Falls nicht gefunden, suche in Custom-Prozessen
            if (!process) {
                // Suche in allen Custom-Prozessen
                for (const catId of Object.keys(assessmentData.customProcesses || {})) {
                    const found = assessmentData.customProcesses[catId].find(p => p.id === processId);
                    if (found) {
                        // Finde die Kategorie für Farbe/Icon
                        const cat = hrCategories.find(c => c.id === catId) || 
                                   (assessmentData.customCategories || []).find(c => c.id === catId);
                        process = {
                            ...found,
                            categoryId: catId,
                            categoryName: cat?.name || 'Eigene Kategorie',
                            color: cat?.color || '#6366f1',
                            icon: cat?.icon || 'fa-cogs'
                        };
                        break;
                    }
                }
            }
            
            if (!process) {
                console.error('Process not found:', processId);
                return;
            }
            
            const data = assessmentData.prozesse[processId] || {};
            
            document.getElementById('modalTitle').textContent = process.name;
            document.getElementById('modalBody').innerHTML = `
                <input type="hidden" id="currentProcessId" value="${processId}">
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-digital-tachograph" style="color: #6366f1;"></i>
                        Digitalisierungslevel
                    </div>
                    <div class="rating-row">
                        <div class="rating-column">
                            <div class="rating-column-label">IST-Zustand (1 = sehr niedrig, 5 = voll digitalisiert)</div>
                            <div class="rating-scale" data-question="modal-digi-ist">
                                ${[1,2,3,4,5].map(v => `
                                    <div class="rating-option ${data.digiIst === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                        <div class="rating-value">${v}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="rating-column">
                            <div class="rating-column-label">SOLL-Zustand</div>
                            <div class="rating-scale" data-question="modal-digi-soll">
                                ${[1,2,3,4,5].map(v => `
                                    <div class="rating-option ${data.digiSoll === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                        <div class="rating-value">${v}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-star" style="color: #fbbf24;"></i>
                        Prozessqualität
                    </div>
                    <div class="rating-row">
                        <div class="rating-column">
                            <div class="rating-column-label">IST-Zustand (1 = sehr schlecht, 5 = ausgezeichnet)</div>
                            <div class="rating-scale" data-question="modal-qual-ist">
                                ${[1,2,3,4,5].map(v => `
                                    <div class="rating-option ${data.qualIst === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                        <div class="rating-value">${v}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="rating-column">
                            <div class="rating-column-label">SOLL-Zustand</div>
                            <div class="rating-scale" data-question="modal-qual-soll">
                                ${[1,2,3,4,5].map(v => `
                                    <div class="rating-option ${data.qualSoll === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                        <div class="rating-value">${v}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-exclamation-triangle" style="color: #ef4444;"></i>
                        Wichtigkeit für Ihr Unternehmen
                    </div>
                    <div class="rating-scale" data-question="modal-wichtigkeit" style="max-width: 400px;">
                        ${[1,2,3,4,5].map(v => `
                            <div class="rating-option ${data.wichtigkeit === v ? 'selected' : ''}" data-value="${v}" onclick="selectModalRating(this)">
                                <div class="rating-value">${v}</div>
                                <div class="rating-label">${v === 1 ? 'Gering' : v === 3 ? 'Mittel' : v === 5 ? 'Sehr hoch' : ''}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-tools" style="color: #10b981;"></i>
                        Aktuell verwendete Tools
                    </div>
                    <textarea class="wizard-textarea" id="modalTools" placeholder="z.B. SAP, Workday, Excel...">${data.tools || ''}</textarea>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-comment-alt" style="color: #06b6d4;"></i>
                        Anmerkungen / Pain-Points
                    </div>
                    <textarea class="wizard-textarea" id="modalNotes" placeholder="Beschreiben Sie Herausforderungen und Verbesserungsideen...">${data.notes || ''}</textarea>
                </div>
                
                <div class="rating-group">
                    <div class="rating-group-title">
                        <i class="fas fa-align-left" style="color: #8b5cf6;"></i>
                        Kurzbeschreibung Prozess
                    </div>
                    <textarea class="wizard-textarea" id="modalProcessDescription" placeholder="Wer macht was, womit, wann, warum?" oninput="updateWorkflowLinkVisibility()">${data.description || ''}</textarea>
                    
                    <div class="workflow-section">
                        <div id="workflowGenerateLink" class="workflow-generate-link ${data.description ? '' : 'disabled'}" onclick="generateWorkflow('${processId}')">
                            <i class="fas fa-project-diagram"></i>
                            <span>Workflow zeichnen</span>
                        </div>
                        <div id="workflowLoading" class="workflow-loading" style="display: none;">
                            <div class="spinner"></div>
                            <span>Workflow wird generiert...</span>
                        </div>
                        <div id="workflowError" class="workflow-error" style="display: none;"></div>
                        
                        <div id="bpmnViewerContainer" class="bpmn-viewer-container ${data.bpmnXml ? 'active' : ''}">
                            <div class="bpmn-viewer-header">
                                <span class="bpmn-viewer-title"><i class="fas fa-sitemap"></i> Prozess-Workflow</span>
                                <div class="bpmn-viewer-actions">
                                    <button class="bpmn-viewer-btn secondary" onclick="generateWorkflow('${processId}')">
                                        <i class="fas fa-sync-alt"></i> Neu generieren
                                    </button>
                                    <button class="bpmn-viewer-btn primary" onclick="downloadBpmn('${processId}')">
                                        <i class="fas fa-download"></i> .bpmn
                                    </button>
                                </div>
                            </div>
                            <div id="bpmnViewerCanvas"></div>
                            <div class="bpmn-hint">
                                <span class="bpmn-hint-desktop"><i class="fas fa-search-plus"></i> Ctrl+Mausrad oder Shift+Mausrad zoomen &nbsp;|&nbsp; <i class="fas fa-hand-paper"></i> Leertaste+Ziehen verschieben</span>
                                <span class="bpmn-hint-mobile"><i class="fas fa-hand-pointer"></i> Wischen zum Verschieben &nbsp;|&nbsp; <i class="fas fa-expand-arrows-alt"></i> Zwei Finger zoomen</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('processModal').classList.add('active');
            
            // Initialize BPMN viewer if there's existing XML
            if (data.bpmnXml) {
                setTimeout(() => initBpmnViewer(data.bpmnXml), 100);
            }
            // Hide mobile export footer when modal is open
            const mobileFooter = document.querySelector('.mobile-export-footer');
            if (mobileFooter) mobileFooter.style.display = 'none';
        }

        // Select modal rating
        function selectModalRating(element) {
            const scale = element.closest('.rating-scale');
            scale.querySelectorAll('.rating-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
        }

        // Close modal
        function closeModal() {
            document.getElementById('processModal').classList.remove('active');
            // Show mobile export footer again
            const mobileFooter = document.querySelector('.mobile-export-footer');
            if (mobileFooter) mobileFooter.style.display = '';
        }

        // Save process rating
        function saveProcessRating() {
            const processId = document.getElementById('currentProcessId').value;
            
            const getSelectedValue = (question) => {
                const selected = document.querySelector(`[data-question="${question}"] .rating-option.selected`);
                return selected ? parseInt(selected.dataset.value) : null;
            };
            
            // Preserve existing data if present
            const existingData = assessmentData.prozesse[processId] || {};
            
            // Get values from form, fallback to existing values if empty
            const descriptionField = document.getElementById('modalProcessDescription');
            const toolsField = document.getElementById('modalTools');
            const notesField = document.getElementById('modalNotes');
            
            const newDescription = descriptionField?.value?.trim() || '';
            const newTools = toolsField?.value?.trim() || '';
            const newNotes = notesField?.value?.trim() || '';
            
            assessmentData.prozesse[processId] = {
                digiIst: getSelectedValue('modal-digi-ist'),
                digiSoll: getSelectedValue('modal-digi-soll'),
                qualIst: getSelectedValue('modal-qual-ist'),
                qualSoll: getSelectedValue('modal-qual-soll'),
                wichtigkeit: getSelectedValue('modal-wichtigkeit'),
                // Behalte bestehende Werte, wenn Felder leer sind
                description: newDescription || existingData.description || '',
                tools: newTools || existingData.tools || '',
                notes: newNotes || existingData.notes || '',
                bpmnXml: existingData.bpmnXml || null
            };
            
            saveData();
            closeModal();
            initProcessGrid();
        }

        // Update all progress bars
        function updateAllProgress() {
            // Vision progress
            const visionQuestions = ['vision-1', 'vision-2', 'vision-3', 'vision-4'];
            const visionAnswered = visionQuestions.filter(q => assessmentData.vision[q]).length;
            document.getElementById('progress-vision').style.width = `${(visionAnswered / 4) * 100}%`;
            document.getElementById('progress-vision-text').textContent = `${visionAnswered}/4`;
            
            // Kultur progress (9 question pairs = 18 total, but counting as 9)
            const kulturKeys = Object.keys(assessmentData.kultur).length;
            const kulturProgress = Math.min((kulturKeys / 18) * 100, 100);
            document.getElementById('progress-kultur').style.width = `${kulturProgress}%`;
            document.getElementById('progress-kultur-text').textContent = `${Math.floor(kulturKeys/2)}/9`;
            
            // Organisation progress
            const orgKeys = Object.keys(assessmentData.organisation).length;
            const orgProgress = Math.min((orgKeys / 10) * 100, 100);
            document.getElementById('progress-organisation').style.width = `${orgProgress}%`;
            document.getElementById('progress-organisation-text').textContent = `${orgKeys}/7`;
            
            // Prozesse progress (32 Prozesse in 8 Kategorien)
            const processesCompleted = Object.keys(assessmentData.prozesse).length;
            document.getElementById('progress-prozesse').style.width = `${(processesCompleted / 32) * 100}%`;
            document.getElementById('progress-prozesse-text').textContent = `${processesCompleted}/32`;
            
            // Auch die Prozess-Statistik Box in Results aktualisieren
            updateProcessStats();
            
            // Dashboard Gesamtscore aktualisieren
            updateDashboardScore();
            
            // Header-Fortschrittsanzeige aktualisieren
            updateHeaderProgress();
        }
        
        // Header-Kuchendiagramm aktualisieren
        function updateHeaderProgress() {
            const circle = document.getElementById('headerProgressCircle');
            const text = document.getElementById('headerProgressText');
            const label = document.getElementById('headerProgressLabel');
            
            if (!circle || !text) return;
            
            // Gesamtfortschritt berechnen (gewichtet)
            const visionQuestions = ['vision-1', 'vision-2', 'vision-3', 'vision-4'];
            const visionAnswered = visionQuestions.filter(q => assessmentData.vision[q]).length;
            const visionProgress = visionAnswered / 4;
            
            const kulturKeys = Object.keys(assessmentData.kultur).length;
            const kulturProgress = Math.min(kulturKeys / 18, 1);
            
            const orgKeys = Object.keys(assessmentData.organisation).length;
            const orgProgress = Math.min(orgKeys / 10, 1);
            
            const processesCompleted = Object.keys(assessmentData.prozesse).length;
            const processProgress = processesCompleted / 32;
            
            // Gewichteter Durchschnitt (alle 4 Bereiche gleich gewichtet)
            const totalProgress = Math.round(((visionProgress + kulturProgress + orgProgress + processProgress) / 4) * 100);
            
            // Kuchendiagramm aktualisieren (Umfang des Kreises = 2 * PI * r = 2 * 3.14159 * 16 ≈ 100.53)
            const circumference = 100.53;
            const offset = circumference - (circumference * totalProgress / 100);
            circle.style.strokeDashoffset = offset;
            
            // Farbe basierend auf Fortschritt
            if (totalProgress >= 75) {
                circle.style.stroke = '#10b981'; // Grün
            } else if (totalProgress >= 50) {
                circle.style.stroke = '#fbbf24'; // Gelb
            } else if (totalProgress >= 25) {
                circle.style.stroke = '#f97316'; // Orange
            } else {
                circle.style.stroke = '#6366f1'; // Lila (Standard)
            }
            
            // Text aktualisieren
            text.textContent = totalProgress + '%';
            
            // Label aktualisieren
            if (label) {
                if (totalProgress === 0) {
                    label.textContent = 'Starten Sie!';
                } else if (totalProgress < 50) {
                    label.textContent = 'Weiter so!';
                } else if (totalProgress < 100) {
                    label.textContent = 'Fast fertig!';
                } else {
                    label.textContent = 'Komplett!';
                }
            }
        }
        
        // Dashboard-Score auf Startseite aktualisieren
        function updateDashboardScore() {
            const scoreEl = document.getElementById('dashboardTotalScore');
            if (!scoreEl) return;
            
            const visionScore = calculateCategoryScore('vision', 4);
            const kulturScore = calculateCategoryScore('kultur', 18);
            const orgScore = calculateCategoryScore('organisation', 10);
            const processScore = calculateProcessScore();
            
            const total = Math.round((visionScore + kulturScore + orgScore + processScore) / 4);
            
            scoreEl.textContent = total + '%';
            
            // Farbe basierend auf Score
            if (total >= 70) {
                scoreEl.style.color = '#10b981';
            } else if (total >= 40) {
                scoreEl.style.color = '#fbbf24';
            } else {
                scoreEl.style.color = '#ef4444';
            }
        }

        // Generate results
        function generateResults() {
            const resultsOverview = document.getElementById('resultsOverview');
            
            // Calculate scores
            const visionScore = calculateCategoryScore('vision', 4);
            const kulturScore = calculateCategoryScore('kultur', 18);
            const orgScore = calculateCategoryScore('organisation', 10);
            const processScore = calculateProcessScore();
            
            // Speichere Scores global für selectCategory()
            window.categoryScores = {
                vision: visionScore,
                kultur: kulturScore,
                organisation: orgScore,
                prozesse: processScore
            };
            
            resultsOverview.innerHTML = `
                <div class="result-card" id="card-vision" onclick="selectCategory('vision')">
                    <div class="result-score ${getScoreClass(visionScore)}">${visionScore}%</div>
                    <div class="result-label">Vision</div>
                    <div class="result-description">Strategie & Ausrichtung</div>
                </div>
                <div class="result-card" id="card-kultur" onclick="selectCategory('kultur')">
                    <div class="result-score ${getScoreClass(kulturScore)}">${kulturScore}%</div>
                    <div class="result-label">Kultur</div>
                    <div class="result-description">Leadership & Change</div>
                </div>
                <div class="result-card" id="card-organisation" onclick="selectCategory('organisation')">
                    <div class="result-score ${getScoreClass(orgScore)}">${orgScore}%</div>
                    <div class="result-label">Organisation</div>
                    <div class="result-description">HR-Struktur</div>
                </div>
                <div class="result-card" id="card-prozesse" onclick="selectCategory('prozesse')">
                    <div class="result-score ${getScoreClass(processScore)}">${processScore}%</div>
                    <div class="result-label">Prozesse</div>
                    <div class="result-description">Digitalisierungsgrad</div>
                </div>
            `;
            
            // Render workflow dashboard (wird bei Prozesse-Kategorie angezeigt)
            renderWorkflowDashboard();
            
            // Vision automatisch auswählen beim Laden
            selectCategory('vision');
        }
        
        // Hilfsfunktion: Gesamtzahl aller Prozesse (Standard + Custom)
        function getTotalProcessCount() {
            let count = hrProcesses.length;
            // Custom-Prozesse in Standard-Kategorien
            if (assessmentData.customProcesses) {
                for (const procs of Object.values(assessmentData.customProcesses)) {
                    count += procs.length;
                }
            }
            return count;
        }
        
        // Prozess-Statistik aktualisieren
        function updateProcessStats() {
            const totalProcesses = getTotalProcessCount();
            const ratedProcesses = Object.keys(assessmentData.prozesse || {});
            const ratedCount = ratedProcesses.length;
            
            let digitalCount = 0;
            let potentialCount = 0;
            
            ratedProcesses.forEach(id => {
                const data = assessmentData.prozesse[id];
                if (data) {
                    const avgScore = ((data.digiIst || 0) + (data.qualIst || 0)) / 2;
                    const percent = (avgScore / 5) * 100;
                    
                    if (percent >= 60) digitalCount++;
                    if (percent < 40) potentialCount++;
                }
            });
            
            // Nicht bewertete Prozesse (für Potenzial-Logik)
            const notRated = hrProcesses.filter(p => !(assessmentData.prozesse && assessmentData.prozesse[p.id]));
            const notRatedCount = notRated.length;
            const totalPotential = potentialCount + notRatedCount; // Verbesserungspotenzial = niedrig digitalisiert + noch nicht bewertet
            
            // UI aktualisieren (mit Null-Check)
            const ratedEl = document.getElementById('processesRatedCount');
            const totalEl = document.getElementById('processesTotalCount');
            const digitalEl = document.getElementById('digitalProcessesCount');
            const potentialEl = document.getElementById('potentialProcessesCount');
            const potentialLabelEl = document.getElementById('potentialProcessesLabel');
            
            if (ratedEl) ratedEl.textContent = ratedCount;
            if (totalEl) totalEl.textContent = totalProcesses;
            if (digitalEl) digitalEl.textContent = digitalCount;
            if (potentialEl) {
                if (totalPotential >= 20) {
                    potentialEl.textContent = 'Extrem hoch';
                    potentialEl.style.fontSize = '1.25rem';
                } else if (totalPotential >= 10) {
                    potentialEl.textContent = 'Sehr hoch';
                    potentialEl.style.fontSize = '1.35rem';
                } else if (totalPotential >= 5) {
                    potentialEl.textContent = 'Hoch';
                    potentialEl.style.fontSize = '1.5rem';
                } else {
                    potentialEl.textContent = potentialCount;
                    potentialEl.style.fontSize = '2rem';
                }
            }
            if (potentialLabelEl) potentialLabelEl.textContent = totalPotential > 0 ? totalPotential + ' Prozesse mit Verbesserungspotenzial' : 'Potenzial (<40%)';
            
            // Manuelle Angaben (Tools, Pain-Points, Kurzbeschreibung) in den Ergebnissen anzeigen
            const manualBox = document.getElementById('processManualEntriesBox');
            const manualList = document.getElementById('processManualEntriesList');
            if (manualBox && manualList) {
                const entries = [];
                (ratedProcesses || []).forEach(id => {
                    const data = assessmentData.prozesse[id];
                    const processInfo = findProcessInfo(id);
                    if (!data) return;
                    const tools = (data.tools && String(data.tools).trim()) || '';
                    const notes = (data.notes && String(data.notes).trim()) || '';
                    const desc = (data.description && String(data.description).trim()) || '';
                    if (!tools && !notes && !desc) return;
                    entries.push({ name: processInfo.processName, tools, notes, desc });
                });
                if (entries.length > 0) {
                    manualBox.style.display = 'block';
                    manualList.innerHTML = entries.map(e => {
                        const parts = [];
                        if (e.desc) parts.push('<strong>Kurzbeschr.:</strong> ' + escapeHtml(e.desc));
                        if (e.tools) parts.push('<strong>Aktuell:</strong> ' + escapeHtml(e.tools));
                        if (e.notes) parts.push('<strong>Pain-Points:</strong> ' + escapeHtml(e.notes));
                        return '<div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 0.75rem 1rem; margin-bottom: 0.5rem;"><div style="color: #fde68a; font-weight: 600; margin-bottom: 0.35rem;">' + escapeHtml(e.name) + '</div><div style="color: rgba(255,255,255,0.8); font-size: 0.85rem; line-height: 1.4;">' + parts.join(' &nbsp;|&nbsp; ') + '</div></div>';
                    }).join('');
                } else {
                    manualBox.style.display = 'none';
                }
            }
            
            // Nicht bewertete Prozesse anzeigen
            const notRatedBox = document.getElementById('notRatedProcessesList');
            const notRatedList = document.getElementById('notRatedList');
            if (notRatedBox && notRatedList) {
                if (notRatedCount > 0 && notRatedCount < totalProcesses) {
                    notRatedBox.style.display = 'block';
                    notRatedList.textContent = notRated.map(p => p.name).join(', ');
                } else {
                    notRatedBox.style.display = 'none';
                }
            }
        }
        
        function escapeHtml(str) {
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function calculateCategoryScore(category, maxQuestions) {
            const values = Object.values(assessmentData[category]).filter(v => typeof v === 'number');
            if (values.length === 0) return 0;
            const avg = values.reduce((a, b) => a + b, 0) / values.length;
            return Math.round((avg / 5) * 100);
        }

        function calculateProcessScore() {
            const processes = Object.values(assessmentData.prozesse);
            if (processes.length === 0) return 0;
            
            let totalScore = 0;
            processes.forEach(p => {
                if (p.digiIst) totalScore += p.digiIst;
                if (p.qualIst) totalScore += p.qualIst;
            });
            
            return Math.round((totalScore / (processes.length * 10)) * 100);
        }

        function getScoreClass(score) {
            if (score >= 80) return 'excellent';
            if (score >= 60) return 'good';
            if (score >= 40) return 'moderate';
            return 'needs-work';
        }

        function generateRecommendations() {
            const list = document.getElementById('recommendationsList');
            const recommendations = [];
            
            // Process-based recommendations
            Object.entries(assessmentData.prozesse).forEach(([id, data]) => {
                const processInfo = findProcessInfo(id);
                
                const digiGap = (data.digiSoll || 0) - (data.digiIst || 0);
                const qualGap = (data.qualSoll || 0) - (data.qualIst || 0);
                const totalGap = digiGap + qualGap;
                const priority = totalGap * (data.wichtigkeit || 1);
                
                if (totalGap > 0) {
                    recommendations.push({
                        title: processInfo.processName,
                        text: `Gap von ${totalGap} Punkten identifiziert. ${digiGap > 0 ? `Digitalisierung um ${digiGap} Stufen verbessern.` : ''} ${qualGap > 0 ? `Prozessqualität um ${qualGap} Stufen verbessern.` : ''}`,
                        priority: priority > 6 ? 'high' : priority > 3 ? 'medium' : 'low',
                        score: priority
                    });
                }
            });
            
            // Sort by priority score
            recommendations.sort((a, b) => b.score - a.score);
            
            list.innerHTML = recommendations.length > 0 ? recommendations.slice(0, 10).map(rec => `
                <div class="recommendation-card ${rec.priority}-priority">
                    <div class="recommendation-header">
                        <div class="recommendation-title">${rec.title}</div>
                        <span class="recommendation-priority ${rec.priority}">${rec.priority === 'high' ? 'Hohe Priorität' : rec.priority === 'medium' ? 'Mittlere Priorität' : 'Niedrige Priorität'}</span>
                    </div>
                    <div class="recommendation-text">${rec.text}</div>
                </div>
            `).join('') : '<p style="color: #a5b4fc; text-align: center;">Bitte bewerten Sie mehr Prozesse, um Handlungsempfehlungen zu erhalten.</p>';
        }

        // Download results - öffnet Lead Capture Modal
        function downloadResults() {
            document.getElementById('leadCaptureModal').classList.add('active');
        }
        
        // Ergebnisse im Profil speichern - prüft Auth
        function saveResultsToProfile() {
            // Prüfe ob Benutzer angemeldet ist
            const userToken = localStorage.getItem('userToken') || sessionStorage.getItem('userToken');
            const userData = localStorage.getItem('userData');
            
            if (userToken && userData) {
                // Benutzer ist angemeldet - speichere direkt
                saveTestResults();
            } else {
                // Benutzer muss sich anmelden
                document.getElementById('authModal').classList.add('active');
            }
        }
        
        // Test-Ergebnisse speichern
        function saveTestResults() {
            const scores = calculateScores();
            const timestamp = new Date().toISOString();
            const userData = JSON.parse(localStorage.getItem('userData') || '{}');
            
            const testResult = {
                id: 'hr-selbsttest-' + Date.now(),
                type: 'HR-Selbsttest',
                date: timestamp,
                scores: scores,
                gesamtscore: ((scores.vision + scores.kultur + scores.organisation + scores.prozesse) / 4).toFixed(2),
                answers: collectAllAnswers()
            };
            
            // Hole bestehende gespeicherte Tests
            let savedTests = JSON.parse(localStorage.getItem('savedHRTests') || '[]');
            savedTests.unshift(testResult); // Neueste zuerst
            if (savedTests.length > 10) savedTests = savedTests.slice(0, 10); // Max 10 behalten
            
            localStorage.setItem('savedHRTests', JSON.stringify(savedTests));
            
            // Zeige Erfolgsmeldung
            showSaveSuccess();
        }
        
        // Alle Antworten sammeln (inkl. Prozessdaten)
        function collectAllAnswers() {
            // Alle assessmentData einschließen (enthält alle 32 Prozesse)
            const fullData = JSON.parse(JSON.stringify(assessmentData));
            
            // Zusätzlich DOM-Inputs sammeln
            const domInputs = {};
            document.querySelectorAll('input[type="range"], input[type="radio"]:checked, select').forEach(input => {
                if (input.id || input.name) {
                    domInputs[input.id || input.name] = input.value;
                }
            });
            
            // Alle Kategorien (Standard + Custom) für Statistik
            const allCats = [...hrCategories, ...(assessmentData.customCategories || [])];
            
            return {
                assessmentData: fullData,
                prozesseBewertet: Object.keys(fullData.prozesse || {}).length,
                prozesseGesamt: getTotalProcessCount(),
                kategorien: allCats.map(cat => {
                    const customProcs = (assessmentData.customProcesses && assessmentData.customProcesses[cat.id]) || [];
                    const allProcs = [...cat.processes, ...customProcs];
                    return {
                        name: cat.name,
                        bewertet: allProcs.filter(p => fullData.prozesse[p.id]).length,
                        gesamt: allProcs.length
                    };
                }),
                domInputs: domInputs
            };
        }
        
        // Erfolgs-Feedback anzeigen
        function showSaveSuccess() {
            const successDiv = document.createElement('div');
            successDiv.className = 'save-success-toast';
            successDiv.innerHTML = '<i class="fas fa-check-circle"></i> Ergebnisse erfolgreich gespeichert!';
            successDiv.style.cssText = 'position: fixed; top: 100px; right: 20px; background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 1rem 1.5rem; border-radius: 12px; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4); z-index: 10001; animation: slideIn 0.3s ease;';
            document.body.appendChild(successDiv);
            
            setTimeout(() => {
                successDiv.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => successDiv.remove(), 300);
            }, 3000);
        }
        
        // Auth Modal schließen
        function closeAuthModal() {
            document.getElementById('authModal').classList.remove('active');
        }
        
        // Login-Funktion
        async function handleLogin() {
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;
            
            if (!email || !password) {
                showAuthError('Bitte E-Mail und Passwort eingeben.');
                return;
            }
            
            try {
                // Versuche Login über Cognito/Auth API
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('userToken', data.token);
                    localStorage.setItem('userData', JSON.stringify({ email, name: data.name || email.split('@')[0] }));
                    closeAuthModal();
                    saveTestResults();
                } else {
                    // Fallback: Lokaler Login für Demo
                    localStorage.setItem('userToken', 'demo-token-' + Date.now());
                    localStorage.setItem('userData', JSON.stringify({ email, name: email.split('@')[0] }));
                    closeAuthModal();
                    saveTestResults();
                }
            } catch (e) {
                // Offline/Demo-Modus
                localStorage.setItem('userToken', 'demo-token-' + Date.now());
                localStorage.setItem('userData', JSON.stringify({ email, name: email.split('@')[0] }));
                closeAuthModal();
                saveTestResults();
            }
        }
        
        // Registrierung
        async function handleRegister() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            
            if (!name || !email || !password) {
                showAuthError('Bitte alle Felder ausfüllen.');
                return;
            }
            
            if (password.length < 6) {
                showAuthError('Passwort muss mindestens 6 Zeichen haben.');
                return;
            }
            
            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, password })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    localStorage.setItem('userToken', data.token || 'demo-token-' + Date.now());
                    localStorage.setItem('userData', JSON.stringify({ email, name }));
                    closeAuthModal();
                    saveTestResults();
                } else {
                    // Fallback für Demo
                    localStorage.setItem('userToken', 'demo-token-' + Date.now());
                    localStorage.setItem('userData', JSON.stringify({ email, name }));
                    closeAuthModal();
                    saveTestResults();
                }
            } catch (e) {
                // Demo-Modus
                localStorage.setItem('userToken', 'demo-token-' + Date.now());
                localStorage.setItem('userData', JSON.stringify({ email, name }));
                closeAuthModal();
                saveTestResults();
            }
        }
        
        // Auth-Tab wechseln
        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            document.querySelector(`.auth-tab[data-tab="${tab}"]`).classList.add('active');
            document.getElementById(tab + 'Form').classList.add('active');
        }
        
        // Auth Fehler anzeigen
        function showAuthError(msg) {
            const errDiv = document.getElementById('authError');
            errDiv.textContent = msg;
            errDiv.style.display = 'block';
            setTimeout(() => errDiv.style.display = 'none', 4000);
        }
        
        // Lead Capture Formular validieren
        // Fake E-Mail Domains Blacklist
        const fakeEmailDomains = [
            'yopmail.com', 'tempmail.com', 'guerrillamail.com', 'mailinator.com',
            'temp-mail.org', 'fakeinbox.com', 'throwaway.email', 'maildrop.cc',
            'dispostable.com', 'getnada.com', 'tempail.com', '10minutemail.com',
            'trashmail.com', 'sharklasers.com', 'guerrillamail.info', 'grr.la',
            'spam4.me', 'mailnesia.com', 'mytemp.email', 'mohmal.com',
            'emailondeck.com', 'temp.email', 'fakemailgenerator.com', 'tempr.email'
        ];

        function isValidEmail(email) {
            // Standard E-Mail Regex
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) return { valid: false, reason: 'Ungültiges E-Mail-Format' };
            
            // Domain extrahieren
            const domain = email.split('@')[1].toLowerCase();
            
            // Fake-Domain Check
            if (fakeEmailDomains.some(fake => domain.includes(fake))) {
                return { valid: false, reason: 'Bitte verwenden Sie eine geschäftliche E-Mail-Adresse' };
            }
            
            return { valid: true };
        }

        function validateLeadForm() {
            const name = document.getElementById('leadName').value.trim();
            const email = document.getElementById('leadEmail').value.trim();
            const consent = document.getElementById('leadConsent').checked;
            const submitBtn = document.getElementById('leadSubmitBtn');
            const emailError = document.getElementById('leadEmailError');
            
            // E-Mail validieren
            let emailValid = false;
            if (email) {
                const validation = isValidEmail(email);
                emailValid = validation.valid;
                if (emailError) {
                    emailError.textContent = validation.valid ? '' : validation.reason;
                    emailError.style.display = validation.valid ? 'none' : 'block';
                }
            } else if (emailError) {
                emailError.style.display = 'none';
            }
            
            submitBtn.disabled = !(name && email && emailValid && consent);
        }
        
        // KI-generiertes Management Summary abrufen
        async function generateAISummary(scores, name) {
            const apiKey = localStorage.getItem('openai_api_key');
            if (!apiKey) {
                return generateFallbackSummary(scores);
            }
            
            const prompt = `Du bist ein HR-Digitalexperte. Erstelle ein professionelles Management Summary (max 150 Worte) fuer folgende HR-Digital-Readiness-Analyse:

Ergebnisse fuer ${name}:
- Vision: ${scores.vision.toFixed(1)}/5.0 (${((scores.vision/5)*100).toFixed(0)}%)
- Kultur: ${scores.kultur.toFixed(1)}/5.0 (${((scores.kultur/5)*100).toFixed(0)}%)
- Organisation: ${scores.organisation.toFixed(1)}/5.0 (${((scores.organisation/5)*100).toFixed(0)}%)
- Prozesse: ${scores.prozesse.toFixed(1)}/5.0 (${((scores.prozesse/5)*100).toFixed(0)}%)
- Gesamt: ${scores.total.toFixed(1)}/5.0 (${((scores.total/5)*100).toFixed(0)}%)

Schreibe das Summary in professionellem Deutsch ohne Emojis. Beginne mit einer Gesamteinschaetzung, dann die wichtigsten Staerken und Entwicklungsfelder.`;

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [{ role: 'user', content: prompt }],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    return data.choices[0].message.content;
                }
            } catch (e) {
                console.log('KI-Summary nicht verfuegbar, nutze Fallback');
            }
            
            return generateFallbackSummary(scores);
        }
        
        // Fallback Summary ohne KI
        function generateFallbackSummary(scores) {
            const totalPercent = (scores.total / 5) * 100;
            let level = 'fortgeschritten';
            if (totalPercent < 40) level = 'am Anfang der Digitalisierungsreise';
            else if (totalPercent < 60) level = 'auf gutem Weg';
            else if (totalPercent < 80) level = 'fortgeschritten';
            else level = 'hervorragend aufgestellt';
            
            const dims = [
                { name: 'Vision', score: scores.vision },
                { name: 'Kultur', score: scores.kultur },
                { name: 'Organisation', score: scores.organisation },
                { name: 'Prozesse', score: scores.prozesse }
            ].sort((a, b) => b.score - a.score);
            
            return `Mit einem Gesamtscore von ${scores.total.toFixed(1)}/5.0 (${totalPercent.toFixed(0)}%) ist Ihre HR-Organisation ${level}. Besondere Stärke zeigt sich im Bereich ${dims[0].name} (${dims[0].score.toFixed(1)}/5.0). Das größte Entwicklungspotenzial liegt im Bereich ${dims[3].name} (${dims[3].score.toFixed(1)}/5.0). Durch gezielte Maßnahmen in diesem Bereich können Sie Ihre digitale HR-Reife signifikant steigern.`;
        }
        
        // Detaillierte Tipps pro Dimension
        function getDetailedTips(dimension, score) {
            const tips = {
                vision: {
                    low: [
                        'Definieren Sie eine klare 3-Jahres-Vision für Ihre HR-Digitalisierung',
                        'Führen Sie Interviews mit Führungskräften zur Erwartungshaltung durch',
                        'Benchmarken Sie sich mit Wettbewerbern und Best-Practice-Unternehmen',
                        'Erstellen Sie ein Vision-Statement und kommunizieren Sie es breit'
                    ],
                    medium: [
                        'Schärfen Sie Ihre Vision mit messbaren KPIs und Meilensteinen',
                        'Binden Sie Stakeholder aus allen Unternehmensbereichen ein',
                        'Entwickeln Sie eine Roadmap mit konkreten Initiativen',
                        'Prüfen Sie neue Technologietrends wie KI und Automatisierung'
                    ],
                    high: [
                        'Positionieren Sie HR als strategischen Innovationstreiber',
                        'Teilen Sie Ihre Vision auf Konferenzen und in Fachmedien',
                        'Explorieren Sie emerging Technologies wie Generative AI',
                        'Bauen Sie ein Innovations-Lab oder Pilotprogramm auf'
                    ]
                },
                kultur: {
                    low: [
                        'Starten Sie ein Digital-Fitness-Programm für HR-Mitarbeitende',
                        'Identifizieren Sie Change-Agents und Digital Champions',
                        'Schaffen Sie psychologische Sicherheit für Experimente',
                        'Kommunizieren Sie Erfolgsgeschichten und Quick Wins'
                    ],
                    medium: [
                        'Etablieren Sie eine Lernkultur mit regelmäßigen Schulungen',
                        'Fördern Sie bereichsübergreifende Zusammenarbeit',
                        'Implementieren Sie Feedback-Mechanismen und Retrospektiven',
                        'Belohnen Sie Innovation und kalkulierte Risikobereitschaft'
                    ],
                    high: [
                        'Nutzen Sie Ihre Kultur aktiv im Employer Branding',
                        'Exportieren Sie Best Practices in andere Unternehmensbereiche',
                        'Bauen Sie Communities of Practice auf',
                        'Investieren Sie in kontinuierliches Lernen und Upskilling'
                    ]
                },
                organisation: {
                    low: [
                        'Klären Sie Rollen und Verantwortlichkeiten für die Digitalisierung',
                        'Definieren Sie klare Entscheidungswege und Governance',
                        'Prüfen Sie die Ressourcenausstattung (Budget, Personal)',
                        'Etablieren Sie ein Steering Committee für HR-Tech'
                    ],
                    medium: [
                        'Optimieren Sie die Zusammenarbeit zwischen HR und IT',
                        'Schaffen Sie dedizierte HR-Tech-Rollen oder -Teams',
                        'Implementieren Sie agile Arbeitsmethoden in HR-Projekten',
                        'Bauen Sie Partnerschaften mit HR-Tech-Anbietern auf'
                    ],
                    high: [
                        'Positionieren Sie HR als Center of Excellence',
                        'Skalieren Sie erfolgreiche Strukturen unternehmensweit',
                        'Investieren Sie in spezialisierte HR-Tech-Expertise',
                        'Evaluieren Sie ein HR-Analytics- oder Data-Science-Team'
                    ]
                },
                prozesse: {
                    low: [
                        'Dokumentieren und analysieren Sie Ihre HR-Kernprozesse',
                        'Identifizieren Sie Quick Wins mit hohem Automatisierungspotenzial',
                        'Starten Sie mit einfachen RPA-Anwendungen (z.B. Dateneingabe)',
                        'Eliminieren Sie manuelle, papierbasierte Workflows'
                    ],
                    medium: [
                        'Implementieren Sie End-to-End-Prozessautomatisierung',
                        'Nutzen Sie Workflow-Tools wie Power Automate oder Zapier',
                        'Integrieren Sie Ihre HR-Systeme für nahtlosen Datenfluss',
                        'Messen Sie Prozesseffizienz mit klaren KPIs'
                    ],
                    high: [
                        'Explorieren Sie KI-gestützte Prozessoptimierung',
                        'Implementieren Sie Predictive Analytics in HR-Prozessen',
                        'Nutzen Sie Chatbots und Self-Service-Portale',
                        'Streben Sie hyperautomatisierte End-to-End-Journeys an'
                    ]
                }
            };
            
            const level = score < 2 ? 'low' : (score < 3.5 ? 'medium' : 'high');
            return tips[dimension][level];
        }
        
        // PDF Export Funktion - Premium C-Level Design
        async function generatePDFReport(name, email, scores) {
            if (!window.jspdf) {
                await new Promise((resolve) => {
                    const checkInterval = setInterval(() => {
                        if (window.jspdf) { clearInterval(checkInterval); resolve(); }
                    }, 100);
                    setTimeout(() => { clearInterval(checkInterval); resolve(); }, 5000);
                });
            }
            if (!window.jspdf) throw new Error('jsPDF konnte nicht geladen werden.');

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const margin = 15;
            const contentWidth = pageWidth - (2 * margin);
            let yPos = 0;
            
            // Pre-render BPMN diagrams
            let bpmnImages = {};
            try {
                bpmnImages = await preRenderBpmnImages();
            } catch (err) {
                console.warn('Could not pre-render BPMN images:', err);
            }

            // Profilbild laden (asynchron)
            let profileImageData = null;
            try {
                const loadImage = () => new Promise((resolve) => {
                    const img = new Image();
                    img.crossOrigin = 'anonymous';
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const size = Math.min(img.width, img.height);
                        canvas.width = size;
                        canvas.height = size;
                        const ctx = canvas.getContext('2d');
                        
                        // Runde Ecken mit Canvas zeichnen
                        const radius = size * 0.12;
                        ctx.beginPath();
                        ctx.moveTo(radius, 0);
                        ctx.lineTo(size - radius, 0);
                        ctx.quadraticCurveTo(size, 0, size, radius);
                        ctx.lineTo(size, size - radius);
                        ctx.quadraticCurveTo(size, size, size - radius, size);
                        ctx.lineTo(radius, size);
                        ctx.quadraticCurveTo(0, size, 0, size - radius);
                        ctx.lineTo(0, radius);
                        ctx.quadraticCurveTo(0, 0, radius, 0);
                        ctx.closePath();
                        ctx.clip();
                        
                        // Bild oben ausrichten (Kopf sichtbar, unten abschneiden)
                        const sx = (img.width - size) / 2;
                        const sy = 0; // Oben starten, nicht zentrieren
                        ctx.drawImage(img, sx, sy, size, size, 0, 0, size, size);
                        
                        resolve(canvas.toDataURL('image/png'));
                    };
                    img.onerror = () => resolve(null);
                    img.src = 'https://manuel-weiss.ch/images/manuel-weiss-profile.png';
                    setTimeout(() => resolve(null), 3000);
                });
                profileImageData = await loadImage();
            } catch (e) {
                console.log('Profilbild konnte nicht geladen werden');
            }

            // Premium Farbpalette
            const colors = {
                primary: [79, 70, 229],      // Indigo
                secondary: [139, 92, 246],   // Purple
                accent: [20, 184, 166],      // Teal
                gold: [245, 158, 11],        // Amber
                success: [16, 185, 129],     // Green
                warning: [251, 146, 60],     // Orange
                danger: [239, 68, 68],       // Red
                dark: [15, 23, 42],          // Slate 900
                light: [248, 250, 252],      // Slate 50
                muted: [100, 116, 139]       // Slate 500
            };

            const getScoreColor = (score) => {
                if (score < 2) return colors.danger;
                if (score < 3.5) return colors.warning;
                return colors.success;
            };

            const getScoreLabel = (score) => {
                if (score < 2) return 'Kritisch';
                if (score < 3) return 'Entwicklungsbedarf';
                if (score < 4) return 'Fortgeschritten';
                return 'Exzellent';
            };

            // Glaseffekt-Box zeichnen
            const drawGlassBox = (x, y, w, h, baseColor, opacity = 0.9) => {
                // Hauptfarbe mit leichter Transparenz
                doc.setFillColor(baseColor[0], baseColor[1], baseColor[2]);
                doc.roundedRect(x, y, w, h, 4, 4, 'F');
                // Subtiler heller Rand oben für Glas-Effekt
                doc.setFillColor(255, 255, 255);
                doc.setGState(new doc.GState({ opacity: 0.15 }));
                doc.roundedRect(x, y, w, 2, 2, 2, 'F');
                doc.setGState(new doc.GState({ opacity: 1 }));
            };

            // KI-Summary parallel generieren
            const summaryPromise = generateAISummary(scores, name);

            // Prozess-Statistiken berechnen
            const ratedProcessIds = Object.keys(assessmentData.prozesse || {});
            const totalProcessCount = getTotalProcessCount();
            const ratedCount = ratedProcessIds.length;
            let digitalCount = 0, potentialCount = 0;
            ratedProcessIds.forEach(id => {
                const d = assessmentData.prozesse[id];
                if (d) {
                    const avg = ((d.digiIst || 0) + (d.qualIst || 0)) / 2;
                    if ((avg / 5) * 100 >= 60) digitalCount++;
                    if ((avg / 5) * 100 < 40) potentialCount++;
                }
            });

            // ========== SEITE 1: EXECUTIVE COVER ==========
            // Premium Gradient Header
            doc.setFillColor(...colors.primary);
            doc.rect(0, 0, pageWidth, 85, 'F');
            doc.setFillColor(...colors.secondary);
            doc.rect(0, 75, pageWidth, 15, 'F');

            // Titel
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(32);
            doc.setFont('helvetica', 'bold');
            doc.text('HR Digital Readiness', pageWidth / 2, 35, { align: 'center' });
            doc.setFontSize(14);
            doc.setFont('helvetica', 'normal');
            doc.text('Executive Assessment Report', pageWidth / 2, 48, { align: 'center' });

            // Datum Badge
            doc.setFillColor(255, 255, 255);
            doc.roundedRect(pageWidth / 2 - 35, 58, 70, 10, 5, 5, 'F');
            doc.setTextColor(...colors.primary);
            doc.setFontSize(9);
            doc.text(new Date().toLocaleDateString('de-CH', { year: 'numeric', month: 'long', day: 'numeric' }), pageWidth / 2, 65, { align: 'center' });

            yPos = 100;

            // Client Info Box
            doc.setFillColor(...colors.light);
            doc.roundedRect(margin, yPos, contentWidth, 32, 4, 4, 'F');
            doc.setDrawColor(226, 232, 240);
            doc.setLineWidth(0.5);
            doc.roundedRect(margin, yPos, contentWidth, 32, 4, 4, 'D');

            doc.setTextColor(...colors.muted);
            doc.setFontSize(8);
            doc.text('ERSTELLT FÜR', margin + 10, yPos + 8);
            doc.setTextColor(...colors.dark);
            doc.setFontSize(16);
            doc.setFont('helvetica', 'bold');
            doc.text(name, margin + 10, yPos + 18);
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.setTextColor(...colors.muted);
            doc.text(email, margin + 10, yPos + 26);

            yPos += 45;

            // Executive Score Card
            const totalScore = scores.total;
            const totalPercent = (totalScore / 5) * 100;
            const scoreColor = getScoreColor(totalScore);

            doc.setFillColor(...scoreColor);
            doc.roundedRect(margin, yPos, contentWidth, 55, 6, 6, 'F');

            // Score Ring simulieren
            doc.setFillColor(255, 255, 255);
            doc.circle(margin + 40, yPos + 27, 22, 'F');
            doc.setFillColor(...scoreColor);
            doc.circle(margin + 40, yPos + 27, 18, 'F');
            doc.setFillColor(255, 255, 255);
            doc.circle(margin + 40, yPos + 27, 14, 'F');

            doc.setTextColor(...scoreColor);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text(totalScore.toFixed(1), margin + 40, yPos + 30, { align: 'center' });

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(11);
            doc.text('GESAMTSCORE', margin + 75, yPos + 15);
            doc.setFontSize(28);
            doc.setFont('helvetica', 'bold');
            doc.text(totalPercent.toFixed(0) + '%', margin + 75, yPos + 32);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            doc.text('Digital Readiness', margin + 75, yPos + 42);

            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text(getScoreLabel(totalScore), pageWidth - margin - 10, yPos + 30, { align: 'right' });

            yPos += 70;

            // Dimensionen Overview
            doc.setTextColor(...colors.dark);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('DIMENSIONEN IM ÜBERBLICK', margin, yPos);
            yPos += 10;

            const dimensions = [
                { key: 'vision', name: 'Vision & Strategie', score: scores.vision, icon: '◉' },
                { key: 'kultur', name: 'Kultur & Zusammenarbeit', score: scores.kultur, icon: '◈' },
                { key: 'organisation', name: 'Organisation & Ressourcen', score: scores.organisation, icon: '◇' },
                { key: 'prozesse', name: 'Prozesse & Digitalisierung', score: scores.prozesse, icon: '○' }
            ];

            dimensions.forEach((dim, idx) => {
                const color = getScoreColor(dim.score);
                const pct = (dim.score / 5) * 100;

                doc.setFillColor(...colors.light);
                doc.roundedRect(margin, yPos, contentWidth, 16, 3, 3, 'F');

                // Score Indicator
                doc.setFillColor(...color);
                doc.roundedRect(margin + 2, yPos + 2, 12, 12, 2, 2, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.score.toFixed(1), margin + 8, yPos + 10, { align: 'center' });

                doc.setTextColor(...colors.dark);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.name, margin + 18, yPos + 10);

                // Progress Bar
                const barX = margin + 95;
                const barW = contentWidth - 115;
                doc.setFillColor(226, 232, 240);
                doc.roundedRect(barX, yPos + 5, barW, 6, 3, 3, 'F');
                doc.setFillColor(...color);
                const fillW = (barW * pct) / 100;
                if (fillW > 3) doc.roundedRect(barX, yPos + 5, fillW, 6, 3, 3, 'F');

                doc.setTextColor(...color);
                doc.setFontSize(9);
                doc.text(pct.toFixed(0) + '%', pageWidth - margin - 5, yPos + 10, { align: 'right' });

                yPos += 20;
            });

            yPos += 5;

            // Prozess-Digitalisierung Kompakt
            doc.setFillColor(254, 252, 232);
            doc.roundedRect(margin, yPos, contentWidth, 28, 4, 4, 'F');
            doc.setDrawColor(...colors.gold);
            doc.setLineWidth(0.5);
            doc.roundedRect(margin, yPos, contentWidth, 28, 4, 4, 'D');

            doc.setTextColor(161, 98, 7);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'bold');
            doc.text('PROZESS-DIGITALISIERUNG', margin + 8, yPos + 8);
            doc.setFontSize(8);
            doc.setFont('helvetica', 'normal');
            doc.text(ratedCount + ' von ' + totalProcessCount + ' Prozessen bewertet  |  ' + digitalCount + ' digitalisiert (>60%)  |  ' + potentialCount + ' mit Potenzial (<40%)', margin + 8, yPos + 18);
            if (ratedCount < totalProcessCount) {
                doc.setTextColor(180, 83, 9);
                doc.text('→ ' + (totalProcessCount - ratedCount) + ' Prozesse noch nicht bewertet', margin + 8, yPos + 25);
            }

            // ========== SEITE 2: EXECUTIVE SUMMARY ==========
            doc.addPage();
            
            // Header Bar
            doc.setFillColor(...colors.primary);
            doc.rect(0, 0, pageWidth, 12, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });

            yPos = 25;
            doc.setTextColor(...colors.dark);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Executive Summary', margin, yPos);
            doc.setFillColor(...colors.accent);
            doc.roundedRect(margin, yPos + 3, 35, 2, 1, 1, 'F');

            yPos += 18;

            // KI-Summary Box
            const aiSummary = await summaryPromise;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            const summaryLines = doc.splitTextToSize(aiSummary, contentWidth - 20);
            const summaryBoxHeight = Math.max(45, summaryLines.length * 5 + 16);
            
            doc.setFillColor(...colors.light);
            doc.roundedRect(margin, yPos, contentWidth, summaryBoxHeight, 5, 5, 'F');
            doc.setDrawColor(226, 232, 240);
            doc.setLineWidth(0.3);
            doc.roundedRect(margin, yPos, contentWidth, summaryBoxHeight, 5, 5, 'D');
            
            doc.setTextColor(...colors.dark);
            let lineY = yPos + 12;
            summaryLines.forEach((line) => {
                doc.text(line, margin + 10, lineY);
                lineY += 5;
            });

            yPos += summaryBoxHeight + 12;

            // Key Metrics Grid
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('KEY PERFORMANCE INDICATORS', margin, yPos);
            yPos += 12;

            const metrics = [
                { label: 'Gesamtscore', value: totalScore.toFixed(1) + '/5.0', color: scoreColor },
                { label: 'Readiness', value: totalPercent.toFixed(0) + '%', color: scoreColor },
                { label: 'Prozesse Digital', value: digitalCount + '/' + ratedCount, color: digitalCount > ratedCount/2 ? colors.success : colors.warning },
                { label: 'Handlungsbedarf', value: potentialCount + ' Bereiche', color: potentialCount > 3 ? colors.danger : colors.success }
            ];

            const metricW = (contentWidth - 15) / 4;
            metrics.forEach((m, i) => {
                const x = margin + i * (metricW + 5);
                doc.setFillColor(...m.color);
                doc.roundedRect(x, yPos, metricW, 35, 4, 4, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'normal');
                doc.text(m.label.toUpperCase(), x + metricW/2, yPos + 10, { align: 'center' });
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(m.value, x + metricW/2, yPos + 25, { align: 'center' });
            });

            yPos += 50;

            // Dimensions Detail Cards
            doc.setTextColor(...colors.dark);
            doc.setFontSize(12);
            doc.setFont('helvetica', 'bold');
            doc.text('BEWERTUNGSÜBERSICHT NACH DIMENSIONEN', margin, yPos);
            yPos += 10;

            dimensions.forEach((dim) => {
                const color = getScoreColor(dim.score);
                const pct = (dim.score / 5) * 100;
                const boxH = 24;

                // Card mit Schatten-Effekt
                doc.setFillColor(240, 240, 245);
                doc.roundedRect(margin + 1, yPos + 1, contentWidth, boxH, 5, 5, 'F');
                doc.setFillColor(...colors.light);
                doc.roundedRect(margin, yPos, contentWidth, boxH, 5, 5, 'F');

                // Score Badge - perfekt zentriert
                const badgeW = 28;
                const badgeH = 16;
                const badgeX = margin + 5;
                const badgeY = yPos + (boxH - badgeH) / 2;
                doc.setFillColor(...color);
                doc.roundedRect(badgeX, badgeY, badgeW, badgeH, 4, 4, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.score.toFixed(1), badgeX + badgeW/2, badgeY + badgeH/2 + 3.5, { align: 'center' });

                // Dimension Name
                doc.setTextColor(...colors.dark);
                doc.setFontSize(11);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.name, margin + 40, yPos + 10);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...colors.muted);
                doc.text(getScoreLabel(dim.score), margin + 40, yPos + 18);

                // Mini Bar
                doc.setFillColor(226, 232, 240);
                doc.roundedRect(pageWidth - margin - 55, yPos + 8, 50, 6, 3, 3, 'F');
                doc.setFillColor(...color);
                doc.roundedRect(pageWidth - margin - 55, yPos + 8, (50 * pct) / 100, 6, 3, 3, 'F');

                yPos += 26;
            });

            // ========== SEITE 3: PROZESS-KATEGORIEN ÜBERSICHT ==========
            doc.addPage();

            // Header
            doc.setFillColor(...colors.primary);
            doc.rect(0, 0, pageWidth, 12, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });

            yPos = 25;
            doc.setTextColor(...colors.dark);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Prozess-Digitalisierung nach Kategorien', margin, yPos);
            doc.setFillColor(...colors.accent);
            doc.roundedRect(margin, yPos + 3, 55, 2, 1, 1, 'F');

            yPos += 20;

            // Kategorie Cards - Standard + Custom Kategorien
            const allCategoriesForPdf = [
                ...hrCategories.map(cat => ({
                    ...cat,
                    processes: [
                        ...cat.processes,
                        ...((assessmentData.customProcesses && assessmentData.customProcesses[cat.id]) || [])
                    ]
                })),
                ...(assessmentData.customCategories || []).map(cat => ({
                    ...cat,
                    processes: [
                        ...cat.processes,
                        ...((assessmentData.customProcesses && assessmentData.customProcesses[cat.id]) || [])
                    ]
                }))
            ];
            
            allCategoriesForPdf.forEach((cat, catIdx) => {
                const catProcesses = cat.processes;
                if (catProcesses.length === 0) return; // Leere Kategorien überspringen
                const ratedInCat = catProcesses.filter(p => assessmentData.prozesse && assessmentData.prozesse[p.id]).length;
                const catProgress = catProcesses.length > 0 ? (ratedInCat / catProcesses.length) * 100 : 0;

                // Berechne minimale Höhe für Kategorie-Header + ersten Prozess
                // damit Überschrift nie alleine am Seitenende steht
                let minHeightNeeded = 15; // Kategorie-Header
                if (catProcesses.length > 0) {
                    // Mindestens Platz für ersten Prozess (Basisgröße)
                    minHeightNeeded += 25;
                }
                
                // Neue Seite wenn nicht genug Platz für Header + mindestens einen Prozess
                if (yPos > pageHeight - minHeightNeeded - 25) {
                    doc.addPage();
                    doc.setFillColor(...colors.primary);
                    doc.rect(0, 0, pageWidth, 12, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(8);
                    doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });
                    yPos = 25;
                }

                // Kategorie Header
                const catColor = cat.color ? [parseInt(cat.color.slice(1,3),16), parseInt(cat.color.slice(3,5),16), parseInt(cat.color.slice(5,7),16)] : colors.primary;
                
                doc.setFillColor(...catColor);
                doc.roundedRect(margin, yPos, contentWidth, 12, 3, 3, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'bold');
                doc.text(cat.name, margin + 8, yPos + 8);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'normal');
                doc.text(ratedInCat + '/' + catProcesses.length + ' bewertet', pageWidth - margin - 8, yPos + 8, { align: 'right' });

                yPos += 15;

                // Prozess Items
                catProcesses.forEach((proc, procIdx) => {
                    const procData = assessmentData.prozesse ? assessmentData.prozesse[proc.id] : null;
                    const isRated = !!procData;
                    const procScore = procData ? ((procData.digiIst || 0) + (procData.qualIst || 0)) / 2 : 0;
                    const procPct = (procScore / 5) * 100;
                    const procColor = isRated ? getScoreColor(procScore) : [200, 200, 200];
                    
                    // Berechne Box-Höhe basierend auf Kurzbeschreibung, Tools, Notes und BPMN
                    const descStr = procData && procData.description ? String(procData.description).trim() : '';
                    const toolsStr = procData && procData.tools ? String(procData.tools).trim() : '';
                    const notesStr = procData && procData.notes ? String(procData.notes).trim() : '';
                    const bpmnData = bpmnImages[proc.id];
                    const hasBpmn = bpmnData ? true : false;
                    let boxHeight = 10;
                    let bpmnImgHeight = 0;
                    if (descStr || toolsStr || notesStr || hasBpmn) {
                        if (descStr) {
                            doc.setFontSize(7);
                            const dl = doc.splitTextToSize(descStr, contentWidth - 55);
                            boxHeight += 6 + Math.min(dl.length, 20) * 3.5;
                        }
                        if (toolsStr) {
                            doc.setFontSize(7);
                            const tl = doc.splitTextToSize(toolsStr, contentWidth - 55);
                            boxHeight += 6 + Math.min(tl.length, 2) * 3.5;
                        }
                        if (notesStr) {
                            doc.setFontSize(7);
                            const nl = doc.splitTextToSize(notesStr, contentWidth - 55);
                            boxHeight += 6 + Math.min(nl.length, 3) * 3.5;
                        }
                        if (hasBpmn) {
                            // Calculate actual image height based on aspect ratio
                            const aspectRatio = bpmnData.aspectRatio || 2;
                            const maxWidth = contentWidth - 30;
                            const maxHeight = 38;
                            bpmnImgHeight = Math.min(maxWidth / aspectRatio, maxHeight);
                            boxHeight += 8 + bpmnImgHeight; // Label + image + padding
                        }
                    }
                    
                    // Prüfe ob neue Seite nötig (mit Sicherheitspuffer)
                    const safetyMargin = 35; // Mehr Platz am Seitenende
                    if (yPos + boxHeight > pageHeight - safetyMargin) {
                        doc.addPage();
                        doc.setFillColor(...colors.primary);
                        doc.rect(0, 0, pageWidth, 12, 'F');
                        doc.setTextColor(255, 255, 255);
                        doc.setFontSize(8);
                        doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });
                        yPos = 25;
                    }

                    doc.setFillColor(...colors.light);
                    doc.roundedRect(margin + 5, yPos, contentWidth - 10, boxHeight, 2, 2, 'F');

                    // Status Dot
                    doc.setFillColor(...procColor);
                    doc.circle(margin + 12, yPos + 5, 2.5, 'F');

                    doc.setTextColor(...colors.dark);
                    doc.setFontSize(8);
                    doc.setFont('helvetica', 'normal');
                    doc.text(proc.name, margin + 20, yPos + 6.5);

                    if (isRated) {
                        // Mini Score
                        doc.setTextColor(...procColor);
                        doc.setFont('helvetica', 'bold');
                        doc.text(procScore.toFixed(1), pageWidth - margin - 25, yPos + 6.5, { align: 'right' });
                        doc.setTextColor(...colors.muted);
                        doc.setFont('helvetica', 'normal');
                        doc.text(procPct.toFixed(0) + '%', pageWidth - margin - 8, yPos + 6.5, { align: 'right' });
                        
                        // Aktuelle Applikation / Tools (manuell eingegeben)
                        let detailY = yPos + 12;
                        const toolsStr = (procData.tools && String(procData.tools).trim()) || '';
                        if (toolsStr) {
                            doc.setFillColor(...colors.primary);
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(6);
                            doc.roundedRect(margin + 20, detailY - 2, 28, 5, 1, 1, 'F');
                            doc.text('Aktuell:', margin + 22, detailY + 1.5);
                            doc.setTextColor(...colors.dark);
                            doc.setFontSize(7);
                            const toolLines = doc.splitTextToSize(toolsStr, contentWidth - 55);
                            toolLines.slice(0, 2).forEach((line, idx) => {
                                doc.text(line, margin + 50, detailY + 1.5 + (idx * 3.5));
                            });
                            detailY += 6 + (Math.min(toolLines.length, 2) * 3.5);
                        }
                        // Pain-Points / Anmerkungen (manuell eingegeben)
                        const notesStr = (procData.notes && String(procData.notes).trim()) || '';
                        if (notesStr) {
                            doc.setFillColor(...colors.warning);
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(6);
                            doc.roundedRect(margin + 20, detailY - 2, 28, 5, 1, 1, 'F');
                            doc.text('Pain-Points:', margin + 22, detailY + 1.5);
                            doc.setTextColor(...colors.muted);
                            doc.setFontSize(7);
                            const noteLines = doc.splitTextToSize(notesStr, contentWidth - 55);
                            noteLines.slice(0, 3).forEach((line, idx) => {
                                doc.text(line, margin + 50, detailY + 1.5 + (idx * 3.5));
                            });
                            detailY += 6 + (Math.min(noteLines.length, 3) * 3.5);
                        }
                        // Kurzbeschreibung Prozess
                        const descStr = (procData.description && String(procData.description).trim()) || '';
                        if (descStr) {
                            doc.setFillColor(139, 92, 246);
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(6);
                            doc.roundedRect(margin + 20, detailY - 2, 28, 5, 1, 1, 'F');
                            doc.text('Kurzbeschr.:', margin + 22, detailY + 1.5);
                            doc.setTextColor(...colors.dark);
                            doc.setFontSize(7);
                            const descLines = doc.splitTextToSize(descStr, contentWidth - 55);
                            descLines.slice(0, 20).forEach((line, idx) => {
                                doc.text(line, margin + 50, detailY + 1.5 + (idx * 3.5));
                            });
                            detailY += 6 + (Math.min(descLines.length, 20) * 3.5);
                        }
                        
                        // BPMN Workflow Diagramm (wenn vorhanden)
                        if (bpmnImages[proc.id]) {
                            doc.setFillColor(16, 185, 129);
                            doc.setTextColor(255, 255, 255);
                            doc.setFontSize(6);
                            doc.roundedRect(margin + 20, detailY - 2, 28, 5, 1, 1, 'F');
                            doc.text('Workflow:', margin + 22, detailY + 1.5);
                            
                            try {
                                const bpmnData = bpmnImages[proc.id];
                                const imgDataUrl = bpmnData.dataUrl || bpmnData;
                                const aspectRatio = bpmnData.aspectRatio || 2;
                                
                                // Calculate dimensions maintaining aspect ratio
                                const maxWidth = contentWidth - 30;
                                const maxHeight = 38;
                                
                                let imgWidth, imgHeight;
                                if (maxWidth / aspectRatio <= maxHeight) {
                                    imgWidth = maxWidth;
                                    imgHeight = maxWidth / aspectRatio;
                                } else {
                                    imgHeight = maxHeight;
                                    imgWidth = maxHeight * aspectRatio;
                                }
                                
                                doc.addImage(imgDataUrl, 'PNG', margin + 20, detailY + 4, imgWidth, imgHeight);
                            } catch (imgErr) {
                                console.warn('Could not add BPMN image to PDF:', imgErr);
                            }
                        }
                    } else {
                        doc.setTextColor(...colors.muted);
                        doc.setFontSize(7);
                        doc.text('nicht bewertet', pageWidth - margin - 8, yPos + 6.5, { align: 'right' });
                    }

                    yPos += boxHeight + 2;
                });

                yPos += 8;
            });

            // ========== DETAIL-SEITEN PRO DIMENSION ==========
            dimensions.forEach((dim) => {
                doc.addPage();

                // Header
                doc.setFillColor(...colors.primary);
                doc.rect(0, 0, pageWidth, 12, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(8);
                doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });

                yPos = 25;
                const color = getScoreColor(dim.score);
                const pct = (dim.score / 5) * 100;

                // Dimension Title
                doc.setTextColor(...colors.dark);
                doc.setFontSize(18);
                doc.setFont('helvetica', 'bold');
                doc.text('Bereich: ' + dim.name, margin, yPos);
                doc.setFillColor(...color);
                doc.roundedRect(margin, yPos + 3, 40, 2, 1, 1, 'F');

                yPos += 20;

                // Score Card
                doc.setFillColor(...color);
                doc.roundedRect(margin, yPos, 50, 40, 5, 5, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(28);
                doc.setFont('helvetica', 'bold');
                doc.text(dim.score.toFixed(1), margin + 25, yPos + 22, { align: 'center' });
                doc.setFontSize(10);
                doc.text('von 5.0', margin + 25, yPos + 32, { align: 'center' });

                // Status Box
                doc.setFillColor(...colors.light);
                doc.roundedRect(margin + 58, yPos, contentWidth - 58, 40, 5, 5, 'F');
                doc.setTextColor(...colors.dark);
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(getScoreLabel(dim.score), margin + 68, yPos + 15);
                doc.setFontSize(10);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(...colors.muted);
                doc.text(pct.toFixed(0) + '% der maximalen Punktzahl erreicht', margin + 68, yPos + 26);

                // Progress Bar
                doc.setFillColor(226, 232, 240);
                doc.roundedRect(margin + 68, yPos + 32, contentWidth - 80, 5, 2.5, 2.5, 'F');
                doc.setFillColor(...color);
                doc.roundedRect(margin + 68, yPos + 32, ((contentWidth - 80) * pct) / 100, 5, 2.5, 2.5, 'F');

                yPos += 55;

                // Handlungsempfehlungen
                doc.setTextColor(...colors.dark);
                doc.setFontSize(12);
                doc.setFont('helvetica', 'bold');
                doc.text('HANDLUNGSEMPFEHLUNGEN', margin, yPos);
                yPos += 12;

                const tips = getDetailedTips(dim.key, dim.score);
                tips.forEach((tip, idx) => {
                    // Berechne Textzeilen für dynamische Höhe
                    doc.setFontSize(9);
                    const tipLines = doc.splitTextToSize(tip, contentWidth - 35);
                    const boxHeight = Math.max(18, tipLines.length * 4 + 10);
                    
                    doc.setFillColor(...colors.light);
                    doc.roundedRect(margin, yPos, contentWidth, boxHeight, 4, 4, 'F');

                    // Number Badge - vertikal zentriert
                    const badgeY = yPos + (boxHeight - 14) / 2;
                    doc.setFillColor(...color);
                    doc.roundedRect(margin + 5, badgeY, 14, 14, 3, 3, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(10);
                    doc.setFont('helvetica', 'bold');
                    doc.text((idx + 1).toString(), margin + 12, badgeY + 9.5, { align: 'center' });

                    // Text - auf einer Baseline
                    doc.setTextColor(...colors.dark);
                    doc.setFontSize(9);
                    doc.setFont('helvetica', 'normal');
                    const textY = yPos + (boxHeight / 2) - ((tipLines.length - 1) * 2);
                    tipLines.forEach((line, lineIdx) => {
                        doc.text(line, margin + 25, textY + (lineIdx * 4));
                    });

                    yPos += boxHeight + 4;
                });

                yPos += 5;

                // Quick Win Box
                doc.setFillColor(236, 253, 245);
                doc.roundedRect(margin, yPos, contentWidth, 25, 4, 4, 'F');
                doc.setDrawColor(...colors.success);
                doc.setLineWidth(0.5);
                doc.roundedRect(margin, yPos, contentWidth, 25, 4, 4, 'D');

                doc.setTextColor(22, 101, 52);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text('>> QUICK WIN', margin + 8, yPos + 9);
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(8);
                const qwLines = doc.splitTextToSize('Starten Sie mit: ' + tips[0], contentWidth - 16);
                doc.text(qwLines, margin + 8, yPos + 17);
            });

            // ========== LETZTE SEITE: NEXT STEPS & CTA ==========
            doc.addPage();

            doc.setFillColor(...colors.primary);
            doc.rect(0, 0, pageWidth, 12, 'F');
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(8);
            doc.text('HR Digital Readiness Report  |  ' + name, pageWidth / 2, 8, { align: 'center' });

            yPos = 25;
            doc.setTextColor(...colors.dark);
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Nächste Schritte', margin, yPos);
            doc.setFillColor(...colors.accent);
            doc.roundedRect(margin, yPos + 3, 30, 2, 1, 1, 'F');

            yPos += 20;

            // Priority Actions
            const sortedDims = [...dimensions].sort((a, b) => a.score - b.score);
            doc.setFontSize(11);
            doc.setFont('helvetica', 'bold');
            doc.text('TOP 3 HANDLUNGSFELDER', margin, yPos);
            yPos += 10;

            sortedDims.slice(0, 3).forEach((dim, idx) => {
                const color = getScoreColor(dim.score);
                doc.setFillColor(...colors.light);
                doc.roundedRect(margin, yPos, contentWidth, 18, 3, 3, 'F');

                doc.setFillColor(...color);
                doc.roundedRect(margin + 4, yPos + 4, 10, 10, 2, 2, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(9);
                doc.setFont('helvetica', 'bold');
                doc.text((idx + 1).toString(), margin + 9, yPos + 11, { align: 'center' });

                doc.setTextColor(...colors.dark);
                doc.setFontSize(10);
                doc.text(dim.name, margin + 20, yPos + 10);
                doc.setTextColor(...color);
                doc.text(dim.score.toFixed(1) + '/5.0', pageWidth - margin - 8, yPos + 10, { align: 'right' });

                yPos += 22;
            });

            yPos += 15;

            // CTA Box
            doc.setFillColor(...colors.primary);
            doc.roundedRect(margin, yPos, contentWidth, 50, 6, 6, 'F');

            doc.setTextColor(255, 255, 255);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Kostenloses Strategiegespräch', pageWidth / 2, yPos + 18, { align: 'center' });
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text('Lassen Sie uns gemeinsam Ihre HR-Digitalisierung vorantreiben', pageWidth / 2, yPos + 30, { align: 'center' });
            doc.text('und konkrete Maßnahmen für Ihre Organisation definieren.', pageWidth / 2, yPos + 38, { align: 'center' });

            yPos += 65;

            // Contact Card mit Profilbild
            const cardHeight = 48;
            const imgSize = 38;
            doc.setFillColor(...colors.light);
            doc.roundedRect(margin, yPos, contentWidth, cardHeight, 5, 5, 'F');

            // Profilbild (bereits mit abgerundeten Ecken via Canvas)
            const imgX = margin + 6;
            const imgY = yPos + 5;
            
            if (profileImageData) {
                doc.addImage(profileImageData, 'PNG', imgX, imgY, imgSize, imgSize);
            } else {
                // Fallback: Platzhalter-Kreis
                doc.setFillColor(...colors.primary);
                doc.roundedRect(imgX, imgY, imgSize, imgSize, 6, 6, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('MW', imgX + imgSize/2, imgY + imgSize/2 + 5, { align: 'center' });
            }

            // Text rechts vom Bild - linksbündig
            const textX = imgX + imgSize + 12;
            doc.setTextColor(...colors.muted);
            doc.setFontSize(8);
            doc.text('IHR ANSPRECHPARTNER', textX, yPos + 10);
            doc.setTextColor(...colors.dark);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Manuel Weiss', textX, yPos + 20);
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text('mail@manuel-weiss.ch', textX, yPos + 28);
            doc.text('www.manuel-weiss.ch', textX, yPos + 35);
            doc.setTextColor(...colors.muted);
            doc.setFontSize(8);
            doc.text('HR Consultant & Digitalisierungsexperte', textX, yPos + 43);

            // Footer auf allen Seiten
            const totalPages = doc.internal.pages.length - 1;
            for (let i = 1; i <= totalPages; i++) {
                doc.setPage(i);
                doc.setFillColor(...colors.light);
                doc.rect(0, pageHeight - 15, pageWidth, 15, 'F');
                doc.setTextColor(...colors.muted);
                doc.setFontSize(7);
                doc.text('Seite ' + i + ' von ' + totalPages, margin, pageHeight - 6);
                doc.text('www.manuel-weiss.ch', pageWidth / 2, pageHeight - 6, { align: 'center' });
                doc.text('Vertraulich', pageWidth - margin, pageHeight - 6, { align: 'right' });
            }

            return doc;
        }

        // Lead Capture absenden und Download starten
        async function submitLeadAndDownload() {
            const name = document.getElementById('leadName').value.trim();
            const email = document.getElementById('leadEmail').value.trim();
            const wantsConsultation = document.getElementById('leadConsultation').checked;
            
            // Lead Modal schließen und Loading-Overlay zeigen
            document.getElementById('leadCaptureModal').classList.remove('active');
            showPdfLoading();
            
            // Scores berechnen
            const scores = calculateScores();
            
            // PDF generieren (vor dem Speichern, um Base64 zu bekommen)
            let pdfBase64 = null;
            let doc = null;
            try {
                updatePdfProgress(20, 'Daten werden analysiert...', 'Ihre Ergebnisse werden aufbereitet');
                await new Promise(r => setTimeout(r, 300));
                
                updatePdfProgress(40, 'PDF wird erstellt...', 'Layout und Design werden angewendet');
                doc = await generatePDFReport(name, email, scores);
                
                updatePdfProgress(70, 'PDF wird finalisiert...', 'Grafiken und Diagramme werden eingefügt');
                await new Promise(r => setTimeout(r, 200));
                
                // PDF als Base64 extrahieren
                pdfBase64 = doc.output('datauristring').split(',')[1];
                updatePdfProgress(85, 'Daten werden gespeichert...', 'Fast fertig');
            } catch (pdfError) {
                console.warn('PDF konnte nicht generiert werden:', pdfError);
                hidePdfLoading();
                alert('Fehler bei der PDF-Generierung: ' + pdfError.message);
                return;
            }
            
            // Prozess-Details aufbereiten (ohne zu große BPMN-XMLs für die Übersicht)
            const prozessDetails = {};
            for (const [processId, data] of Object.entries(assessmentData.prozesse || {})) {
                if (data) {
                    // Prozessname finden (Standard + Custom)
                    const processInfo = findProcessInfo(processId);
                    
                    prozessDetails[processId] = {
                        name: processInfo.processName,
                        category: processInfo.categoryName,
                        digiIst: data.digiIst,
                        digiSoll: data.digiSoll,
                        qualIst: data.qualIst,
                        qualSoll: data.qualSoll,
                        wichtigkeit: data.wichtigkeit,
                        description: data.description || '',
                        tools: data.tools || '',
                        notes: data.notes || '',
                        hasBpmn: !!data.bpmnXml,
                        bpmnXml: data.bpmnXml || null
                    };
                }
            }
            
            // Vollständige Lead-Daten
            const leadData = {
                name: name,
                email: email,
                wantsConsultation: wantsConsultation,
                scores: {
                    total: parseFloat(scores.total.toFixed(2)),
                    vision: parseFloat(scores.vision.toFixed(2)),
                    kultur: parseFloat(scores.kultur.toFixed(2)),
                    organisation: parseFloat(scores.organisation.toFixed(2)),
                    prozesse: parseFloat(scores.prozesse.toFixed(2))
                },
                // Alle Antworten speichern
                answers: {
                    vision: assessmentData.vision || {},
                    kultur: assessmentData.kultur || {},
                    organisation: assessmentData.organisation || {}
                },
                // Prozess-Details
                prozessDetails: prozessDetails,
                prozesseBewertet: Object.keys(assessmentData.prozesse || {}).length,
                prozesseGesamt: 32,
                // PDF als Base64
                pdfBase64: pdfBase64,
                timestamp: new Date().toISOString()
            };

            // Lead zentral in AWS S3 speichern (über API)
            const apiBaseUrl = window.AWS_API_URL || 'https://6i6ysj9c8c.execute-api.eu-central-1.amazonaws.com/v1';
            try {
                const response = await fetch(`${apiBaseUrl}/hr-leads/save`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(leadData)
                });
                const result = await response.json();
                if (result.success) {
                    console.log('✅ Lead in AWS gespeichert:', result.leadId);
                } else {
                    throw new Error(result.error || 'Speichern fehlgeschlagen');
                }
            } catch (e) {
                console.log('HR-Leads API Fehler, speichere lokal:', e);
                // Fallback: Lokal speichern (ohne PDF wegen Größe)
                const localLeadData = { ...leadData };
                delete localLeadData.pdfBase64; // Zu groß für localStorage
                delete localLeadData.prozessDetails; // Kompakte Version
                localLeadData.prozesseBewertet = Object.keys(assessmentData.prozesse || {}).length;
                
                let savedLeads = JSON.parse(localStorage.getItem('hrSelbsttestLeads') || '[]');
                savedLeads.unshift(localLeadData);
                if (savedLeads.length > 100) savedLeads = savedLeads.slice(0, 100);
                localStorage.setItem('hrSelbsttestLeads', JSON.stringify(savedLeads));
            }
            
            // PDF herunterladen
            try {
                updatePdfProgress(100, 'Download wird gestartet...', 'Ihr PDF ist bereit');
                await new Promise(r => setTimeout(r, 300));
                
                if (doc) {
                    doc.save(`HR-Digital-Readiness-Report-${name.replace(/\s+/g, '-')}-${new Date().toISOString().split('T')[0]}.pdf`);
                }
                
                // Loading ausblenden
                hidePdfLoading();
                
                // Danke-Nachricht
                alert('Vielen Dank! Ihr PDF-Report wurde erfolgreich generiert und heruntergeladen.' + (wantsConsultation ? '\n\nWir melden uns zeitnah für ein Beratungsgespräch bei Ihnen.' : ''));
            } catch (error) {
                console.error('PDF Export Fehler:', error);
                hidePdfLoading();
                alert('Fehler beim PDF-Export: ' + error.message + '\n\nBitte versuchen Sie es erneut oder kontaktieren Sie uns direkt.');
            }
        }
        
        // PDF Loading Overlay Funktionen
        function showPdfLoading() {
            document.getElementById('pdfLoadingOverlay').classList.add('active');
            document.getElementById('pdfProgressFill').style.width = '0%';
        }
        
        function hidePdfLoading() {
            document.getElementById('pdfLoadingOverlay').classList.remove('active');
        }
        
        function updatePdfProgress(percent, text, subtext) {
            document.getElementById('pdfProgressFill').style.width = percent + '%';
            if (text) document.getElementById('pdfLoadingText').textContent = text;
            if (subtext) document.getElementById('pdfLoadingSubtext').textContent = subtext;
        }
        
        // ═══════════════════════════════════════════════════════════════════════════
        // HR EMPFEHLUNGEN - Basierend auf Persönlichkeitsentwicklungs-Workflows
        // ═══════════════════════════════════════════════════════════════════════════
        
        const hrRecommendations = {
            vision: {
                title: 'Vision & Strategie',
                icon: 'fa-eye',
                subcategories: [
                    { id: 'hr_strategie', name: 'HR-Strategie', keys: ['vision-1', 'vision-2'] },
                    { id: 'digitalisierung', name: 'Digitalisierungsvision', keys: ['vision-3'] },
                    { id: 'zukunft', name: 'Zukunftsausrichtung', keys: ['vision-4'] }
                ],
                recommendations: {
                    low: [
                        { title: 'Strategische Zielklärung (OKR)', desc: 'Definieren Sie klare, messbare HR-Ziele mit dem OKR-Framework. Verknüpfen Sie HR-Initiativen direkt mit Unternehmenszielen.', icon: 'fa-bullseye', link: '/methods/goal-setting.html', linkText: 'Ziel-Setting Workflow' },
                        { title: 'Digital Roadmap erstellen', desc: 'Entwickeln Sie einen 3-Jahres-Digitalisierungsplan für HR. Priorisieren Sie Quick Wins und langfristige Transformationen.', icon: 'fa-road', link: null },
                        { title: 'Stakeholder-Analyse', desc: 'Identifizieren Sie Key-Player und deren Erwartungen. Bauen Sie Allianzen für Ihre HR-Transformation auf.', icon: 'fa-users', link: '/methods/swot-analysis.html', linkText: 'SWOT-Analyse' },
                        { title: 'Vision Workshop', desc: 'Entwickeln Sie gemeinsam mit dem Team eine inspirierende HR-Vision. Nutzen Sie kreative Methoden für Zukunftsbilder.', icon: 'fa-lightbulb', link: '/methods/vision-board.html', linkText: 'Vision Board Workflow' },
                        { title: 'Quick Wins identifizieren', desc: 'Definieren Sie 3-5 sofort umsetzbare Massnahmen mit hoher Sichtbarkeit und geringem Aufwand.', icon: 'fa-rocket', link: null }
                    ],
                    medium: [
                        { title: 'Strategie-Review', desc: 'Überprüfen Sie Ihre HR-Strategie auf Aktualität und Alignment mit Unternehmenszielen. Passen Sie Prioritäten an.', icon: 'fa-sync', link: null },
                        { title: 'KPI-Dashboard aufbauen', desc: 'Implementieren Sie ein HR-Analytics-Dashboard mit den wichtigsten Kennzahlen für strategische Entscheidungen.', icon: 'fa-chart-line', link: null },
                        { title: 'Change Roadmap', desc: 'Planen Sie Ihre Veränderungsinitiativen systematisch mit klaren Meilensteinen und Verantwortlichkeiten.', icon: 'fa-map', link: '/methods/change-stages.html', linkText: 'Change Stages Workflow' },
                        { title: 'Benchmark-Analyse', desc: 'Vergleichen Sie Ihre HR-Praktiken mit Best Practices der Branche und identifizieren Sie Verbesserungspotenziale.', icon: 'fa-balance-scale', link: null }
                    ],
                    high: [
                        { title: 'Innovation Lab', desc: 'Etablieren Sie einen Raum für HR-Innovationen. Testen Sie neue Technologien und Methoden in Pilotprojekten.', icon: 'fa-flask', link: null },
                        { title: 'Thought Leadership', desc: 'Positionieren Sie Ihr HR-Team als Vorreiter. Teilen Sie Erfolge und Learnings intern und extern.', icon: 'fa-award', link: null },
                        { title: 'Continuous Improvement', desc: 'Implementieren Sie einen systematischen Verbesserungsprozess mit regelmässigen Reviews und Anpassungen.', icon: 'fa-infinity', link: null }
                    ]
                }
            },
            kultur: {
                title: 'Kultur & Leadership',
                icon: 'fa-heart',
                subcategories: [
                    { id: 'leadership', name: 'Leadership & Führung', keys: ['kultur-leadership-1-ist', 'kultur-leadership-2-ist', 'kultur-leadership-3-ist'] },
                    { id: 'kommunikation', name: 'Kommunikation', keys: ['kultur-comm-1-ist', 'kultur-comm-2-ist', 'kultur-comm-3-ist'] },
                    { id: 'change', name: 'Change & Veränderung', keys: ['kultur-change-1-ist', 'kultur-change-2-ist', 'kultur-change-3-ist'] }
                ],
                recommendations: {
                    low: [
                        { title: 'Feedback-Kultur etablieren', desc: 'Führen Sie strukturiertes 360°-Feedback ein. Schaffen Sie psychologische Sicherheit für offene Kommunikation.', icon: 'fa-comments', link: '/methods/johari-window.html', linkText: 'Johari Window Workflow' },
                        { title: 'Change Champions benennen', desc: 'Identifizieren Sie Veränderungsbotschafter in allen Bereichen. Schulen Sie diese als Multiplikatoren.', icon: 'fa-user-tie', link: '/methods/change-stages.html', linkText: 'Change Stages Workflow' },
                        { title: 'Emotionale Intelligenz Training', desc: 'Entwickeln Sie EQ-Kompetenzen bei Führungskräften. Verbessern Sie Empathie und Selbstwahrnehmung.', icon: 'fa-brain', link: '/methods/emotional-intelligence.html', linkText: 'EQ Workflow' },
                        { title: 'Konfliktmanagement aufbauen', desc: 'Etablieren Sie klare Prozesse für Konfliktlösung. Schulen Sie Mediatoren und definieren Sie Eskalationsstufen.', icon: 'fa-handshake', link: '/methods/conflict-escalation.html', linkText: 'Konflikt-Workflow' },
                        { title: 'Werte-Alignment Workshop', desc: 'Verankern Sie Unternehmenswerte im Alltag. Übersetzen Sie abstrakte Werte in konkretes Verhalten.', icon: 'fa-gem', link: '/methods/values-clarification.html', linkText: 'Werte-Klärung' },
                        { title: 'Team-Retrospektiven einführen', desc: 'Implementieren Sie regelmässige Team-Reflexionen. Lernen Sie aus Erfolgen und Misserfolgen.', icon: 'fa-users-cog', link: null }
                    ],
                    medium: [
                        { title: 'Leadership Development', desc: 'Bauen Sie ein systematisches Führungskräfte-Entwicklungsprogramm auf. Kombinieren Sie Training, Coaching und Praxis.', icon: 'fa-graduation-cap', link: null },
                        { title: 'Engagement Survey', desc: 'Führen Sie regelmässige Mitarbeiterbefragungen durch. Leiten Sie konkrete Massnahmen aus den Ergebnissen ab.', icon: 'fa-poll', link: null },
                        { title: 'Lernkultur fördern', desc: 'Schaffen Sie Zeit und Raum für kontinuierliches Lernen. Etablieren Sie Wissensaustausch-Formate.', icon: 'fa-book-open', link: null },
                        { title: 'Agile Methoden einführen', desc: 'Pilotieren Sie agile Arbeitsweisen in HR. Nutzen Sie Sprints und Stand-ups für mehr Flexibilität.', icon: 'fa-sync-alt', link: null }
                    ],
                    high: [
                        { title: 'Culture Ambassadors', desc: 'Etablieren Sie ein Netzwerk von Kultur-Botschaftern. Stärken Sie die gelebte Unternehmenskultur.', icon: 'fa-star', link: null },
                        { title: 'Innovation Challenges', desc: 'Organisieren Sie regelmässige Innovationswettbewerbe. Fördern Sie kreatives Denken und Eigeninitiative.', icon: 'fa-lightbulb', link: null },
                        { title: 'Best Practice Sharing', desc: 'Teilen Sie Erfolgsgeschichten systematisch. Lernen Sie von den Besten im Unternehmen.', icon: 'fa-share-alt', link: null }
                    ]
                }
            },
            organisation: {
                title: 'Organisation & Struktur',
                icon: 'fa-sitemap',
                subcategories: [
                    { id: 'reaktiv', name: 'Reaktiv vs. Proaktiv', keys: ['org-reactive-ist'] },
                    { id: 'inhouse', name: 'Inhouse vs. Extern', keys: ['org-inhouse-ist'] },
                    { id: 'prozess', name: 'Prozess vs. Kunde', keys: ['org-process-ist'] },
                    { id: 'generalist', name: 'Generalist vs. Spezialist', keys: ['org-generalist-ist'] },
                    { id: 'gl', name: 'GL-Anbindung', keys: ['org-gl'] }
                ],
                recommendations: {
                    low: [
                        { title: 'RACI-Matrix erstellen', desc: 'Klären Sie Verantwortlichkeiten mit einer RACI-Matrix. Definieren Sie wer Responsible, Accountable, Consulted und Informed ist.', icon: 'fa-table', link: null },
                        { title: 'Prozesslandkarte entwickeln', desc: 'Visualisieren Sie alle HR-Prozesse in einer übersichtlichen Landkarte. Identifizieren Sie Schnittstellen und Abhängigkeiten.', icon: 'fa-project-diagram', link: '/bpmn-generator.html', linkText: 'BPMN Generator' },
                        { title: 'Skills-Matrix aufbauen', desc: 'Erfassen Sie systematisch die Kompetenzen Ihres HR-Teams. Identifizieren Sie Lücken und Entwicklungsbedarf.', icon: 'fa-th', link: '/methods/competence-map.html', linkText: 'Kompetenz-Map' },
                        { title: 'Ressourcen-Analyse', desc: 'Analysieren Sie Ihre HR-Kapazitäten. Planen Sie Ressourcen basierend auf strategischen Prioritäten.', icon: 'fa-chart-pie', link: '/methods/resource-analysis.html', linkText: 'Ressourcen-Analyse' },
                        { title: 'SWOT-Analyse HR', desc: 'Führen Sie eine ehrliche Stärken-Schwächen-Analyse Ihrer HR-Organisation durch.', icon: 'fa-chess', link: '/methods/swot-analysis.html', linkText: 'SWOT-Analyse' }
                    ],
                    medium: [
                        { title: 'Service Level Agreements', desc: 'Definieren Sie klare SLAs für HR-Services. Messen Sie Qualität und Reaktionszeiten.', icon: 'fa-file-contract', link: null },
                        { title: 'HR Operating Model', desc: 'Überprüfen Sie Ihr HR-Betriebsmodell. Optimieren Sie die Balance zwischen Shared Services, CoE und Business Partnering.', icon: 'fa-cogs', link: null },
                        { title: 'Wissensmanagement', desc: 'Bauen Sie ein HR-Wissensmanagement-System auf. Dokumentieren Sie Prozesse und Best Practices.', icon: 'fa-database', link: null },
                        { title: 'Governance Framework', desc: 'Etablieren Sie klare Governance-Strukturen für HR-Entscheidungen und Policies.', icon: 'fa-balance-scale', link: null }
                    ],
                    high: [
                        { title: 'Center of Excellence', desc: 'Bauen Sie spezialisierte Expertise-Center für strategische HR-Themen auf.', icon: 'fa-medal', link: null },
                        { title: 'Agile HR Organisation', desc: 'Transformieren Sie HR zu einer agilen Organisation mit cross-funktionalen Teams.', icon: 'fa-random', link: null },
                        { title: 'HR Tech Stack Review', desc: 'Optimieren Sie Ihre HR-Technologie-Landschaft für maximale Effizienz und Integration.', icon: 'fa-layer-group', link: null }
                    ]
                }
            },
            prozesse: {
                title: 'Prozesse & Digitalisierung',
                icon: 'fa-cogs',
                subcategories: [], // Dynamisch basierend auf bewerteten Prozessen
                recommendations: {
                    low: [
                        { title: 'Automatisierungspotenzial identifizieren', desc: 'Analysieren Sie repetitive HR-Aufgaben. Priorisieren Sie Prozesse mit hohem Automatisierungspotenzial.', icon: 'fa-robot', link: null },
                        { title: 'Workflow-Optimierung', desc: 'Nutzen Sie BPMN-Modellierung um Prozesse zu visualisieren und Ineffizienzen zu identifizieren.', icon: 'fa-project-diagram', link: '/bpmn-generator.html', linkText: 'BPMN Generator' },
                        { title: 'Tool-Evaluation', desc: 'Vergleichen Sie HR-Software-Lösungen systematisch. Erstellen Sie eine Anforderungsmatrix.', icon: 'fa-search', link: null },
                        { title: 'KPIs definieren', desc: 'Legen Sie messbare Prozess-KPIs fest. Etablieren Sie ein regelmässiges Monitoring.', icon: 'fa-tachometer-alt', link: null },
                        { title: 'Pilotprojekte starten', desc: 'Wählen Sie 2-3 Prozesse für Digitalisierungs-Piloten. Lernen Sie aus ersten Erfahrungen.', icon: 'fa-flask', link: null }
                    ],
                    medium: [
                        { title: 'End-to-End Digitalisierung', desc: 'Digitalisieren Sie komplette Prozessketten. Eliminieren Sie Medienbrüche.', icon: 'fa-link', link: null },
                        { title: 'Self-Service Portal', desc: 'Implementieren Sie ein Mitarbeiter-Self-Service-Portal für häufige HR-Anfragen.', icon: 'fa-user-cog', link: null },
                        { title: 'Prozess-Monitoring', desc: 'Etablieren Sie ein Dashboard zur Überwachung von Prozess-Performance und SLAs.', icon: 'fa-tv', link: null },
                        { title: 'Integration optimieren', desc: 'Verbessern Sie die Integration zwischen HR-Systemen. Reduzieren Sie manuelle Dateneingaben.', icon: 'fa-plug', link: null }
                    ],
                    high: [
                        { title: 'Predictive Analytics', desc: 'Nutzen Sie KI für vorausschauende HR-Analysen. Antizipieren Sie Trends und Risiken.', icon: 'fa-brain', link: null },
                        { title: 'Process Mining', desc: 'Analysieren Sie tatsächliche Prozessabläufe mit Process Mining. Identifizieren Sie Optimierungspotenziale.', icon: 'fa-search-plus', link: null },
                        { title: 'Continuous Automation', desc: 'Etablieren Sie einen kontinuierlichen Automatisierungsprozess. Nutzen Sie RPA für weitere Effizienzgewinne.', icon: 'fa-infinity', link: null }
                    ]
                }
            }
        };
        
        // Aktive Kategorie für Inline-Detail
        let activeCategory = null;
        
        // Kategorie auswählen und Inline-Detail anzeigen
        function selectCategory(category) {
            const config = hrRecommendations[category];
            if (!config) return;
            
            const score = window.categoryScores ? window.categoryScores[category] : 0;
            
            // Alte Kachel deaktivieren
            if (activeCategory) {
                const oldCard = document.getElementById('card-' + activeCategory);
                if (oldCard) oldCard.classList.remove('active');
            }
            
            // Neue Kachel aktivieren
            activeCategory = category;
            const newCard = document.getElementById('card-' + category);
            if (newCard) newCard.classList.add('active');
            
            // Workflow-Dashboard nur bei Prozesse anzeigen
            const workflowDashboard = document.getElementById('workflowDashboard');
            if (workflowDashboard) {
                workflowDashboard.style.display = category === 'prozesse' ? 'block' : 'none';
            }
            
            // Inline-Detail Container befüllen
            const container = document.getElementById('categoryDetailInline');
            if (!container) return;
            
            // Score-Farbe bestimmen
            const scoreColor = score >= 70 ? '#10b981' : score >= 40 ? '#fbbf24' : '#ef4444';
            
            container.innerHTML = `
                <div class="detail-header">
                    <div class="detail-header-icon">
                        <i class="fas ${config.icon}"></i>
                    </div>
                    <div>
                        <div class="detail-header-title">${config.title}</div>
                        <div class="detail-header-subtitle">${getCategorySubtitle(category)}</div>
                    </div>
                    <div class="detail-header-score" style="color: ${scoreColor}">${score}%</div>
                </div>
                <div class="detail-section">
                    ${generateSubcategoryScores(category, config)}
                </div>
                <div class="detail-section">
                    ${generateCategoryRecommendations(category, score, config)}
                </div>
            `;
            
            container.classList.add('active');
        }
        
        // Untertitel für Kategorien
        function getCategorySubtitle(category) {
            const subtitles = {
                vision: 'Strategie & Ausrichtung',
                kultur: 'Leadership & Change',
                organisation: 'HR-Struktur',
                prozesse: 'Digitalisierungsgrad'
            };
            return subtitles[category] || '';
        }
        
        // Legacy-Funktion für Kompatibilität (leitet auf selectCategory um)
        function showCategoryDetail(category, score) {
            if (window.categoryScores) {
                window.categoryScores[category] = score;
            }
            selectCategory(category);
        }
        
        function closeCategoryDetail() {
            // Nicht mehr benötigt für Inline-Ansicht, aber für Kompatibilität behalten
            const container = document.getElementById('categoryDetailInline');
            if (container) container.classList.remove('active');
            
            if (activeCategory) {
                const card = document.getElementById('card-' + activeCategory);
                if (card) card.classList.remove('active');
                activeCategory = null;
            }
        }
        
        // Unterkategorie-Scores berechnen
        function generateSubcategoryScores(category, config) {
            let html = '<h3><i class="fas fa-chart-bar"></i> Unterbereiche</h3>';
            
            if (category === 'prozesse') {
                // Dynamische Prozess-Kategorien (Standard + Custom)
                const processCategories = {};
                for (const [processId, data] of Object.entries(assessmentData.prozesse || {})) {
                    if (data) {
                        const processInfo = findProcessInfo(processId);
                        const categoryName = processInfo.categoryName || 'Sonstige';
                        
                        if (!processCategories[categoryName]) {
                            processCategories[categoryName] = { scores: [], count: 0 };
                        }
                        const avgScore = ((data.digiIst || 0) + (data.qualIst || 0)) / 2;
                        processCategories[categoryName].scores.push(avgScore);
                        processCategories[categoryName].count++;
                    }
                }
                
                for (const [catName, catData] of Object.entries(processCategories)) {
                    const avgScore = catData.scores.reduce((a, b) => a + b, 0) / catData.scores.length;
                    const percent = Math.round((avgScore / 5) * 100);
                    html += generateSubcategoryItem(catName, percent, catData.count + ' Prozesse bewertet');
                }
                
                if (Object.keys(processCategories).length === 0) {
                    html += '<p style="color: #a5b4fc; font-style: italic;">Noch keine Prozesse bewertet. Bewerten Sie Prozesse im Prozesse-Tab für detaillierte Auswertungen.</p>';
                }
            } else {
                // Statische Kategorien (Vision, Kultur, Organisation)
                const data = assessmentData[category] || {};
                
                for (const subcat of config.subcategories) {
                    let scores = [];
                    // Verwende die definierten Keys direkt
                    for (const key of (subcat.keys || [])) {
                        const value = data[key];
                        if (typeof value === 'number') {
                            scores.push(value);
                        }
                    }
                    
                    if (scores.length > 0) {
                        const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
                        const percent = Math.round((avgScore / 5) * 100);
                        html += generateSubcategoryItem(subcat.name, percent, scores.length + ' von ' + subcat.keys.length + ' bewertet');
                    } else {
                        html += generateSubcategoryItem(subcat.name, 0, 'Noch nicht bewertet');
                    }
                }
            }
            
            return html;
        }
        
        function generateSubcategoryItem(name, percent, subtitle = null) {
            const colorClass = percent >= 70 ? '#10b981' : percent >= 40 ? '#fbbf24' : '#ef4444';
            return `
                <div class="subcategory-item">
                    <div class="subcategory-header">
                        <span class="subcategory-name">${escapeHtml(name)}</span>
                        <span class="subcategory-score" style="color: ${colorClass}">${percent}%</span>
                    </div>
                    ${subtitle ? `<div style="font-size: 0.8rem; color: #a5b4fc; margin-bottom: 0.5rem;">${escapeHtml(subtitle)}</div>` : ''}
                    <div class="subcategory-bar">
                        <div class="subcategory-fill" style="width: ${percent}%; background: ${colorClass};"></div>
                    </div>
                </div>
            `;
        }
        
        // Empfehlungen basierend auf Score generieren
        function generateCategoryRecommendations(category, score, config) {
            let html = '<h3><i class="fas fa-lightbulb"></i> Empfohlene Massnahmen</h3>';
            
            // Score-Level bestimmen
            let level = 'low';
            if (score >= 70) level = 'high';
            else if (score >= 40) level = 'medium';
            
            const recommendations = config.recommendations[level] || [];
            
            if (recommendations.length === 0) {
                html += '<p style="color: #a5b4fc;">Keine spezifischen Empfehlungen für diesen Score-Bereich.</p>';
                return html;
            }
            
            recommendations.forEach((rec, idx) => {
                html += `
                    <div class="recommendation-item">
                        <div class="recommendation-item-header">
                            <div class="recommendation-icon">
                                <i class="fas ${rec.icon}"></i>
                            </div>
                            <div>
                                <div class="recommendation-item-title">${escapeHtml(rec.title)}</div>
                                <div class="recommendation-item-desc">${escapeHtml(rec.desc)}</div>
                            </div>
                        </div>
                        ${rec.link ? `
                        <div class="recommendation-actions">
                            <a href="${rec.link}" class="recommendation-btn primary" target="_blank">
                                <i class="fas fa-play"></i> ${rec.linkText || 'Workflow starten'}
                            </a>
                            <button class="recommendation-btn secondary" onclick="alert('Detaillierte Anleitung wird in Kürze verfügbar sein.')">
                                <i class="fas fa-info-circle"></i> Mehr erfahren
                            </button>
                        </div>
                        ` : ''}
                    </div>
                `;
            });
            
            // Quick Win Hinweis
            if (level === 'low' && recommendations.length > 0) {
                html += `
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 12px; padding: 1rem; margin-top: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.75rem; color: #10b981; font-weight: 600; margin-bottom: 0.5rem;">
                            <i class="fas fa-rocket"></i> Quick Win Empfehlung
                        </div>
                        <p style="color: #a5b4fc; margin: 0; font-size: 0.9rem;">
                            Starten Sie mit "<strong>${escapeHtml(recommendations[0].title)}</strong>" - diese Massnahme bietet schnelle Erfolge bei überschaubarem Aufwand.
                        </p>
                    </div>
                `;
            }
            
            return html;
        }

        // Scores berechnen
        function calculateScores() {
            const calcAvg = (obj) => {
                const values = Object.values(obj).filter(v => typeof v === 'number');
                return values.length ? values.reduce((a, b) => a + b, 0) / values.length : 0;
            };
            
            const vision = calcAvg(assessmentData.vision);
            const kultur = calcAvg(assessmentData.kultur);
            const organisation = calcAvg(assessmentData.organisation);
            const prozesse = Object.values(assessmentData.prozesse).reduce((sum, p) => {
                if (p && p.digiIst) sum += (p.digiIst + (p.qualIst || 3)) / 2;
                return sum;
            }, 0) / Math.max(Object.keys(assessmentData.prozesse).length, 1);
            
            return {
                vision,
                kultur,
                organisation,
                prozesse: prozesse || 0,
                total: (vision + kultur + organisation + (prozesse || 0)) / 4
            };
        }
        
        // Modal schließen
        function closeLeadModal() {
            document.getElementById('leadCaptureModal').classList.remove('active');
        }

        // Initialize
        // Admin: Leads anzeigen (Ctrl+Shift+L)
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'L') {
                showLeadsAdmin();
            }
        });

        function showLeadsAdmin() {
            const leads = JSON.parse(localStorage.getItem('hrSelbsttestLeads') || '[]');
            if (leads.length === 0) {
                alert('Keine Leads vorhanden.');
                return;
            }
            
            // Modal für Leads erstellen
            const modal = document.createElement('div');
            modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:99999;overflow:auto;padding:2rem;';
            
            let html = `
                <div style="max-width:900px;margin:0 auto;background:#1e293b;border-radius:16px;padding:2rem;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem;">
                        <h2 style="color:#10b981;margin:0;">📊 HR-Selbsttest Leads (${leads.length})</h2>
                        <button onclick="this.closest('div').parentElement.remove()" style="background:#ef4444;color:white;border:none;padding:0.5rem 1rem;border-radius:8px;cursor:pointer;">Schließen</button>
                    </div>
                    <button onclick="navigator.clipboard.writeText(JSON.stringify(JSON.parse(localStorage.getItem('hrSelbsttestLeads')||'[]'),null,2));alert('Leads kopiert!')" style="background:#6366f1;color:white;border:none;padding:0.5rem 1rem;border-radius:8px;cursor:pointer;margin-bottom:1rem;">📋 Alle als JSON kopieren</button>
                    <button onclick="if(confirm('Alle Leads löschen?')){localStorage.removeItem('hrSelbsttestLeads');this.closest('div').parentElement.remove();}" style="background:#ef4444;color:white;border:none;padding:0.5rem 1rem;border-radius:8px;cursor:pointer;margin-left:0.5rem;margin-bottom:1rem;">🗑️ Alle löschen</button>
                    <div style="overflow-x:auto;">
                        <table style="width:100%;border-collapse:collapse;font-size:0.9rem;">
                            <thead>
                                <tr style="background:#334155;">
                                    <th style="padding:0.75rem;text-align:left;color:#10b981;">Datum</th>
                                    <th style="padding:0.75rem;text-align:left;color:#10b981;">Name</th>
                                    <th style="padding:0.75rem;text-align:left;color:#10b981;">E-Mail</th>
                                    <th style="padding:0.75rem;text-align:center;color:#10b981;">Beratung?</th>
                                    <th style="padding:0.75rem;text-align:center;color:#10b981;">Score</th>
                                    <th style="padding:0.75rem;text-align:center;color:#10b981;">Prozesse</th>
                                </tr>
                            </thead>
                            <tbody>
            `;
            
            leads.forEach((lead, i) => {
                const date = new Date(lead.timestamp).toLocaleString('de-CH');
                const scoreColor = lead.scores.total >= 3.5 ? '#10b981' : lead.scores.total >= 2 ? '#f59e0b' : '#ef4444';
                html += `
                    <tr style="border-bottom:1px solid #475569;${i%2?'background:#1e293b':'background:#0f172a'}">
                        <td style="padding:0.75rem;color:#94a3b8;">${date}</td>
                        <td style="padding:0.75rem;color:#fff;font-weight:600;">${lead.name}</td>
                        <td style="padding:0.75rem;"><a href="mailto:${lead.email}" style="color:#60a5fa;">${lead.email}</a></td>
                        <td style="padding:0.75rem;text-align:center;">${lead.wantsConsultation ? '✅' : '❌'}</td>
                        <td style="padding:0.75rem;text-align:center;color:${scoreColor};font-weight:700;">${lead.scores.total}/5</td>
                        <td style="padding:0.75rem;text-align:center;color:#94a3b8;">${lead.prozesseBewertet}/${lead.prozesseGesamt}</td>
                    </tr>
                `;
            });
            
            html += '</tbody></table></div></div>';
            modal.innerHTML = html;
            document.body.appendChild(modal);
        }

        // ========================================
        // BPMN Workflow Generation Functions
        // ========================================
        
        let bpmnViewer = null;
        let currentWorkflowProcessId = null;
        
        // Update workflow link visibility based on description input
        function updateWorkflowLinkVisibility() {
            const description = document.getElementById('modalProcessDescription')?.value?.trim();
            const link = document.getElementById('workflowGenerateLink');
            if (link) {
                if (description && description.length > 10) {
                    link.classList.remove('disabled');
                } else {
                    link.classList.add('disabled');
                }
            }
        }
        
        // Get API URL for BPMN generation
        function getBpmnApiUrl() {
            return (window.getApiUrl && window.getApiUrl('TEXT_TO_BPMN_GPT')) ||
                (window.AWS_APP_CONFIG && window.AWS_APP_CONFIG.API_BASE ? window.AWS_APP_CONFIG.API_BASE + '/text-to-bpmn-gpt' : '');
        }
        
        // Get OpenAI API Key from admin settings
        async function getOpenAIApiKey() {
            if (window.awsAPISettings && typeof window.awsAPISettings.getFullApiKey === 'function') {
                try {
                    const key = await window.awsAPISettings.getFullApiKey('openai');
                    if (key && typeof key === 'string' && key.length > 10) return key;
                } catch (e) {
                    console.warn('OpenAI-Key nicht geladen:', e);
                }
            }
            return '';
        }
        
        // Generate workflow from process description
        async function generateWorkflow(processId) {
            const description = document.getElementById('modalProcessDescription')?.value?.trim();
            if (!description || description.length < 10) {
                showWorkflowError('Bitte geben Sie zuerst eine Kurzbeschreibung ein.');
                return;
            }
            
            currentWorkflowProcessId = processId;
            
            // Show loading state
            document.getElementById('workflowGenerateLink').style.display = 'none';
            document.getElementById('workflowLoading').style.display = 'flex';
            document.getElementById('workflowError').style.display = 'none';
            
            // Clear the viewer canvas but keep container visible for smooth transition
            const viewerCanvas = document.getElementById('bpmnViewerCanvas');
            if (viewerCanvas) viewerCanvas.innerHTML = '';
            
            try {
                const apiKey = await getOpenAIApiKey();
                const apiUrl = getBpmnApiUrl();
                
                if (!apiUrl) {
                    throw new Error('API-URL ist nicht konfiguriert.');
                }
                
                if (!apiKey) {
                    throw new Error('OpenAI API-Key nicht konfiguriert. Bitte im Admin-Panel unter API Keys hinterlegen.');
                }
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        text: description,
                        openaiApiKey: apiKey,
                        processId: processId
                    })
                });
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.error || response.statusText || 'Unbekannter Fehler');
                }
                
                if (!data.success || !data.bpmnXml) {
                    throw new Error(data.error || 'Kein gültiges BPMN-XML erhalten.');
                }
                
                // Store BPMN XML AND description in assessment data
                if (!assessmentData.prozesse[processId]) {
                    assessmentData.prozesse[processId] = {};
                }
                assessmentData.prozesse[processId].bpmnXml = data.bpmnXml;
                // Speichere auch die Beschreibung, die für den Workflow verwendet wurde
                assessmentData.prozesse[processId].description = description;
                saveData();
                
                // Hide loading before showing viewer
                document.getElementById('workflowLoading').style.display = 'none';
                
                // Show the viewer container first to ensure it has dimensions
                document.getElementById('bpmnViewerContainer').classList.add('active');
                
                // Wait for CSS transition and container to be visible
                await new Promise(resolve => setTimeout(resolve, 150));
                
                // Now initialize the viewer
                await initBpmnViewer(data.bpmnXml);
                
            } catch (error) {
                console.error('Workflow generation error:', error);
                showWorkflowError(error.message);
                document.getElementById('workflowLoading').style.display = 'none';
            } finally {
                document.getElementById('workflowGenerateLink').style.display = 'flex';
            }
        }
        
        // Initialize BPMN viewer with XML
        async function initBpmnViewer(xml) {
            const container = document.getElementById('bpmnViewerCanvas');
            const viewerContainer = document.getElementById('bpmnViewerContainer');
            if (!container) return;
            
            // Hide error message
            const errorEl = document.getElementById('workflowError');
            if (errorEl) errorEl.style.display = 'none';
            
            // Clear previous viewer
            container.innerHTML = '';
            
            // Make sure container is visible before rendering
            if (viewerContainer) {
                viewerContainer.classList.add('active');
            }
            
            // Wait for container to be visible and have dimensions
            await new Promise(resolve => setTimeout(resolve, 100));
            
            // Create new viewer with zoom enabled
            bpmnViewer = new BpmnJS({
                container: container,
                // Aktiviere Zoom-Scroll Modul
                zoomScroll: {
                    enabled: true
                },
                // Aktiviere Move-Canvas für Drag
                moveCanvas: {
                    enabled: true
                }
            });
            
            try {
                await bpmnViewer.importXML(xml);
                
                // Wait a bit more for the diagram to be fully rendered
                await new Promise(resolve => setTimeout(resolve, 50));
                
                // Fit to viewport with error handling
                const canvas = bpmnViewer.get('canvas');
                
                // Reset zoom level for new diagram
                currentZoomLevel = 1;
                
                // Setup reactive interaction (drag & zoom)
                setupBpmnInteraction(container);
                
                // Check if container has valid dimensions
                const rect = container.getBoundingClientRect();
                if (rect.width > 0 && rect.height > 0) {
                    try {
                        canvas.zoom('fit-viewport');
                        currentZoomLevel = canvas.zoom();
                    } catch (zoomErr) {
                        console.warn('Zoom error, using fallback:', zoomErr);
                        canvas.zoom(0.8);
                        currentZoomLevel = 0.8;
                    }
                } else {
                    // Container not visible yet, retry after a delay
                    setTimeout(() => {
                        try {
                            const newRect = container.getBoundingClientRect();
                            if (newRect.width > 0 && newRect.height > 0) {
                                canvas.zoom('fit-viewport');
                            } else {
                                canvas.zoom(0.8);
                            }
                        } catch (e) {
                            console.warn('Delayed zoom failed:', e);
                        }
                    }, 300);
                }
            } catch (err) {
                console.error('BPMN import error:', err);
                showWorkflowError('Diagramm konnte nicht geladen werden: ' + (err.message || err));
            }
        }
        
        // Show workflow error message
        function showWorkflowError(message) {
            const errorEl = document.getElementById('workflowError');
            if (errorEl) {
                errorEl.innerHTML = '<i class="fas fa-exclamation-circle"></i> ' + message;
                errorEl.style.display = 'flex';
            }
        }
        
        // BPMN Zoom and Pan Functions
        let currentZoomLevel = 1;
        
        function bpmnZoom(action) {
            if (!bpmnViewer) return;
            
            try {
                const canvas = bpmnViewer.get('canvas');
                
                switch(action) {
                    case 'in':
                        currentZoomLevel = Math.min(currentZoomLevel * 1.2, 4);
                        canvas.zoom(currentZoomLevel);
                        break;
                    case 'out':
                        currentZoomLevel = Math.max(currentZoomLevel / 1.2, 0.2);
                        canvas.zoom(currentZoomLevel);
                        break;
                    case 'fit':
                        canvas.zoom('fit-viewport');
                        currentZoomLevel = canvas.zoom();
                        break;
                    case 'reset':
                        currentZoomLevel = 1;
                        canvas.zoom(1);
                        canvas.scroll({ dx: 0, dy: 0 });
                        break;
                }
            } catch (e) {
                console.warn('Zoom error:', e);
            }
        }
        
        // Reaktive BPMN-Interaktion: Shift+Mausrad Zoom mit zoomScroll.stepZoom()
        function setupBpmnInteraction(containerElement) {
            if (!containerElement || !bpmnViewer) return;
            
            // Shift+Mausrad zum Zoomen - nutzt das eingebaute zoomScroll Modul
            containerElement.addEventListener('wheel', function(e) {
                // Nur mit Shift-Taste (Ctrl wird von bpmn-js selbst behandelt)
                if (!e.shiftKey) return;
                if (!bpmnViewer) return;
                
                e.preventDefault();
                e.stopPropagation();
                
                try {
                    // Nutze das eingebaute zoomScroll Modul mit stepZoom()
                    const zoomScroll = bpmnViewer.get('zoomScroll');
                    if (!zoomScroll) {
                        console.warn('zoomScroll module not available');
                        return;
                    }
                    // deltaY < 0 = Mausrad nach oben = reinzoomen = stepZoom(1)
                    // deltaY > 0 = Mausrad nach unten = rauszoomen = stepZoom(-1)
                    const delta = e.deltaY < 0 ? 1 : -1;
                    zoomScroll.stepZoom(delta);
                    
                    // Update currentZoomLevel für Konsistenz
                    const canvas = bpmnViewer.get('canvas');
                    currentZoomLevel = canvas.zoom();
                } catch (err) {
                    console.warn('Zoom error:', err);
                }
            }, { passive: false, capture: true });
            
            // Touch-Support für Mobile (Pinch-Zoom)
            let initialDistance = 0;
            let lastTouchX = 0;
            let lastTouchY = 0;
            let lastPinchTime = 0;
            
            containerElement.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    lastTouchX = e.touches[0].clientX;
                    lastTouchY = e.touches[0].clientY;
                } else if (e.touches.length === 2) {
                    initialDistance = Math.hypot(
                        e.touches[0].clientX - e.touches[1].clientX,
                        e.touches[0].clientY - e.touches[1].clientY
                    );
                    lastPinchTime = Date.now();
                }
            }, { passive: true });
            
            containerElement.addEventListener('touchmove', (e) => {
                if (!bpmnViewer) return;
                
                try {
                    const canvas = bpmnViewer.get('canvas');
                    
                    if (e.touches.length === 1) {
                        // Pan mit einem Finger
                        const dx = e.touches[0].clientX - lastTouchX;
                        const dy = e.touches[0].clientY - lastTouchY;
                        lastTouchX = e.touches[0].clientX;
                        lastTouchY = e.touches[0].clientY;
                        canvas.scroll({ dx: dx, dy: dy });
                        e.preventDefault();
                    } else if (e.touches.length === 2 && initialDistance > 0) {
                        // Pinch zoom mit zwei Fingern
                        const newDistance = Math.hypot(
                            e.touches[0].clientX - e.touches[1].clientX,
                            e.touches[0].clientY - e.touches[1].clientY
                        );
                        const scale = newDistance / initialDistance;
                        
                        // Throttle: Maximal alle 100ms zoomen
                        const now = Date.now();
                        if (now - lastPinchTime < 100) {
                            e.preventDefault();
                            return;
                        }
                        
                        // Prüfe aktuelle Zoom-Stufe und verhindere zu extremes Zoomen
                        const currentZoom = canvas.zoom();
                        const minZoom = 0.2;
                        const maxZoom = 4;
                        
                        if (scale > 1.08 && currentZoom < maxZoom) {
                            // Reinzoomen - aber nur wenn nicht schon max
                            const zoomScroll = bpmnViewer.get('zoomScroll');
                            zoomScroll.stepZoom(1);
                            initialDistance = newDistance;
                            lastPinchTime = now;
                            currentZoomLevel = canvas.zoom();
                        } else if (scale < 0.92 && currentZoom > minZoom) {
                            // Rauszoomen - aber nur wenn nicht schon min
                            const zoomScroll = bpmnViewer.get('zoomScroll');
                            zoomScroll.stepZoom(-1);
                            initialDistance = newDistance;
                            lastPinchTime = now;
                            currentZoomLevel = canvas.zoom();
                        }
                        e.preventDefault();
                    }
                } catch (err) {
                    console.warn('Touch zoom error:', err);
                }
            }, { passive: false });
        }
        
        // Render Workflow Dashboard in Results Section
        function renderWorkflowDashboard() {
            const dashboard = document.getElementById('workflowDashboard');
            const cardsContainer = document.getElementById('workflowCards');
            
            if (!dashboard || !cardsContainer) return;
            
            // Find all processes with BPMN workflows
            const workflowProcesses = [];
            const prozesse = assessmentData.prozesse || {};
            
            for (const [processId, data] of Object.entries(prozesse)) {
                if (data && data.bpmnXml) {
                    // Find process name (Standard + Custom)
                    const processInfo = findProcessInfo(processId);
                    
                    workflowProcesses.push({
                        id: processId,
                        name: processInfo.processName,
                        category: processInfo.categoryName,
                        description: data.description || '',
                        bpmnXml: data.bpmnXml
                    });
                }
            }
            
            // Hide dashboard if no workflows
            if (workflowProcesses.length === 0) {
                dashboard.style.display = 'none';
                return;
            }
            
            dashboard.style.display = 'block';
            
            // Generate cards HTML
            cardsContainer.innerHTML = workflowProcesses.map(proc => `
                <div class="workflow-card" data-process-id="${proc.id}">
                    <div class="workflow-card-preview">
                        <div class="bpmn-preview" id="preview-${proc.id}"></div>
                    </div>
                    <div class="workflow-card-body">
                        <h4 class="workflow-card-title">
                            <i class="fas fa-sitemap"></i>
                            ${escapeHtml(proc.name)}
                        </h4>
                        <p class="workflow-card-desc">
                            ${proc.description ? escapeHtml(proc.description) : '<em>Automatisch generierter Workflow basierend auf Ihrer Prozessbeschreibung</em>'}
                        </p>
                        <div class="workflow-card-meta">
                            <span class="workflow-card-badge">
                                <i class="fas fa-folder"></i> ${escapeHtml(proc.category)}
                            </span>
                            <div class="workflow-card-actions">
                                <button class="workflow-card-btn secondary" onclick="downloadBpmnFromDashboard('${proc.id}')" title="BPMN herunterladen">
                                    <i class="fas fa-download"></i>
                                </button>
                                <button class="workflow-card-btn primary" onclick="openWorkflowDetail('${proc.id}')" title="Details anzeigen">
                                    <i class="fas fa-expand"></i> Öffnen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Render BPMN previews
            setTimeout(() => {
                workflowProcesses.forEach(proc => {
                    renderBpmnPreview(proc.id, proc.bpmnXml);
                });
            }, 100);
        }
        
        // Render BPMN preview in a card
        async function renderBpmnPreview(processId, bpmnXml) {
            const container = document.getElementById(`preview-${processId}`);
            if (!container) return;
            
            // Show loading state first
            container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #64748b; font-size: 0.85rem;"><i class="fas fa-spinner fa-spin" style="margin-right: 0.5rem;"></i> Lade Vorschau...</div>';
            
            if (!bpmnXml) {
                container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #94a3b8; font-size: 0.85rem;"><i class="fas fa-project-diagram" style="margin-right: 0.5rem; opacity: 0.5;"></i> Vorschau nicht verfügbar</div>';
                return;
            }
            
            try {
                // Clear container and create fresh div for viewer
                container.innerHTML = '';
                
                const viewer = new BpmnJS({
                    container: container
                });
                
                await viewer.importXML(bpmnXml);
                
                const canvas = viewer.get('canvas');
                canvas.zoom('fit-viewport');
                
                // Add subtle styling to preview
                container.style.background = 'linear-gradient(145deg, #ffffff, #f8fafc)';
            } catch (err) {
                console.warn('Could not render preview for', processId, err);
                container.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #94a3b8; font-size: 0.85rem;"><i class="fas fa-exclamation-circle" style="margin-right: 0.5rem;"></i> Vorschau nicht verfügbar</div>';
            }
        }
        
        // Download BPMN from dashboard
        function downloadBpmnFromDashboard(processId) {
            const data = assessmentData.prozesse[processId];
            if (!data || !data.bpmnXml) {
                alert('Kein Workflow vorhanden.');
                return;
            }
            
            // Find process name (Standard + Custom)
            const processInfo = findProcessInfo(processId);
            const processName = processInfo.processName.replace(/[^a-zA-Z0-9äöüÄÖÜß]/g, '-');
            
            const blob = new Blob([data.bpmnXml], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workflow-${processName}.bpmn`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Open workflow detail modal
        function openWorkflowDetail(processId) {
            // Open the process modal to show the workflow
            openProcessModal(processId);
        }
        
        // Download BPMN file
        function downloadBpmn(processId) {
            const data = assessmentData.prozesse[processId];
            if (!data || !data.bpmnXml) {
                alert('Kein Workflow vorhanden.');
                return;
            }
            
            const blob = new Blob([data.bpmnXml], { type: 'application/xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `workflow-${processId}-${Date.now()}.bpmn`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Convert BPMN XML to PNG image (base64)
        async function bpmnToImage(bpmnXml) {
            // Timeout wrapper to prevent hanging
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error('BPMN rendering timeout')), 10000);
            });
            
            const renderPromise = new Promise(async (resolve, reject) => {
                let tempContainer = null;
                let viewer = null;
                
                try {
                    // Create temporary container - smaller for mobile
                    const isMobile = window.innerWidth < 768;
                    const containerWidth = isMobile ? 800 : 1200;
                    const containerHeight = isMobile ? 400 : 600;
                    
                    tempContainer = document.createElement('div');
                    tempContainer.style.cssText = `position: absolute; left: -9999px; top: -9999px; width: ${containerWidth}px; height: ${containerHeight}px;`;
                    document.body.appendChild(tempContainer);
                    
                    // Create viewer
                    viewer = new BpmnJS({ container: tempContainer });
                    
                    await viewer.importXML(bpmnXml);
                    
                    // Fit to viewport to get proper bounds
                    const canvas = viewer.get('canvas');
                    canvas.zoom('fit-viewport');
                    
                    // Get SVG with viewBox for proper scaling
                    const { svg } = await viewer.saveSVG();
                    
                    // Parse SVG to get dimensions
                    const parser = new DOMParser();
                    const svgDoc = parser.parseFromString(svg, 'image/svg+xml');
                    const svgEl = svgDoc.documentElement;
                    
                    // Get viewBox or width/height
                    let svgWidth = 800;
                    let svgHeight = 400;
                    const viewBox = svgEl.getAttribute('viewBox');
                    if (viewBox) {
                        const parts = viewBox.split(' ').map(Number);
                        if (parts.length === 4) {
                            svgWidth = parts[2];
                            svgHeight = parts[3];
                        }
                    }
                    
                    // Scale factor for quality (reduced for mobile compatibility)
                    const scale = isMobile ? 1 : 1.5;
                    const maxWidth = isMobile ? 1200 : 2000;
                    const maxHeight = isMobile ? 800 : 1200;
                    const outputWidth = Math.min(Math.max(svgWidth * scale, 800), maxWidth);
                    const outputHeight = Math.min(Math.max(svgHeight * scale, 400), maxHeight);
                    
                    // Set explicit dimensions on SVG for proper rendering
                    svgEl.setAttribute('width', outputWidth);
                    svgEl.setAttribute('height', outputHeight);
                    
                    const modifiedSvg = new XMLSerializer().serializeToString(svgDoc);
                    
                    // Convert SVG to PNG via canvas
                    const imgCanvas = document.createElement('canvas');
                    const ctx = imgCanvas.getContext('2d');
                    const img = new Image();
                    
                    img.onload = () => {
                        // Set canvas size to match image
                        imgCanvas.width = img.width;
                        imgCanvas.height = img.height;
                        
                        // White background
                        ctx.fillStyle = '#ffffff';
                        ctx.fillRect(0, 0, imgCanvas.width, imgCanvas.height);
                        
                        // Draw image
                        ctx.drawImage(img, 0, 0);
                        
                        // Get base64 with high quality
                        const dataUrl = imgCanvas.toDataURL('image/png', 1.0);
                        
                        // Store aspect ratio for PDF
                        const aspectRatio = img.width / img.height;
                        
                        // Cleanup
                        viewer.destroy();
                        document.body.removeChild(tempContainer);
                        URL.revokeObjectURL(img.src);
                        
                        resolve({ dataUrl, aspectRatio, width: img.width, height: img.height });
                    };
                    
                    img.onerror = (err) => {
                        if (viewer) viewer.destroy();
                        if (tempContainer && tempContainer.parentNode) {
                            document.body.removeChild(tempContainer);
                        }
                        reject(err);
                    };
                    
                    // Create blob URL from modified SVG
                    const svgBlob = new Blob([modifiedSvg], { type: 'image/svg+xml;charset=utf-8' });
                    img.src = URL.createObjectURL(svgBlob);
                    
                } catch (err) {
                    // Cleanup on error
                    if (viewer) {
                        try { viewer.destroy(); } catch (e) {}
                    }
                    if (tempContainer && tempContainer.parentNode) {
                        try { document.body.removeChild(tempContainer); } catch (e) {}
                    }
                    reject(err);
                }
            });
            
            // Race between render and timeout
            return Promise.race([renderPromise, timeoutPromise]);
        }
        
        // Pre-render all BPMN diagrams for PDF export
        async function preRenderBpmnImages() {
            const images = {};
            const prozesse = assessmentData.prozesse || {};
            
            for (const [processId, data] of Object.entries(prozesse)) {
                if (data && data.bpmnXml) {
                    try {
                        images[processId] = await bpmnToImage(data.bpmnXml);
                    } catch (err) {
                        console.warn('Could not render BPMN for', processId, err);
                    }
                }
            }
            
            return images;
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadSavedData();
            initProcessGrid();
            updateHeaderProgress();
            
            // Remove all slider-container elements (they are redundant with rating labels)
            document.querySelectorAll('.slider-container').forEach(el => el.remove());
            
            // Add rating labels to all rating-options that don't have them
            const defaultLabels = {
                1: 'Trifft gar nicht zu',
                2: 'Trifft wenig zu',
                3: 'Teils/teils',
                4: 'Trifft zu',
                5: 'Trifft voll zu'
            };
            
            document.querySelectorAll('.rating-option').forEach(option => {
                if (!option.querySelector('.rating-label')) {
                    const value = option.dataset.value;
                    const label = document.createElement('div');
                    label.className = 'rating-label';
                    label.textContent = defaultLabels[value] || '';
                    option.appendChild(label);
                }
            });
            
            // Restore selected ratings
            Object.entries(assessmentData.vision).forEach(([question, value]) => {
                const scale = document.querySelector(`[data-question="${question}"]`);
                if (scale) {
                    const option = scale.querySelector(`[data-value="${value}"]`);
                    if (option) option.classList.add('selected');
                }
            });
            
            Object.entries(assessmentData.kultur).forEach(([question, value]) => {
                const scale = document.querySelector(`[data-question="${question}"]`);
                if (scale) {
                    const option = scale.querySelector(`[data-value="${value}"]`);
                    if (option) option.classList.add('selected');
                }
            });
            
            Object.entries(assessmentData.organisation).forEach(([question, value]) => {
                if (typeof value === 'number') {
                    const scale = document.querySelector(`[data-question="${question}"]`);
                    if (scale) {
                        const option = scale.querySelector(`[data-value="${value}"]`);
                        if (option) option.classList.add('selected');
                    }
                }
            });
        });
    </script>
    
    <!-- Auth Modal für Profil-Speicherung -->
    <div class="lead-capture-modal" id="authModal">
        <div class="lead-capture-content" style="max-width: 420px;">
            <h2><i class="fas fa-user-circle"></i> Anmelden oder Registrieren</h2>
            <p style="margin-bottom: 1.5rem;">Melden Sie sich an, um Ihre Ergebnisse dauerhaft zu speichern und später wieder aufzurufen.</p>
            
            <div class="auth-tabs" style="display: flex; margin-bottom: 1.5rem; border-radius: 12px; overflow: hidden; background: rgba(255,255,255,0.1);">
                <button class="auth-tab active" data-tab="login" onclick="switchAuthTab('login')" style="flex: 1; padding: 0.75rem; border: none; background: transparent; color: white; cursor: pointer; font-weight: 600; transition: all 0.3s;">Anmelden</button>
                <button class="auth-tab" data-tab="register" onclick="switchAuthTab('register')" style="flex: 1; padding: 0.75rem; border: none; background: transparent; color: rgba(255,255,255,0.6); cursor: pointer; font-weight: 600; transition: all 0.3s;">Registrieren</button>
            </div>
            
            <style>
                .auth-tab.active { background: rgba(99, 102, 241, 0.5) !important; color: white !important; }
                .auth-form { display: none; }
                .auth-form.active { display: block; }
                @keyframes slideIn { from { transform: translateX(100px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
                @keyframes slideOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(100px); opacity: 0; } }
            </style>
            
            <div id="authError" style="display: none; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); color: #fca5a5; padding: 0.75rem; border-radius: 8px; margin-bottom: 1rem; font-size: 0.9rem;"></div>
            
            <!-- Login Form -->
            <div class="auth-form active" id="loginForm">
                <div class="lead-form-group">
                    <label for="authEmail">E-Mail</label>
                    <input type="email" id="authEmail" placeholder="ihre@email.ch">
                </div>
                <div class="lead-form-group">
                    <label for="authPassword">Passwort</label>
                    <input type="password" id="authPassword" placeholder="Ihr Passwort">
                </div>
                <button class="lead-submit-btn" onclick="handleLogin()" style="background: linear-gradient(135deg, #6366f1, #8b5cf6);">
                    <i class="fas fa-sign-in-alt"></i> Anmelden
                </button>
            </div>
            
            <!-- Register Form -->
            <div class="auth-form" id="registerForm">
                <div class="lead-form-group">
                    <label for="regName">Name</label>
                    <input type="text" id="regName" placeholder="Ihr Name">
                </div>
                <div class="lead-form-group">
                    <label for="regEmail">E-Mail</label>
                    <input type="email" id="regEmail" placeholder="ihre@email.ch">
                </div>
                <div class="lead-form-group">
                    <label for="regPassword">Passwort (min. 6 Zeichen)</label>
                    <input type="password" id="regPassword" placeholder="Neues Passwort">
                </div>
                <button class="lead-submit-btn" onclick="handleRegister()" style="background: linear-gradient(135deg, #10b981, #059669);">
                    <i class="fas fa-user-plus"></i> Registrieren & Speichern
                </button>
            </div>
            
            <button class="btn-nav btn-back" onclick="closeAuthModal()" style="width: 100%; margin-top: 1rem;">
                Abbrechen
            </button>
        </div>
    </div>
    
    <!-- Lead Capture Modal -->
    <div class="lead-capture-modal" id="leadCaptureModal">
        <div class="lead-capture-content">
            <h2><i class="fas fa-download"></i> Ergebnisse herunterladen</h2>
            <p>Bitte geben Sie Ihre Kontaktdaten ein, um Ihre personalisierten HR-Analyse-Ergebnisse herunterzuladen.</p>
            
            <div class="lead-form-group">
                <label for="leadName">Name *</label>
                <input type="text" id="leadName" placeholder="Ihr vollständiger Name" oninput="validateLeadForm()">
            </div>
            
            <div class="lead-form-group">
                <label for="leadEmail">E-Mail * (geschäftlich)</label>
                <input type="email" id="leadEmail" placeholder="ihre.email@firma.ch" oninput="validateLeadForm()">
                <div id="leadEmailError" style="display: none; color: #ef4444; font-size: 0.8rem; margin-top: 4px;"></div>
            </div>
            
            <div class="checkbox-group-lead">
                <input type="checkbox" id="leadConsent" onchange="validateLeadForm()">
                <label for="leadConsent">Ich erlaube Manuel Weiss, mich bezüglich meiner HR-Analyse zu kontaktieren. *</label>
            </div>
            
            <div class="checkbox-group-lead">
                <input type="checkbox" id="leadConsultation">
                <label for="leadConsultation">Ich möchte ein kostenloses Beratungsgespräch buchen.</label>
            </div>
            
            <button class="lead-submit-btn" id="leadSubmitBtn" onclick="submitLeadAndDownload()" disabled>
                <i class="fas fa-download"></i> Ergebnisse herunterladen
            </button>
            
            <button class="btn-nav btn-back" onclick="closeLeadModal()" style="width: 100%; margin-top: 0.5rem;">
                Abbrechen
            </button>
        </div>
    </div>
    
    <!-- PDF Loading Overlay -->
    <div id="pdfLoadingOverlay" class="pdf-loading-overlay">
        <div class="pdf-loading-content">
            <div class="pdf-spinner"></div>
            <p class="pdf-loading-text" id="pdfLoadingText">PDF wird generiert...</p>
            <p class="pdf-loading-subtext" id="pdfLoadingSubtext">Ihre Ergebnisse werden aufbereitet</p>
            <div class="pdf-progress-bar">
                <div class="pdf-progress-fill" id="pdfProgressFill"></div>
            </div>
        </div>
    </div>
    
    <!-- Category Detail Modal -->
    <div id="categoryDetailModal" class="category-detail-modal">
        <div class="category-detail-content">
            <div class="category-detail-header">
                <div class="category-detail-title">
                    <i class="fas fa-chart-pie" id="categoryDetailIcon" style="font-size: 2rem; color: #a5b4fc;"></i>
                    <h2 id="categoryDetailTitle">Kategorie</h2>
                </div>
                <div class="category-detail-score" id="categoryDetailScore">0%</div>
                <button class="category-detail-close" onclick="closeCategoryDetail()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="category-detail-body">
                <div class="subcategory-section" id="subcategorySection">
                    <!-- Dynamisch befüllt -->
                </div>
                <div class="recommendations-list" id="categoryRecommendations">
                    <!-- Dynamisch befüllt -->
                </div>
            </div>
        </div>
    </div>
</body>
</html>
