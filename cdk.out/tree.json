{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.221.0"},"children":{"ManuelWeissEmailSetup":{"id":"ManuelWeissEmailSetup","path":"ManuelWeissEmailSetup","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.221.0"},"children":{"EmailHostedZone":{"id":"EmailHostedZone","path":"ManuelWeissEmailSetup/EmailHostedZone","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.HostedZone","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/EmailHostedZone/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.CfnHostedZone","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Route53::HostedZone","aws:cdk:cloudformation:props":{"hostedZoneConfig":{"comment":"Hosted zone for manuel-weiss.ch email setup"},"name":"manuel-weiss.ch."}}}}},"DomainIdentity":{"id":"DomainIdentity","path":"ManuelWeissEmailSetup/DomainIdentity","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.EmailIdentity","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/DomainIdentity/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.CfnEmailIdentity","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SES::EmailIdentity","aws:cdk:cloudformation:props":{"emailIdentity":"manuel-weiss.ch","mailFromAttributes":{"mailFromDomain":"mail.manuel-weiss.ch"}}}}}},"EmailIdentity":{"id":"EmailIdentity","path":"ManuelWeissEmailSetup/EmailIdentity","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.EmailIdentity","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/EmailIdentity/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.CfnEmailIdentity","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SES::EmailIdentity","aws:cdk:cloudformation:props":{"emailIdentity":"mail@manuel-weiss.ch"}}}}},"EmailBucket":{"id":"EmailBucket","path":"ManuelWeissEmailSetup/EmailBucket","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.Bucket","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/EmailBucket/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucket","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::Bucket","aws:cdk:cloudformation:props":{"bucketEncryption":{"serverSideEncryptionConfiguration":[{"serverSideEncryptionByDefault":{"sseAlgorithm":"AES256"}}]},"bucketName":"manu-email-storage-038333965110","lifecycleConfiguration":{"rules":[{"expirationInDays":90,"id":"DeleteOldEmails","status":"Enabled"}]},"publicAccessBlockConfiguration":{"blockPublicAcls":true,"blockPublicPolicy":true,"ignorePublicAcls":true,"restrictPublicBuckets":true},"versioningConfiguration":{"status":"Enabled"}}}},"Policy":{"id":"Policy","path":"ManuelWeissEmailSetup/EmailBucket/Policy","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.BucketPolicy","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/EmailBucket/Policy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_s3.CfnBucketPolicy","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::S3::BucketPolicy","aws:cdk:cloudformation:props":{"bucket":{"Ref":"EmailBucket843A740F"},"policyDocument":{"Statement":[{"Action":"s3:PutObject","Condition":{"StringEquals":{"aws:SourceAccount":{"Ref":"AWS::AccountId"}}},"Effect":"Allow","Principal":{"Service":"ses.amazonaws.com"},"Resource":{"Fn::Join":["",[{"Fn::GetAtt":["EmailBucket843A740F","Arn"]},"/emails/*"]]}}],"Version":"2012-10-17"}}}}}}}},"EmailProcessor":{"id":"EmailProcessor","path":"ManuelWeissEmailSetup/EmailProcessor","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.221.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"ManuelWeissEmailSetup/EmailProcessor/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.221.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"ManuelWeissEmailSetup/EmailProcessor/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.221.0","metadata":[]}},"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/EmailProcessor/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"ManuelWeissEmailSetup/EmailProcessor/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/EmailProcessor/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["s3:Abort*","s3:DeleteObject*","s3:GetBucket*","s3:GetObject*","s3:List*","s3:PutObject","s3:PutObjectLegalHold","s3:PutObjectRetention","s3:PutObjectTagging","s3:PutObjectVersionTagging"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["EmailBucket843A740F","Arn"]},{"Fn::Join":["",[{"Fn::GetAtt":["EmailBucket843A740F","Arn"]},"/*"]]}]},{"Action":["ses:SendEmail","ses:SendRawEmail"],"Effect":"Allow","Resource":"*"}],"Version":"2012-10-17"},"policyName":"EmailProcessorServiceRoleDefaultPolicy0B15DAB8","roles":[{"Ref":"EmailProcessorServiceRole637381CE"}]}}}}}}},"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/EmailProcessor/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\n        const AWS = require('aws-sdk');\n        const ses = new AWS.SES();\n        const s3 = new AWS.S3();\n\n        exports.handler = async (event) => {\n          console.log('E-Mail verarbeitet:', JSON.stringify(event, null, 2));\n          \n          // Hier kannst du E-Mail-Logik hinzuf√ºgen:\n          // - Weiterleitung an andere Adressen\n          // - Automatische Antworten\n          // - Spam-Filterung\n          // - etc.\n          \n          return {\n            statusCode: 200,\n            body: 'E-Mail erfolgreich verarbeitet'\n          };\n        };\n      "},"environment":{"variables":{"EMAIL_BUCKET":{"Ref":"EmailBucket843A740F"},"DOMAIN_NAME":"manuel-weiss.ch"}},"handler":"index.handler","role":{"Fn::GetAtt":["EmailProcessorServiceRole637381CE","Arn"]},"runtime":"nodejs18.x"}}},"AllowSes":{"id":"AllowSes","path":"ManuelWeissEmailSetup/EmailProcessor/AllowSes","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["EmailProcessor218EC076","Arn"]},"principal":"ses.amazonaws.com","sourceAccount":{"Ref":"AWS::AccountId"}}}}}},"ReceiptRuleSet":{"id":"ReceiptRuleSet","path":"ManuelWeissEmailSetup/ReceiptRuleSet","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.ReceiptRuleSet","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/ReceiptRuleSet/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.CfnReceiptRuleSet","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SES::ReceiptRuleSet","aws:cdk:cloudformation:props":{"ruleSetName":"manu-email-rules"}}},"IncomingEmailRule":{"id":"IncomingEmailRule","path":"ManuelWeissEmailSetup/ReceiptRuleSet/IncomingEmailRule","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.ReceiptRule","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/ReceiptRuleSet/IncomingEmailRule/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ses.CfnReceiptRule","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SES::ReceiptRule","aws:cdk:cloudformation:props":{"rule":{"actions":[{"s3Action":{"bucketName":{"Ref":"EmailBucket843A740F"},"objectKeyPrefix":"emails/"}},{"lambdaAction":{"functionArn":{"Fn::GetAtt":["EmailProcessor218EC076","Arn"]}}}],"enabled":true,"recipients":["manuel-weiss.ch"]},"ruleSetName":{"Ref":"ReceiptRuleSetD3CCC994"}}}}}}}},"SPFRecord":{"id":"SPFRecord","path":"ManuelWeissEmailSetup/SPFRecord","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.TxtRecord","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/SPFRecord/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.CfnRecordSet","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Route53::RecordSet","aws:cdk:cloudformation:props":{"hostedZoneId":{"Ref":"EmailHostedZoneBA66C4A6"},"name":"manuel-weiss.ch.","resourceRecords":["\"v=spf1 include:amazonses.com ~all\""],"ttl":"1800","type":"TXT"}}}}},"DMARCRecord":{"id":"DMARCRecord","path":"ManuelWeissEmailSetup/DMARCRecord","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.TxtRecord","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/DMARCRecord/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.CfnRecordSet","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Route53::RecordSet","aws:cdk:cloudformation:props":{"hostedZoneId":{"Ref":"EmailHostedZoneBA66C4A6"},"name":"_dmarc.manuel-weiss.ch.","resourceRecords":["\"v=DMARC1; p=quarantine; rua=mailto:dmarc@manu.ch\""],"ttl":"1800","type":"TXT"}}}}},"MXRecord":{"id":"MXRecord","path":"ManuelWeissEmailSetup/MXRecord","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.MxRecord","version":"2.221.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"ManuelWeissEmailSetup/MXRecord/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_route53.CfnRecordSet","version":"2.221.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Route53::RecordSet","aws:cdk:cloudformation:props":{"hostedZoneId":{"Ref":"EmailHostedZoneBA66C4A6"},"name":"manuel-weiss.ch.","resourceRecords":["10 inbound-smtp.eu-central-1.amazonaws.com"],"ttl":"1800","type":"MX"}}}}},"DomainName":{"id":"DomainName","path":"ManuelWeissEmailSetup/DomainName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.221.0"}},"EmailAddress":{"id":"EmailAddress","path":"ManuelWeissEmailSetup/EmailAddress","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.221.0"}},"EmailBucketName":{"id":"EmailBucketName","path":"ManuelWeissEmailSetup/EmailBucketName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.221.0"}},"HostedZoneId":{"id":"HostedZoneId","path":"ManuelWeissEmailSetup/HostedZoneId","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.221.0"}},"DKIMInstructions":{"id":"DKIMInstructions","path":"ManuelWeissEmailSetup/DKIMInstructions","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.221.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"ManuelWeissEmailSetup/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"ManuelWeissEmailSetup/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.221.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"ManuelWeissEmailSetup/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.221.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"ManuelWeissEmailSetup/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.221.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}