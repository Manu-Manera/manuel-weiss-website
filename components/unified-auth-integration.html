<!-- üîß UNIFIED AUTH INTEGRATION -->
<!-- Diese Komponente muss in ALLE HTML-Dateien eingef√ºgt werden -->

<!-- AWS SDK -->
<script src="https://sdk.amazonaws.com/js/aws-sdk-2.1490.0.min.js"></script>
<!-- Auth Configuration -->
<script src="js/unified-auth-config.js"></script>
<script src="js/unified-auth-manager.js"></script>
<!-- Enhanced Error Handling -->
<script>
// Globale Fehlerbehandlung f√ºr Auth-Probleme
window.addEventListener('error', (event) => {
    if (event.error && event.error.message) {
        const message = event.error.message.toLowerCase();
        
        if (message.includes('cors')) {
            console.error('üö® CORS Error detected');
            if (window.enhancedAuth) {
                window.enhancedAuth.showNotification(
                    'CORS-Fehler: Bitte Domain in AWS Cognito konfigurieren', 
                    'error'
                );
            }
        } else if (message.includes('network') || message.includes('fetch')) {
            console.error('üö® Network Error detected');
            if (window.enhancedAuth) {
                window.enhancedAuth.showNotification(
                    'Netzwerk-Fehler: Bitte Internetverbindung pr√ºfen', 
                    'error'
                );
            }
        } else if (message.includes('token') || message.includes('auth')) {
            console.error('üö® Auth Error detected');
            if (window.enhancedAuth) {
                window.enhancedAuth.showNotification(
                    'Authentifizierungs-Fehler: Bitte erneut anmelden', 
                    'error'
                );
            }
        }
    }
});
// Unhandled Promise Rejections
window.addEventListener('unhandledrejection', (event) => {
    console.error('üö® Unhandled Promise Rejection:', event.reason);
    
    if (event.reason && event.reason.message) {
        const message = event.reason.message.toLowerCase();
        if (message.includes('cors') || message.includes('network') || message.includes('auth')) {
            if (window.enhancedAuth) {
                window.enhancedAuth.showNotification(
                    'System-Fehler: Bitte Seite neu laden', 
                    'error'
                );
            }
        }
    }
});

// Debug Information
console.log('üîß Auth System Status:', {
    enhancedAuth: !!window.enhancedAuth,
    awsAuth: !!window.awsAuth,
    globalAuth: !!window.globalAuth,
    authModals: !!window.authModals,
    awsSDK: typeof AWS !== 'undefined'
});
</script>

<!-- Auth Status Debug Panel (nur in Development) -->
<script>
// Debug Panel f√ºr Development
if (window.location.hostname === 'localhost' || window.location.hostname.includes('127.0.0.1')) {
    const debugPanel = document.createElement('div');
    debugPanel.id = 'auth-debug-panel';
    debugPanel.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 10px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 10000;
        max-width: 300px;
    `;
    const updateDebugInfo = () => {
        const isLoggedIn = window.enhancedAuth ? window.enhancedAuth.isLoggedIn() : false;
        const user = window.enhancedAuth ? window.enhancedAuth.getCurrentUser() : null;
        debugPanel.innerHTML = `
            <div><strong>Auth Debug Panel</strong></div>
            <div>Status: ${isLoggedIn ? '‚úÖ Angemeldet' : '‚ùå Nicht angemeldet'}</div>
            <div>User: ${user ? user.email : 'Kein User'}</div>
            <div>Session: ${localStorage.getItem('aws_auth_session') ? '‚úÖ' : '‚ùå'}</div>
            <div>Enhanced Auth: ${window.enhancedAuth ? '‚úÖ' : '‚ùå'}</div>
            <div>AWS SDK: ${typeof AWS !== 'undefined' ? '‚úÖ' : '‚ùå'}</div>
        `;
    };
    document.body.appendChild(debugPanel);
    updateDebugInfo();
    // Update alle 5 Sekunden
    setInterval(updateDebugInfo, 5000);
}
</script>

<script>
        // Load auth modals
        async function loadAuthModals() {
            try {
                const response = await fetch('components/unified-auth-modals.html');
                const html = await response.text();
                document.getElementById('authModalsContainer').innerHTML = html;
            } catch (error) {
                console.error('Error loading auth modals:', error);
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadAuthModals();
        });
    </script>
