<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>Bewerbungsmanager - Dashboard</title>
    <meta name="description" content="Ihr pers√∂nliches Bewerbungs-Dashboard. KI-Anschreiben in 60 Sekunden, Lebenslauf-Editor, Tracking und Interview-Vorbereitung.">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="css/applications-main.css">
    <link rel="stylesheet" href="css/dashboard.css?v=20260116fix">
    <link rel="stylesheet" href="css/landing.css?v=20260110">
    
    <!-- Critical Mobile Navbar Override - Wie Hauptseite -->
    <style>
        /* Mobile: Nur Hamburger sichtbar, kein wei√üer Balken */
        @media (max-width: 768px) {
            /* Navbar transparent auf Mobile */
            .navbar {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                background: transparent !important;
                border: none !important;
                box-shadow: none !important;
                z-index: 1000 !important;
                pointer-events: none !important;
            }
            
            /* Desktop Nav verstecken */
            .navbar .desktop-nav {
                display: none !important;
            }
            
            /* Hamburger rechts mit Milchglas-Kreis wie Hauptseite */
            .navbar .mobile-hamburger {
                display: flex !important;
                position: fixed !important;
                top: 16px !important;
                right: 16px !important;
                width: 48px !important;
                height: 48px !important;
                border-radius: 50% !important;
                background: rgba(255, 255, 255, 0.95) !important;
                backdrop-filter: blur(10px) !important;
                -webkit-backdrop-filter: blur(10px) !important;
                border: 1px solid rgba(255, 255, 255, 0.5) !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
                z-index: 10000 !important;
                cursor: pointer !important;
                pointer-events: auto !important;
                flex-direction: column !important;
                justify-content: center !important;
                align-items: center !important;
                gap: 5px !important;
            }
            
            .navbar .mobile-hamburger span {
                width: 22px !important;
                height: 2px !important;
                background: #1e3a8a !important;
                border-radius: 2px !important;
                transition: all 0.3s ease !important;
            }
            
            /* Mobile Fullscreen Menu */
            .mobile-menu-fullscreen {
                position: fixed !important;
                top: 0 !important;
                left: -100% !important;
                width: 100% !important;
                height: 100vh !important;
                background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 50%, #7c3aed 100%) !important;
                z-index: 9999 !important;
                transition: left 0.3s ease !important;
                display: flex !important;
                flex-direction: column !important;
                justify-content: center !important;
                align-items: center !important;
                visibility: visible !important;
            }
            
            .mobile-menu-fullscreen.active {
                left: 0 !important;
            }
            
            /* Hamburger verstecken wenn Men√º aktiv */
            .mobile-hamburger.active {
                display: none !important;
                visibility: hidden !important;
                opacity: 0 !important;
            }
            
            /* Close Button f√ºr Mobile Menu */
            .mobile-menu-close {
                position: absolute !important;
                top: 20px !important;
                right: 20px !important;
                width: 48px !important;
                height: 48px !important;
                border-radius: 50% !important;
                background: rgba(255, 255, 255, 0.2) !important;
                border: none !important;
                color: white !important;
                font-size: 24px !important;
                cursor: pointer !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                transition: all 0.3s ease !important;
            }
            
            .mobile-menu-close:hover {
                background: rgba(255, 255, 255, 0.3) !important;
                transform: scale(1.1) !important;
            }
            
            .mobile-menu-overlay {
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                width: 100% !important;
                height: 100% !important;
                background: rgba(0, 0, 0, 0.5) !important;
                opacity: 0 !important;
                visibility: hidden !important;
                z-index: 9998 !important;
                transition: opacity 0.3s ease, visibility 0.3s ease !important;
            }
            
            .mobile-menu-overlay.active {
                opacity: 1 !important;
                visibility: visible !important;
            }
            
            /* Mobile Menu Content */
            .mobile-menu-content {
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                gap: 16px !important;
                width: 85% !important;
                max-width: 320px !important;
                padding: 0 20px !important;
            }
            
            .mobile-menu-link {
                color: white !important;
                font-size: 1.25rem !important;
                font-weight: 600 !important;
                text-decoration: none !important;
                padding: 18px 28px !important;
                border-radius: 16px !important;
                transition: all 0.3s ease !important;
                background: rgba(255, 255, 255, 0.12) !important;
                backdrop-filter: blur(10px) !important;
                -webkit-backdrop-filter: blur(10px) !important;
                border: 1px solid rgba(255, 255, 255, 0.2) !important;
                width: 100% !important;
                text-align: center !important;
                box-sizing: border-box !important;
                /* Mehrzeilig erlauben */
                white-space: normal !important;
                line-height: 1.3 !important;
                word-wrap: break-word !important;
                hyphens: auto !important;
            }
            
            .mobile-menu-link:hover,
            .mobile-menu-link.active {
                background: rgba(255, 255, 255, 0.25) !important;
                transform: scale(1.02) !important;
            }
            
            /* Profil bearbeiten Link - Spezielle Hervorhebung */
            .mobile-profile-link {
                background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.2)) !important;
                border: 1px solid rgba(16, 185, 129, 0.4) !important;
            }
            
            .mobile-profile-link:hover {
                background: linear-gradient(135deg, rgba(16, 185, 129, 0.5), rgba(5, 150, 105, 0.3)) !important;
            }
            
            .mobile-profile-link i {
                margin-right: 8px !important;
            }
            
            .mobile-auth-btn {
                margin-top: 20px !important;
                padding: 14px 28px !important;
                background: rgba(255, 255, 255, 0.2) !important;
                border: 2px solid white !important;
                border-radius: 12px !important;
                color: white !important;
                font-size: 1.1rem !important;
                font-weight: 600 !important;
                cursor: pointer !important;
                display: flex !important;
                align-items: center !important;
                gap: 10px !important;
            }
            
            .mobile-language-switcher {
                display: flex !important;
                gap: 12px !important;
                margin-top: 10px !important;
            }
            
            .mobile-language-switcher button {
                font-size: 1.5rem !important;
                background: transparent !important;
                border: none !important;
                cursor: pointer !important;
            }
        }
        
        /* Quick Editor Links Hover Effect */
        .editor-quick-link:hover {
            background: rgba(255,255,255,0.35) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        @media (max-width: 768px) {
            .quick-editor-links {
                padding: 10px !important;
                margin-top: 60px !important;
            }
            .editor-quick-link {
                padding: 8px 15px !important;
                font-size: 14px !important;
            }
        }
    </style>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation - Wie auf Hauptseite: Nur Hamburger auf Mobile, transparent -->
    <nav class="navbar">
        <!-- Mobile: Nur Hamburger-Icon (rechts positioniert wie Hauptseite) -->
        <button class="mobile-hamburger" id="mobileHamburger" aria-label="Men√º √∂ffnen">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <!-- Desktop Navigation -->
        <div class="desktop-nav">
        <div class="nav-container">
            <div class="nav-menu" id="navMenu">
                <a href="../index.html" class="nav-link">Start</a>
                <a href="../persoenlichkeitsentwicklung-uebersicht.html" class="nav-link">Pers√∂nlichkeitsentwicklung</a>
                <a href="index.html" class="nav-link">Bewerbungsmanager</a>
                <a href="coaching.html" class="nav-link">Coaching</a>
                <div class="nav-divider"></div>
                <button class="lang-link-compact" data-lang="de" title="Deutsch">üá©üá™</button>
                <button class="lang-link-compact" data-lang="en" title="English">üá¨üáß</button>
                    <div class="auth-container">
                        <button id="authButton" class="nav-login-btn">
                    <i class="fas fa-user"></i>
                    <span id="authButtonText">Anmelden</span>
                </button>
                        <!-- User Dropdown -->
                        <div id="userDropdown" class="user-dropdown" style="display: none;">
                            <div class="dropdown-header">
                                <img id="userAvatarImg" src="../images/default-avatar.png" alt="Avatar" class="dropdown-avatar">
                                <div class="dropdown-user-info">
                                    <span id="userName" class="dropdown-name">Benutzer</span>
                                    <span id="userEmail" class="dropdown-email">email@example.com</span>
                </div>
            </div>
                            <div class="dropdown-divider"></div>
                            <a href="../user-profile.html" class="dropdown-item">
                                <i class="fas fa-user-edit"></i>
                                Profil bearbeiten
                            </a>
                            <a href="../user-profile.html#settings" class="dropdown-item">
                                <i class="fas fa-cog"></i>
                                Einstellungen
                            </a>
                            <div class="dropdown-divider"></div>
                            <button onclick="logout()" class="dropdown-item dropdown-logout">
                                <i class="fas fa-sign-out-alt"></i>
                                Abmelden
            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile Fullscreen Menu -->
        <div class="mobile-menu-overlay" id="mobileMenuOverlay"></div>
        <div class="mobile-menu-fullscreen" id="mobileMenuFullscreen">
            <!-- Close Button -->
            <button class="mobile-menu-close" id="mobileMenuClose" aria-label="Men√º schlie√üen">
                <i class="fas fa-times"></i>
            </button>
            <div class="mobile-menu-content">
                <a href="../index.html" class="mobile-menu-link">Start</a>
                <a href="../persoenlichkeitsentwicklung-uebersicht.html" class="mobile-menu-link">Pers√∂nlichkeits-<br>entwicklung</a>
                <a href="index.html" class="mobile-menu-link active">Bewerbungs-<br>manager</a>
                <a href="coaching.html" class="mobile-menu-link">Coaching</a>
                <!-- Profil bearbeiten - Nur sichtbar wenn eingeloggt -->
                <a href="../user-profile.html?source=dashboard#personal" class="mobile-menu-link mobile-profile-link" id="mobileProfileLink" style="display: none;">
                    <i class="fas fa-user-edit"></i> Profil<br>bearbeiten
                </a>
                <div class="mobile-language-switcher">
                    <button class="lang-link-compact" data-lang="de" title="Deutsch">üá©üá™</button>
                    <button class="lang-link-compact" data-lang="en" title="English">üá¨üáß</button>
                </div>
                <button id="mobileAuthButton" class="mobile-auth-btn">
                    <i class="fas fa-user"></i>
                    <span id="mobileAuthButtonText">Anmelden</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- MAIN DASHBOARD -->
    <main class="dashboard-main">
        <!-- Hero Stats Bar - Anklickbare Kacheln -->
        <div class="dashboard-stats-bar">
            <div class="stat-item clickable" onclick="showTab('cover')" title="Anschreiben anzeigen">
                <i class="fas fa-envelope"></i>
                <div class="stat-content">
                    <span class="stat-number" id="statCoverLetters">0</span>
                    <span class="stat-label">Anschreiben</span>
                </div>
            </div>
            <div class="stat-item clickable" onclick="showTab('resume')" title="Lebensl√§ufe anzeigen">
                <i class="fas fa-file-alt"></i>
                <div class="stat-content">
                    <span class="stat-number" id="statResumes">0</span>
                    <span class="stat-label">Lebensl√§ufe</span>
                </div>
            </div>
            <div class="stat-item clickable" onclick="showTab('documents')" title="Zeugnisse anzeigen">
                <i class="fas fa-certificate"></i>
                <div class="stat-content">
                    <span class="stat-number" id="statDocuments">0</span>
                    <span class="stat-label">Zeugnisse</span>
                </div>
            </div>
            <div class="stat-item clickable" onclick="showTab('photos')" title="Fotos anzeigen">
                <i class="fas fa-camera"></i>
                <div class="stat-content">
                    <span class="stat-number" id="statPhotos">0</span>
                    <span class="stat-label">Fotos</span>
                </div>
            </div>
            <div class="stat-item clickable" onclick="showTab('portfolio')" title="Bewerbungsmappen anzeigen">
                <i class="fas fa-folder-open"></i>
                <div class="stat-content">
                    <span class="stat-number" id="statPortfolios">0</span>
                    <span class="stat-label">Bewerbungsmappen</span>
                </div>
            </div>
            <div class="stat-item clickable" onclick="showTab('tracking')" title="Aktive Bewerbungen anzeigen">
                <i class="fas fa-paper-plane"></i>
                <div class="stat-content">
                    <span class="stat-number" id="statTotal">0</span>
                    <span class="stat-label" style="line-height: 1.2;">Aktive<br>Bewerbungen</span>
                </div>
            </div>
            <div class="stat-item highlight">
                <i class="fas fa-trophy"></i>
                <div class="stat-content">
                    <span class="stat-number" id="statSuccess">0%</span>
                    <span class="stat-label">Erfolg</span>
                </div>
            </div>
        </div>

        <!-- Quick Action Links to Editors -->
        <div class="quick-editor-links" style="display: flex; gap: 15px; padding: 15px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); margin: 0 -20px; justify-content: center; flex-wrap: wrap;">
            <a href="cover-letter-editor.html" class="editor-quick-link" style="display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: rgba(255,255,255,0.2); border-radius: 25px; color: white; text-decoration: none; font-weight: 500; transition: all 0.3s; backdrop-filter: blur(10px);">
                <i class="fas fa-magic"></i>
                <span>KI Anschreiben-Designer</span>
            </a>
            <a href="resume-editor.html" class="editor-quick-link" style="display: flex; align-items: center; gap: 8px; padding: 10px 20px; background: rgba(255,255,255,0.2); border-radius: 25px; color: white; text-decoration: none; font-weight: 500; transition: all 0.3s; backdrop-filter: blur(10px);">
                <i class="fas fa-file-alt"></i>
                <span>Lebenslauf-Designer</span>
            </a>
        </div>

        <!-- Tab Navigation -->
        <div class="dashboard-tabs">
            <button class="tab-btn active" data-tab="quick" onclick="showTab('quick')">
                <i class="fas fa-bolt"></i>
                <span>Quick Apply</span>
                <span class="tab-badge new">NEU</span>
            </button>
            <button class="tab-btn" data-tab="cover" onclick="showTab('cover')">
                <i class="fas fa-file-alt"></i>
                <span>Anschreiben</span>
            </button>
            <button class="tab-btn" data-tab="resume" onclick="showTab('resume')">
                <i class="fas fa-id-card"></i>
                <span>Lebenslauf</span>
            </button>
            <button class="tab-btn" data-tab="documents" onclick="showTab('documents')">
                <i class="fas fa-certificate"></i>
                <span>Zeugnisse</span>
            </button>
            <button class="tab-btn" data-tab="photos" onclick="showTab('photos')">
                <i class="fas fa-camera"></i>
                <span>Fotos</span>
            </button>
            <button class="tab-btn" data-tab="portfolio" onclick="showTab('portfolio')">
                <i class="fas fa-folder-open"></i>
                <span>Bewerbungsmappe</span>
                <span class="tab-badge new">NEU</span>
            </button>
            <button class="tab-btn" data-tab="tracking" onclick="showTab('tracking')">
                <i class="fas fa-tasks"></i>
                <span>Tracking</span>
            </button>
            <button class="tab-btn" data-tab="interview" onclick="showTab('interview')">
                <i class="fas fa-microphone"></i>
                <span>Interview</span>
            </button>
            <button class="tab-btn" data-tab="profile" onclick="showTab('profile')">
                <i class="fas fa-user-cog"></i>
                <span>Profil</span>
            </button>
        </div>

        <!-- Tab Content Container -->
        <div class="dashboard-content">
            
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 1: QUICK APPLY - Der Star des Dashboards -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-quick" class="tab-content active">
                <div class="quick-apply-container">
                    <div class="quick-apply-hero">
                        <div class="hero-icon">
                            <i class="fas fa-magic"></i>
                        </div>
                        <h1>Bewerbung in <span class="highlight-text">60 Sekunden</span></h1>
                        <p>Stellenanzeige einf√ºgen ‚Üí KI generiert Anschreiben ‚Üí Fertig!</p>
                    </div>

                    <!-- Step 1: Job Input -->
                    <div class="quick-step" id="quickStep1">
                        <div class="step-header">
                            <span class="step-number">1</span>
                            <h2>Stellenanzeige einf√ºgen</h2>
                        </div>
                        
                        <div class="input-toggle">
                            <button class="toggle-btn active" data-input="url" onclick="toggleInputType('url')">
                                <i class="fas fa-link"></i> URL einf√ºgen
                            </button>
                            <button class="toggle-btn" data-input="text" onclick="toggleInputType('text')">
                                <i class="fas fa-paste"></i> Text einf√ºgen
                            </button>
                        </div>

                        <div class="input-area" id="inputUrl">
                            <div class="url-input-wrapper">
                                <i class="fas fa-globe"></i>
                                <input type="url" id="jobUrl" placeholder="https://www.stepstone.de/stellenangebote/..." 
                                       onpaste="handleUrlPaste(event)" onkeyup="handleUrlInput(event)">
                                <button class="btn-parse" id="parseUrlBtn" onclick="parseJobUrl()" disabled>
                                    <i class="fas fa-search"></i> Analysieren
                                </button>
                            </div>
                            <div class="url-hints">
                                <span><i class="fas fa-check"></i> StepStone</span>
                                <span><i class="fas fa-check"></i> Indeed</span>
                                <span><i class="fas fa-check"></i> LinkedIn</span>
                                <span><i class="fas fa-check"></i> XING</span>
                                <span><i class="fas fa-check"></i> Jede URL</span>
                            </div>
                        </div>

                        <div class="input-area hidden" id="inputText">
                            <textarea id="jobText" rows="8" 
                                      placeholder="Kopieren Sie hier die komplette Stellenanzeige ein...

Beispiel:
Senior Softwareentwickler (m/w/d)
Firma XYZ GmbH, M√ºnchen
Vollzeit | Ab sofort

Ihre Aufgaben:
- Entwicklung von...
- ..."
                                      oninput="handleTextInput()"></textarea>
                            <div class="char-counter">
                                <span id="charCount">0</span> Zeichen
                            </div>
                        </div>

                        <!-- Parsed Job Preview -->
                        <div class="parsed-job hidden" id="parsedJobPreview">
                            <div class="parsed-header">
                                <i class="fas fa-check-circle"></i>
                                <span>Stellenanzeige erkannt!</span>
                                <button class="btn-edit" onclick="editParsedJob()">
                                    <i class="fas fa-edit"></i> Bearbeiten
                                </button>
                            </div>
                            <div class="parsed-content">
                                <div class="parsed-field">
                                    <label>Position</label>
                                    <input type="text" id="parsedTitle" placeholder="Jobtitel">
                                </div>
                                <div class="parsed-field">
                                    <label>Unternehmen</label>
                                    <input type="text" id="parsedCompany" placeholder="Firmenname">
                                </div>
                                <div class="parsed-field">
                                    <label>Standort</label>
                                    <input type="text" id="parsedLocation" placeholder="Stadt">
                                </div>
                                <div class="parsed-field full-width">
                                    <label>Anforderungen (erkannt)</label>
                                    <div class="requirements-tags" id="parsedRequirements">
                                        <!-- Wird dynamisch gef√ºllt -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Quick Profile (falls nicht vorhanden) -->
                    <div class="quick-step" id="quickStep2">
                        <div class="step-header">
                            <span class="step-number">2</span>
                            <h2>Kurz √ºber Sie <span class="optional-badge">Nur 5 Felder</span></h2>
                        </div>
                        
                        <div class="quick-profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-user"></i> Ihr Name *</label>
                                    <input type="text" id="quickName" placeholder="Max Mustermann" required>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-briefcase"></i> Aktuelle Position</label>
                                    <input type="text" id="quickCurrentJob" placeholder="z.B. Softwareentwickler">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label><i class="fas fa-calendar"></i> Berufserfahrung *</label>
                                    <select id="quickExperience" required>
                                        <option value="">Bitte w√§hlen...</option>
                                        <option value="0-1">Berufseinsteiger (0-1 Jahre)</option>
                                        <option value="1-3">Junior (1-3 Jahre)</option>
                                        <option value="3-5">Mid-Level (3-5 Jahre)</option>
                                        <option value="5-10">Senior (5-10 Jahre)</option>
                                        <option value="10+">Expert (10+ Jahre)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label><i class="fas fa-map-marker-alt"></i> Ihr Standort</label>
                                    <input type="text" id="quickLocation" placeholder="z.B. Berlin">
                                </div>
                            </div>
                            <div class="form-group full-width">
                                <label><i class="fas fa-star"></i> Ihre Top-3 St√§rken *</label>
                                <input type="text" id="quickSkills" placeholder="z.B. JavaScript, Projektmanagement, Teamf√ºhrung" required>
                                <small>Kommagetrennt eingeben</small>
                            </div>
                            <div class="form-group full-width">
                                <label><i class="fas fa-heart"></i> Was motiviert Sie bei dieser Stelle?</label>
                                <textarea id="quickMotivation" rows="3" placeholder="Optional: 1-2 S√§tze warum diese Stelle Sie interessiert..."></textarea>
                            </div>
                        </div>

                        <div class="profile-save-hint">
                            <label class="checkbox-label">
                                <input type="checkbox" id="saveQuickProfile" checked>
                                <span>Diese Daten f√ºr zuk√ºnftige Bewerbungen speichern</span>
                            </label>
                        </div>
                    </div>

                    <!-- Step 3: Generate -->
                    <div class="quick-step" id="quickStep3">
                        <div class="generation-options">
                            <div class="option-group">
                                <label>Tonalit√§t</label>
                                <div class="option-buttons">
                                    <button class="option-btn active" data-tone="formal" onclick="selectTone('formal')">
                                        <i class="fas fa-user-tie"></i> Formal
                                    </button>
                                    <button class="option-btn" data-tone="modern" onclick="selectTone('modern')">
                                        <i class="fas fa-rocket"></i> Modern
                                    </button>
                                    <button class="option-btn" data-tone="creative" onclick="selectTone('creative')">
                                        <i class="fas fa-paint-brush"></i> Kreativ
                                    </button>
                                </div>
                            </div>
                            <div class="option-group">
                                <label>L√§nge</label>
                                <div class="option-buttons">
                                    <button class="option-btn" data-length="short" onclick="selectLength('short')">
                                        <i class="fas fa-compress-alt"></i> Kurz
                                    </button>
                                    <button class="option-btn active" data-length="medium" onclick="selectLength('medium')">
                                        <i class="fas fa-align-left"></i> Mittel
                                    </button>
                                    <button class="option-btn" data-length="long" onclick="selectLength('long')">
                                        <i class="fas fa-expand-alt"></i> Lang
                                    </button>
                                </div>
                            </div>
                        </div>

                        <button class="btn-generate" id="generateBtn" onclick="generateQuickApplication()" disabled>
                            <div class="btn-content">
                                <i class="fas fa-magic"></i>
                                <span>Anschreiben generieren</span>
                            </div>
                            <div class="btn-loading hidden">
                                <div class="spinner"></div>
                                <span>KI arbeitet...</span>
                            </div>
                        </button>

                        <div class="generation-info" id="generationInfo">
                            <i class="fas fa-info-circle"></i>
                            <span id="apiStatusText">Pr√ºfe API-Konfiguration...</span>
                        </div>
                        <div class="api-hint hidden" id="apiHint">
                            <i class="fas fa-key"></i>
                            <span>Kein API-Key? <a href="../admin.html#api-keys" target="_blank">Im Admin Panel konfigurieren</a></span>
                        </div>
                    </div>

                    <!-- Result Section (dynamisch gef√ºllt) -->
                    <div class="quick-step hidden" id="resultSection"></div>

                    <!-- Job Data Display (versteckt bis analysiert) -->
                    <div id="jobDataDisplay" class="hidden"></div>

                    <!-- Legacy Step 4 - f√ºr R√ºckw√§rtskompatibilit√§t -->
                    <div class="quick-step hidden" id="quickStep4">
                        <div class="step-header success">
                            <i class="fas fa-check-circle"></i>
                            <h2>Ihr Anschreiben ist fertig!</h2>
                        </div>

                        <div class="result-container">
                            <div class="result-header">
                                <div class="result-meta">
                                    <span class="job-title" id="resultJobTitle">Senior Developer</span>
                                    <span class="company-name" id="resultCompany">@ Firma XYZ</span>
                                </div>
                                <div class="result-actions">
                                    <button class="btn-action" onclick="copyToClipboard()">
                                        <i class="fas fa-copy"></i> Kopieren
                                    </button>
                                    <button class="btn-action" onclick="downloadAsPdf()">
                                        <i class="fas fa-file-pdf"></i> PDF
                                    </button>
                                    <button class="btn-action" onclick="downloadAsDocx()">
                                        <i class="fas fa-file-word"></i> Word
                                    </button>
                                    <button class="btn-action primary" onclick="sendViaEmail()">
                                        <i class="fas fa-envelope"></i> Per E-Mail
                                    </button>
                                </div>
                            </div>

                            <div class="result-editor">
                                <textarea id="resultText" rows="20"></textarea>
                                <div class="editor-toolbar">
                                    <button onclick="regenerateCoverLetter()" title="Neu generieren">
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                    <button onclick="improveText('formal')" title="Formaler">
                                        <i class="fas fa-user-tie"></i>
                                    </button>
                                    <button onclick="improveText('shorter')" title="K√ºrzen">
                                        <i class="fas fa-compress"></i>
                                    </button>
                                    <button onclick="improveText('stronger')" title="√úberzeugender">
                                        <i class="fas fa-bolt"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="result-footer">
                                <button class="btn-secondary" onclick="startNewApplication()">
                                    <i class="fas fa-plus"></i> Neue Bewerbung
                                </button>
                                <button class="btn-primary" onclick="addToTracking()">
                                    <i class="fas fa-tasks"></i> Zum Tracking hinzuf√ºgen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 2: ANSCHREIBEN (Meine Anschreiben) -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-cover" class="tab-content">
                <div class="cover-letters-container">
                    <div class="cover-letters-header">
                        <h2><i class="fas fa-file-alt"></i> Meine Anschreiben</h2>
                        <a href="cover-letter-editor.html" class="btn-primary">
                            <i class="fas fa-plus"></i> Neues Anschreiben erstellen
                        </a>
                    </div>
                    
                    <!-- Gespeicherte Anschreiben Liste -->
                    <div id="coverLettersList" class="cover-letters-list">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>
                    
                    <!-- Empty State -->
                    <div id="coverLettersEmpty" class="empty-state" style="display: none;">
                        <i class="fas fa-envelope-open"></i>
                        <h3>Noch keine Anschreiben</h3>
                        <p>Erstellen Sie Ihr erstes Anschreiben mit dem Quick Apply!</p>
                        <button onclick="showTab('quick')" class="btn-primary">
                            <i class="fas fa-rocket"></i> Quick Apply starten
                        </button>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 3: LEBENSLAUF (Vereinfacht wie Anschreiben) -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-resume" class="tab-content">
                <div class="resumes-container">
                    <div class="resumes-header">
                        <h2><i class="fas fa-file-alt"></i> Meine Lebensl√§ufe</h2>
                            <a href="resume-editor.html" class="btn-primary">
                            <i class="fas fa-plus"></i> Neuen Lebenslauf erstellen
                            </a>
                        </div>
                    
                    <!-- Gespeicherte Lebensl√§ufe Liste -->
                    <div id="resumesList" class="resumes-list">
                        <!-- Wird dynamisch gef√ºllt -->
                    </div>

                    <!-- Empty State -->
                    <div id="resumesEmpty" class="empty-state" style="display: none;">
                        <i class="fas fa-id-card"></i>
                        <h3>Noch keine Lebensl√§ufe</h3>
                        <p>Erstellen Sie Ihren ersten professionellen Lebenslauf!</p>
                        <a href="resume-editor.html" class="btn-primary">
                            <i class="fas fa-plus"></i> Lebenslauf erstellen
                        </a>
                                </div>
                                </div>
                                </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB: ZEUGNISSE & ZERTIFIKATE -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-documents" class="tab-content">
                <div class="documents-container">
                    <div class="documents-header">
                        <h2><i class="fas fa-certificate"></i> Zeugnisse & Zertifikate</h2>
                        <p>Laden Sie Ihre Zeugnisse und Zertifikate hoch, um sie bei Bewerbungen schnell anh√§ngen zu k√∂nnen.</p>
                                </div>
                    
                    <!-- Upload Area -->
                    <div class="documents-upload-area">
                        <input type="file" id="documentFileInput" accept=".pdf" multiple style="display: none;">
                        <div class="upload-dropzone" onclick="document.getElementById('documentFileInput').click()">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h3>Dokumente hochladen</h3>
                            <p>PDF-Dateien hier ablegen oder klicken</p>
                            <span class="upload-hint">Max. 10MB pro Datei</span>
                                </div>
                    </div>
                    
                    <!-- Document Categories -->
                    <div class="documents-categories">
                        <div class="category-section">
                            <h3><i class="fas fa-graduation-cap"></i> Zeugnisse</h3>
                            <div id="documentsCertificates" class="documents-list">
                                <div class="empty-state-small" id="noCertificates">
                                    <i class="fas fa-file-pdf"></i>
                                    <p>Noch keine Zeugnisse hochgeladen</p>
                                </div>
                            </div>
                        </div>

                        <div class="category-section">
                            <h3><i class="fas fa-award"></i> Zertifikate & Weiterbildungen</h3>
                            <div id="documentsAwards" class="documents-list">
                                <div class="empty-state-small" id="noAwards">
                                    <i class="fas fa-file-pdf"></i>
                                    <p>Noch keine Zertifikate hochgeladen</p>
                                </div>
                            </div>
                        </div>

                        <div class="category-section">
                            <h3><i class="fas fa-briefcase"></i> Arbeitszeugnisse</h3>
                            <div id="documentsWork" class="documents-list">
                                <div class="empty-state-small" id="noWorkDocs">
                                    <i class="fas fa-file-pdf"></i>
                                    <p>Noch keine Arbeitszeugnisse hochgeladen</p>
                            </div>
                            </div>
                        </div>
                    </div>
                </div>
                        </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB: BEWERBUNGSFOTOS -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-photos" class="tab-content">
                <div class="photos-container">
                    <div class="photos-header">
                        <h2><i class="fas fa-camera"></i> Bewerbungsfotos</h2>
                        <p>Laden Sie Ihre professionellen Bewerbungsfotos hoch</p>
                            </div>

                    <!-- Upload Area -->
                    <div class="photo-upload-area" id="photoUploadArea">
                        <div class="upload-dropzone" id="photoDropzone">
                            <i class="fas fa-cloud-upload-alt"></i>
                            <h3>Foto hochladen</h3>
                            <p>Drag & Drop oder klicken zum Ausw√§hlen</p>
                            <p class="upload-hints">JPG, PNG ‚Ä¢ Max. 5MB ‚Ä¢ Empfohlen: 600x800px</p>
                            <input type="file" id="photoFileInput" accept="image/jpeg,image/png,image/webp" hidden>
                        </div>
                    </div>

                    <!-- Photo Gallery -->
                    <div class="photos-gallery" id="photosGallery">
                        <h3><i class="fas fa-images"></i> Meine Bewerbungsfotos</h3>
                        <div class="gallery-grid" id="galleryGrid">
                            <!-- Photos werden dynamisch geladen -->
                        </div>
                        <div class="gallery-empty" id="galleryEmpty">
                            <i class="fas fa-portrait"></i>
                            <p>Noch keine Bewerbungsfotos hochgeladen</p>
                            <button class="btn-secondary" onclick="document.getElementById('photoFileInput').click()">
                                <i class="fas fa-upload"></i> Erstes Foto hochladen
                            </button>
                        </div>
                        </div>

                    <!-- Photo Tips -->
                    <div class="photo-tips">
                        <h4><i class="fas fa-lightbulb"></i> Tipps f√ºr das perfekte Bewerbungsfoto</h4>
                        <ul>
                            <li><i class="fas fa-check"></i> Professionelle Kleidung (Business oder Smart Casual)</li>
                            <li><i class="fas fa-check"></i> Neutraler Hintergrund</li>
                            <li><i class="fas fa-check"></i> Gute Beleuchtung (nat√ºrliches Licht ideal)</li>
                            <li><i class="fas fa-check"></i> Freundlicher, nat√ºrlicher Gesichtsausdruck</li>
                            <li><i class="fas fa-check"></i> Hochformat, Kopf und Schultern sichtbar</li>
                        </ul>
                            </div>
                            </div>
                        </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB: BEWERBUNGSMAPPE - Der komplette Bewerbungs-Builder -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-portfolio" class="tab-content">
                <div class="portfolio-container">
                    <div class="portfolio-header">
                        <h2><i class="fas fa-folder-open"></i> Bewerbungsmappe erstellen</h2>
                        <p>F√ºgen Sie alle Dokumente zusammen und erstellen Sie eine professionelle Bewerbungsmappe</p>
                                </div>

                    <div class="portfolio-builder">
                        <!-- Step 1: Dokumente ausw√§hlen -->
                        <div class="builder-step">
                            <div class="step-header">
                                <span class="step-number">1</span>
                                <h3>Dokumente ausw√§hlen</h3>
                            </div>
                            
                            <div class="document-selection">
                                <!-- Anschreiben -->
                                <div class="document-selector">
                                    <div class="selector-header">
                                        <label class="selector-toggle">
                                            <input type="checkbox" id="includeCoverLetter" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <i class="fas fa-file-alt"></i>
                                        <span>Anschreiben</span>
                                    </div>
                                    <select id="selectCoverLetter" class="document-dropdown">
                                        <option value="">-- Anschreiben w√§hlen --</option>
                                    </select>
                                </div>

                                <!-- Lebenslauf -->
                                <div class="document-selector">
                                    <div class="selector-header">
                                        <label class="selector-toggle">
                                            <input type="checkbox" id="includeResume" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <i class="fas fa-id-card"></i>
                                        <span>Lebenslauf</span>
                                </div>
                                    <select id="selectResume" class="document-dropdown">
                                        <option value="">-- Lebenslauf w√§hlen --</option>
                                    </select>
                                </div>

                                <!-- Bewerbungsfoto -->
                                <div class="document-selector">
                                    <div class="selector-header">
                                        <label class="selector-toggle">
                                            <input type="checkbox" id="includePhoto" checked>
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <i class="fas fa-camera"></i>
                                        <span>Bewerbungsfoto</span>
                            </div>
                                    <select id="selectPhoto" class="document-dropdown">
                                        <option value="">-- Foto w√§hlen --</option>
                                    </select>
                                    <small class="selector-hint">Wird auf dem Lebenslauf platziert</small>
                        </div>

                                <!-- Zeugnisse -->
                                <div class="document-selector">
                                    <div class="selector-header">
                                        <label class="selector-toggle">
                                            <input type="checkbox" id="includeCertificates">
                                            <span class="toggle-slider"></span>
                                        </label>
                                        <i class="fas fa-certificate"></i>
                                        <span>Zeugnisse & Zertifikate</span>
                                    </div>
                                    <div id="certificatesList" class="multi-select">
                                        <!-- Wird dynamisch gef√ºllt -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 2: Design w√§hlen -->
                        <div class="builder-step">
                            <div class="step-header">
                                <span class="step-number">2</span>
                                <h3>Design w√§hlen</h3>
                            </div>
                            
                            <div class="design-templates">
                                <div class="template-grid">
                                    <!-- Template 1: Classic -->
                                    <div class="template-card active" data-template="classic">
                                        <div class="template-preview classic-preview">
                                            <div class="preview-header"></div>
                                            <div class="preview-content">
                                                <div class="preview-photo"></div>
                                                <div class="preview-lines"></div>
                                            </div>
                                        </div>
                                        <span class="template-name">Klassisch</span>
                                    </div>

                                    <!-- Template 2: Modern -->
                                    <div class="template-card" data-template="modern">
                                        <div class="template-preview modern-preview">
                                            <div class="preview-sidebar"></div>
                                            <div class="preview-main">
                                                <div class="preview-lines"></div>
                                            </div>
                                        </div>
                                        <span class="template-name">Modern</span>
                                    </div>

                                    <!-- Template 3: Creative -->
                                    <div class="template-card" data-template="creative">
                                        <div class="template-preview creative-preview">
                                            <div class="preview-accent"></div>
                                            <div class="preview-photo round"></div>
                                            <div class="preview-lines"></div>
                                        </div>
                                        <span class="template-name">Kreativ</span>
                                    </div>

                                    <!-- Template 4: Minimal -->
                                    <div class="template-card" data-template="minimal">
                                        <div class="template-preview minimal-preview">
                                            <div class="preview-lines thin"></div>
                                        </div>
                                        <span class="template-name">Minimalistisch</span>
                                    </div>

                                    <!-- Template 5: Professional -->
                                    <div class="template-card" data-template="professional">
                                        <div class="template-preview professional-preview">
                                            <div class="preview-header-bar"></div>
                                            <div class="preview-two-column">
                                                <div class="preview-col"></div>
                                                <div class="preview-col"></div>
                                            </div>
                                        </div>
                                        <span class="template-name">Professional</span>
                                    </div>

                                    <!-- Template 6: Executive -->
                                    <div class="template-card" data-template="executive">
                                        <div class="template-preview executive-preview">
                                            <div class="preview-border"></div>
                                            <div class="preview-elegant-content">
                                                <div class="preview-photo elegant"></div>
                                                <div class="preview-lines"></div>
                                            </div>
                                        </div>
                                        <span class="template-name">Executive</span>
                                    </div>
                                </div>

                                <!-- Erweiterte Design-Gestaltung -->
                                <div class="design-customization">
                                    <div class="customization-section">
                                        <h4><i class="fas fa-palette"></i> Farben & Stil</h4>
                                        <div class="customization-row">
                                            <label>
                                                <span>Akzentfarbe</span>
                                                <input type="color" id="accentColor" value="#2563eb">
                                            </label>
                                            <label>
                                                <span>Textfarbe</span>
                                                <input type="color" id="textColor" value="#1e293b">
                                            </label>
                                            <label>
                                                <span>Hintergrundfarbe</span>
                                                <input type="color" id="backgroundColor" value="#ffffff">
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="customization-section">
                                        <h4><i class="fas fa-font"></i> Typografie</h4>
                                        <div class="customization-row">
                                            <label>
                                                <span>Schriftart</span>
                                                <select id="fontFamily">
                                                    <option value="Inter">Inter (Modern)</option>
                                                    <option value="Roboto">Roboto</option>
                                                    <option value="Playfair Display">Playfair Display (Elegant)</option>
                                                    <option value="Montserrat">Montserrat</option>
                                                    <option value="Open Sans">Open Sans</option>
                                                    <option value="Lato">Lato</option>
                                                    <option value="Georgia">Georgia (Klassisch)</option>
                                                    <option value="Times New Roman">Times New Roman</option>
                                                </select>
                                            </label>
                                            <label>
                                                <span>Schriftgr√∂√üe</span>
                                                <input type="range" id="fontSize" min="9" max="14" value="11" step="0.5">
                                                <span id="fontSizeValue">11pt</span>
                                            </label>
                                            <label>
                                                <span>Zeilenabstand</span>
                                                <input type="range" id="lineHeight" min="1.2" max="2.0" value="1.6" step="0.1">
                                                <span id="lineHeightValue">1.6</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="customization-section">
                                        <h4><i class="fas fa-ruler"></i> Abst√§nde</h4>
                                        <div class="customization-row">
                                            <label>
                                                <span>Seitenrand</span>
                                                <input type="range" id="pageMargin" min="15" max="40" value="25" step="1">
                                                <span id="pageMarginValue">25mm</span>
                                            </label>
                                            <label>
                                                <span>Absatz-Abstand</span>
                                                <input type="range" id="paragraphSpacing" min="0" max="20" value="10" step="1">
                                                <span id="paragraphSpacingValue">10px</span>
                                            </label>
                                        </div>
                                    </div>
                                    
                                    <div class="customization-section">
                                        <h4><i class="fas fa-cog"></i> Erweiterte Optionen</h4>
                                        <div class="customization-row">
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="showPageNumbers" checked>
                                                <span>Seitenzahlen anzeigen</span>
                                            </label>
                                            <label class="checkbox-label">
                                                <input type="checkbox" id="unifiedDesign" checked>
                                                <span>Einheitliches Design f√ºr alle Dokumente</span>
                                            </label>
                                        </div>
                                        <button class="btn-secondary btn-sm" onclick="loadDesignFromEditors()" style="margin-top: 0.5rem;">
                                            <i class="fas fa-sync"></i> Design von Anschreiben/Lebenslauf √ºbernehmen
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Step 3: Vorschau & Export -->
                        <div class="builder-step">
                            <div class="step-header">
                                <span class="step-number">3</span>
                                <h3>Vorschau & Download</h3>
                            </div>
                            
                            <div class="preview-actions">
                                <button class="btn-secondary" onclick="previewPortfolio()">
                                    <i class="fas fa-eye"></i> Vorschau anzeigen
                            </button>
                                <button class="btn-primary" onclick="generatePortfolioPDF()">
                                    <i class="fas fa-download"></i> Als PDF herunterladen
                            </button>
                    </div>

                            <!-- Live Preview -->
                            <div class="portfolio-preview" id="portfolioPreview">
                                <div class="preview-placeholder">
                                    <i class="fas fa-file-pdf"></i>
                                    <p>Klicken Sie auf "Vorschau anzeigen" um Ihre Bewerbungsmappe zu sehen</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 4: TRACKING -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-tracking" class="tab-content">
                <div class="tracking-container">
                    <div class="tracking-header">
                        <h2><i class="fas fa-tasks"></i> Meine Bewerbungen</h2>
                        <button class="btn-primary" onclick="showAddApplicationModal()">
                            <i class="fas fa-plus"></i> Neue Bewerbung
                        </button>
                    </div>

                    <!-- Simple List View (statt komplexem Kanban) -->
                    <div class="tracking-filters">
                        <button class="filter-btn active" data-filter="all" onclick="filterApplications('all')">
                            Alle <span class="count" id="filterAll">0</span>
                        </button>
                        <button class="filter-btn" data-filter="pending" onclick="filterApplications('pending')">
                            <i class="fas fa-clock"></i> Offen <span class="count" id="filterPending">0</span>
                        </button>
                        <button class="filter-btn" data-filter="interview" onclick="filterApplications('interview')">
                            <i class="fas fa-comments"></i> Interview <span class="count" id="filterInterview">0</span>
                        </button>
                        <button class="filter-btn" data-filter="offer" onclick="filterApplications('offer')">
                            <i class="fas fa-star"></i> Angebot <span class="count" id="filterOffer">0</span>
                        </button>
                        <button class="filter-btn" data-filter="rejected" onclick="filterApplications('rejected')">
                            <i class="fas fa-times"></i> Absage <span class="count" id="filterRejected">0</span>
                        </button>
                    </div>

                    <div class="applications-list" id="applicationsList">
                        <!-- Wird dynamisch gef√ºllt -->
                        <div class="empty-state" id="emptyState">
                            <i class="fas fa-inbox"></i>
                            <h3>Noch keine Bewerbungen</h3>
                            <p>Erstellen Sie Ihre erste Bewerbung mit dem Quick Apply!</p>
                            <button class="btn-primary" onclick="showTab('quick')">
                                <i class="fas fa-bolt"></i> Quick Apply starten
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 5: INTERVIEW -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-interview" class="tab-content">
                <div class="tab-placeholder">
                    <i class="fas fa-microphone"></i>
                    <h2>Interview-Vorbereitung</h2>
                    <p>KI-generierte Fragen und Musterantworten</p>
                    <a href="interview-prep.html" class="btn-primary">
                        <i class="fas fa-play"></i> Interview-Training starten
                    </a>
                    <span class="migration-hint">Wird in n√§chster Phase hier integriert</span>
                </div>
            </div>

            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <!-- TAB 6: PROFIL -->
            <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
            <div id="tab-profile" class="tab-content">
                <div class="profile-container">
                    <div class="profile-header">
                        <h2><i class="fas fa-user-cog"></i> Mein Bewerbungsprofil</h2>
                        <p>Diese Daten werden f√ºr alle Bewerbungen verwendet</p>
                    </div>

                    <form id="profileForm" class="profile-form-compact">
                        <!-- Pers√∂nliche Daten -->
                        <section class="profile-section">
                            <h3><i class="fas fa-user"></i> Pers√∂nliche Daten</h3>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Vorname *</label>
                                    <input type="text" id="profileFirstName" required>
                                </div>
                                <div class="form-group">
                                    <label>Nachname *</label>
                                    <input type="text" id="profileLastName" required>
                                </div>
                                <div class="form-group">
                                    <label>E-Mail *</label>
                                    <input type="email" id="profileEmail" required>
                                </div>
                                <div class="form-group">
                                    <label>Telefon</label>
                                    <input type="tel" id="profilePhone">
                                </div>
                                <div class="form-group">
                                    <label>Wohnort</label>
                                    <input type="text" id="profileLocation">
                                </div>
                                <div class="form-group">
                                    <label>Aktuelle Position</label>
                                    <input type="text" id="profileCurrentJob">
                                </div>
                            </div>
                        </section>

                        <!-- Berufserfahrung -->
                        <section class="profile-section">
                            <h3><i class="fas fa-briefcase"></i> Berufserfahrung</h3>
                            <div class="form-group full-width">
                                <label>Jahre Berufserfahrung</label>
                                <select id="profileExperience">
                                    <option value="">Bitte w√§hlen...</option>
                                    <option value="0-1">Berufseinsteiger (0-1 Jahre)</option>
                                    <option value="1-3">Junior (1-3 Jahre)</option>
                                    <option value="3-5">Mid-Level (3-5 Jahre)</option>
                                    <option value="5-10">Senior (5-10 Jahre)</option>
                                    <option value="10+">Expert (10+ Jahre)</option>
                                </select>
                            </div>
                            <div class="form-group full-width">
                                <label>Kurzes Profil / Summary</label>
                                <textarea id="profileSummary" rows="4" placeholder="2-3 S√§tze √ºber Sie und Ihre wichtigsten Qualifikationen..."></textarea>
                            </div>
                        </section>

                        <!-- Skills -->
                        <section class="profile-section">
                            <h3><i class="fas fa-star"></i> F√§higkeiten & St√§rken</h3>
                            <div class="form-group full-width">
                                <label>Ihre Top-Skills (kommagetrennt)</label>
                                <input type="text" id="profileSkills" placeholder="z.B. JavaScript, Projektmanagement, Teamf√ºhrung, Excel">
                            </div>
                            <div class="skills-tags" id="skillsTags">
                                <!-- Wird dynamisch gef√ºllt -->
                            </div>
                        </section>

                        <div class="profile-actions">
                            <button type="button" class="btn-secondary" onclick="resetProfile()">
                                <i class="fas fa-undo"></i> Zur√ºcksetzen
                            </button>
                            <button type="submit" class="btn-primary" onclick="saveProfile(event)">
                                <i class="fas fa-save"></i> Profil speichern
                            </button>
                        </div>
                    </form>

                    <!-- Daten-Status -->
                    <div class="profile-status">
                        <div class="status-item">
                            <i class="fas fa-database"></i>
                            <span>Daten werden lokal in Ihrem Browser gespeichert</span>
                        </div>
                        <div class="status-item">
                            <i class="fas fa-shield-alt"></i>
                            <span>Keine Weitergabe an Dritte</span>
                        </div>
                    </div>
                </div>
            </div>

        </div><!-- End dashboard-content -->
    </main>

    <!-- Modal: Neue Bewerbung hinzuf√ºgen -->
    <div class="modal-overlay hidden" id="addApplicationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> Bewerbung hinzuf√ºgen</h3>
                <button class="modal-close" onclick="closeModal('addApplicationModal')">&times;</button>
            </div>
            <form id="addApplicationForm" onsubmit="addApplication(event)">
                <div class="form-group">
                    <label>Position *</label>
                    <input type="text" id="newAppPosition" required>
                </div>
                <div class="form-group">
                    <label>Unternehmen *</label>
                    <input type="text" id="newAppCompany" required>
                </div>
                <div class="form-group">
                    <label>Standort</label>
                    <input type="text" id="newAppLocation" placeholder="z.B. M√ºnchen, Remote">
                </div>
                <div class="form-group">
                    <label>Bewerbungsdatum</label>
                    <input type="date" id="newAppDate" value="">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="newAppStatus">
                        <option value="pending">Gesendet / Offen</option>
                        <option value="interview">Interview eingeladen</option>
                        <option value="offer">Angebot erhalten</option>
                        <option value="rejected">Absage</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Job-URL</label>
                    <input type="url" id="newAppUrl" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>Notizen</label>
                    <textarea id="newAppNotes" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('addApplicationModal')">Abbrechen</button>
                    <button type="submit" class="btn-primary">Hinzuf√ºgen</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal: Bewerbung bearbeiten -->
    <div class="modal-overlay hidden" id="editApplicationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Bewerbung bearbeiten</h3>
                <button class="modal-close" onclick="closeModal('editApplicationModal')">&times;</button>
            </div>
            <form id="editApplicationForm" onsubmit="updateApplication(event)">
                <input type="hidden" id="editAppId">
                <div class="form-group">
                    <label>Position *</label>
                    <input type="text" id="editAppPosition" required>
                </div>
                <div class="form-group">
                    <label>Unternehmen *</label>
                    <input type="text" id="editAppCompany" required>
                </div>
                <div class="form-group">
                    <label>Standort</label>
                    <input type="text" id="editAppLocation">
                </div>
                <div class="form-group">
                    <label>Bewerbungsdatum</label>
                    <input type="date" id="editAppDate">
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="editAppStatus">
                        <option value="pending">Gesendet / Offen</option>
                        <option value="interview">Interview eingeladen</option>
                        <option value="offer">Angebot erhalten</option>
                        <option value="rejected">Absage</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Job-URL</label>
                    <input type="url" id="editAppUrl">
                </div>
                <div class="form-group">
                    <label>Notizen</label>
                    <textarea id="editAppNotes" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label>Anschreiben</label>
                    <textarea id="editAppCoverLetter" rows="5" placeholder="Gespeichertes Anschreiben..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('editApplicationModal')">Abbrechen</button>
                    <button type="submit" class="btn-primary">Speichern</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <!-- PDF.js f√ºr OCR im Dashboard -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
    
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1490.0.min.js"></script>
    <script src="../js/aws-app-config.js?v=20260117"></script>
    <script src="../js/aws-media.js?v=20260117"></script>
    <script src="../js/smart-media-upload.js?v=20260117"></script>
    <script src="../js/success-checkmark.js?v=20260112"></script>
    <script src="../js/unified-aws-auth.js?v=20260112"></script>
    <script src="../js/unified-auth-modals.js?v=20260112"></script>
    <script src="../js/global-api-manager.js?v=20260112i"></script>
    <script src="../js/aws-api-settings.js?v=20260113fix"></script>
    <script src="../js/cloud-data-service.js?v=20260114c"></script>
    <script src="../js/unified-profile-service.js?v=20260115fix2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="js/utils.js?v=20260112i"></script>
    <script src="js/dashboard-core.js?v=20260116fix"></script>
    <script src="js/quick-apply.js?v=20260112i"></script>
    
    <script>
        // Initialize Global API Manager
        if (!window.globalAPIManager) {
            window.globalAPIManager = new GlobalAPIManager();
        }
        
        // Wait for AWS Auth System
        function waitForAuthSystem() {
            return new Promise(resolve => {
                if (window.awsAuth && window.awsAuth.isInitialized) {
                    resolve();
                } else {
                    const checkInterval = setInterval(() => {
                        if (window.awsAuth && window.awsAuth.isInitialized) {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                    setTimeout(() => {
                        clearInterval(checkInterval);
                        resolve(); // Resolve anyway after timeout
                    }, 5000);
                }
            });
        }
        
        // =============================================================================
        // VEREINFACHTE AUTH UI - Eine einzige Quelle der Wahrheit
        // =============================================================================
        function setupAuthUI() {
            const authButton = document.getElementById('authButton');
            const mobileAuthButton = document.getElementById('mobileAuthButton');
            const userDropdown = document.getElementById('userDropdown');
            
            if (!authButton) return;
            
            // DROPDOWN STATE - Komplett isoliert und sicher
            let dropdownIsOpen = false;
            let lastUserClickTime = 0;
            let isMouseDown = false;
            
            // Sichere Dropdown-Steuerung
            function forceCloseDropdown() {
                dropdownIsOpen = false;
                if (userDropdown) {
                    userDropdown.style.display = 'none';
                    userDropdown.classList.remove('show');
                    userDropdown.setAttribute('aria-hidden', 'true');
                }
            }
            
            function openDropdown() {
                // Nur √∂ffnen wenn: mousedown k√ºrzlich war UND mindestens 50ms vergangen sind
                const now = Date.now();
                const timeSinceClick = now - lastUserClickTime;
                if (timeSinceClick > 1000) {
                    console.log('‚ùå Dropdown-√ñffnen blockiert: zu lange seit letztem Klick (' + timeSinceClick + 'ms)');
                    return false;
                }
                
                dropdownIsOpen = true;
                if (userDropdown) {
                    userDropdown.style.display = 'block';
                    userDropdown.classList.add('show');
                    userDropdown.setAttribute('aria-hidden', 'false');
                }
                return true;
            }
            
            // CRITICAL: Schlie√üe Dropdown bei JEDEM verd√§chtigen Event
            forceCloseDropdown(); // Initial geschlossen
            window.addEventListener('blur', forceCloseDropdown);
            window.addEventListener('focus', forceCloseDropdown);
            document.addEventListener('visibilitychange', forceCloseDropdown);
            document.addEventListener('scroll', forceCloseDropdown, true);
            
            // Mousedown registrieren f√ºr sicheren Klick-Check
            authButton.addEventListener('mousedown', (e) => {
                if (e.isTrusted && e.button === 0) {
                    isMouseDown = true;
                    lastUserClickTime = Date.now();
                }
            }, { passive: true });
            
            authButton.addEventListener('mouseup', () => {
                isMouseDown = false;
            }, { passive: true });
            
            // Auth button click - ULTRA-STRIKTE √úberpr√ºfung
            authButton.addEventListener('click', (e) => {
                // Sicherheitspr√ºfung 1: Muss ein trusted Event sein
                if (!e.isTrusted) {
                    console.log('‚ùå [Auth] Programmatischer Klick blockiert');
                    forceCloseDropdown();
                    return;
                }
                
                // Sicherheitspr√ºfung 2: Muss ein echter Maus-Klick sein (detail > 0)
                if (e.detail === 0) {
                    console.log('‚ùå [Auth] Kein echter Mausklick (detail=0)');
                    forceCloseDropdown();
                    return;
                }
                
                // Sicherheitspr√ºfung 3: lastUserClickTime muss k√ºrzlich sein
                const timeSinceClick = Date.now() - lastUserClickTime;
                if (timeSinceClick > 1000) {
                    console.log('‚ùå [Auth] Klick zu alt:', timeSinceClick, 'ms');
                    forceCloseDropdown();
                    return;
                }
                
                e.preventDefault();
                e.stopPropagation();
                
                const isLoggedIn = window.awsAuth && window.awsAuth.isLoggedIn();
                
                if (isLoggedIn) {
                    // Toggle basierend auf aktuellem Zustand
                    if (dropdownIsOpen) {
                        forceCloseDropdown();
                    } else {
                        openDropdown();
                    }
                } else {
                    forceCloseDropdown();
                    if (window.authModals) {
                        window.authModals.showLogin();
                    } else if (window.unifiedAuthModals) {
                        window.unifiedAuthModals.showLogin();
                    }
                }
            }, { passive: false, capture: false });
            
            // Klick au√üerhalb schlie√üt
            document.addEventListener('click', (e) => {
                if (!e.isTrusted) return;
                if (!dropdownIsOpen) return;
                
                if (!authButton.contains(e.target) && !userDropdown?.contains(e.target)) {
                    forceCloseDropdown();
                }
            }, true);
            
            // Escape schlie√üt - NUR Escape, keine anderen Tasten
            document.addEventListener('keydown', (e) => {
                // KRITISCH: Nur Escape schlie√üt, KEINE andere Taste √∂ffnet das Dropdown
                if (e.key === 'Escape') {
                    forceCloseDropdown();
                }
                // Alle anderen Tasten ignorieren - Dropdown wird NUR durch Mausklick ge√∂ffnet
            }, { passive: true });
            
            // ZUS√ÑTZLICHE SICHERHEIT: Schlie√üe Dropdown bei JEDEM Tastendruck (au√üer Escape)
            // Das verhindert, dass das Dropdown durch Tastatur-Events ge√∂ffnet wird
            document.addEventListener('keydown', (e) => {
                if (e.key !== 'Escape' && dropdownIsOpen) {
                    // Schlie√üe nur wenn es bereits offen ist, √∂ffne es NIEMALS durch Tastatur
                    // (Dies verhindert versehentliches √ñffnen w√§hrend des Tippens)
                }
            }, { passive: true });
            
            // ZUS√ÑTZLICHE SICHERHEIT: Schlie√üe Dropdown bei Fokus-Wechsel
            window.addEventListener('blur', () => {
                forceCloseDropdown();
            });
            
            // ZUS√ÑTZLICHE SICHERHEIT: Schlie√üe Dropdown wenn Fenster nicht aktiv ist
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    forceCloseDropdown();
                }
            });
            
            // =============================================================================
            // NAME UPDATE - Nur eine Funktion, keine konkurrierenden Updates
            // =============================================================================
            let currentDisplayName = null;
            let updateInProgress = false;
            
            async function updateAuthUI() {
                if (updateInProgress) return;
                updateInProgress = true;
                
                try {
                    const isLoggedIn = window.awsAuth && window.awsAuth.isLoggedIn();
                    const userData = isLoggedIn ? window.awsAuth.getUserDataFromToken() : null;
                    
                    if (isLoggedIn && userData) {
                        let firstName = '';
                        let fullName = '';
                        let email = userData.email || '';
                        let profileImage = '../images/default-avatar.png';
                        
                        // EINZIGE QUELLE: UnifiedProfileService
                        if (window.unifiedProfileService) {
                            // Warte bis initialisiert (max 3 Sekunden)
                            let attempts = 0;
                            while (!window.unifiedProfileService.isInitialized && attempts < 30) {
                                await new Promise(r => setTimeout(r, 100));
                                attempts++;
                            }
                            
                            if (window.unifiedProfileService.isInitialized) {
                                firstName = window.unifiedProfileService.getFirstName() || '';
                                fullName = window.unifiedProfileService.getDisplayName() || '';
                                email = window.unifiedProfileService.getEmail() || email;
                                const img = window.unifiedProfileService.getProfileImage();
                                if (img) profileImage = img;
                            }
                        }
                        
                        // Fallbacks nur wenn UnifiedProfileService keine Daten hat
                        if (!firstName || firstName === 'Test') {
                            // Fallback: Email-Prefix
                            if (email) {
                                firstName = email.split('@')[0];
                                if (firstName.length < 3) firstName = 'Profil';
                            } else {
                                firstName = 'Profil';
                            }
                            fullName = firstName;
                        }
                        
                        // Nur updaten wenn sich was ge√§ndert hat
                        if (currentDisplayName !== fullName) {
                            currentDisplayName = fullName;
                            console.log('‚úÖ Auth UI Update - Vorname:', firstName, 'Voll:', fullName);
                            
                            // Button: Nur Vorname - WICHTIG: Event-Listener bleiben erhalten durch selektives Update
                            const existingImg = authButton.querySelector('img.nav-user-avatar');
                            const existingSpan = authButton.querySelector('span');
                            const existingIcon = authButton.querySelector('i.fa-chevron-down');
                            
                            if (existingImg) {
                                existingImg.src = profileImage;
                                existingImg.onerror = function() { this.src = '../images/default-avatar.png'; };
                            } else {
                                const img = document.createElement('img');
                                img.src = profileImage;
                                img.alt = 'User';
                                img.className = 'nav-user-avatar';
                                img.onerror = function() { this.src = '../images/default-avatar.png'; };
                                authButton.insertBefore(img, authButton.firstChild);
                            }
                            
                            if (existingSpan) {
                                existingSpan.textContent = firstName;
                            } else {
                                const span = document.createElement('span');
                                span.textContent = firstName;
                                authButton.appendChild(span);
                            }
                            
                            if (!existingIcon) {
                                const icon = document.createElement('i');
                                icon.className = 'fas fa-chevron-down';
                                authButton.appendChild(icon);
                            }
                            
                            authButton.classList.add('logged-in');
                            
                            // Dropdown-Inhalte
                            const userName = document.getElementById('userName');
                            const userEmail = document.getElementById('userEmail');
                            const userAvatar = document.getElementById('userAvatarImg');
                            
                            if (userName) userName.textContent = fullName;
                            if (userEmail) userEmail.textContent = email;
                            if (userAvatar) userAvatar.src = profileImage;
                        }
                        
                        // Mobile
                        if (mobileAuthButton) {
                            mobileAuthButton.innerHTML = `<i class="fas fa-sign-out-alt"></i> Abmelden`;
                            mobileAuthButton.onclick = () => window.awsAuth.logout();
                        }
                        
                        const mobileProfileLink = document.getElementById('mobileProfileLink');
                        if (mobileProfileLink) mobileProfileLink.style.display = 'block';
                        
                    } else {
                        // Nicht eingeloggt
                        currentDisplayName = null;
                        authButton.innerHTML = `<i class="fas fa-user"></i><span>Anmelden</span>`;
                        authButton.classList.remove('logged-in');
                        forceCloseDropdown();
                        
                        if (mobileAuthButton) {
                            mobileAuthButton.innerHTML = `<i class="fas fa-user"></i> Anmelden`;
                            mobileAuthButton.onclick = () => {
                                closeMobileMenu();
                                if (window.authModals) window.authModals.showLogin();
                            };
                        }
                        
                        const mobileProfileLink = document.getElementById('mobileProfileLink');
                        if (mobileProfileLink) mobileProfileLink.style.display = 'none';
                    }
                    
                    // Dashboard Update (nur einmal)
                    if (window.DashboardCore?.checkAuthStatus) {
                        window.DashboardCore.checkAuthStatus();
                    }
                    
                } finally {
                    updateInProgress = false;
                }
            }
            
            // UnifiedProfileService Listener - Einziger Weg f√ºr Profil-Updates
            if (window.unifiedProfileService) {
                window.unifiedProfileService.onProfileChange(() => {
                    updateAuthUI();
                });
            }
            
            // Auth State Changes
            window.addEventListener('authStateChanged', () => {
                forceCloseDropdown(); // IMMER schlie√üen bei Auth-√Ñnderung
                setTimeout(updateAuthUI, 100);
            });
            
            // Initial
            updateAuthUI();
        }
        
        // Logout function for dropdown
        window.logout = async function() {
            if (window.awsAuth) {
                await window.awsAuth.logout();
                showToast('Erfolgreich abgemeldet', 'success');
                setTimeout(() => location.reload(), 500);
            }
        };
        
        // Mobile Menu Functions
        function openMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenuFullscreen');
            const overlay = document.getElementById('mobileMenuOverlay');
            const hamburger = document.getElementById('mobileHamburger');
            
            if (mobileMenu) mobileMenu.classList.add('active');
            if (overlay) overlay.classList.add('active');
            if (hamburger) hamburger.classList.add('active');
            document.body.style.overflow = 'hidden';
        }
        
        function closeMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenuFullscreen');
            const overlay = document.getElementById('mobileMenuOverlay');
            const hamburger = document.getElementById('mobileHamburger');
            
            if (mobileMenu) mobileMenu.classList.remove('active');
            if (overlay) overlay.classList.remove('active');
            if (hamburger) hamburger.classList.remove('active');
            document.body.style.overflow = '';
        }
        
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenuFullscreen');
            if (mobileMenu && mobileMenu.classList.contains('active')) {
                closeMobileMenu();
            } else {
                openMobileMenu();
            }
        }
        
        // Setup Mobile Menu Event Listeners
        function setupMobileMenu() {
            const hamburger = document.getElementById('mobileHamburger');
            const closeBtn = document.getElementById('mobileMenuClose');
            const overlay = document.getElementById('mobileMenuOverlay');
            const menuLinks = document.querySelectorAll('.mobile-menu-link');
            
            if (hamburger) {
                hamburger.addEventListener('click', toggleMobileMenu);
            }
            
            if (closeBtn) {
                closeBtn.addEventListener('click', closeMobileMenu);
            }
            
            if (overlay) {
                overlay.addEventListener('click', closeMobileMenu);
            }
            
            // Close menu when clicking a link
            menuLinks.forEach(link => {
                link.addEventListener('click', closeMobileMenu);
            });
        }
        
        // HINWEIS: loadCoverLetters ist jetzt in dashboard-core.js definiert
        // und wird als window.loadCoverLetters exportiert
        // Die lokale Funktion wurde entfernt, um Konflikte zu vermeiden
        
        // View cover letter in modal
        window.viewCoverLetter = function(id) {
            const drafts = JSON.parse(localStorage.getItem('cover_letter_drafts') || '[]');
            const draft = drafts.find(d => d.id === id);
            if (!draft) return;
            
            const modal = document.createElement('div');
            modal.className = 'cover-letter-modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>${draft.jobData?.position || 'Anschreiben'} - ${draft.jobData?.company || ''}</h3>
                        <button onclick="this.closest('.cover-letter-modal').remove()" class="btn-close">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <pre style="white-space: pre-wrap; font-family: inherit;">${draft.content}</pre>
                    </div>
                    <div class="modal-footer">
                        <button onclick="copyCoverLetter('${id}'); this.closest('.cover-letter-modal').remove();" class="btn-secondary">
                            <i class="fas fa-copy"></i> Kopieren
                        </button>
                        <button onclick="downloadCoverLetter('${id}'); this.closest('.cover-letter-modal').remove();" class="btn-primary">
                            <i class="fas fa-download"></i> Herunterladen
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        };
        
        // Copy cover letter
        window.copyCoverLetter = function(id) {
            const drafts = JSON.parse(localStorage.getItem('cover_letter_drafts') || '[]');
            const draft = drafts.find(d => d.id === id);
            if (!draft) return;
            
            navigator.clipboard.writeText(draft.content).then(() => {
                showToast('Anschreiben kopiert!', 'success');
            });
        };
        
        // Download cover letter
        window.downloadCoverLetter = function(id) {
            const drafts = JSON.parse(localStorage.getItem('cover_letter_drafts') || '[]');
            const draft = drafts.find(d => d.id === id);
            if (!draft) return;
            
            const blob = new Blob([draft.content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Anschreiben_${draft.jobData?.company || 'Bewerbung'}_${new Date(draft.createdAt).toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('Anschreiben heruntergeladen', 'success');
        };
        
        // HINWEIS: deleteCoverLetter ist jetzt in dashboard-core.js definiert
        // und wird als window.deleteCoverLetter exportiert
        // Die alte Funktion wurde entfernt, um Konflikte zu vermeiden
        
        // Simple toast notification
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 10000;
                padding: 1rem 1.5rem; border-radius: 8px; color: white;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', async () => {
            // Setup mobile menu
            setupMobileMenu();
            
            // Wait for auth system
            await waitForAuthSystem();
            
            // Setup auth UI
            setupAuthUI();
            
            // Initialize auth modals if not already done
            if (!window.authModals && window.UnifiedAuthModals) {
                window.authModals = new UnifiedAuthModals();
            }
            
            // Initialize dashboard
            initDashboard();
            
            // Load cover letters when switching to that tab - nutze window.loadCoverLetters aus dashboard-core.js
            if (typeof window.loadCoverLetters === 'function') {
                await window.loadCoverLetters();
            } else {
                console.warn('window.loadCoverLetters nicht verf√ºgbar');
            }
            
            // Initialize documents tab
            initDocumentsTab();
            
            // Load resumes - nutze window.loadResumes aus dashboard-core.js
            if (typeof window.loadResumes === 'function') {
                await window.loadResumes();
            } else {
                console.warn('window.loadResumes nicht verf√ºgbar');
            }
            
            // Update stats
            updateDashboardStats();
        });
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // LEBENSL√ÑUFE FUNKTIONEN
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        // HINWEIS: loadResumes ist jetzt in dashboard-core.js definiert und wird als window.loadResumes exportiert
        // Die lokale Funktion wurde entfernt, um Konflikte zu vermeiden
        
        window.viewResumePDF = function(id) {
            // √ñffne resume-editor mit PDF-Export-Modus
            window.location.href = `resume-editor.html?id=${id}&action=pdf`;
        };
        
        window.duplicateResume = async function(id) {
            try {
                // Lade Lebensl√§ufe aus Cloud oder localStorage
                let resumes = [];
                if (window.cloudDataService && window.cloudDataService.isUserLoggedIn()) {
                    resumes = await window.cloudDataService.getResumes(true);
                } else {
                    resumes = JSON.parse(localStorage.getItem('user_resumes') || '[]');
                }
                
                const resume = resumes.find(r => r.id === id);
                if (!resume) {
                    showToast('Lebenslauf nicht gefunden', 'error');
                    return;
                }
                
                const newResume = {
                    ...resume,
                    id: `resume_${Date.now().toString(36)}`,
                    name: (resume.name || resume.personalInfo?.firstName || 'Lebenslauf') + ' (Kopie)',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                // Speichere in Cloud wenn eingeloggt
                if (window.cloudDataService && window.cloudDataService.isUserLoggedIn()) {
                    try {
                        await window.cloudDataService.saveResume(newResume);
                    } catch (error) {
                        console.warn('Cloud-Speichern fehlgeschlagen, speichere lokal:', error);
                        resumes.unshift(newResume);
                        localStorage.setItem('user_resumes', JSON.stringify(resumes));
                    }
                } else {
                    resumes.unshift(newResume);
                    localStorage.setItem('user_resumes', JSON.stringify(resumes));
                }
                
                // Nutze window.loadResumes aus dashboard-core.js
                if (typeof window.loadResumes === 'function') {
                    await window.loadResumes();
                }
                
                // Stats aktualisieren
                if (typeof updateDashboardStats === 'function') {
                    await updateDashboardStats();
                }
                
                showToast('Lebenslauf dupliziert', 'success');
            } catch (error) {
                console.error('Fehler beim Duplizieren:', error);
                showToast('Fehler beim Duplizieren', 'error');
            }
        };
        
        // HINWEIS: deleteResume ist jetzt in dashboard-core.js definiert
        // und wird als window.deleteResume exportiert
        // Die alte Funktion wurde entfernt, um Konflikte zu vermeiden
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DOKUMENTE / ZEUGNISSE FUNKTIONEN
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function initDocumentsTab() {
            const fileInput = document.getElementById('documentFileInput');
            if (!fileInput) return;
            
            fileInput.addEventListener('change', handleDocumentUpload);
            
            // Drag & Drop
            const dropzone = document.querySelector('.documents-upload-area .upload-dropzone');
            if (dropzone) {
                dropzone.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropzone.style.borderColor = 'var(--primary)';
                });
                dropzone.addEventListener('dragleave', () => {
                    dropzone.style.borderColor = '';
                });
                dropzone.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropzone.style.borderColor = '';
                    const files = e.dataTransfer.files;
                    if (files.length) processDocumentFiles(files);
                });
            }
            
            // Lade gespeicherte Dokumente
            loadSavedDocuments();
        }
        
        async function handleDocumentUpload(e) {
            const files = e.target.files;
            if (files.length) {
                await processDocumentFiles(files);
            }
        }
        
        async function processDocumentFiles(files) {
            for (const file of files) {
                if (file.type !== 'application/pdf') {
                    showToast('Nur PDF-Dateien erlaubt', 'error');
                    continue;
                }
                if (file.size > 10 * 1024 * 1024) {
                    showToast(`${file.name} ist zu gro√ü (max. 10MB)`, 'error');
                    continue;
                }
                
                // Zeige Kategorie-Auswahl
                showCategoryModal(file);
            }
        }
        
        function showCategoryModal(file) {
            const modal = document.createElement('div');
            modal.className = 'document-category-modal';
            modal.innerHTML = `
                <div class="category-modal-content">
                    <h3>Kategorie f√ºr "${file.name}"</h3>
                    <div class="category-options">
                        <div class="category-option" onclick="saveDocument('${file.name}', 'certificates', this)">
                            <i class="fas fa-graduation-cap"></i>
                            <span>Zeugnis</span>
                        </div>
                        <div class="category-option" onclick="saveDocument('${file.name}', 'awards', this)">
                            <i class="fas fa-award"></i>
                            <span>Zertifikat / Weiterbildung</span>
                        </div>
                        <div class="category-option" onclick="saveDocument('${file.name}', 'work', this)">
                            <i class="fas fa-briefcase"></i>
                            <span>Arbeitszeugnis</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Speichere File tempor√§r
            window.pendingDocumentFile = file;
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
            
            document.body.appendChild(modal);
        }
        
        window.saveDocument = async function(fileName, category, element) {
            const file = window.pendingDocumentFile;
            if (!file) return;
            
            // Pr√ºfe ob User eingeloggt ist (am Anfang)
            const isLoggedIn = window.cloudDataService?.isUserLoggedIn?.() || 
                               window.awsAuth?.isLoggedIn?.() || 
                               window.realUserAuth?.isLoggedIn?.() ||
                               false;
            
            console.log('üìã Dokument-Upload gestartet:', {
                fileName: file.name,
                fileSize: file.size,
                category: category,
                isLoggedIn: isLoggedIn
            });
            
            // Warnung wenn User eingeloggt ist, aber Upload-Scripts fehlen
            if (isLoggedIn && !window.smartMediaUpload && !window.awsMedia?.uploadDocument) {
                console.error('‚ùå User ist eingeloggt, aber Upload-Scripts fehlen!');
                showToast('Upload-System nicht verf√ºgbar. Bitte Seite neu laden.', 'error');
                element.closest('.document-category-modal').remove();
                return;
            }
            
            try {
                const now = new Date().toISOString();
                const docId = `doc_${Date.now().toString(36)}`;
                const documentData = {
                    id: docId,
                    name: file.name,
                    size: file.size,
                    fileType: file.type,
                    category,
                    createdAt: now,
                    updatedAt: now
                };
                
                // Hole User-ID - versuche verschiedene Quellen
                let userId = 'anonymous';
                try {
                    const user = window.awsAuth?.getCurrentUser?.() || window.realUserAuth?.getCurrentUser?.();
                    if (user) {
                        userId = user.userId || user.id || user.email || user.sub || 'anonymous';
                    }
                    // Fallback: Versuche aus localStorage
                    if (userId === 'anonymous') {
                        const profile = JSON.parse(localStorage.getItem('bewerbungsmanager_profile') || '{}');
                        userId = profile.userId || profile.id || profile.email || 'anonymous';
                    }
                    // Fallback: Versuche aus unifiedProfileService
                    if (userId === 'anonymous' && window.unifiedProfileService) {
                        const profile = window.unifiedProfileService.getProfileData();
                        userId = profile?.userId || profile?.id || profile?.email || 'anonymous';
                    }
                    console.log('üë§ User-ID f√ºr Upload:', userId);
                } catch (userError) {
                    console.warn('‚ö†Ô∏è Fehler beim Abrufen der User-ID:', userError);
                    userId = 'anonymous';
                }
                
                let uploadError = null;
                let uploadSuccess = false;
                
                // 1. Versuche Smart Media Upload (beste Option)
                if (window.smartMediaUpload) {
                    try {
                        const categoryMap = {
                            'certificates': 'certificate',
                            'awards': 'certificate',
                            'work': 'document'
                        };
                        const uploadCategory = categoryMap[category] || 'certificate';
                        
                        console.log('üì§ Starte Smart Media Upload:', { 
                            fileName: file.name, 
                            fileSize: file.size, 
                            fileType: file.type,
                            category: uploadCategory,
                            userId: userId 
                        });
                        
                        showToast('Upload l√§uft...', 'info');
                        
                        const result = await window.smartMediaUpload.upload(file, {
                            category: uploadCategory,
                            userId: userId,
                            onProgress: (progress) => {
                                console.log(`Upload Progress: ${progress}% - ${file.name}`);
                            },
                            onError: (error) => {
                                console.error('‚ùå Smart Media Upload Error Callback:', error);
                            }
                        });
                        
                        console.log('üì• Smart Media Upload Result:', result);
                        
                        if (result && result.url) {
                            documentData.url = result.url;
                            documentData.storage = result.uploadMethod === 'AWS S3' ? 's3' : 'local';
                            documentData.s3Url = result.s3Url || null;
                            documentData.base64 = result.base64 || null;
                            uploadSuccess = true;
                            console.log('‚úÖ Smart Media Upload erfolgreich:', {
                                url: result.url,
                                method: result.uploadMethod,
                                storage: documentData.storage
                            });
                        } else {
                            throw new Error('Upload erfolgreich, aber keine URL erhalten');
                        }
                    } catch (error) {
                        uploadError = error;
                        console.error('‚ùå Smart Media Upload fehlgeschlagen:', {
                            error: error.message,
                            stack: error.stack,
                            fileName: file.name,
                            fileSize: file.size
                        });
                        console.warn('Versuche Fallback...');
                    }
                } else {
                    console.warn('‚ö†Ô∏è smartMediaUpload nicht verf√ºgbar');
                }
                
                // 2. Fallback: awsMedia.uploadDocument
                if (!uploadSuccess && window.awsMedia?.uploadDocument) {
                    try {
                        const fileType = category === 'work' ? 'document' : 'certificate';
                        console.log('üì§ Versuche AWS Media Upload Fallback:', { fileType, userId });
                        
                        const uploadResult = await window.awsMedia.uploadDocument(file, userId, fileType);
                        
                        if (uploadResult && uploadResult.publicUrl) {
                            documentData.url = uploadResult.publicUrl;
                            documentData.storage = 's3';
                            documentData.s3Key = uploadResult.key || null;
                            uploadSuccess = true;
                            console.log('‚úÖ AWS Media Upload erfolgreich:', uploadResult.publicUrl);
                        } else {
                            throw new Error('Upload erfolgreich, aber keine publicUrl erhalten');
                        }
                    } catch (error) {
                        uploadError = error;
                        console.error('‚ùå AWS Media Upload fehlgeschlagen:', {
                            error: error.message,
                            stack: error.stack,
                            fileName: file.name
                        });
                        console.warn('Versuche lokalen Fallback...');
                    }
                } else if (!uploadSuccess) {
                    console.warn('‚ö†Ô∏è awsMedia.uploadDocument nicht verf√ºgbar');
                }
                
                // 3. Fallback: Lokaler Speicher (NUR wenn User NICHT eingeloggt ist)
                // isLoggedIn wurde bereits am Anfang der Funktion deklariert
                
                if (!uploadSuccess) {
                    // WICHTIG: Wenn User eingeloggt ist, KEIN lokaler Fallback!
                    if (isLoggedIn) {
                        const errorMsg = uploadError 
                            ? `Cloud-Upload fehlgeschlagen: ${uploadError.message || 'Unbekannter Fehler'}. Bitte versuchen Sie es erneut oder kontaktieren Sie den Support.`
                            : 'Cloud-Upload fehlgeschlagen. Bitte versuchen Sie es erneut.';
                        console.error('‚ùå Upload fehlgeschlagen f√ºr angemeldeten User:', {
                            error: uploadError,
                            fileName: file.name,
                            fileSize: file.size,
                            userId: userId,
                            smartMediaUploadAvailable: !!window.smartMediaUpload,
                            awsMediaAvailable: !!window.awsMedia,
                            apiBase: window.AWS_APP_CONFIG?.MEDIA_API_BASE || window.AWS_APP_CONFIG?.API_BASE || 'Nicht konfiguriert'
                        });
                        showToast(errorMsg, 'error');
                        element.closest('.document-category-modal').remove();
                        return; // ABBRUCH - kein lokaler Fallback f√ºr angemeldete User!
                    }
                    
                    // Nur f√ºr NICHT eingeloggte User: Lokaler Fallback
                    console.log('‚ÑπÔ∏è User nicht eingeloggt - verwende lokalen Speicher als Fallback');
                    
                    // localStorage Limit ist ca. 5-10MB, aber wir nehmen 5MB als sicher
                    const maxLocalSize = 5 * 1024 * 1024; // 5MB
                    
                    if (file.size > maxLocalSize) {
                        const errorMsg = uploadError 
                            ? `Upload fehlgeschlagen: ${uploadError.message || 'Unbekannter Fehler'}. Datei ist zu gro√ü f√ºr lokalen Speicher (max. 5MB). Bitte melden Sie sich an f√ºr Cloud-Upload.`
                            : 'PDF zu gro√ü f√ºr lokalen Speicher (max. 5MB). Bitte melden Sie sich an f√ºr Cloud-Upload.';
                        showToast(errorMsg, 'error');
                        element.closest('.document-category-modal').remove();
                        return;
                    }
                    
                    // readFileAsDataURL ist in dashboard-core.js definiert
                    // Falls nicht verf√ºgbar, hier definieren
                    const readFileAsDataURL = window.readFileAsDataURL || function(file) {
                        return new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = () => resolve(reader.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(file);
                        });
                    };
                    
                    try {
                        const dataUrl = await readFileAsDataURL(file);
                        documentData.dataUrl = dataUrl;
                        documentData.storage = 'local';
                        console.log('‚úÖ Dokument lokal gespeichert (User nicht eingeloggt)');
                    } catch (readError) {
                        console.error('Fehler beim Lesen der Datei:', readError);
                        showToast('Fehler beim Lesen der Datei. Bitte versuchen Sie es erneut.', 'error');
                        element.closest('.document-category-modal').remove();
                        return;
                    }
                }
                
                // Save metadata to cloud - IMMER wenn eingeloggt
                // isLoggedIn wurde bereits am Anfang der Funktion deklariert
                
                if (isLoggedIn) {
                    // WICHTIG: Wenn User eingeloggt ist, MUSS Cloud-Speicherung funktionieren
                    if (documentData.storage !== 's3' && !documentData.url) {
                        const errorMsg = 'Cloud-Upload fehlgeschlagen. Bitte versuchen Sie es erneut oder kontaktieren Sie den Support.';
                        console.error('‚ùå Cloud-Upload fehlgeschlagen f√ºr angemeldeten User:', {
                            documentData,
                            fileName: file.name
                        });
                        showToast(errorMsg, 'error');
                        element.closest('.document-category-modal').remove();
                        return; // ABBRUCH - kein lokaler Fallback!
                    }
                    
                    try {
                        await window.cloudDataService.saveDocument(documentData);
                        console.log('‚úÖ Dokument-Metadaten in Cloud gespeichert');
                    } catch (cloudError) {
                        console.error('‚ùå Cloud-Speichern der Metadaten fehlgeschlagen:', cloudError);
                        // KEIN lokaler Fallback f√ºr Metadaten bei angemeldeten Usern!
                        showToast('Fehler beim Speichern der Metadaten. Bitte versuchen Sie es erneut.', 'error');
                        element.closest('.document-category-modal').remove();
                        return;
                    }
                } else {
                    // Nicht eingeloggt: nur lokal
                    console.log('‚ÑπÔ∏è User nicht eingeloggt - speichere nur lokal');
                    const documents = JSON.parse(localStorage.getItem('user_certificates') || '[]');
                    documents.push(documentData);
                    localStorage.setItem('user_certificates', JSON.stringify(documents));
                }
                
                element.closest('.document-category-modal').remove();
                await loadSavedDocuments();
                
                // Stats aktualisieren
                if (typeof updateDashboardStats === 'function') {
                    await updateDashboardStats();
                }
                
                // Erfolgsmeldung basierend auf Storage-Typ
                if (isLoggedIn && documentData.storage === 's3') {
                    showToast('Dokument erfolgreich in Cloud gespeichert!', 'success');
                } else if (!isLoggedIn && documentData.storage === 'local') {
                    showToast('Dokument lokal gespeichert. Melden Sie sich an f√ºr Cloud-Speicherung.', 'info');
                } else {
                    // Sollte nicht passieren bei angemeldeten Usern
                    if (isLoggedIn) {
                        showToast('Fehler: Dokument konnte nicht in Cloud gespeichert werden.', 'error');
                    } else {
                        showToast('Dokument gespeichert!', 'success');
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Document save error:', {
                    error: error.message,
                    stack: error.stack,
                    fileName: file?.name,
                    fileSize: file?.size,
                    userId: userId
                });
                
                // Detaillierte Fehlermeldung
                let errorMsg = 'Fehler beim Speichern';
                if (error.message) {
                    errorMsg += ': ' + error.message;
                }
                if (error.message && error.message.includes('zu gro√ü')) {
                    errorMsg += ' Bitte verwenden Sie eine kleinere Datei oder kontaktieren Sie den Support.';
                } else if (error.message && (error.message.includes('NetworkError') || error.message.includes('Failed to fetch'))) {
                    errorMsg += ' Netzwerkfehler. Bitte √ºberpr√ºfen Sie Ihre Internetverbindung.';
                } else if (error.message && error.message.includes('API Endpoint')) {
                    errorMsg += ' Server-Konfigurationsfehler. Bitte kontaktieren Sie den Support.';
                }
                
                showToast(errorMsg, 'error');
                
                // Modal nicht schlie√üen bei Fehler, damit User es erneut versuchen kann
                // element.closest('.document-category-modal')?.remove();
            } finally {
                // Cleanup
                window.pendingDocumentFile = null;
            }
        };
        
        async function loadSavedDocuments() {
            let documents = [];
            try {
                if (window.cloudDataService && window.cloudDataService.isUserLoggedIn()) {
                    documents = await window.cloudDataService.getDocuments(true);
                } else {
                    documents = JSON.parse(localStorage.getItem('user_certificates') || '[]');
                }
            } catch (error) {
                console.warn('Dokumente konnten nicht geladen werden:', error);
                documents = JSON.parse(localStorage.getItem('user_certificates') || '[]');
            }
            
            // Sync local cache for view/download actions
            localStorage.setItem('user_certificates', JSON.stringify(documents || []));
            
            // Stats aktualisieren
            if (typeof updateDashboardStats === 'function') {
                await updateDashboardStats();
            }
            
            const categories = {
                certificates: 'documentsCertificates',
                awards: 'documentsAwards',
                work: 'documentsWork'
            };
            
            const emptyStates = {
                certificates: 'noCertificates',
                awards: 'noAwards',
                work: 'noWorkDocs'
            };
            
            const grouped = { certificates: [], awards: [], work: [] };
            documents.forEach(doc => {
                const cat = doc.category || doc.type || 'certificates';
                if (!grouped[cat]) grouped[cat] = [];
                grouped[cat].push(doc);
            });
            
            Object.entries(categories).forEach(([cat, containerId]) => {
                const container = document.getElementById(containerId);
                const emptyState = document.getElementById(emptyStates[cat]);
                if (!container) return;
                
                const docs = grouped[cat] || [];
                
                if (docs.length === 0) {
                    if (emptyState) emptyState.style.display = 'block';
                    container.innerHTML = '';
                    return;
                }
                
                if (emptyState) emptyState.style.display = 'none';
                
                container.innerHTML = docs.map(doc => `
                    <div class="document-item" data-id="${doc.id}">
                        <div class="document-info">
                            <i class="fas fa-file-pdf"></i>
                            <div class="document-details">
                                <h4>${doc.name}</h4>
                                <span>${formatFileSize(doc.size)} ‚Ä¢ ${new Date(doc.updatedAt || doc.createdAt).toLocaleDateString('de-DE')}</span>
                            </div>
                        </div>
                        <div class="document-actions">
                            <button onclick="viewDocument('${cat}', '${doc.id}')" title="Ansehen">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button onclick="downloadDocument('${cat}', '${doc.id}')" title="Herunterladen">
                                <i class="fas fa-download"></i>
                            </button>
                            <button onclick="deleteDocument('${cat}', '${doc.id}')" class="btn-danger" title="L√∂schen">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `).join('');
            });
        }
        
        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }
        
        window.viewDocument = function(category, id) {
            const documents = JSON.parse(localStorage.getItem('user_certificates') || '[]');
            const doc = documents.find(d => d.id === id);
            if (!doc) return;
            
            const url = doc.url || doc.dataUrl;
            if (!url) return;
            
            const win = window.open();
            win.document.write(`<iframe src="${url}" style="width:100%;height:100%;border:none;"></iframe>`);
        };
        
        window.downloadDocument = function(category, id) {
            const documents = JSON.parse(localStorage.getItem('user_certificates') || '[]');
            const doc = documents.find(d => d.id === id);
            if (!doc) return;
            
            const url = doc.url || doc.dataUrl;
            if (!url) return;
            
            const a = document.createElement('a');
            a.href = url;
            a.download = doc.name;
            a.click();
        };
        
        window.deleteDocument = async function(category, id) {
            if (!confirm('Dokument wirklich l√∂schen?')) return;
            
            if (window.cloudDataService && window.cloudDataService.isUserLoggedIn()) {
                await window.cloudDataService.deleteDocument(id);
            }
            
            let documents = JSON.parse(localStorage.getItem('user_certificates') || '[]');
            documents = documents.filter(d => d.id !== id);
            localStorage.setItem('user_certificates', JSON.stringify(documents));
            
            // Cloud l√∂schen
            if (window.cloudDataService && window.cloudDataService.isUserLoggedIn()) {
                try {
                    await window.cloudDataService.deleteDocument(id);
                } catch (error) {
                    console.warn('Cloud-L√∂schen fehlgeschlagen:', error);
                }
            }
            
            await loadSavedDocuments();
            
            // Stats aktualisieren
            if (typeof updateDashboardStats === 'function') {
                await updateDashboardStats();
            }
            
            showToast('Dokument gel√∂scht', 'success');
        };
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // DASHBOARD STATISTIKEN
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // HINWEIS: updateDashboardStats ist jetzt in dashboard-core.js definiert
        // und wird als window.updateDashboardStats exportiert
    </script>
</body>
</html>

