<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anschreiben-Editor - Bewerbungsmanager</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="css/applications-main.css">
    <link rel="stylesheet" href="css/cover-letter-editor.css?v=20260114designer">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Lato:wght@300;400;700&family=Merriweather:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="../images/manuel-weiss-portrait.jpg" alt="Manuel Weiss" class="nav-logo">
                <span class="nav-title">Manuel Weiss</span>
            </div>
            
            <button class="mobile-hamburger" id="mobileHamburger" aria-label="Menü öffnen">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <div class="nav-menu">
                <a href="../index.html" class="nav-link">Start</a>
                <a href="index.html" class="nav-link active">Bewerbungsmanager</a>
                <a href="../user-profile.html" class="nav-link">Profil</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="cover-letter-editor">
        <!-- Header -->
        <div class="editor-header">
            <a href="dashboard.html" class="btn-back">
                <i class="fas fa-arrow-left"></i> Zurück
            </a>
            <div class="editor-title">
                <h1><i class="fas fa-envelope-open-text"></i> Anschreiben-Editor</h1>
                <p>Erstellen Sie überzeugende Anschreiben mit KI-Unterstützung</p>
            </div>
            <div class="editor-actions">
                <button id="saveBtn" class="btn-icon" title="Speichern">
                    <i class="fas fa-save"></i>
                </button>
                <button id="versionsBtn" class="btn-icon" title="Versionen">
                    <i class="fas fa-layer-group"></i>
                </button>
                <button id="exportTxtBtn" class="btn-icon" title="Als Text exportieren">
                    <i class="fas fa-file-lines"></i>
                </button>
                <button id="exportPdfBtn" class="btn-icon" title="Als PDF exportieren">
                    <i class="fas fa-file-pdf"></i>
                </button>
            </div>
        </div>

        <!-- Editor Layout -->
        <div class="editor-layout">
            <!-- Left Panel: Job Info & Options -->
            <aside class="editor-sidebar">
                <!-- Existing Cover Letters -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-layer-group"></i> Vorhandene Anschreiben</h3>
                    <div class="form-group">
                        <label>Auswahl</label>
                        <select id="coverLetterSelect">
                            <option value="">Bitte auswählen</option>
                        </select>
                    </div>
                    <button id="loadCoverLetterBtn" class="btn-secondary btn-block" type="button">
                        <i class="fas fa-folder-open"></i> Anschreiben laden
                    </button>
                </div>

                <!-- Job Information -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-briefcase"></i> Stelleninformationen</h3>
                    <form id="jobInfoForm">
                        <div class="form-group">
                            <label>Position *</label>
                            <input type="text" name="jobTitle" id="jobTitle" placeholder="z.B. Frontend Developer" required>
                        </div>
                        <div class="form-group">
                            <label>Unternehmen *</label>
                            <input type="text" name="companyName" id="companyName" placeholder="z.B. TechCorp GmbH" required>
                        </div>
                        <div class="form-group">
                            <label>Branche</label>
                            <select name="industry" id="industry">
                                <option value="">Bitte wählen</option>
                                <option value="IT">IT / Software</option>
                                <option value="Finance">Finanzen / Banking</option>
                                <option value="Healthcare">Gesundheitswesen</option>
                                <option value="Consulting">Beratung</option>
                                <option value="Manufacturing">Fertigung / Industrie</option>
                                <option value="Retail">Einzelhandel</option>
                                <option value="Marketing">Marketing / Werbung</option>
                                <option value="Education">Bildung</option>
                                <option value="Other">Sonstiges</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ansprechpartner</label>
                            <input type="text" name="contactPerson" id="contactPerson" placeholder="z.B. Frau Müller">
                        </div>
                        <div class="form-group">
                            <label>Stellenbeschreibung *</label>
                            <textarea name="jobDescription" id="jobDescription" rows="4" placeholder="Fügen Sie relevante Anforderungen ein..." required></textarea>
                        </div>
                    </form>
                </div>

                <!-- Generation Options -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-sliders-h"></i> Optionen</h3>
                    
                    <div class="option-group">
                        <label>Tonalität</label>
                        <div class="option-buttons">
                            <button type="button" class="option-btn" data-option="tone" data-value="formal">
                                <i class="fas fa-user-tie"></i> Formal
                            </button>
                            <button type="button" class="option-btn active" data-option="tone" data-value="modern">
                                <i class="fas fa-rocket"></i> Modern
                            </button>
                            <button type="button" class="option-btn" data-option="tone" data-value="creative">
                                <i class="fas fa-palette"></i> Kreativ
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <label>Länge</label>
                        <div class="option-buttons">
                            <button type="button" class="option-btn" data-option="length" data-value="short">Kurz</button>
                            <button type="button" class="option-btn active" data-option="length" data-value="medium">Mittel</button>
                            <button type="button" class="option-btn" data-option="length" data-value="long">Lang</button>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <label>Schwerpunkt</label>
                        <div class="option-buttons">
                            <button type="button" class="option-btn active" data-option="focus" data-value="experience">Erfahrung</button>
                            <button type="button" class="option-btn" data-option="focus" data-value="skills">Skills</button>
                            <button type="button" class="option-btn" data-option="focus" data-value="motivation">Motivation</button>
                        </div>
                    </div>
                </div>

                <!-- Placeholder Helpers -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-brackets-curly"></i> Platzhalter</h3>
                    <div class="placeholder-grid">
                        <button type="button" class="placeholder-btn" data-placeholder="{{companyName}}">Firma</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{jobTitle}}">Position</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{contactPerson}}">Ansprechperson</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{firstName}}">Vorname</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{lastName}}">Nachname</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{location}}">Standort</button>
                    </div>
                </div>

                <!-- Generate Button -->
                <button id="generateBtn" class="btn-generate">
                    <i class="fas fa-magic"></i> Anschreiben generieren
                </button>
            </aside>

            <!-- Main Editor Area -->
            <div class="editor-main">
                <!-- Loading Animation -->
                <div id="loadingAnimation" class="loading-animation" style="display: none;">
                    <div class="loading-content">
                        <div class="loading-spinner">
                            <i class="fas fa-brain fa-spin"></i>
                        </div>
                        <h3>KI generiert Ihr Anschreiben...</h3>
                        <p>Analysiere Stellenbeschreibung und erstelle personalisiertes Anschreiben</p>
                        <div class="loading-progress">
                            <div class="loading-bar"></div>
                        </div>
                    </div>
                </div>

                <!-- Editor Content -->
                <div id="editorContent" class="editor-content">
                    <!-- Empty State -->
                    <div id="emptyState" class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-envelope-open-text"></i>
                        </div>
                        <h3>Noch kein Anschreiben erstellt</h3>
                        <p>Füllen Sie die Stelleninformationen aus und klicken Sie auf "Anschreiben generieren"</p>
                        <div class="empty-hints">
                            <div class="hint-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Tipp: Je detaillierter die Stellenbeschreibung, desto besser das Anschreiben</span>
                            </div>
                            <div class="hint-item">
                                <i class="fas fa-user"></i>
                                <span>Ihr Profil wird automatisch einbezogen</span>
                            </div>
                        </div>
                    </div>

                    <!-- Generated Letter -->
                    <div id="generatedLetter" class="generated-letter" style="display: none;">
                        <!-- Letter Header -->
                        <div class="letter-header">
                            <div class="letter-sender">
                                <span id="senderName">Max Mustermann</span>
                                <span id="senderAddress">Musterstraße 1, 12345 Musterstadt</span>
                                <span id="senderContact">max@example.com | +49 123 456789</span>
                            </div>
                            <div class="letter-date" id="letterDate"></div>
                        </div>

                        <!-- Letter Recipient -->
                        <div class="letter-recipient">
                            <span id="companyNameDisplay"></span>
                            <span id="contactPersonDisplay"></span>
                        </div>

                        <!-- Letter Subject -->
                        <div class="letter-subject">
                            <strong>Betreff:</strong> <span id="subjectLine"></span>
                        </div>

                        <!-- Letter Body -->
                        <div class="letter-body">
                            <textarea id="letterText" placeholder="Ihr Anschreiben wird hier angezeigt..."></textarea>
                        </div>

                        <!-- Letter Footer -->
                        <div class="letter-footer">
                            <span>Mit freundlichen Grüßen</span>
                        <img id="signatureImage" alt="Unterschrift" style="display:none;">
                            <span id="signatureName"></span>
                        </div>
                    </div>
                </div>

                <!-- Editor Toolbar -->
                <div id="editorToolbar" class="editor-toolbar" style="display: none;">
                    <div class="toolbar-left">
                        <button class="toolbar-btn" onclick="formatText('bold')" title="Fett">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button class="toolbar-btn" onclick="formatText('italic')" title="Kursiv">
                            <i class="fas fa-italic"></i>
                        </button>
                        <div class="toolbar-divider"></div>
                        <button class="toolbar-btn" onclick="regenerateParagraph()" title="Absatz neu generieren">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="toolbar-btn" onclick="improveSelected()" title="Auswahl verbessern">
                            <i class="fas fa-magic"></i>
                        </button>
                    </div>
                    <div class="toolbar-right">
                        <span class="word-count">
                            <i class="fas fa-file-word"></i>
                            <span id="wordCount">0</span> Wörter
                        </span>
                        <span class="char-count">
                            <i class="fas fa-text-width"></i>
                            <span id="charCount">0</span> Zeichen
                        </span>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Design Options -->
            <aside class="editor-design-panel" id="designPanel">
                <h3><i class="fas fa-palette"></i> Design</h3>
                
                <!-- Letter Styles -->
                <div class="design-section">
                    <label>Stil</label>
                    <div class="style-options">
                        <button class="style-btn active" data-style="modern">
                            <span class="style-preview modern-preview"></span>
                            <span>Modern</span>
                        </button>
                        <button class="style-btn" data-style="classic">
                            <span class="style-preview classic-preview"></span>
                            <span>Klassisch</span>
                        </button>
                        <button class="style-btn" data-style="minimal">
                            <span class="style-preview minimal-preview"></span>
                            <span>Minimal</span>
                        </button>
                    </div>
                </div>

                <!-- Font Selection -->
                <div class="design-section">
                    <label>Schriftart</label>
                    <select id="fontSelect" class="design-select">
                        <option value="Inter">Inter (Modern)</option>
                        <option value="Roboto">Roboto</option>
                        <option value="Lato">Lato</option>
                        <option value="Merriweather">Merriweather (Klassisch)</option>
                        <option value="Arial">Arial</option>
                        <option value="Times New Roman">Times New Roman</option>
                    </select>
                </div>

                <!-- Color Theme -->
                <div class="design-section">
                    <label>Farbschema</label>
                    <div class="color-options">
                        <button class="color-btn active" data-color="#6366f1" style="background: #6366f1;"></button>
                        <button class="color-btn" data-color="#3b82f6" style="background: #3b82f6;"></button>
                        <button class="color-btn" data-color="#10b981" style="background: #10b981;"></button>
                        <button class="color-btn" data-color="#8b5cf6" style="background: #8b5cf6;"></button>
                        <button class="color-btn" data-color="#1e293b" style="background: #1e293b;"></button>
                        <button class="color-btn" data-color="#ef4444" style="background: #ef4444;"></button>
                    </div>
                </div>

                <!-- Font Size -->
                <div class="design-section">
                    <label>Schriftgröße</label>
                    <div class="slider-group">
                        <input type="range" id="fontSizeSlider" min="10" max="14" value="11" step="0.5">
                        <span id="fontSizeValue">11pt</span>
                    </div>
                </div>

                <!-- Line Height -->
                <div class="design-section">
                    <label>Zeilenabstand</label>
                    <div class="slider-group">
                        <input type="range" id="lineHeightSlider" min="1.2" max="2.0" value="1.6" step="0.1">
                        <span id="lineHeightValue">1.6</span>
                    </div>
                </div>

                <!-- Margin -->
                <div class="design-section">
                    <label>Seitenrand</label>
                    <div class="slider-group">
                        <input type="range" id="marginSlider" min="15" max="35" value="25" step="1">
                        <span id="marginValue">25mm</span>
                    </div>
                </div>

                <!-- Paragraph Spacing -->
                <div class="design-section">
                    <label>Absatz-Abstand</label>
                    <div class="slider-group">
                        <input type="range" id="paragraphSpacingSlider" min="4" max="20" value="10" step="1">
                        <span id="paragraphSpacingValue">10px</span>
                    </div>
                </div>

                <!-- Signature Spacing -->
                <div class="design-section">
                    <label>Signatur-Abstand</label>
                    <div class="slider-group">
                        <input type="range" id="signatureSpacingSlider" min="10" max="60" value="32" step="2">
                        <span id="signatureSpacingValue">32px</span>
                    </div>
                </div>

                <!-- Signature Upload -->
                <div class="design-section">
                    <label>Signatur (optional)</label>
                    <input type="file" id="signatureUpload" accept="image/*">
                    <button type="button" class="btn-secondary" id="removeSignatureBtn" style="margin-top:0.5rem;">Signatur entfernen</button>
                </div>

                <!-- Match CV Design -->
                <div class="design-section">
                    <label>Design übernehmen</label>
                    <button type="button" class="btn-secondary" id="syncCvDesignBtn">
                        <i class="fas fa-link"></i> CV-Design übernehmen
                    </button>
                </div>

                <!-- Quality Checks -->
                <div class="design-section">
                    <label>Qualitätscheck</label>
                    <div id="qualityCheckList" class="quality-check-list"></div>
                </div>

                <!-- Structure Editor -->
                <div class="design-section">
                    <label>Struktur</label>
                    <button type="button" class="btn-secondary" id="openBlocksEditor">
                        <i class="fas fa-layer-group"></i> Absätze als Blöcke bearbeiten
                    </button>
                </div>
            </aside>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Blocks Editor Modal -->
    <div id="blocksEditorModal" class="blocks-editor-modal">
        <div class="blocks-editor-content">
            <div class="blocks-editor-header">
                <h2><i class="fas fa-layer-group"></i> Absatz-Editor</h2>
                <button type="button" class="blocks-editor-close" id="closeBlocksEditor">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="blocks-editor-body">
                <div id="blocksContainer" class="blocks-container"></div>
                <button type="button" class="btn-secondary" id="addBlockBtn">
                    <i class="fas fa-plus"></i> Absatz hinzufügen
                </button>
            </div>
            <div class="blocks-editor-footer">
                <button type="button" class="btn-secondary" id="cancelBlocksBtn">Abbrechen</button>
                <button type="button" class="btn-primary" id="saveBlocksBtn">Übernehmen</button>
            </div>
        </div>
    </div>

    <!-- Versions Modal -->
    <div id="coverLetterVersionsModal" class="blocks-editor-modal">
        <div class="blocks-editor-content">
            <div class="blocks-editor-header">
                <h2><i class="fas fa-layer-group"></i> Versionen</h2>
                <button type="button" class="blocks-editor-close" id="closeVersionsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="blocks-editor-body">
                <div class="resume-versions-create">
                    <input type="text" id="coverLetterVersionName" placeholder="Versionsname (z.B. Sales, Tech, Consulting)">
                    <button type="button" class="btn-primary" id="saveCoverLetterVersion">
                        <i class="fas fa-save"></i> Version speichern
                    </button>
                </div>
                <div id="coverLetterVersionsList" class="resume-versions-list"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/unified-aws-auth.js?v=20260113"></script>
    <script src="../js/aws-profile-api.js?v=20260113"></script>
    <script src="../js/aws-api-settings.js?v=20260113"></script>
    <script src="../js/global-api-manager.js?v=20260113"></script>
    <script src="../js/cloud-data-service.js?v=20260113"></script>
    <script src="js/cover-letter-editor.js?v=20260114designer"></script>
    
    <!-- Mobile Menu Script -->
    <script>
        (function() {
            const mobileHamburger = document.getElementById('mobileHamburger');
            const navMenu = document.querySelector('.nav-menu');
            
            if (mobileHamburger && navMenu) {
                mobileHamburger.addEventListener('click', () => {
                    mobileHamburger.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });
            }
        })();
    </script>
</body>
</html>
