<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <title>Anschreiben-Editor - Bewerbungsmanager</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="css/applications-main.css">
    <link rel="stylesheet" href="css/cover-letter-editor.css?v=20260115editable">
    <link rel="stylesheet" href="css/inline-suggestions.css?v=20260115">
    <link rel="stylesheet" href="css/job-match.css?v=20260115">
    <link rel="stylesheet" href="css/split-view.css?v=20260115">
    <link rel="stylesheet" href="css/collaboration.css?v=20260115">
    <link rel="manifest" href="../manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;500;600;700&family=Lato:wght@300;400;700&family=Montserrat:wght@300;400;500;600;700&family=Merriweather:wght@300;400;700&family=Nunito:wght@300;400;500;600;700&family=Source+Sans+Pro:wght@300;400;600;700&family=Source+Code+Pro:wght@400;500;600&family=Playfair+Display:wght@400;500;600;700&family=Poppins:wght@300;400;500;600;700&family=Quicksand:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;700&family=Cormorant+Garamond:wght@400;500;600;700&family=Libre+Baskerville:wght@400;700&family=Crimson+Pro:wght@400;500;600;700&family=Cinzel:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Fira+Code:wght@400;500;600&family=Dancing+Script:wght@400;500;600;700&family=Great+Vibes&family=Pacifico&family=Satisfy&family=Allura&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="../images/manuel-weiss-portrait.jpg" alt="Manuel Weiss" class="nav-logo">
                <span class="nav-title">Manuel Weiss</span>
            </div>
            
            <button class="mobile-hamburger" id="mobileHamburger" aria-label="Men√º √∂ffnen">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            
            <div class="nav-menu">
                <a href="../index.html" class="nav-link">Start</a>
                <a href="index.html" class="nav-link active">Bewerbungsmanager</a>
                <a href="../user-profile.html" class="nav-link">Profil</a>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="cover-letter-editor">
        <!-- Header -->
        <div class="editor-header">
            <a href="dashboard.html" class="btn-back">
                <i class="fas fa-arrow-left"></i> Zur√ºck
            </a>
            <div class="editor-title">
                <h1><i class="fas fa-envelope-open-text"></i> Anschreiben-Editor</h1>
                <p>Erstellen Sie √ºberzeugende Anschreiben mit KI-Unterst√ºtzung</p>
            </div>
            <div class="editor-actions">
                <button id="saveBtn" class="btn-icon" title="Speichern">
                    <i class="fas fa-save"></i>
                </button>
                <button id="versionsBtn" class="btn-icon" title="Versionen">
                    <i class="fas fa-layer-group"></i>
                </button>
                <button id="exportTxtBtn" class="btn-icon" title="Als Text exportieren">
                    <i class="fas fa-file-lines"></i>
                </button>
                <button id="exportPdfBtn" class="btn-icon" title="Als PDF exportieren">
                    <i class="fas fa-file-pdf"></i>
                </button>
            </div>
        </div>

        <!-- Mobile Overlay -->
        <div class="mobile-overlay" id="mobileOverlay"></div>
        
        <!-- Mobile Sidebar Toggle -->
        <button class="mobile-sidebar-toggle" id="mobileSidebarToggle" style="display: none;">
            <i class="fas fa-sliders-h"></i>
        </button>
        
        <!-- Mobile Quick Actions -->
        <div class="mobile-quick-actions" id="mobileQuickActions" style="display: none;">
            <button class="mobile-quick-btn" id="mobileGenerateBtn" title="KI generieren">
                <i class="fas fa-magic"></i>
            </button>
            <button class="mobile-quick-btn primary" id="mobileSaveBtn" title="Speichern">
                <i class="fas fa-save"></i>
            </button>
        </div>

        <!-- Editor Layout -->
        <div class="editor-layout">
            <!-- Left Panel: Job Info & Options -->
            <aside class="editor-sidebar" id="editorSidebar">
                <!-- Existing Cover Letters -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-layer-group"></i> Vorhandene Anschreiben</h3>
                    <div class="form-group">
                        <label>Auswahl</label>
                        <select id="coverLetterSelect">
                            <option value="">Bitte ausw√§hlen</option>
                        </select>
                    </div>
                    <button id="loadCoverLetterBtn" class="btn-secondary btn-block" type="button">
                        <i class="fas fa-folder-open"></i> Anschreiben laden
                    </button>
                </div>

                <!-- Job Information -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-briefcase"></i> Stelleninformationen</h3>
                    <form id="jobInfoForm">
                        <div class="form-group">
                            <label>Position *</label>
                            <input type="text" name="jobTitle" id="jobTitle" placeholder="z.B. Frontend Developer" required>
                        </div>
                        <div class="form-group">
                            <label>Unternehmen *</label>
                            <input type="text" name="companyName" id="companyName" placeholder="z.B. TechCorp GmbH" required>
                            <button type="button" class="btn-secondary btn-inline" id="searchCompanyAddressBtn">
                                <i class="fas fa-search"></i> Adresse recherchieren
                            </button>
                        </div>
                        <div class="form-group" id="companyAddressGroup" style="display: none;">
                            <label>Firmenadresse</label>
                            <textarea name="companyAddress" id="companyAddress" rows="3" placeholder="Stra√üe, PLZ Ort"></textarea>
                            <small style="display: block; margin-top: 0.25rem; color: var(--cl-text-muted); font-size: 0.75rem;">
                                Automatisch gefunden - Bitte √ºberpr√ºfen und ggf. anpassen
                            </small>
                        </div>
                        <div class="form-group">
                            <label>Branche</label>
                            <select name="industry" id="industry">
                                <option value="">Bitte w√§hlen</option>
                                <option value="IT">IT / Software</option>
                                <option value="Finance">Finanzen / Banking</option>
                                <option value="Healthcare">Gesundheitswesen</option>
                                <option value="Consulting">Beratung</option>
                                <option value="Manufacturing">Fertigung / Industrie</option>
                                <option value="Retail">Einzelhandel</option>
                                <option value="Marketing">Marketing / Werbung</option>
                                <option value="Education">Bildung</option>
                                <option value="Other">Sonstiges</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Land / Best Practices</label>
                            <select name="country" id="countrySelect">
                                <option value="DE" selected>üá©üá™ Deutschland</option>
                                <option value="CH">üá®üá≠ Schweiz</option>
                                <option value="AT">üá¶üáπ √ñsterreich</option>
                                <option value="US">üá∫üá∏ USA</option>
                            </select>
                            <small style="display: block; margin-top: 0.25rem; color: var(--cl-text-muted); font-size: 0.75rem;">
                                Passt Datum, Gru√üformel und Formatierung automatisch an
                            </small>
                        </div>
                        <div class="form-group">
                            <label>Ansprechpartner</label>
                            <input type="text" name="contactPerson" id="contactPerson" placeholder="z.B. Frau M√ºller">
                    <button type="button" class="btn-secondary btn-inline" id="suggestContactBtn">
                        <i class="fas fa-wand-magic-sparkles"></i> Ansprechperson vorschlagen
                    </button>
                        </div>
                        <div class="form-group">
                            <label>Stellenbeschreibung *</label>
                            <textarea name="jobDescription" id="jobDescription" rows="4" placeholder="F√ºgen Sie relevante Anforderungen ein..." required></textarea>
                        </div>
                    </form>
                </div>

                <!-- Generation Options -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-sliders-h"></i> Optionen</h3>
                    
                    <div class="option-group">
                        <label>Tonalit√§t</label>
                        <div class="option-buttons">
                            <button type="button" class="option-btn" data-option="tone" data-value="formal">
                                <i class="fas fa-user-tie"></i> Formal
                            </button>
                            <button type="button" class="option-btn active" data-option="tone" data-value="modern">
                                <i class="fas fa-rocket"></i> Modern
                            </button>
                            <button type="button" class="option-btn" data-option="tone" data-value="creative">
                                <i class="fas fa-palette"></i> Kreativ
                            </button>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <label>L√§nge</label>
                        <div class="option-buttons">
                            <button type="button" class="option-btn" data-option="length" data-value="short">Kurz</button>
                            <button type="button" class="option-btn active" data-option="length" data-value="medium">Mittel</button>
                            <button type="button" class="option-btn" data-option="length" data-value="long">Lang</button>
                        </div>
                    </div>
                    
                    <div class="option-group">
                        <label>Schwerpunkt</label>
                        <div class="option-buttons">
                            <button type="button" class="option-btn active" data-option="focus" data-value="experience">Erfahrung</button>
                            <button type="button" class="option-btn" data-option="focus" data-value="skills">Skills</button>
                            <button type="button" class="option-btn" data-option="focus" data-value="motivation">Motivation</button>
                        </div>
                    </div>

                <div class="option-group">
                    <label>Ziel-Modus</label>
                    <div class="option-buttons">
                        <button type="button" class="option-btn active" data-option="goal" data-value="role-fit">Rollen-Fit</button>
                        <button type="button" class="option-btn" data-option="goal" data-value="impact">Impact</button>
                        <button type="button" class="option-btn" data-option="goal" data-value="leadership">Leadership</button>
                        <button type="button" class="option-btn" data-option="goal" data-value="tech-depth">Tech-Depth</button>
                    </div>
                </div>
                </div>

                <!-- Placeholder Helpers -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-brackets-curly"></i> Platzhalter</h3>
                    <div class="placeholder-grid">
                        <button type="button" class="placeholder-btn" data-placeholder="{{companyName}}">Firma</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{jobTitle}}">Position</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{contactPerson}}">Ansprechperson</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{firstName}}">Vorname</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{lastName}}">Nachname</button>
                        <button type="button" class="placeholder-btn" data-placeholder="{{location}}">Standort</button>
                    </div>
                </div>

                <!-- Branchen-Template Section -->
                <div class="sidebar-section">
                    <h3><i class="fas fa-industry"></i> Branchen-Template</h3>
                    <select id="industryTemplateSelect" class="form-select">
                        <option value="">Standard</option>
                        <option value="IT">IT / Software</option>
                        <option value="Finance">Finanzen / Banking</option>
                        <option value="Consulting">Beratung</option>
                        <option value="Healthcare">Gesundheitswesen</option>
                    </select>
                </div>

                <!-- Generate Buttons -->
                <div class="sidebar-section generate-section">
                    <button id="generateBtn" class="btn-generate" onclick="if(window.coverLetterEditor){window.coverLetterEditor.generateCoverLetter();} else {console.error('CoverLetterEditor nicht initialisiert');}">
                        <i class="fas fa-magic"></i> Anschreiben generieren
                    </button>
                    
                    <button id="skillGapBtn" class="btn-skill-gap" onclick="if(window.coverLetterEditor){window.coverLetterEditor.startSkillGapAnalysis();} else {console.error('CoverLetterEditor nicht initialisiert');}">
                        <i class="fas fa-chart-bar"></i> Skill Gap Analyse
                    </button>
                    <p class="skill-gap-hint">
                        <i class="fas fa-info-circle"></i>
                        Analysiert Anforderungen vs. deine Skills und erstellt ein ma√ügeschneidertes Anschreiben
                    </p>
                </div>
            </aside>

            <!-- Main Editor Area -->
            <div class="editor-main">
                <!-- Loading Animation -->
                <div id="loadingAnimation" class="loading-animation" style="display: none;">
                    <div class="loading-content">
                        <div class="loading-spinner">
                            <i class="fas fa-brain fa-spin"></i>
                        </div>
                        <h3>KI generiert Ihr Anschreiben...</h3>
                        <p>Analysiere Stellenbeschreibung und erstelle personalisiertes Anschreiben</p>
                        <div class="loading-progress">
                            <div class="loading-bar"></div>
                        </div>
                    </div>
                </div>

                <!-- Editor Content -->
                <div id="editorContent" class="editor-content">
                    <!-- Empty State -->
                    <div id="emptyState" class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-envelope-open-text"></i>
                        </div>
                        <h3>Noch kein Anschreiben erstellt</h3>
                        <p>F√ºllen Sie die Stelleninformationen aus und klicken Sie auf "Anschreiben generieren"</p>
                        <div class="empty-hints">
                            <div class="hint-item">
                                <i class="fas fa-lightbulb"></i>
                                <span>Tipp: Je detaillierter die Stellenbeschreibung, desto besser das Anschreiben</span>
                            </div>
                            <div class="hint-item">
                                <i class="fas fa-user"></i>
                                <span>Ihr Profil wird automatisch einbezogen</span>
                            </div>
                        </div>
                    </div>

                    <!-- Generated Letter -->
                    <div id="generatedLetter" class="generated-letter" style="display: none;">
                        <!-- Page Container with Page Break Indicator -->
                        <div class="letter-page-container">
                            <!-- Letter Header -->
                            <div class="letter-header">
                                <div class="letter-sender">
                                    <!-- Mehrzeiliger Adressblock -->
                                    <span id="senderName" contenteditable="true" class="editable-field sender-name" data-placeholder="Vorname Nachname">Vorname Nachname</span>
                                    <span id="senderStreet" contenteditable="true" class="editable-field sender-street" data-placeholder="Stra√üe Hausnummer">Stra√üe Hausnummer</span>
                                    <span id="senderCity" contenteditable="true" class="editable-field sender-city" data-placeholder="PLZ Ort">PLZ Ort</span>
                                    <span id="senderContact" contenteditable="true" class="editable-field sender-contact" data-placeholder="E-Mail | Telefon">E-Mail | Telefon</span>
                                </div>
                                <div class="letter-date-container">
                                    <span id="letterLocation" contenteditable="true" class="editable-field letter-location" data-placeholder=""><!-- Ort, optional --></span>
                                    <span id="letterDate" contenteditable="true" class="editable-field"></span>
                                </div>
                            </div>

                            <!-- Letter Recipient (Company Address) - Mehrzeilig -->
                            <div class="letter-recipient">
                                <span id="companyNameDisplay" contenteditable="true" class="editable-field company-name" placeholder="Firmenname inkl. Rechtsform">Firmenname GmbH</span>
                                <span id="companyStreetDisplay" contenteditable="true" class="editable-field company-street" placeholder="Stra√üe Hausnummer">Stra√üe Hausnummer</span>
                                <span id="companyLocationDisplay" contenteditable="true" class="editable-field company-location" placeholder="Land - PLZ Ort">CH - 8000 Z√ºrich</span>
                                <span id="contactPersonDisplay" contenteditable="true" class="editable-field contact-person" placeholder="z.Hd. Ansprechpartner"></span>
                            </div>

                            <!-- Letter Subject -->
                            <div class="letter-subject">
                                <span class="subject-label">Betreff:</span> 
                                <input type="text" id="subjectLine" class="subject-input" placeholder="Bewerbung als...">
                            </div>

                            <!-- Letter Salutation (Anrede) - wird von KI generiert -->
                            <div class="letter-salutation">
                                <input type="text" id="greetingSalutation" value="" class="greeting-salutation-input" placeholder="Anrede wird von KI generiert...">
                            </div>

                            <!-- Letter Body - ohne Scrollbar -->
                            <div class="letter-body" id="letterBody">
                                <div id="letterText" class="letter-text-content" contenteditable="true" data-placeholder="Ihr Anschreiben wird hier angezeigt..."></div>
                            </div>

                            <!-- Page Break Indicator -->
                            <div class="page-break-indicator" id="pageBreakIndicator">
                                <span>--- Seitenumbruch (Seite 2) ---</span>
                            </div>

                            <!-- Letter Footer -->
                            <div class="letter-footer">
                                <input type="text" id="greetingText" value="Mit freundlichen Gr√º√üen" class="greeting-input" placeholder="Gru√üformel">
                                <div class="signature-container" id="signatureContainer">
                                    <img id="signatureImage" alt="Unterschrift" class="signature-image" style="display:none; cursor: move; user-select: none;" draggable="false">
                                    <input type="text" id="signatureName" class="signature-name-input" placeholder="Ihr Name">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Editor Toolbar -->
                <div id="editorToolbar" class="editor-toolbar" style="display: none;">
                    <div class="toolbar-left">
                        <button class="toolbar-btn" onclick="formatText('bold')" title="Fett">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button class="toolbar-btn" onclick="formatText('italic')" title="Kursiv">
                            <i class="fas fa-italic"></i>
                        </button>
                        <div class="toolbar-divider"></div>
                        <button class="toolbar-btn" onclick="regenerateParagraph()" title="Absatz neu generieren">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                        <button class="toolbar-btn" onclick="improveSelected()" title="Auswahl verbessern">
                            <i class="fas fa-magic"></i>
                        </button>
                        <div class="toolbar-divider"></div>
                        <!-- √úbersetzungs-Dropdown -->
                        <div class="translate-dropdown">
                            <button class="toolbar-btn translate-btn" id="translateBtn" title="Anschreiben √ºbersetzen">
                                <i class="fas fa-language"></i>
                                <span>√úbersetzen</span>
                                <i class="fas fa-chevron-down" style="font-size: 0.7rem; margin-left: 4px;"></i>
                            </button>
                            <div class="translate-dropdown-menu" id="translateMenu">
                                <div class="translate-menu-header">In Sprache √ºbersetzen:</div>
                                <button data-lang="en" data-country="UK">üá¨üáß English (UK)</button>
                                <button data-lang="en" data-country="US">üá∫üá∏ English (US)</button>
                                <button data-lang="de" data-country="DE">üá©üá™ Deutsch</button>
                                <button data-lang="de" data-country="CH">üá®üá≠ Deutsch (CH)</button>
                                <button data-lang="de" data-country="AT">üá¶üáπ Deutsch (AT)</button>
                                <button data-lang="fr" data-country="FR">üá´üá∑ Fran√ßais</button>
                                <button data-lang="it" data-country="IT">üáÆüáπ Italiano</button>
                                <button data-lang="es" data-country="ES">üá™üá∏ Espa√±ol</button>
                                <button data-lang="pt" data-country="PT">üáµüáπ Portugu√™s</button>
                                <button data-lang="nl" data-country="NL">üá≥üá± Nederlands</button>
                                <button data-lang="pl" data-country="PL">üáµüá± Polski</button>
                                <button data-lang="sv" data-country="SE">üá∏üá™ Svenska</button>
                                <button data-lang="da" data-country="DK">üá©üá∞ Dansk</button>
                                <button data-lang="no" data-country="NO">üá≥üá¥ Norsk</button>
                                <button data-lang="fi" data-country="FI">üá´üáÆ Suomi</button>
                                <button data-lang="cs" data-country="CZ">üá®üáø ƒåe≈°tina</button>
                                <button data-lang="hu" data-country="HU">üá≠üá∫ Magyar</button>
                                <button data-lang="el" data-country="GR">üá¨üá∑ ŒïŒªŒªŒ∑ŒΩŒπŒ∫Œ¨</button>
                            </div>
                        </div>
                    </div>
                    <div class="toolbar-right">
                        <span class="word-count">
                            <i class="fas fa-file-word"></i>
                            <span id="wordCount">0</span> W√∂rter
                        </span>
                        <span class="char-count">
                            <i class="fas fa-text-width"></i>
                            <span id="charCount">0</span> Zeichen
                        </span>
                    </div>
                </div>
            </div>

            <!-- Right Panel: Design Options -->
            <aside class="editor-design-panel" id="designPanel">
                <h3><i class="fas fa-palette"></i> Design</h3>
                
                <!-- Letter Styles -->
                <div class="design-section">
                    <label>Stil</label>
                    <div class="style-options">
                        <button class="style-btn active" data-style="modern">
                            <span class="style-preview modern-preview"></span>
                            <span>Modern</span>
                        </button>
                        <button class="style-btn" data-style="classic">
                            <span class="style-preview classic-preview"></span>
                            <span>Klassisch</span>
                        </button>
                        <button class="style-btn" data-style="minimal">
                            <span class="style-preview minimal-preview"></span>
                            <span>Minimal</span>
                        </button>
                        <button class="style-btn" data-style="elegant">
                            <span class="style-preview elegant-preview"></span>
                            <span>Elegant</span>
                        </button>
                        <button class="style-btn" data-style="creative">
                            <span class="style-preview creative-preview"></span>
                            <span>Kreativ</span>
                        </button>
                        <button class="style-btn" data-style="corporate">
                            <span class="style-preview corporate-preview"></span>
                            <span>Corporate</span>
                        </button>
                    </div>
                </div>

                <!-- Font Selection - Synchron mit Lebenslauf -->
                <div class="design-section">
                    <label>Schriftart</label>
                    <select id="fontSelect" class="design-select">
                        <optgroup label="Sans-Serif (Modern)">
                            <option value="Inter" selected>Inter (Modern)</option>
                            <option value="Roboto">Roboto</option>
                            <option value="Open Sans">Open Sans</option>
                            <option value="Lato">Lato</option>
                            <option value="Montserrat">Montserrat</option>
                            <option value="Nunito">Nunito</option>
                            <option value="Source Sans Pro">Source Sans Pro</option>
                            <option value="Poppins">Poppins</option>
                            <option value="Quicksand">Quicksand</option>
                            <option value="DM Sans">DM Sans</option>
                        </optgroup>
                        <optgroup label="Serif (Klassisch)">
                            <option value="Merriweather">Merriweather</option>
                            <option value="Playfair Display">Playfair Display</option>
                            <option value="Cormorant Garamond">Cormorant Garamond</option>
                            <option value="Libre Baskerville">Libre Baskerville</option>
                            <option value="Crimson Pro">Crimson Pro</option>
                            <option value="Cinzel">Cinzel</option>
                        </optgroup>
                        <optgroup label="Monospace (Technisch)">
                            <option value="Source Code Pro">Source Code Pro</option>
                            <option value="JetBrains Mono">JetBrains Mono</option>
                            <option value="Fira Code">Fira Code</option>
                        </optgroup>
                        <optgroup label="System-Fonts">
                            <option value="Arial">Arial</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Helvetica Neue">Helvetica Neue</option>
                        </optgroup>
                    </select>
                </div>

                <!-- Color Theme - Erweitert -->
                <div class="design-section">
                    <label>Farbschema</label>
                    <div class="color-options" style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px;">
                        <!-- Professional -->
                        <button class="color-btn active" data-color="#6366f1" style="background: #6366f1;" title="Indigo"></button>
                        <button class="color-btn" data-color="#3b82f6" style="background: #3b82f6;" title="Blau"></button>
                        <button class="color-btn" data-color="#0891b2" style="background: #0891b2;" title="Cyan"></button>
                        <button class="color-btn" data-color="#059669" style="background: #059669;" title="Smaragd"></button>
                        <button class="color-btn" data-color="#10b981" style="background: #10b981;" title="Gr√ºn"></button>
                        <button class="color-btn" data-color="#84cc16" style="background: #84cc16;" title="Lime"></button>
                        <!-- Creative -->
                        <button class="color-btn" data-color="#8b5cf6" style="background: #8b5cf6;" title="Violett"></button>
                        <button class="color-btn" data-color="#a855f7" style="background: #a855f7;" title="Lila"></button>
                        <button class="color-btn" data-color="#ec4899" style="background: #ec4899;" title="Pink"></button>
                        <button class="color-btn" data-color="#f43f5e" style="background: #f43f5e;" title="Rose"></button>
                        <button class="color-btn" data-color="#ef4444" style="background: #ef4444;" title="Rot"></button>
                        <button class="color-btn" data-color="#f97316" style="background: #f97316;" title="Orange"></button>
                        <!-- Neutral -->
                        <button class="color-btn" data-color="#1e293b" style="background: #1e293b;" title="Slate"></button>
                        <button class="color-btn" data-color="#374151" style="background: #374151;" title="Grau"></button>
                        <button class="color-btn" data-color="#78716c" style="background: #78716c;" title="Stone"></button>
                        <button class="color-btn" data-color="#a16207" style="background: #a16207;" title="Amber"></button>
                        <button class="color-btn" data-color="#dc2626" style="background: #dc2626;" title="Schweizer Rot"></button>
                        <button class="color-btn" data-color="#fbbf24" style="background: #fbbf24;" title="Gold"></button>
                    </div>
                    <!-- Custom Color Picker -->
                    <div style="display: flex; align-items: center; gap: 8px; margin-top: 8px;">
                        <input type="color" id="customColorPicker" value="#6366f1" style="width: 36px; height: 28px; border: none; cursor: pointer; border-radius: 4px;">
                        <input type="text" id="customColorHex" value="#6366f1" class="design-select" style="flex: 1; font-family: monospace; font-size: 0.8rem;" placeholder="#HEX">
                    </div>
                </div>

                <!-- Header & Adress-Einstellungen - WICHTIG: Ganz oben! -->
                <div class="design-section" style="background: rgba(99,102,241,0.05); border-radius: 8px; padding: 12px; margin: -8px -8px 16px -8px;">
                    <label style="color: var(--cl-primary);">üìç Kopfbereich & Adressen</label>
                    <div class="header-settings">
                        <div class="slider-group" style="margin-bottom: 8px;">
                            <span style="font-size: 0.75rem; min-width: 100px;">Header-Abstand</span>
                            <input type="range" id="headerTopMarginSlider" min="0" max="30" value="0" step="1">
                            <span id="headerTopMarginValue">0mm</span>
                        </div>
                        <div class="slider-group" style="margin-bottom: 8px;">
                            <span style="font-size: 0.75rem; min-width: 100px;">Empf√§nger-Abstand</span>
                            <input type="range" id="recipientTopMarginSlider" min="0" max="50" value="20" step="1">
                            <span id="recipientTopMarginValue">20mm</span>
                        </div>
                        <div class="slider-group" style="margin-bottom: 8px;">
                            <span style="font-size: 0.75rem; min-width: 100px;">Betreff-Abstand oben</span>
                            <input type="range" id="subjectMarginTopSlider" min="5" max="30" value="15" step="1">
                            <span id="subjectMarginTopValue">15mm</span>
                        </div>
                        <div class="slider-group">
                            <span style="font-size: 0.75rem; min-width: 100px;">Betreff-Abstand unten</span>
                            <input type="range" id="subjectMarginBottomSlider" min="5" max="25" value="10" step="1">
                            <span id="subjectMarginBottomValue">10mm</span>
                        </div>
                    </div>
                </div>
                
                <!-- Datum-Einstellungen -->
                <div class="design-section" style="background: rgba(16,185,129,0.05); border-radius: 8px; padding: 12px; margin: -8px -8px 16px -8px;">
                    <label style="color: #10b981;">üìÖ Datum</label>
                    <div class="date-settings">
                        <div class="slider-group" style="margin-bottom: 8px;">
                            <span style="font-size: 0.75rem; min-width: 100px;">Format</span>
                            <select id="dateFormatSelect" class="design-select" style="flex: 1;">
                                <option value="de-long">20. Januar 2026</option>
                                <option value="de-short">20.01.2026</option>
                                <option value="ch">20. Januar 2026</option>
                                <option value="at">20. J√§nner 2026</option>
                                <option value="en-uk">20 January 2026</option>
                                <option value="en-us">January 20, 2026</option>
                                <option value="fr">20 janvier 2026</option>
                                <option value="nl">20 januari 2026</option>
                                <option value="iso">2026-01-20</option>
                            </select>
                        </div>
                        <div class="slider-group" style="margin-bottom: 8px;">
                            <span style="font-size: 0.75rem; min-width: 100px;">Position</span>
                            <select id="datePositionSelect" class="design-select" style="flex: 1;">
                                <option value="top-right">Oben rechts (DE/CH/AT)</option>
                                <option value="top-left">Oben links</option>
                                <option value="below-sender">Unter Absender</option>
                                <option value="above-recipient">√úber Empf√§nger</option>
                            </select>
                        </div>
                        <div class="slider-group">
                            <span style="font-size: 0.75rem; min-width: 100px;">Datum-H√∂he</span>
                            <input type="range" id="dateTopOffsetSlider" min="0" max="50" value="0" step="1">
                            <span id="dateTopOffsetValue">0mm</span>
                        </div>
                        <div class="slider-group" style="margin-top: 8px;">
                            <label style="font-size: 0.75rem; display: flex; align-items: center; gap: 6px;">
                                <input type="checkbox" id="dateIncludeLocation" style="width: auto;">
                                <span>Ort vor Datum (z.B. "Z√ºrich, 20.01.2026")</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Text-Formatierung -->
                <div class="design-section" style="background: rgba(245,158,11,0.05); border-radius: 8px; padding: 12px; margin: -8px -8px 16px -8px;">
                    <label style="color: #f59e0b;">‚úèÔ∏è Text-Formatierung</label>
                    <div class="text-format-settings">
                        <div class="format-option" style="margin-bottom: 8px;">
                            <label style="font-size: 0.75rem; display: flex; align-items: center; gap: 6px;">
                                <input type="checkbox" id="senderNameBold" checked style="width: auto;">
                                <span>Absender-Name fett</span>
                            </label>
                        </div>
                        <div class="format-option" style="margin-bottom: 8px;">
                            <label style="font-size: 0.75rem; display: flex; align-items: center; gap: 6px;">
                                <input type="checkbox" id="companyNameBold" style="width: auto;">
                                <span>Firmenname fett</span>
                            </label>
                        </div>
                        <div class="format-option" style="margin-bottom: 8px;">
                            <label style="font-size: 0.75rem; display: flex; align-items: center; gap: 6px;">
                                <input type="checkbox" id="subjectBold" checked style="width: auto;">
                                <span>Betreff fett</span>
                            </label>
                        </div>
                        <div class="format-option">
                            <label style="font-size: 0.75rem; display: flex; align-items: center; gap: 6px;">
                                <input type="checkbox" id="signatureNameBold" style="width: auto;">
                                <span>Unterschrift-Name fett</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Font Size -->
                <div class="design-section">
                    <label>Schriftgr√∂√üe</label>
                    <div class="slider-group">
                        <input type="range" id="fontSizeSlider" min="10" max="14" value="11" step="0.5">
                        <span id="fontSizeValue">11pt</span>
                    </div>
                </div>

                <!-- Line Height -->
                <div class="design-section">
                    <label>Zeilenabstand</label>
                    <div class="slider-group">
                        <input type="range" id="lineHeightSlider" min="1.2" max="2.0" value="1.6" step="0.1">
                        <span id="lineHeightValue">1.6</span>
                    </div>
                </div>

                <!-- Margin -->
                <div class="design-section">
                    <label>Seitenrand</label>
                    <div class="slider-group">
                        <input type="range" id="marginSlider" min="15" max="35" value="25" step="1">
                        <span id="marginValue">25mm</span>
                    </div>
                </div>

                <!-- Paragraph Spacing -->
                <div class="design-section">
                    <label>Absatz-Abstand</label>
                    <div class="slider-group">
                        <input type="range" id="paragraphSpacingSlider" min="4" max="20" value="10" step="1">
                        <span id="paragraphSpacingValue">10px</span>
                    </div>
                </div>

                <!-- Signature Spacing -->
                <div class="design-section">
                    <label>Signatur-Abstand</label>
                    <div class="slider-group">
                        <input type="range" id="signatureSpacingSlider" min="10" max="60" value="32" step="2">
                        <span id="signatureSpacingValue">32px</span>
                    </div>
                </div>

                <!-- Signature Section -->
                <div class="design-section signature-section">
                    <label>Signatur (optional)</label>
                    
                    <!-- Signature Tabs -->
                    <div class="signature-method-tabs">
                        <button type="button" class="signature-tab active" data-tab="upload">
                            <i class="fas fa-upload"></i> Hochladen
                        </button>
                        <button type="button" class="signature-tab" data-tab="draw">
                            <i class="fas fa-pen"></i> Zeichnen
                        </button>
                        <button type="button" class="signature-tab" data-tab="generate">
                            <i class="fas fa-magic"></i> Generieren
                        </button>
                    </div>
                    
                    <!-- Upload Tab -->
                    <div id="signatureTabUpload" class="signature-tab-content">
                        <input type="file" id="signatureUpload" accept="image/*">
                        <small style="display: block; margin-top: 0.25rem; color: var(--cl-text-muted); font-size: 0.75rem;">
                            PNG mit transparentem Hintergrund empfohlen
                        </small>
                    </div>
                    
                    <!-- Draw Tab -->
                    <div id="signatureTabDraw" class="signature-tab-content" style="display: none;">
                        <div class="signature-canvas-container">
                            <canvas id="signatureCanvas" width="280" height="100"></canvas>
                            <button type="button" class="clear-signature-btn" id="clearSignatureCanvas" title="L√∂schen">
                                <i class="fas fa-eraser"></i>
                            </button>
                        </div>
                        <button type="button" class="btn-secondary btn-block" id="useDrawnSignature">
                            <i class="fas fa-check"></i> Unterschrift √ºbernehmen
                        </button>
                    </div>
                    
                    <!-- Generate Tab -->
                    <div id="signatureTabGenerate" class="signature-tab-content" style="display: none;">
                        <input type="text" id="signatureNameInput" class="form-input" placeholder="Ihr Name">
                        <select id="signatureStyleSelect" class="form-select" style="margin-top: 8px;">
                            <option value="'Dancing Script', cursive">Elegant</option>
                            <option value="'Great Vibes', cursive">Vibes</option>
                            <option value="'Pacifico', cursive">Pacifico</option>
                            <option value="'Satisfy', cursive">Satisfy</option>
                            <option value="'Allura', cursive">Allura</option>
                        </select>
                        <div id="signatureGeneratePreview" class="signature-preview"></div>
                        <button type="button" class="btn-secondary btn-block" id="useGeneratedSignature" style="margin-top: 8px;">
                            <i class="fas fa-check"></i> Unterschrift √ºbernehmen
                        </button>
                    </div>
                    
                    <!-- Signature Preview -->
                    <div id="signaturePreviewContainer" class="signature-preview-container" style="margin-top: 12px;">
                        <div id="signaturePreview"></div>
                    </div>
                    
                    <button type="button" class="btn-secondary" id="removeSignatureBtn" style="margin-top:0.5rem;">
                        <i class="fas fa-trash"></i> Signatur entfernen
                    </button>
                    
                    <!-- Save to Profile -->
                    <div class="save-signature-option" style="margin-top: 8px;">
                        <label class="checkbox-label" style="display: flex; align-items: center; gap: 8px; font-size: 0.8rem; cursor: pointer;">
                            <input type="checkbox" id="saveSignatureToProfile">
                            <span>Im Profil speichern</span>
                        </label>
                    </div>
                </div>

                <!-- Match CV Design -->
                <div class="design-section">
                    <label>Design √ºbernehmen</label>
                    <button type="button" class="btn-secondary" id="syncCvDesignBtn">
                        <i class="fas fa-link"></i> CV-Design √ºbernehmen
                    </button>
                </div>

                <!-- Quality Checks -->
                <div class="design-section">
                    <label>Qualit√§tscheck</label>
                    <div id="qualityCheckList" class="quality-check-list"></div>
                </div>

                <!-- Structure Editor -->
                <div class="design-section">
                    <label>Struktur</label>
                    <button type="button" class="btn-secondary" id="openBlocksEditor">
                        <i class="fas fa-layer-group"></i> Abs√§tze als Bl√∂cke bearbeiten
                    </button>
                </div>
            </aside>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Blocks Editor Modal -->
    <div id="blocksEditorModal" class="blocks-editor-modal">
        <div class="blocks-editor-content">
            <div class="blocks-editor-header">
                <h2><i class="fas fa-layer-group"></i> Absatz-Editor</h2>
                <button type="button" class="blocks-editor-close" id="closeBlocksEditor">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="blocks-editor-body">
                <div id="blocksContainer" class="blocks-container"></div>
                <div class="blocks-ai-panel">
                    <div class="blocks-ai-title">
                        <i class="fas fa-brain"></i> KI-Absatztools
                    </div>
                    <div class="blocks-ai-hint">W√§hle einen Absatz und erstelle Alternativen oder Verbesserungen.</div>
                    <div class="blocks-ai-actions">
                        <button type="button" class="btn-secondary" data-block-action="alternatives">Alternativen</button>
                        <button type="button" class="btn-secondary" data-block-action="shorten">K√ºrzen</button>
                        <button type="button" class="btn-secondary" data-block-action="expand">Erweitern</button>
                        <button type="button" class="btn-secondary" data-block-action="active">Aktiver</button>
                        <button type="button" class="btn-secondary" data-block-action="concrete">Konkreter</button>
                        <button type="button" class="btn-secondary" data-block-action="proof">Beleg hinzuf√ºgen</button>
                    </div>
                    <div id="blockAiSuggestions" class="blocks-ai-suggestions"></div>
                </div>
                <button type="button" class="btn-secondary" id="addBlockBtn">
                    <i class="fas fa-plus"></i> Absatz hinzuf√ºgen
                </button>
            </div>
            <div class="blocks-editor-footer">
                <button type="button" class="btn-secondary" id="cancelBlocksBtn">Abbrechen</button>
                <button type="button" class="btn-primary" id="saveBlocksBtn">√úbernehmen</button>
            </div>
        </div>
    </div>

    <!-- Versions Modal -->
    <div id="coverLetterVersionsModal" class="blocks-editor-modal">
        <div class="blocks-editor-content">
            <div class="blocks-editor-header">
                <h2><i class="fas fa-layer-group"></i> Versionen</h2>
                <button type="button" class="blocks-editor-close" id="closeVersionsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="blocks-editor-body">
                <div class="resume-versions-create">
                    <input type="text" id="coverLetterVersionName" placeholder="Versionsname (z.B. Sales, Tech, Consulting)">
                    <button type="button" class="btn-primary" id="saveCoverLetterVersion">
                        <i class="fas fa-save"></i> Version speichern
                    </button>
                </div>
                <div id="coverLetterVersionsList" class="resume-versions-list"></div>
                <div id="coverLetterVersionDiff" class="resume-version-diff"></div>
            </div>
        </div>
    </div>

    <!-- Skill Gap Analyse Modal -->
    <div id="skillGapModal" class="skill-gap-modal" style="display: none;">
        <div class="skill-gap-content">
            <div class="skill-gap-header">
                <h2><i class="fas fa-chart-bar"></i> Skill Gap Analyse</h2>
                <button type="button" class="close-btn" onclick="window.coverLetterEditor?.closeSkillGapModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="skill-gap-body">
                <!-- Progress Steps -->
                <div class="skill-gap-steps">
                    <div class="step active" data-step="1">
                        <div class="step-icon"><i class="fas fa-search"></i></div>
                        <span>Anforderungen analysieren</span>
                    </div>
                    <div class="step" data-step="2">
                        <div class="step-icon"><i class="fas fa-user"></i></div>
                        <span>Skills sammeln</span>
                    </div>
                    <div class="step" data-step="3">
                        <div class="step-icon"><i class="fas fa-balance-scale"></i></div>
                        <span>Matching</span>
                    </div>
                    <div class="step" data-step="4">
                        <div class="step-icon"><i class="fas fa-file-alt"></i></div>
                        <span>Anschreiben</span>
                    </div>
                </div>
                
                <!-- Step Content -->
                <div id="skillGapStepContent" class="skill-gap-step-content">
                    <!-- Dynamic content here -->
                    <div class="loading-state">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Analysiere Stellenbeschreibung...</p>
                    </div>
                </div>
                
                <!-- Results Preview -->
                <div id="skillGapResults" class="skill-gap-results" style="display: none;">
                    <h3>Anforderungen vs. Deine Skills</h3>
                    <div id="skillGapTable" class="skill-gap-table">
                        <!-- Dynamic table -->
                    </div>
                </div>
            </div>
            
            <div class="skill-gap-footer">
                <button type="button" class="btn-secondary" onclick="window.coverLetterEditor?.closeSkillGapModal()">
                    Abbrechen
                </button>
                <button type="button" class="btn-primary" id="skillGapGenerateBtn" disabled>
                    <i class="fas fa-magic"></i> Anschreiben generieren
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../js/unified-aws-auth.js?v=20260113"></script>
    <script src="../js/aws-profile-api.js?v=20260113"></script>
    <script src="../js/aws-api-settings.js?v=20260113"></script>
    <script>
        // Sicherstellen dass awsAPISettings initialisiert ist
        if (typeof AWSAPISettingsService !== 'undefined' && !window.awsAPISettings) {
            console.log('üîß Initialisiere awsAPISettings manuell...');
            window.awsAPISettings = new AWSAPISettingsService();
        }
    </script>
    <script src="../js/global-api-manager.js?v=20260113"></script>
    <script src="../js/cloud-data-service.js?v=20260114c"></script>
    <script src="../js/workflow-api.js?v=20260114c"></script>
    <script src="../js/unified-profile-service.js?v=20260115"></script>
    <script src="js/cover-letter-editor.js?v=20260120"></script>
    <!-- KI-Schreibassistent entfernt auf Benutzerwunsch -->
    <!-- Job-Match-Analyzer entfernt wegen Absturz-Problemen -->
    <script src="js/industry-templates.js?v=20260115"></script>
    <script src="js/split-view-editor.js?v=20260115"></script>
    <script src="js/collaboration.js?v=20260115"></script>
    
    <!-- Mobile Menu Script -->
    <script>
        (function() {
            const mobileHamburger = document.getElementById('mobileHamburger');
            const navMenu = document.querySelector('.nav-menu');
            
            if (mobileHamburger && navMenu) {
                mobileHamburger.addEventListener('click', () => {
                    mobileHamburger.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });
            }
            
            // Mobile Sidebar Toggle
            const sidebarToggle = document.getElementById('mobileSidebarToggle');
            const sidebar = document.getElementById('editorSidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            function toggleSidebar() {
                sidebar?.classList.toggle('mobile-open');
                overlay?.classList.toggle('active');
            }
            
            sidebarToggle?.addEventListener('click', toggleSidebar);
            overlay?.addEventListener('click', toggleSidebar);
            
            // Mobile Quick Actions
            document.getElementById('mobileGenerateBtn')?.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();
                console.log('üì± Mobile Generate Button geklickt');
                const generateBtn = document.getElementById('generateBtn');
                if (generateBtn) {
                    generateBtn.click();
                } else {
                    console.error('‚ùå Desktop Generate Button nicht gefunden f√ºr Mobile-Trigger');
                }
            });
            
            document.getElementById('mobileSaveBtn')?.addEventListener('click', () => {
                document.getElementById('saveBtn')?.click();
            });
        })();
    </script>
</body>
</html>
