<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Fähigkeit & Agilität - Organisationsentwicklung Assessment - Manuel Weiss</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Detaillierte Bewertung der change fähigkeit & agilität für Organisationsentwicklung.">
    <meta name="keywords" content="Change Management, Agilität, Organisationsentwicklung">
    <meta name="author" content="Manuel Weiss">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/ki-assessment-detail.css">
    <style>
        .detail-header {
            background: linear-gradient(135deg, #14b8a6 0%, #0d9488 100%);
        }
        
        .criterion-icon {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }
        
        .detail-slider::-webkit-slider-thumb {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }
        
        .detail-slider::-moz-range-thumb {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }
        
        .sub-criterion-slider::-webkit-slider-thumb {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }
        
        .sub-criterion-slider::-moz-range-thumb {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }
        
        .slider-value-display {
            color: #0d9488;
        }
        
        .sub-criterion-value {
            color: #0d9488;
        }
        
        .criterion-average-value {
            color: #0d9488;
        }
        
        .aggregated-score {
            background: linear-gradient(135deg, #14b8a6, #0d9488);
        }
        
        .save-button {
            color: #0d9488;
        }
        
        .criterion-examples {
            border-left: 4px solid #14b8a6;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="manuel-weiss-photo.svg" alt="Manuel Weiss" class="nav-logo">
                <span class="nav-name">Manuel Weiss</span>
            </div>
            <div class="nav-links">
                <a href="index.html">Home</a>
                <a href="hr-transformation.html">HR-Transformation</a>
                <a href="index.html#about">Über mich</a>
                <a href="index.html#contact">Kontakt</a>
            </div>
        </div>
    </nav>
    
    <div class="detail-assessment-container">
        <div class="detail-header">
            <a href="organisationsentwicklung-workflow.html" class="back-button">
                <i class="fas fa-arrow-left"></i>
                Zurück zur Übersicht
            </a>
            <h1><i class="fas fa-sync-alt"></i> Change Fähigkeit & Agilität</h1>
            <p>Bewerten Sie die Change-Fähigkeit und Agilität Ihrer Organisation. Wissenschaftlich fundierte Bewertung basierend auf modernen Change-Management-Prinzipien.</p>
        </div>
        
        <div id="criteriaContainer">
            <!-- Criteria will be dynamically loaded -->
        </div>
        
        <div class="aggregated-score">
            <h3>Gesamtbewertung</h3>
            <div class="score-display">
                <div class="score-circle-large" id="aggregatedScore">1.0</div>
                <div class="score-description" id="scoreDescription">Bewerten Sie die Kriterien, um Ihre Gesamtbewertung zu sehen</div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; flex-wrap: wrap;">
                <button class="save-button" onclick="saveAndReturn()" style="flex: 1; min-width: 200px;">
                    <i class="fas fa-save"></i> Bewertung speichern und zurück
                </button>
                <button class="export-button excel" onclick="exportToExcel()" style="background: #217346; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; flex: 1; min-width: 150px;">
                    <i class="fas fa-file-excel"></i> Excel Export
                </button>
                <button class="export-button pdf" onclick="exportToPDF()" style="background: #dc3545; color: white; border: none; padding: 1rem 2rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; flex: 1; min-width: 150px;">
                    <i class="fas fa-file-pdf"></i> PDF Export
                </button>
            </div>
        </div>
    </div>
    
    <script>
        const changeAgilityCriteria = [            {
                id: 'changeReadiness',
                title: 'Change-Readiness',
                description: 'Wie ready ist die Organisation für Veränderungen?',
                icon: 'fa-check-circle',
                subCriteria: [
                    { 
                        id: 'changeAwareness', 
                        title: 'Change-Bewusstsein',
                        description: 'Gibt es Change-Bewusstsein?',
                        examples: ['Bewusstsein', 'Awareness', 'Verständnis', 'Sensibilität']
                    },
                    { 
                        id: 'changeCapability', 
                        title: 'Change-Fähigkeiten',
                        description: 'Gibt es Change-Fähigkeiten?',
                        examples: ['Fähigkeiten', 'Kompetenzen', 'Skills', 'Expertise']
                    },
                    { 
                        id: 'changeInfrastructure', 
                        title: 'Change-Infrastruktur',
                        description: 'Gibt es eine Change-Infrastruktur?',
                        examples: ['Infrastruktur', 'Strukturen', 'Prozesse', 'Systeme']
                    },
                    { 
                        id: 'changeResources', 
                        title: 'Change-Ressourcen',
                        description: 'Gibt es Change-Ressourcen?',
                        examples: ['Ressourcen', 'Budget', 'Mitarbeiter', 'Tools']
                    },
                    { 
                        id: 'changeHistory', 
                        title: 'Change-Erfahrung',
                        description: 'Gibt es Change-Erfahrung?',
                        examples: ['Erfahrung', 'Historie', 'Lessons Learned', 'Best Practices']
                    }
                ]
            },
            {
                id: 'changeManagement',
                title: 'Change Management',
                description: 'Wie gut ist Change Management?',
                icon: 'fa-sync-alt',
                subCriteria: [
                    { 
                        id: 'changeMethodology', 
                        title: 'Change-Methodologie',
                        description: 'Gibt es eine Change-Methodologie?',
                        examples: ['Methodologie', 'Framework', 'Prozess', 'Ansatz']
                    },
                    { 
                        id: 'changeProcesses', 
                        title: 'Change-Prozesse',
                        description: 'Gibt es strukturierte Change-Prozesse?',
                        examples: ['Prozesse', 'Struktur', 'Phasen', 'Schritte']
                    },
                    { 
                        id: 'changeTeams', 
                        title: 'Change-Teams',
                        description: 'Gibt es Change-Teams?',
                        examples: ['Teams', 'Change Agents', 'Botschafter', 'Promotoren']
                    },
                    { 
                        id: 'changeTools', 
                        title: 'Change-Tools',
                        description: 'Gibt es Change-Tools?',
                        examples: ['Tools', 'Plattformen', 'Software', 'Technologie']
                    },
                    { 
                        id: 'changeGovernance', 
                        title: 'Change-Governance',
                        description: 'Gibt es Change-Governance?',
                        examples: ['Governance', 'Steuerung', 'Kontrolle', 'Management']
                    }
                ]
            },
            {
                id: 'stakeholderManagement',
                title: 'Stakeholder-Management',
                description: 'Wie gut ist das Stakeholder-Management?',
                icon: 'fa-user-friends',
                subCriteria: [
                    { 
                        id: 'stakeholderMapping', 
                        title: 'Stakeholder-Mapping',
                        description: 'Gibt es Stakeholder-Mapping?',
                        examples: ['Mapping', 'Analyse', 'Identifikation', 'Kategorisierung']
                    },
                    { 
                        id: 'stakeholderEngagement', 
                        title: 'Stakeholder-Engagement',
                        description: 'Wie gut ist das Stakeholder-Engagement?',
                        examples: ['Engagement', 'Einbindung', 'Partizipation', 'Beteiligung']
                    },
                    { 
                        id: 'stakeholderCommunication', 
                        title: 'Stakeholder-Kommunikation',
                        description: 'Wie gut ist die Stakeholder-Kommunikation?',
                        examples: ['Kommunikation', 'Dialog', 'Austausch', 'Information']
                    },
                    { 
                        id: 'resistanceManagement', 
                        title: 'Widerstandsmanagement',
                        description: 'Gibt es Widerstandsmanagement?',
                        examples: ['Widerstand', 'Management', 'Umgang', 'Lösung']
                    },
                    { 
                        id: 'stakeholderAlignment', 
                        title: 'Stakeholder-Alignment',
                        description: 'Gibt es Stakeholder-Alignment?',
                        examples: ['Alignment', 'Ausrichtung', 'Konsens', 'Einigkeit']
                    }
                ]
            },
            {
                id: 'adaptability',
                title: 'Anpassungsfähigkeit',
                description: 'Wie anpassungsfähig ist die Organisation?',
                icon: 'fa-adjust',
                subCriteria: [
                    { 
                        id: 'flexibility', 
                        title: 'Flexibilität',
                        description: 'Wie flexibel ist die Organisation?',
                        examples: ['Flexibilität', 'Anpassung', 'Agilität', 'Beweglichkeit']
                    },
                    { 
                        id: 'rapidResponse', 
                        title: 'Schnelle Reaktionsfähigkeit',
                        description: 'Kann schnell reagiert werden?',
                        examples: ['Schnelligkeit', 'Reaktion', 'Agilität', 'Effizienz']
                    },
                    { 
                        id: 'resilience', 
                        title: 'Resilienz',
                        description: 'Wie resilient ist die Organisation?',
                        examples: ['Resilienz', 'Widerstandsfähigkeit', 'Stärke', 'Robustheit']
                    },
                    { 
                        id: 'pivotCapability', 
                        title: 'Pivot-Fähigkeit',
                        description: 'Kann die Organisation pivoten?',
                        examples: ['Pivot', 'Richtungswechsel', 'Anpassung', 'Flexibilität']
                    },
                    { 
                        id: 'continuousAdaptation', 
                        title: 'Kontinuierliche Anpassung',
                        description: 'Gibt es kontinuierliche Anpassung?',
                        examples: ['Anpassung', 'Evolution', 'Verbesserung', 'Lernen']
                    }
                ]
            },
            {
                id: 'agility',
                title: 'Organisatorische Agilität',
                description: 'Wie agil ist die Organisation?',
                icon: 'fa-bolt',
                subCriteria: [
                    { 
                        id: 'agileStructures', 
                        title: 'Agile Strukturen',
                        description: 'Gibt es agile Strukturen?',
                        examples: ['Strukturen', 'Organisation', 'Framework', 'Methodologie']
                    },
                    { 
                        id: 'agileProcesses', 
                        title: 'Agile Prozesse',
                        description: 'Gibt es agile Prozesse?',
                        examples: ['Prozesse', 'Methoden', 'Praktiken', 'Ansätze']
                    },
                    { 
                        id: 'agileMindset', 
                        title: 'Agiles Mindset',
                        description: 'Gibt es ein agiles Mindset?',
                        examples: ['Mindset', 'Kultur', 'Werte', 'Prinzipien']
                    },
                    { 
                        id: 'iterativeApproach', 
                        title: 'Iterative Arbeitsweise',
                        description: 'Wird iterativ gearbeitet?',
                        examples: ['Iterativ', 'Zyklen', 'Sprints', 'Inkrementell']
                    },
                    { 
                        id: 'agileTools', 
                        title: 'Agile Tools',
                        description: 'Gibt es agile Tools?',
                        examples: ['Tools', 'Plattformen', 'Software', 'Technologie']
                    }
                ]
            },
            {
                id: 'learningFromChange',
                title: 'Lernen aus Veränderungen',
                description: 'Wie gut wird aus Veränderungen gelernt?',
                icon: 'fa-book',
                subCriteria: [
                    { 
                        id: 'lessonsLearned', 
                        title: 'Lessons Learned',
                        description: 'Werden Lessons Learned dokumentiert?',
                        examples: ['Lessons Learned', 'Dokumentation', 'Lernen', 'Erfahrung']
                    },
                    { 
                        id: 'postChangeReview', 
                        title: 'Post-Change Reviews',
                        description: 'Gibt es Post-Change Reviews?',
                        examples: ['Reviews', 'Evaluation', 'Analyse', 'Reflexion']
                    },
                    { 
                        id: 'changeMetrics', 
                        title: 'Change-Metriken',
                        description: 'Gibt es Change-Metriken?',
                        examples: ['Metriken', 'KPIs', 'Messung', 'Tracking']
                    },
                    { 
                        id: 'bestPractices', 
                        title: 'Best Practices',
                        description: 'Gibt es Best Practices?',
                        examples: ['Best Practices', 'Erfolgsfaktoren', 'Lernen', 'Sharing']
                    },
                    { 
                        id: 'continuousImprovement', 
                        title: 'Kontinuierliche Verbesserung',
                        description: 'Gibt es kontinuierliche Verbesserung?',
                        examples: ['Verbesserung', 'Optimierung', 'Evolution', 'Lernen']
                    }
                ]
            },
            {
                id: 'experimentation',
                title: 'Experimentierfreude',
                description: 'Wie experimentierfreudig ist die Organisation?',
                icon: 'fa-flask',
                subCriteria: [
                    { 
                        id: 'experimentCulture', 
                        title: 'Experimentier-Kultur',
                        description: 'Gibt es eine Experimentier-Kultur?',
                        examples: ['Kultur', 'Mindset', 'Werte', 'Normen']
                    },
                    { 
                        id: 'pilotProjects', 
                        title: 'Pilot-Projekte',
                        description: 'Gibt es Pilot-Projekte?',
                        examples: ['Pilot', 'Test', 'Experiment', 'Validierung']
                    },
                    { 
                        id: 'testAndLearn', 
                        title: 'Test & Learn Ansatz',
                        description: 'Gibt es einen Test & Learn Ansatz?',
                        examples: ['Test & Learn', 'Experimente', 'Validierung', 'Lernen']
                    },
                    { 
                        id: 'failFast', 
                        title: 'Fail-Fast Mentalität',
                        description: 'Gibt es eine Fail-Fast Mentalität?',
                        examples: ['Fail-Fast', 'Schnelles Scheitern', 'Lernen', 'Resilienz']
                    },
                    { 
                        id: 'experimentResources', 
                        title: 'Ressourcen für Experimente',
                        description: 'Gibt es Ressourcen für Experimente?',
                        examples: ['Ressourcen', 'Budget', 'Zeit', 'Räume']
                    }
                ]
            },
            {
                id: 'futureOrientation',
                title: 'Zukunftsorientierung',
                description: 'Wie zukunftsorientiert ist die Organisation?',
                icon: 'fa-crystal-ball',
                subCriteria: [
                    { 
                        id: 'trendMonitoring', 
                        title: 'Trend-Monitoring',
                        description: 'Gibt es Trend-Monitoring?',
                        examples: ['Trends', 'Monitoring', 'Beobachtung', 'Analyse']
                    },
                    { 
                        id: 'scenarioPlanning', 
                        title: 'Szenario-Planung',
                        description: 'Gibt es Szenario-Planung?',
                        examples: ['Szenarien', 'Planung', 'Vorausschau', 'Strategie']
                    },
                    { 
                        id: 'futureReadiness', 
                        title: 'Zukunftsfähigkeit',
                        description: 'Wie zukunftsfähig ist die Organisation?',
                        examples: ['Zukunftsfähigkeit', 'Readiness', 'Vorbereitung', 'Strategie']
                    },
                    { 
                        id: 'disruptionAwareness', 
                        title: 'Disruptions-Bewusstsein',
                        description: 'Gibt es Disruptions-Bewusstsein?',
                        examples: ['Disruption', 'Bewusstsein', 'Sensibilität', 'Vorbereitung']
                    },
                    { 
                        id: 'strategicForesight', 
                        title: 'Strategische Vorausschau',
                        description: 'Gibt es strategische Vorausschau?',
                        examples: ['Vorausschau', 'Foresight', 'Antizipation', 'Planung']
                    }
                ]
            },
            {
                id: 'changeCommunication',
                title: 'Change-Kommunikation',
                description: 'Wie gut ist die Change-Kommunikation?',
                icon: 'fa-bullhorn',
                subCriteria: [
                    { 
                        id: 'changeStory', 
                        title: 'Change-Story und Narrative',
                        description: 'Gibt es eine Change-Story?',
                        examples: ['Story', 'Narrative', 'Kommunikation', 'Botschaft']
                    },
                    { 
                        id: 'regularUpdates', 
                        title: 'Regelmäßige Change-Updates',
                        description: 'Gibt es regelmäßige Updates?',
                        examples: ['Updates', 'Kommunikation', 'Information', 'News']
                    },
                    { 
                        id: 'transparentCommunication', 
                        title: 'Transparente Kommunikation',
                        description: 'Ist die Kommunikation transparent?',
                        examples: ['Transparenz', 'Offenheit', 'Ehrlichkeit', 'Kommunikation']
                    },
                    { 
                        id: 'twoWayDialogue', 
                        title: 'Zwei-Wege-Dialog',
                        description: 'Gibt es Zwei-Wege-Dialog?',
                        examples: ['Dialog', 'Austausch', 'Feedback', 'Interaktion']
                    },
                    { 
                        id: 'changeChampions', 
                        title: 'Change Champions und Botschafter',
                        description: 'Gibt es Change Champions?',
                        examples: ['Champions', 'Botschafter', 'Promotoren', 'Treiber']
                    }
                ]
            },
            {
                id: 'changeSustainability',
                title: 'Change-Nachhaltigkeit',
                description: 'Wie nachhaltig sind Veränderungen?',
                icon: 'fa-anchor',
                subCriteria: [
                    { 
                        id: 'changeAnchoring', 
                        title: 'Change-Verankerung',
                        description: 'Werden Veränderungen verankert?',
                        examples: ['Verankerung', 'Nachhaltigkeit', 'Institutionalisierung', 'Kultur']
                    },
                    { 
                        id: 'longTermSuccess', 
                        title: 'Langfristiger Erfolg',
                        description: 'Wie nachhaltig ist der Erfolg?',
                        examples: ['Nachhaltigkeit', 'Langfristigkeit', 'Erfolg', 'Stabilität']
                    },
                    { 
                        id: 'changeReinforcement', 
                        title: 'Change-Verstärkung',
                        description: 'Werden Veränderungen verstärkt?',
                        examples: ['Verstärkung', 'Reinforcement', 'Konsolidierung', 'Stabilisierung']
                    },
                    { 
                        id: 'culturalIntegration', 
                        title: 'Kulturelle Integration',
                        description: 'Werden Veränderungen kulturell integriert?',
                        examples: ['Integration', 'Kultur', 'Werte', 'Normen']
                    },
                    { 
                        id: 'sustainedChange', 
                        title: 'Nachhaltige Veränderungen',
                        description: 'Sind Veränderungen nachhaltig?',
                        examples: ['Nachhaltigkeit', 'Dauerhaftigkeit', 'Stabilität', 'Kontinuität']
                    }
                ]
            }
        ];
        
        let assessmentData = {};
        let assessmentExporter = null;
        
        function initializeAssessment() {
            // Load saved data
            const saved = localStorage.getItem('orgDevDetailAssessments');
            if (saved) {
                const allAssessments = JSON.parse(saved);
                if (allAssessments.changeAgility) {
                    assessmentData = allAssessments.changeAgility;
                }
            }
            
            // Initialize assessment data structure
            changeAgilityCriteria.forEach(criterion => {
                if (!assessmentData[criterion.id]) {
                    assessmentData[criterion.id] = {};
                }
                criterion.subCriteria.forEach(subCriterion => {
                    if (!assessmentData[criterion.id][subCriterion.id]) {
                        assessmentData[criterion.id][subCriterion.id] = 1;
                    }
                });
            });
            
            renderCriteria();
            updateAggregatedScore();
            assessmentExporter = new AssessmentExporter();
        }
        
        function renderCriteria() {
            const container = document.getElementById('criteriaContainer');
            container.innerHTML = '';
            
            changeAgilityCriteria.forEach(criterion => {
                const criterionCard = document.createElement('div');
                criterionCard.className = 'criterion-card';
                
                const averageScore = calculateCriterionAverage(criterion.id);
                
                criterionCard.innerHTML = `
                    <div class="criterion-header">
                        <div class="criterion-icon">
                            <i class="fas ${criterion.icon}"></i>
                        </div>
                        <div class="criterion-title-section">
                            <h3 class="criterion-title">${criterion.title}</h3>
                            <p class="criterion-description">${criterion.description}</p>
                        </div>
                        <div class="criterion-average">
                            <div class="criterion-average-value">${averageScore.toFixed(1)}</div>
                            <div style="font-size: 0.75rem; color: #6b7280;">Durchschnitt</div>
                        </div>
                    </div>
                    
                    <div class="sub-criteria-container">
                        ${criterion.subCriteria.map(subCriterion => {
                            const value = assessmentData[criterion.id][subCriterion.id] || 1;
                            return `
                                <div class="sub-criterion-item">
                                    <div class="sub-criterion-label">
                                        <h4>${subCriterion.title}</h4>
                                        <p>${subCriterion.description}</p>
                                        <div class="criterion-examples">
                                            <strong>Beispiele:</strong>
                                            <ul>
                                                ${subCriterion.examples.map(ex => `<li>${ex}</li>`).join('')}
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="sub-criterion-slider-wrapper">
                                        <input type="range" min="1" max="5" value="${value}" 
                                               class="sub-criterion-slider" 
                                               id="${criterion.id}_${subCriterion.id}"
                                               oninput="updateSubCriterionValue('${criterion.id}', '${subCriterion.id}', this.value)">
                                        <div class="sub-criterion-value">${value}</div>
                                        <div class="sub-criterion-scale">
                                            <span>1</span>
                                            <span>2</span>
                                            <span>3</span>
                                            <span>4</span>
                                            <span>5</span>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                container.appendChild(criterionCard);
            });
        }
        
        function updateSubCriterionValue(criterionId, subCriterionId, value) {
            if (!assessmentData[criterionId]) {
                assessmentData[criterionId] = {};
            }
            assessmentData[criterionId][subCriterionId] = parseInt(value);
            
            const valueDisplay = document.querySelector(`#${criterionId}_${subCriterionId}`).nextElementSibling;
            if (valueDisplay) {
                valueDisplay.textContent = value;
            }
            
            updateCriterionAverage(criterionId);
            updateAggregatedScore();
            saveAssessment();
        }
        
        function calculateCriterionAverage(criterionId) {
            const criterion = changeAgilityCriteria.find(c => c.id === criterionId);
            if (!criterion || !assessmentData[criterionId]) return 1.0;
            
            const values = criterion.subCriteria.map(sub => 
                assessmentData[criterionId][sub.id] || 1
            );
            const sum = values.reduce((acc, val) => acc + val, 0);
            return sum / values.length;
        }
        
        function updateCriterionAverage(criterionId) {
            const average = calculateCriterionAverage(criterionId);
            const criterionCard = document.querySelector(`.criterion-card:has(#${criterionId}_${changeAgilityCriteria.find(c => c.id === criterionId).subCriteria[0].id})`);
            if (criterionCard) {
                const averageDisplay = criterionCard.querySelector('.criterion-average-value');
                if (averageDisplay) {
                    averageDisplay.textContent = average.toFixed(1);
                }
            }
        }
        
        function updateAggregatedScore() {
            const averages = changeAgilityCriteria.map(c => calculateCriterionAverage(c.id));
            const overallAverage = averages.reduce((acc, val) => acc + val, 0) / averages.length;
            
            const scoreDisplay = document.getElementById('aggregatedScore');
            const descriptionDisplay = document.getElementById('scoreDescription');
            
            if (scoreDisplay) {
                scoreDisplay.textContent = overallAverage.toFixed(1);
            }
            
            if (descriptionDisplay) {
                let description = '';
                if (overallAverage <= 1.5) {
                    description = 'Starr und unflexibel - Erhebliche Verbesserung der Change-Fähigkeit nötig';
                } else if (overallAverage <= 2.5) {
                    description = 'Teilweise change-ready - Change-Verbesserungen erforderlich';
                } else if (overallAverage <= 3.5) {
                    description = 'Gut change-ready - Weitere Optimierung möglich';
                } else if (overallAverage <= 4.5) {
                    description = 'Sehr change-ready - Kleine Verbesserungen möglich';
                } else {
                    description = 'Hervorragend change-ready - Agile und anpassungsfähige Organisation';
                }
                descriptionDisplay.textContent = description;
            }
        }
        
        function saveAssessment() {
            const aggregated = parseFloat(changeAgilityCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / changeAgilityCriteria.length).toFixed(1);
            const criterionAverages = changeAgilityCriteria.map(criterion => ({
                criterionId: criterion.id,
                average: calculateCriterionAverage(criterion.id)
            }));
            
            const allAssessments = JSON.parse(localStorage.getItem('orgDevDetailAssessments') || '{}');
            allAssessments.changeAgility = {
                aggregated: parseFloat(aggregated),
                details: assessmentData,
                criteria: assessmentData, // Legacy support
                criterionAverages: criterionAverages,
                timestamp: new Date().toISOString()
            };
            localStorage.setItem('orgDevDetailAssessments', JSON.stringify(allAssessments));
        }
        
        function saveAndReturn() {
            const aggregated = parseFloat(changeAgilityCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / changeAgilityCriteria.length).toFixed(1);
            
            // Save detailed assessment
            saveAssessment();
            
            // Also update main workflow (analog zu HR-Strategieentwicklung)
            let workflowData = JSON.parse(localStorage.getItem('orgDevWorkflow') || '{}');
            if (!workflowData.orgDevMaturityData) workflowData.orgDevMaturityData = {};
            workflowData.orgDevMaturityData.changeAgility = parseFloat(aggregated);
            localStorage.setItem('orgDevWorkflow', JSON.stringify(workflowData));
            
            window.location.href = 'organisationsentwicklung-workflow.html';
        }
        
        async function exportToExcel() {
            if (!assessmentExporter) {
                assessmentExporter = new AssessmentExporter();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            const data = prepareExportData();
            await assessmentExporter.exportToExcel(data, `Organisationsentwicklung-Change-Fähigkeit-&-Agilität-Assessment-${new Date().toISOString().split('T')[0]}`);
        }
        
        async function exportToPDF() {
            if (!assessmentExporter) {
                assessmentExporter = new AssessmentExporter();
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            const data = prepareExportData();
            await assessmentExporter.exportToPDF(data, `Organisationsentwicklung-Change-Fähigkeit-&-Agilität-Assessment-${new Date().toISOString().split('T')[0]}`);
        }
        
        function prepareExportData() {
            const aggregated = parseFloat(changeAgilityCriteria.map(c => calculateCriterionAverage(c.id)).reduce((acc, val) => acc + val, 0) / changeAgilityCriteria.length).toFixed(1);
            
            return {
                dimension: 'changeAgility',
                dimensionName: 'Change Fähigkeit & Agilität',
                overall: parseFloat(aggregated),
                criteria: changeAgilityCriteria.map(criterion => ({
                    id: criterion.id,
                    title: criterion.title,
                    description: criterion.description,
                    average: calculateCriterionAverage(criterion.id),
                    subCriteria: criterion.subCriteria.map(sub => ({
                        id: sub.id,
                        title: sub.title,
                        description: sub.description,
                        examples: sub.examples,
                        score: assessmentData[criterion.id][sub.id] || 1
                    }))
                })),
                timestamp: new Date().toISOString()
            };
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initializeAssessment);
    </script>
    
    <!-- Assessment Export Script -->
    <script src="js/assessment-export.js"></script>
</body>
</html>
