version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "ğŸš€ Preparing Manuel Weiss Multi-User System for Amplify"
        - npm install -g @aws-amplify/cli
        - echo "ğŸ“¦ Installing dependencies..."
        - npm install || echo "No package.json dependencies to install"
    build:
      commands:
        - echo "ğŸ”§ Building Multi-User Frontend..."
        - echo "âœ… Static site - no build required"
        - echo "ğŸ”— Updating API endpoints for production..."
        # Update API endpoints in JavaScript files
        - |
          if [ "$AWS_BRANCH" = "main" ]; then
            echo "ğŸŒ Production deployment - updating API URLs"
            # Get API Gateway URL from CloudFormation
            API_URL=$(aws cloudformation describe-stacks --stack-name manuel-weiss-complete-stack --query 'Stacks[0].Outputs[?OutputKey==`ApiGatewayUrl`].OutputValue' --output text --region eu-central-1)
            echo "ğŸ”— API Gateway URL: $API_URL"
            # Update js/docs.js with real API URL
            sed -i "s|base: '/api'|base: '$API_URL'|g" js/docs.js
            echo "âœ… API endpoints updated for production"
          fi
        - echo "ğŸ¯ Frontend build complete"
    postBuild:
      commands:
        - echo "ğŸ“Š Post-build optimizations..."
        - echo "ğŸ” Verifying all files are present..."
        - ls -la | head -20
        - echo "âœ… Multi-User system ready for deployment"
  artifacts:
    baseDirectory: /
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
